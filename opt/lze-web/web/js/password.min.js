function showlogin(t){switch(ipstatus(),0==logstatus&&0!=t?t=1:1==logstatus&&0==passtatus&&0!=t&&(t=2),t){case 1:enterpass&&document.removeEventListener("keydown",enterpass),enterip=function(t){enter(1,t)},document.addEventListener("keydown",enterip),notify("输入主机"),loginpage.style.display="flex",passbar.style.opacity="",hostbar.style.display="flex",hostbox.style.display="flex",backlogin.style.display="block",setTimeout(function(){loginpage.style.opacity="1",hostbar.style.opacity="1",hostbox.style.opacity="1",passbar.style.display="",backlogin.style.opacity="1"},10);break;case 2:enterip&&document.removeEventListener("keydown",enterip),enterpass=function(t){enter(2,t)},document.addEventListener("keydown",enterpass),notify("输入密码"),hostbar.style.opacity="",hostbox.style.opacity="",loginpage.style.display="flex",passbar.style.display="flex",backlogin.style.display="block",setTimeout(function(){hostbar.style.display="",hostbox.style.display="",loginpage.style.opacity="1",passbar.style.opacity="1",backlogin.style.opacity="1"},10);break;case 3:notify("已登陆"),loginpage.style.display="flex",hostbar.style.display="",passbar.style.display="",hostbox.style.display="",backlogin.style.display="block",setTimeout(function(){loginpage.style.opacity="1",hostbar.style.opacity="",hostbox.style.opacity="",passbar.style.opacity="",backlogin.style.opacity="1"},10);break;case 4:reloadPage();break;case 0:loginpage.style.opacity="",passbar.style.opacity="",hostbar.style.opacity="",hostbox.style.display="",backlogin.style.opacity="",setTimeout(function(){loginpage.style.display="",passbar.style.display="",hostbox.style.opacity="",hostbar.style.display="",backlogin.style.display=""},1e3)}}function enter(t,e){switch(t){case 1:"Enter"===e.key&&(console.log("ip"),addhost());break;case 2:"Enter"===e.key&&(console.log("pass"),sendpass())}enterevent=1}function access(){ip=getip()?getip():window.location.hostname,""==ip?(logstatus=0,showlogin(1)):""!=ip&&(logstatus=1,checklogin(0)),ipstatus()}function sendpass(){const t=btoa(document.getElementById("password").value);fetch(`${protocol}//${ip}/code/auth/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})}).then(t=>t.json()).then(t=>{t.success?(localStorage.setItem(`authToken_${ip}`,t.token),reloadPage()):notify("验证失败: "+t.message)}).catch(t=>console.error("Error:",t))}function logout(){localStorage.removeItem(`authToken_${ip}`),notify("已登出"),reloadPage()}function checklogin(t){token=localStorage.getItem(`authToken_${ip}`);var e=new XMLHttpRequest;e.open("GET",`${protocol}//${ip}/code/auth/check.php`,!0),e.setRequestHeader("Authorization",`Bearer ${token}`),e.onreadystatechange=function(){try{e.readyState===XMLHttpRequest.DONE&&(200===e.status?(passtatus=1,0==t?showlogin(0):1==t&&showlogin(4)):(passtatus=0,loginicon(),showlogin(2)))}catch(t){console.log(t),notify(t)}},e.send()}function loginicon(){root.style.setProperty("--login","url(../../icon/nologin_grey.svg)"),root.style.setProperty("--loginhover","url(../../icon/nologin_white.svg)")}function xmlnologin(t){401===t.status&&(loginicon(),checklogin())}function xmltoken(t){token&&t.setRequestHeader("Authorization",`Bearer ${token}`)}function fetchtoken(){return{method:"GET",headers:{Authorization:"Bearer "+token,"Content-Type":"application/json"}}}function fetchnologin(t){401===t.status&&(loginicon(),checklogin())}function switchip(){logstatus=0,showlogin(1)}function connect(){ip=document.getElementById("ip-input").value,logstatus="1",checklogin(1)}function local(){ip=window.location.hostname,logstatus="1"}function gethost(){const t=localStorage.getItem("host");return t?JSON.parse(t):defaulthost}function savehost(t){localStorage.setItem("host",JSON.stringify(t))}function clearData(){confirm("确定要清空所有数据吗？")&&(localStorage.removeItem("host"),creatlist())}function creatlist(){const t=gethost(),e=document.getElementById("ipList");e.innerHTML="",t.host.forEach((t,o)=>{const s=document.createElement("li");s.className="host-btn",s.innerHTML=`${t} <button class="removehost" onclick="deletehost(${o})"></button>`,s.addEventListener("click",function(){ip=t,logstatus=1,checklogin(1)}),e.appendChild(s)})}function addhost(){logstatus=0;const t=document.getElementById("ip-input"),e=t.value.trim();if(e){const o=gethost();o.host.includes(e)||(o.host.push(e),savehost(o),creatlist()),connect(),t.value=""}else alert("请输入一个有效的 IP 地址。")}function deletehost(t){const e=gethost();e.host.splice(t,1),savehost(e),creatlist()}function ipstatus(){document.getElementById("ip-status").innerText=ip,"undefined"!=typeof ishome&&ishome&&(document.getElementById("ip-li").innerText=ip)}const loginpage=document.getElementById("login-page"),passbar=document.getElementById("pass-bar"),hostbar=document.getElementById("host-bar"),hostbox=document.getElementById("host-box");let password,ip,logstatus,passtatus;const login=document.getElementById("login"),root=document.documentElement;let token,enterpass=null,enterip=null;const defaulthost={host:[]};creatlist();