function showlogin(status){switch(ipstatus(),0==logstatus&&0!=status?status=1:1==logstatus&&0==passtatus&&0!=status&&(status=2),status){case 1:enterpass&&document.removeEventListener("keydown",enterpass),enterip=function(event){enter(1,event)},document.addEventListener("keydown",enterip),notify("输入主机"),loginpage.style.display="flex",passbar.style.opacity="",hostbar.style.display="flex",hostbox.style.display="flex",backlogin.style.display="block",setTimeout(function(){loginpage.style.opacity="1",hostbar.style.opacity="1",hostbox.style.opacity="1",passbar.style.display="",backlogin.style.opacity="1"},10);break;case 2:enterip&&document.removeEventListener("keydown",enterip),enterpass=function(event){enter(2,event)},document.addEventListener("keydown",enterpass),notify("输入密码"),hostbar.style.opacity="",hostbox.style.opacity="",loginpage.style.display="flex",passbar.style.display="flex",backlogin.style.display="block",setTimeout(function(){hostbar.style.display="",hostbox.style.display="",loginpage.style.opacity="1",passbar.style.opacity="1",backlogin.style.opacity="1"},10);break;case 3:notify("已登陆"),loginpage.style.display="flex",hostbar.style.display="",passbar.style.display="",hostbox.style.display="",backlogin.style.display="block",setTimeout(function(){loginpage.style.opacity="1",hostbar.style.opacity="",hostbox.style.opacity="",passbar.style.opacity="",backlogin.style.opacity="1"},10);break;case 4:reloadPage();break;case 0:loginpage.style.opacity="",passbar.style.opacity="",hostbar.style.opacity="",hostbox.style.display="",backlogin.style.opacity="",setTimeout(function(){loginpage.style.display="",passbar.style.display="",hostbox.style.opacity="",hostbar.style.display="",backlogin.style.display=""},1e3)}}function enter(status,event){switch(status){case 1:"Enter"===event.key&&(console.log("ip"),addhost());break;case 2:"Enter"===event.key&&(console.log("pass"),sendpass())}enterevent=1}function access(){ip=getip()?getip():window.location.hostname,""==ip?(logstatus=0,showlogin(1)):""!=ip&&(logstatus=1,checklogin(0)),ipstatus()}function sendpass(){const password=btoa(document.getElementById("password").value);fetch(`${protocol}//${ip}/code/auth/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:password})}).then(response=>response.json()).then(data=>{data.success?(localStorage.setItem(`authToken_${ip}`,data.token),reloadPage()):notify("验证失败: "+data.message)}).catch(error=>console.error("Error:",error))}function logout(){localStorage.removeItem(`authToken_${ip}`),notify("已登出"),reloadPage()}function checklogin(status){token=localStorage.getItem(`authToken_${ip}`);var xhr=new XMLHttpRequest;xhr.open("GET",`${protocol}//${ip}/code/auth/check.php`,!0),xhr.setRequestHeader("Authorization",`Bearer ${token}`),xhr.onreadystatechange=function(){try{xhr.readyState===XMLHttpRequest.DONE&&(200===xhr.status?(passtatus=1,0==status?showlogin(0):1==status&&showlogin(4)):(passtatus=0,loginicon(),showlogin(2)))}catch(error){console.log(error),notify(error)}},xhr.send()}function loginicon(){root.style.setProperty("--login","url(../../icon/nologin_grey.svg)"),root.style.setProperty("--loginhover","url(../../icon/nologin_white.svg)")}function xmlnologin(xml){401===xml.status&&(loginicon(),checklogin())}function xmltoken(xml){token&&xml.setRequestHeader("Authorization",`Bearer ${token}`)}function fetchtoken(){return{method:"GET",headers:{Authorization:"Bearer "+token,"Content-Type":"application/json"}}}function fetchnologin(response){401===response.status&&(loginicon(),checklogin())}function switchip(){logstatus=0,showlogin(1)}function connect(){ip=document.getElementById("ip-input").value,logstatus="1",checklogin(1)}function local(){ip=window.location.hostname,logstatus="1"}function gethost(){const hostlist=localStorage.getItem("host");return hostlist?JSON.parse(hostlist):defaulthost}function savehost(hostlist){localStorage.setItem("host",JSON.stringify(hostlist))}function clearData(){confirm("确定要清空所有数据吗？")&&(localStorage.removeItem("host"),creatlist())}function creatlist(){const data=gethost(),ipList=document.getElementById("ipList");ipList.innerHTML="",data.host.forEach((savehost,index)=>{const hostbtn=document.createElement("li");hostbtn.className="host-btn",hostbtn.innerHTML=`${savehost} <button class="removehost" onclick="deletehost(${index})"></button>`,hostbtn.addEventListener("click",function(){ip=savehost,logstatus=1,checklogin(1)}),ipList.appendChild(hostbtn)})}function addhost(){logstatus=0;const ipinput=document.getElementById("ip-input"),hostname=ipinput.value.trim();if(hostname){const data=gethost();data.host.includes(hostname)||(data.host.push(hostname),savehost(data),creatlist()),connect(),ipinput.value=""}else alert("请输入一个有效的 IP 地址。")}function deletehost(index){const data=gethost();data.host.splice(index,1),savehost(data),creatlist()}function ipstatus(){document.getElementById("ip-status").innerText=ip,"undefined"!=typeof ishome&&ishome&&(document.getElementById("ip-li").innerText=ip)}const loginpage=document.getElementById("login-page"),passbar=document.getElementById("pass-bar"),hostbar=document.getElementById("host-bar"),hostbox=document.getElementById("host-box");let password,ip,logstatus,passtatus;const login=document.getElementById("login"),root=document.documentElement;let token,enterpass=null,enterip=null;const defaulthost={host:[]};creatlist();