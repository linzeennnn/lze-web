async function widget(type){let doc=[1,2,3].map(i=>document.getElementById(`doc-li${i}`)),not=[1,2,3].map(i=>document.getElementById(`not-li${i}`)),mon=[1,2,3].map(i=>document.getElementById(`mon-li${i}`)),pic=document.getElementById("pic"),img=document.getElementById("img"),tra=document.getElementById("tra-li"),bok=document.getElementById("bok-li"),disktext=document.getElementById("disk-li"),diskbar=document.getElementById("disk-bar");try{let response=await fetch(`${protocol}//${ip}/code/home/widget.php`,{method:"POST",headers:{"Content-Type":"text/plain"},body:`${type}`}),data=await response.json();if("all"!=type&&"doc"!=type||doc.forEach((el,index)=>{el.innerText=data[`doc${index+1}`],el.title="下载:"+data[`doc${index+1}`],el.style.display=""}),"all"!=type&&"pic"!=type||(img.src=`${protocol}//${ip}/file/Pictures/${data.pic1}`,pic.title="预览:"+data.pic1,pic.style.display=""),"all"!=type&&"not"!=type||not.forEach((el,index)=>{el.innerText=removeext(data[`not${index+1}`]),el.title=removeext(data[`not${index+1}`]),el.style.display=""}),"all"!=type&&"bok"!=type||(bok.innerText=removeext(data.bok1),bok.title=removeext(data.bok1),bok.style.display=""),"all"!=type&&"tra"!=type||(tra.innerText=data.tra1,tra.style.display=""),"all"!=type&&"mon"!=type||(mon.forEach((el,index)=>{el.innerText=data[`mon${index+1}`],el.title="进程"+data[`mon${index+1}`]}),mon.forEach((el,index)=>el.style.display="")),"all"==type){let used=data.used,tol=data.total;disktext.innerText=(used/Math.pow(10,6)).toFixed(2)+"G /"+(tol/Math.pow(10,6)).toFixed(2)+"G",diskbar.style.width=used/tol*100+"%"}}catch(error){console.error("发生错误:",error)}}function removeext(name){return name.substring(0,name.lastIndexOf("."))}function widpage(status,object){switch(status){case 1:const page=document.createElement("div");page.classList.add("widget-page"),page.classList.add("option-page"),page.setAttribute("onclick","widpage(0)"),object.addEventListener("click",event=>{event.stopPropagation()}),page.appendChild(object),document.body.appendChild(page);break;case 0:document.body.removeChild(document.querySelector(".widget-page"))}}function pic(){const prepic=document.createElement("img");prepic.id="pre-pic",prepic.src=document.getElementById("img").src,widpage(1,prepic)}function not(note){const file=note.innerText+".txt",prenot=document.createElement("div"),loading=document.createElement("div"),text=document.createElement("span");loading.classList.add("loading"),prenot.id="pre-note",prenot.appendChild(text),prenot.appendChild(loading),widpage(1,prenot),fetch(`${protocol}//${ip}/file/Note/${file}`).then(response=>response.text()).then(data=>{text.innerText=data,loading.style.display="none"}).catch(error=>{notify(error)})}function bok(book){const file=book.innerText+".bok",prebok=document.createElement("div"),loading=document.createElement("div");loading.classList.add("loading"),prebok.id="pre-bok",prebok.appendChild(loading),widpage(1,prebok),fetch(`${protocol}//${ip}/file/Bookmark/${file}`).then(response=>response.text()).then(data=>{loading.style.display="none",window.location.href=data}).catch(error=>{notify(error)})}function doc(docu){let file=docu.innerText;if(file.endsWith("/")){const predoc=document.createElement("div"),loading=document.createElement("div");loading.classList.add("loading"),predoc.id="pre-doc",predoc.appendChild(loading),widpage(1,predoc),file=file.slice(0,-1),downfolder(file,file)}else window.location.href=`${protocol}//${ip}/code/Documents/doc_download.php?file=${file}&folder=`}const app=document.querySelectorAll(".app"),widgetwid=new ResizeObserver(entries=>{entries.forEach(entry=>{if(entry.contentRect.width<400){const panel=entry.target.querySelectorAll(".panel");panel.forEach(panel=>{panel.style.display="none"})}else{const panel=entry.target.querySelectorAll(".panel");panel.forEach(panel=>{panel.style.display=""})}})});app.forEach(app=>{widgetwid.observe(app)});const panel=document.querySelectorAll(".panel");panel.forEach(panel=>{panel.addEventListener("click",event=>{event.stopPropagation()})});