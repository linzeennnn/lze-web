let winstatus=0,curwin;const protocol=window.location.protocol==="file:"?"${protocol}":window.location.protocol;let user=localStorage.getItem("user"),token=localStorage.getItem("token"),ip=window.location.hostname;user||(user="visitor");function notify(e){const t=document.createElement("div");t.id="notify";const n=document.createElement("span");n.id="notifytext",n.innerText=e,t.appendChild(n),document.body.appendChild(t),setTimeout(function(){t.style.opacity="1",t.style.top="5px"},10),setTimeout(function(){t.style.opacity="",setTimeout(function(){document.body.removeChild(t)},1e3)},1e3)}async function auth(){const e={name:user,token};try{const t=await fetch(`${protocol}//${ip}/server/login/auth_status.cgi`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status==401)throw notify("登陆过期"),log_out(),new Error(`错误`);if(!t.ok)throw notify(`${t.status}错误`),log_out(),new Error(`HTTP 错误！状态码: ${t.status}`);notify("登陆用户"+user)}catch(e){return console.error("请求失败:",e),null}}user!="visitor"?auth():notify("访客登陆");const metacolor={dark:{default:"#242424",green:"#18201b",blue:"#181c20",yellow:"#202018",orange:"#201d18",pink:"#201820",red:"#201818"},light:{default:"#747474",green:"#8eb79d",blue:"#8e9fb7",yellow:"#b7ad8e",orange:"#b79f8e",pink:"#b78eab",red:"#b78e8e"}};let color=localStorage.getItem("color")||"default",mode=localStorage.getItem("mode")||"dark";if(window.matchMedia("(pointer: fine)").matches&&window.matchMedia("(hover: hover)").matches){const e=document.createElement("div");e.classList.add("tooltip"),document.body.appendChild(e),document.addEventListener("mousemove",t=>{const r=e.offsetWidth,c=e.offsetHeight,s=t.clientX,o=t.clientY;let i=s+20,a=o-30;window.innerWidth-s<150&&(i=s-r-20),o<60&&(a=o+c-20),e.style.left=`${i}px`,e.style.top=`${a}px`;const n=t.target.closest("[title], [tip-title]");if(n){if(n.hasAttribute("title")&&!n.hasAttribute("tip-title")){const t=n.getAttribute("title");n.setAttribute("tip-title",t),n.removeAttribute("title"),e.innerText=t}else n.hasAttribute("tip-title")&&(e.innerText=n.getAttribute("tip-title"));e.style.display="",setTimeout(function(){e.style.opacity="1"},500)}}),document.addEventListener("mouseout",t=>{const n=t.target.closest("[title], [tip-title]");n&&(e.innerText="",e.style.display="none",e.style.opacity="")})}function newwindow(e,t){switch(t){case 1:winstatus=1,e.className="window",e.addEventListener("mousedown",function(){winlevel(e)});const t=document.createElement("div");t.onclick=()=>newwindow(e,0),t.className="close-win",t.title="关闭",e.appendChild(t),document.body.appendChild(e),e.style.top=`100px`;let n,s;e.onmousedown=function(t){n=t.clientX-e.getBoundingClientRect().left,s=t.clientY-e.getBoundingClientRect().top;function i(t,o){e.style.left=t-n+"px",e.style.top=o-s+"px"}function o(e){i(e.pageX,e.pageY)}document.addEventListener("mousemove",o),e.onmouseup=function(){document.removeEventListener("mousemove",o),e.onmouseup=null}},e.ondragstart=function(){return!1},e.style.display="flex",setTimeout(()=>{e.style.opacity="1"},10);break;case 0:document.body.removeChild(e),e=null,winstatus=0;break}}function winlevel(e){e.style.zIndex="16",curwin&&curwin!=e&&(curwin.style.zIndex=""),curwin=e}