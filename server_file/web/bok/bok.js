function optionbar(e){const t=document.getElementById("option-bar"),n=document.getElementById("openbar");switch(e){case 0:allmove(e),optionstatus=0,n.style.display="block",t.style.left="",setTimeout(()=>{t.style.display="none"},1e3);break;case 1:allmove(e),optionstatus=1,t.style.display="",setTimeout(()=>{n.style.display="none",t.style.left="0"},10);break}}function allmove(e){const t=document.querySelectorAll(".main");switch(e){case 1:t.forEach(function(e){e&&(e.style.marginLeft="")});break;case 0:t.forEach(function(e){e.style.marginLeft="0"});break}}function handleScroll(){var e=window.scrollY||document.documentElement.scrollTop;e>100?(document.getElementById("top-btn").style.bottom="7%",document.getElementById("top-bar").style.top="10px",document.getElementById("top-bar").style.marginLeft="20%",document.getElementById("top-bar").style.width="65%",document.getElementById("top-bar").style.backgroundColor="transparent",document.getElementById("top-bar").style.boxShadow="none",document.querySelector(".backbtn").style.left="1%",document.querySelector(".backbtn").style.width="15%",document.getElementById("cover-bar").style.top="0"):(document.getElementById("top-btn").style.bottom="",document.getElementById("top-bar").style.top="",document.getElementById("top-bar").style.marginLeft="",document.getElementById("top-bar").style.width="80%",document.getElementById("top-bar").style.backgroundColor="",document.getElementById("top-bar").style.boxShadow="",document.querySelector(".backbtn").style.left="5%",document.querySelector(".backbtn").style.width="",document.getElementById("cover-bar").style.top="")}window.addEventListener("scroll",handleScroll);function handleScroll(){var e=window.scrollY||document.documentElement.scrollTop;e>100?(document.getElementById("top-btn").style.bottom="15%",document.getElementById("top-bar").style.top="10px",document.getElementById("top-bar").style.backgroundColor="transparent",document.getElementById("top-bar").style.boxShadow="none",document.getElementById("top-bar").style.backdropFilter=`none`,document.getElementById("top-bar").style.webkitBackdropFilter=`none`,document.querySelector(".backbtn").style.left="1%",document.getElementById("cover-bar").style.top="0"):(document.getElementById("top-btn").style.bottom="",document.getElementById("top-bar").style.top="100px",document.getElementById("top-bar").style.backgroundColor="",document.getElementById("top-bar").style.boxShadow="",document.querySelector(".backbtn").style.left="5%",document.getElementById("cover-bar").style.top="",document.getElementById("top-bar").style.backdropFilter=``,document.getElementById("top-bar").style.webkitBackdropFilter=``)}window.addEventListener("scroll",handleScroll);function comin(){pageloading(1),getbok(),theme(mode,"red"),document.getElementById("top-bar").style.top="100px",document.getElementById("option-bar").style.left="0",document.getElementById("option-bar").style.opacity="1",document.querySelector(".backbtn").style.left="5%",document.getElementById(`notes`).style.right="0px"}window.onload=comin;function totop(){window.scroll({top:0,left:0,behavior:"smooth"})}function goBack(){window.location.replace(`../../index.html#${ip}`)}function reloadPage(){location.reload()}async function readFile(e){const t=await fetch(e),n=await t.text();return n}async function getbok(){const e=document.getElementById("bok-box");e.innerHTML="";try{const t=await fetch(`${protocol}//${ip}/server/bok/list`);t.ok||notify("获取失败");const n=await t.json(),s=document.getElementById("fileList");n.forEach(t=>{const n=document.createElement("div"),o=document.createElement("span"),s=document.createElement("div");titname=t.name.split(".").slice(0,-1).join(".")||t.name,n.classList.add("bok"),o.classList.add("tit"),s.classList.add("del"),s.title="删除"+titname,n.title="打开"+titname,o.innerText=titname,s.addEventListener("click",function(e){e.stopPropagation()}),n.addEventListener("click",function(){updatebok(t.name),t.content.startsWith("http")||(t.content="http://"+t.content),window.location.href=t.content}),s.addEventListener("click",function(){confirm(`确定要删除书签吗？`)&&delbok(t.name)}),n.appendChild(o),n.appendChild(s),e.appendChild(n)}),pageloading(0)}catch(e){console.log(e),notify(e)}}async function updatebok(e){try{const t=await fetch(`${protocol}//${ip}/server/bok/recent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:e})})}catch(e){notify(e)}}function delbok(e){pageloading(1),fetch(`${protocol}//${ip}/server/bok/del`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,user,token})}).then(e=>{if(e.ok)notify("删除成功"),getbok();else throw e.status===401?(notify("无删除权限"),pageloading(0),new Error("未授权访问")):(notify(e.status+"错误"),pageloading(0),new Error("未授权访问"));return e.text()}).catch(e=>{console.error("Error:",e)})}function newbok(){pageloading(1);let e=document.getElementById("tit-bar"),t=document.getElementById("word-bar"),n=e.value,s=t.innerText;n=e.value+".bok",s=t.innerText,e.value==""&&(n="new_bookmark.bok"),e.value="",t.innerText="",fetch(`${protocol}//${ip}/server/bok/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,text:s,user,token})}).then(e=>{if(e.ok)notify("添加成功"),getbok();else throw e.status===401?(notify("无添加权限"),pageloading(0),new Error("未授权访问")):(notify(e.status+"错误"),pageloading(0),new Error("未授权访问"));return e.text()}).catch(e=>{console.log(e)})}