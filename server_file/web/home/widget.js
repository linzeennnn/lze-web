async function widget(){document.getElementById("ip-li").innerText=user;let s=[1,2,3].map(e=>document.getElementById(`doc-li${e}`)),o=[1,2,3].map(e=>document.getElementById(`not-li${e}`)),i=[1,2,3].map(e=>document.getElementById(`mon-li${e}`)),t=document.getElementById(`pic`),a=document.getElementById(`img`),n=document.getElementById(`tra-li`),e=document.getElementById(`bok-li`),r=document.getElementById(`disk-li`),c=document.getElementById(`disk-bar`);try{let d=await fetch(`${protocol}//${ip}/server/home/widget.cgi`,{method:"POST",headers:{"Content-Type":"text/plain"}}),l=await d.json();if(l){s.forEach((e,t)=>{e.innerText=l[`doc${t+1}`]||"",e.title="预览:"+(l[`doc${t+1}`]||""),e.style.display=""}),a.src=`${protocol}//${ip}/file/Pictures/${l.pic1||""}`,t.title="预览:"+(l.pic1||""),t.style.display="",o.forEach((e,t)=>{e.innerText=removeext(l[`not${t+1}`]||""),e.title=removeext(l[`not${t+1}`]||""),e.style.display=""}),e.innerText=removeext(l.bok1||""),e.title=removeext(l.bok1||""),e.style.display="",n.innerText=l.tra1||"",n.style.display="",i.forEach((e,t)=>{e.innerText=l[`mon${t+1}`]||"",e.title="进程"+(l[`mon${t+1}`]||""),e.style.display=""});let d=l.used||0,u=l.total||0;r.innerText=(d/Math.pow(10,6)).toFixed(2)+"G /"+(u/Math.pow(10,6)).toFixed(2)+"G",c.style.width=d/u*100+"%"}}catch(e){console.error("发生错误:",e)}}function removeext(e){return e.substring(0,e.lastIndexOf("."))}const app=document.querySelectorAll(".app"),widgetwid=new ResizeObserver(e=>{e.forEach(e=>{requestAnimationFrame(()=>{if(e.contentRect.width<400){const t=e.target.querySelectorAll(".panel");t.forEach(e=>{e.style.display="none"})}else{const t=e.target.querySelectorAll(".panel");t.forEach(e=>{e.style.display=""})}})})});app.forEach(e=>{widgetwid.observe(e)});const panel=document.querySelectorAll(".panel");panel.forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation()})});function widpage(e,t){switch(e){case 1:const e=document.createElement("div");e.classList.add("widget-page"),e.classList.add("option-page"),e.setAttribute("onclick","widpage(0)"),t.addEventListener("click",e=>{e.stopPropagation()}),e.appendChild(t),document.body.appendChild(e);break;case 0:document.body.removeChild(document.querySelector(".widget-page"));break}}function pic(){const e=document.createElement("img");e.id="pre-pic",e.src=document.getElementById("img").src,widpage(1,e)}function not(e){const o=e.innerText+".txt",t=document.createElement("div"),n=document.createElement("div"),s=document.createElement("span");n.classList.add("loading"),t.id="pre-note",t.appendChild(s),t.appendChild(n),widpage(1,t),fetch(`${protocol}//${ip}/file/Note/${o}`).then(e=>e.text()).then(e=>{s.innerText=e,n.style.display="none"}).catch(e=>{notify(e)})}function bok(e){const s=e.innerText+".bok",t=document.createElement("div"),n=document.createElement("div");n.classList.add("loading"),t.id="pre-bok",t.appendChild(n),widpage(1,t),fetch(`${protocol}//${ip}/file/Bookmark/${s}`).then(e=>e.text()).then(e=>{n.style.display="none",window.location.href=e}).catch(e=>{notify(e)})}function doc(e){const s=e.innerText,t=document.createElement("div"),n=document.createElement("div");n.classList.add("loading"),t.id="pre-doc",t.appendChild(n),widpage(1,t);const o={name:s};fetch(`${protocol}//${ip}/server/home/doc_list.cgi`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(e=>e.json()).then(e=>{if(e.type=="file"){const e=document.createElement("iframe");e.src=`${protocol}//${ip}/file/Documents/${s}`,e.classList.add("file-preview"),t.appendChild(e)}else e.type=="dir"&&e.list.forEach(e=>{const n=document.createElement("div");n.innerText=e,n.classList.add("list-preview"),t.appendChild(n)});n.style.display="none"}).catch(e=>{notify(e)})}