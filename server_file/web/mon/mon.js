function optionbar(e){const t=document.getElementById("option-bar"),n=document.getElementById("openbar");switch(e){case 0:allmove(e),optionstatus=0,n.style.display="block",t.style.left="",setTimeout(()=>{t.style.display="none"},1e3);break;case 1:allmove(e),optionstatus=1,t.style.display="",setTimeout(()=>{n.style.display="none",t.style.left="0"},10);break}}function allmove(e){const t=document.querySelectorAll(".main");switch(e){case 1:t.forEach(function(e){e&&(e.style.marginLeft="")});break;case 0:t.forEach(function(e){e.style.marginLeft="0"});break}}function handleScroll(){var e=window.scrollY||document.documentElement.scrollTop;e>100?(document.getElementById("top-btn").style.bottom="7%",document.getElementById("top-bar").style.top="10px",document.getElementById("top-bar").style.marginLeft="20%",document.getElementById("top-bar").style.width="65%",document.getElementById("top-bar").style.backgroundColor="transparent",document.getElementById("top-bar").style.boxShadow="none",document.querySelector(".backbtn").style.left="1%",document.querySelector(".backbtn").style.width="15%",document.getElementById("cover-bar").style.top="0"):(document.getElementById("top-btn").style.bottom="",document.getElementById("top-bar").style.top="",document.getElementById("top-bar").style.marginLeft="",document.getElementById("top-bar").style.width="80%",document.getElementById("top-bar").style.backgroundColor="",document.getElementById("top-bar").style.boxShadow="",document.querySelector(".backbtn").style.left="5%",document.querySelector(".backbtn").style.width="",document.getElementById("cover-bar").style.top="")}window.addEventListener("scroll",handleScroll);function handleScroll(){var e=window.scrollY||document.documentElement.scrollTop;e>100?(document.getElementById("top-btn").style.bottom="15%",document.getElementById("top-bar").style.top="10px",document.getElementById("top-bar").style.backgroundColor="transparent",document.getElementById("top-bar").style.boxShadow="none",document.getElementById("top-bar").style.backdropFilter=`none`,document.getElementById("top-bar").style.webkitBackdropFilter=`none`,document.querySelector(".backbtn").style.left="1%",document.getElementById("cover-bar").style.top="0"):(document.getElementById("top-btn").style.bottom="",document.getElementById("top-bar").style.top="100px",document.getElementById("top-bar").style.backgroundColor="",document.getElementById("top-bar").style.boxShadow="",document.querySelector(".backbtn").style.left="5%",document.getElementById("cover-bar").style.top="",document.getElementById("top-bar").style.backdropFilter=``,document.getElementById("top-bar").style.webkitBackdropFilter=``)}window.addEventListener("scroll",handleScroll);function comin(){get_data(),theme(mode,"yellow"),document.getElementById("top-bar").style.top="100px",document.getElementById("option-bar").style.left="0",document.getElementById("option-bar").style.opacity="1",document.querySelector(".backbtn").style.left="5%",document.getElementById(`notes`).style.right="0px"}window.onload=comin;function totop(){window.scroll({top:0,left:0,behavior:"smooth"})}function goBack(){window.location.replace(`../../index.html#${ip}`)}function reloadPage(){location.reload()}async function readFile(e){const t=await fetch(e),n=await t.text();return n}let time=null,monuser=user;async function get_data(){monuser||(monuser="visitor");const s=document.getElementById("save"),t=document.getElementById("mon-box"),n=document.getElementById("user-box"),e=document.getElementById("time-bar");s.style.display="none",e.disabled=!0,pageloading(1),n.innerHTML="",t.innerHTML="",e.classList.contains("edit")&&e.classList.remove("edit");try{const s=await fetch(`${protocol}//${ip}/server/mon/list`);if(!s.ok)throw new Error("网络响应失败");pageloading(0);const o=await s.json(),e=o.control,i=o.user;for(let o in e){let s=document.createElement("div"),i=document.createElement("div"),r=document.createElement("span"),n=e[o].action;s.id=o,r.innerText=e[o].name,r.className="ctl-tit",i.className="ctl-box",i.style.display="none",s.className="ctl",s.appendChild(r),s.appendChild(i),t.appendChild(s);for(let t in n){let e=document.createElement("div");e.className="act",e.innerText=n[t].name,n[t].user.length===0?(e.classList.add("disable"),e.title="添加"+n[t].name+"权限"):n[t].user.forEach(s=>{if(monuser==s){e.classList.add("enable"),e.title="解除"+n[t].name+"权限";return}!e.classList.contains("enable")&&monuser!=s&&!e.classList.contains("disable")&&(e.classList.add("disable"),e.title="添加"+n[t].name+"权限")}),e.onclick=function(){change_control(o,t,e)},i.appendChild(e)}let a=document.createElement("div");a.title="设置"+e[o].name+"权限",a.className="setting",a.onclick=function(){show_ctl_box(i)},s.appendChild(a)}for(let e in i){let t=document.createElement("div");monuser==e&&(time=i[e].tokentime),t.id=e,t.innerText=e,t.title="切换为:"+e,t.className="username",t.onclick=function(){monuser=e,get_data()},n.appendChild(t)}switch_user(monuser,time)}catch(e){console.error("请求失败:",e)}}function switch_user(e,t){const n=document.getElementById("user-bar"),s=document.getElementById("time-bar");n.title="当前用户:"+e,e!="admin"&&e!="lze"?n.innerText="访客":n.innerText=e,t?t=="never"?s.value="永不过期":s.value=t:s.value="无"}function show_user(){const e=document.getElementById("user-box");switch(e.style.display){case"none":e.style.display="flex",document.addEventListener("click",page_hide_user);break;case"flex":e.style.display="none",document.removeEventListener("click",page_hide_user);break;default:e.style.display="flex",document.addEventListener("click",page_hide_user);break}}function page_hide_user(e){const t=document.getElementById("user-box"),n=document.getElementById("user-icon");!t.contains(e.target)&&e.target!==n&&(t.style.display="none",document.removeEventListener("click",page_hide_user))}function show_ctl_box(e){switch(e.style.display){case"none":e.style.display="flex";break;case"flex":e.style.display="none";break}}function edit_time(){const t=document.getElementById("save"),e=document.getElementById("time-bar");e.classList.add("edit"),e.disabled=!1,e.value="",t.style.display="block"}function change_time(){if(confirm("确定更新期限吗?")){const e=document.getElementById("time-bar");if(!check_format(e.value)&&e.value!="never"){alert(`格式错误
正确格式
小时:数字+h
天:数字+d
月:数字+m
年:数字+y
永不过期:never`);return}if(monuser=="visitor"){notify("无登陆");return}pageloading(1);const t={name:monuser,time:e.value,token,user};fetch(`${protocol}//${ip}/server/mon/date`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>{if(e.ok)notify("已更新登陆期限"),get_data();else throw e.status===401?(notify("无权限修改"),pageloading(0),new Error("未授权访问")):(pageloading(0),notify(e.status+"错误"),new Error("未授权访问"))}).catch(e=>{console.error("请求失败:",e)})}}function check_format(e){const t=/^\d+(h|d|m|y)$/;return t.test(e)}function change_control(e,t,n){if(confirm("确定更新权限吗?")){pageloading(1);let s;n.classList.contains("enable")?s="remove":s="add";const o={name:monuser,token,user,change:s,control:e,action:t};fetch(`${protocol}//${ip}/server/mon/update_act`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(e=>{if(e.ok)notify("已更新权限"),get_data();else throw e.status===401?(notify("无权限修改"),pageloading(0),new Error("未授权访问")):(pageloading(0),notify(e.status+"错误"),new Error("未授权访问"))}).catch(e=>{console.error("请求失败:",e)})}}