async function widget(){let e=[1,2,3].map(e=>document.getElementById(`doc-li${e}`)),t=[1,2,3].map(e=>document.getElementById(`not-li${e}`)),n=[1,2,3].map(e=>document.getElementById(`mon-li${e}`)),o=document.getElementById("pic"),d=document.getElementById("img"),i=document.getElementById("tra-li"),c=document.getElementById("bok-li"),l=document.getElementById("disk-li"),a=document.getElementById("disk-bar");try{let r=await fetch(`${protocol}//${ip}/server/home/widget.cgi`,{method:"POST",headers:{"Content-Type":"text/plain"}}),s=await r.json();if(s){e.forEach((e,t)=>{e.innerText=s[`doc${t+1}`]||"",e.title="下载:"+(s[`doc${t+1}`]||""),e.style.display=""}),d.src=`${protocol}//${ip}/file/Pictures/${s.pic1||""}`,o.title="预览:"+(s.pic1||""),o.style.display="",t.forEach((e,t)=>{e.innerText=removeext(s[`not${t+1}`]||""),e.title=removeext(s[`not${t+1}`]||""),e.style.display=""}),c.innerText=removeext(s.bok1||""),c.title=removeext(s.bok1||""),c.style.display="",i.innerText=s.tra1||"",i.style.display="",n.forEach((e,t)=>{e.innerText=s[`mon${t+1}`]||"",e.title="进程"+(s[`mon${t+1}`]||""),e.style.display=""});let r=s.used||0,p=s.total||0;l.innerText=(r/Math.pow(10,6)).toFixed(2)+"G /"+(p/Math.pow(10,6)).toFixed(2)+"G",a.style.width=r/p*100+"%"}}catch(e){console.error("发生错误:",e)}}function removeext(e){return e.substring(0,e.lastIndexOf("."))}function widpage(e,t){switch(e){case 1:const n=document.createElement("div");n.classList.add("widget-page"),n.classList.add("option-page"),n.setAttribute("onclick","widpage(0)"),t.addEventListener("click",e=>{e.stopPropagation()}),n.appendChild(t),document.body.appendChild(n);break;case 0:document.body.removeChild(document.querySelector(".widget-page"))}}function pic(){const e=document.createElement("img");e.id="pre-pic",e.src=document.getElementById("img").src,widpage(1,e)}function not(e){const t=e.innerText+".txt",n=document.createElement("div"),o=document.createElement("div"),d=document.createElement("span");o.classList.add("loading"),n.id="pre-note",n.appendChild(d),n.appendChild(o),widpage(1,n),fetch(`${protocol}//${ip}/file/Note/${t}`).then(e=>e.text()).then(e=>{d.innerText=e,o.style.display="none"}).catch(e=>{notify(e)})}function bok(e){const t=e.innerText+".bok",n=document.createElement("div"),o=document.createElement("div");o.classList.add("loading"),n.id="pre-bok",n.appendChild(o),widpage(1,n),fetch(`${protocol}//${ip}/file/Bookmark/${t}`).then(e=>e.text()).then(e=>{o.style.display="none",window.location.href=e}).catch(e=>{notify(e)})}function doc(e){let t=e.innerText;if(t.endsWith("/")){const e=document.createElement("div"),n=document.createElement("div");n.classList.add("loading"),e.id="pre-doc",e.appendChild(n),widpage(1,e),t=t.slice(0,-1),downfolder(t,t)}else{const e=document.createElement("a");e.download=t,e.href=`${protocol}//${ip}/file/Documents/${t}`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}const app=document.querySelectorAll(".app"),widgetwid=new ResizeObserver(e=>{e.forEach(e=>{if(e.contentRect.width<400){const t=e.target.querySelectorAll(".panel");t.forEach(e=>{e.style.display="none"})}else{const t=e.target.querySelectorAll(".panel");t.forEach(e=>{e.style.display=""})}})});app.forEach(e=>{widgetwid.observe(e)});const panel=document.querySelectorAll(".panel");panel.forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation()})});