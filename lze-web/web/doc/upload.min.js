function uploadFolder(){let e;ifroot();const t=document.getElementById("uploadfolder"),n=t.files;if(0===n.length)return;loading(1),showupload(0);const o=n.length;let a=0,l=0,i=0;for(let e of n){let t;t=e.size<=104857600?20971520:e.size>104857600&&e.size<=524288e3?52428800:e.size>524288e3&&e.size<=1073741824?104857600:e.size>1073741824&&e.size<=3221225472?209715200:314572800,a+=Math.ceil(e.size/t)}const d=document.getElementById("percent"),r=()=>{const e=l/a*100;document.getElementById("bar").style.width=e+"%",d.innerHTML=parseInt(e)+"%"},s=(t,a)=>{let d;d=t.size<=104857600?20971520:t.size>104857600&&t.size<=524288e3?52428800:t.size>524288e3&&t.size<=1073741824?104857600:t.size>1073741824&&t.size<=3221225472?209715200:314572800;let s=0,p=0;const f=s=>{const c=Math.min(s+d,t.size),u=t.slice(s,c),h=t.webkitRelativePath;0===a&&0===s&&(e=n[0].webkitRelativePath.split("/")[0]);const m=new FormData;m.append("file",u),m.append("name",t.name),m.append("relativePath",h),m.append("start",s),m.append("chunkIndex",p),m.append("total",t.size),m.append("last",c>=t.size?1:0),fetch(`${protocol}//${ip}/server/doc/upload_folder.cgi`,{method:"POST",body:m}).then(e=>e.text()).then(n=>{l++,r(),p++,c<t.size?f(c):(i++,i===o&&(loading(0),movefolder(e,nowpath)))}).catch(e=>{console.error("上传失败:",e)})};f(s)};for(let e=0;e<n.length;e++)s(n[e],e);t.value=""}function movefolder(e,t){fetch(`${protocol}//${ip}/server/doc/move_folder.cgi`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,path:t})}).then(e=>e.text()).then(e=>{notify("上传完成"),loadFolder(removeslash(t))}).catch(e=>{notify(e)})}function selfile(){function e(i){if(i>=o)loading(0);else{var d=t[i],r=l[i]*n,s=Math.min(r+n,d.size),p=d.slice(r,s),f=new FormData;f.append("file",p),f.append("fileName",d.name),f.append("totalChunks",a[i]),f.append("currentChunk",l[i]),f.append("nowpath",nowpath);var c=new XMLHttpRequest;c.open("POST",`${protocol}//${ip}/server/doc/upload_file.cgi`,!0),xmltoken(c),c.upload.onprogress=function(e){if(e.lengthComputable){var t=(l[i]+e.loaded/e.total)/a[i]*100,n=document.getElementById("percent");document.getElementById("bar").style.width=t+"%",n.innerHTML=parseInt(t)+"%"}},c.onload=function(){xmlnologin(c),200===c.status&&(l[i]++,l[i]<a[i]?e(i):(e(i+1),notify(`文件 ${d.name} 上传成功`),loadFolder(removeslash(nowpath))))},c.send(f)}}ifroot();var t=fileInput.files;if(0!==t.length){showupload(0);var n=20971520,o=t.length,a=Array(o).fill(0),l=Array(o).fill(0);for(let e=0;e<o;e++){if(0===t[e].size)return void notify(`${t[e].name} 是空文件，上传失败`);a[e]=Math.ceil(t[e].size/n)}loading(1),e(0)}else notify("请先选择文件")}function handleDragOver(e){e.stopPropagation(),e.preventDefault(),uploadarea.style.opacity="1"}function handleDragLeave(e){e.stopPropagation(),e.preventDefault(),uploadarea.style.opacity=""}function handleDrop(e){e.stopPropagation(),e.preventDefault(),uploadarea.style.opacity="";const t=e.dataTransfer,n=(t.files,t.items);for(let e=0;e<n.length;e++){const t=n[e];if("file"===t.kind&&t.webkitGetAsEntry().isFile){const e=t.getAsFile();if(e){const t=new DataTransfer;t.items.add(e),fileInput.files=t.files,selfile()}}else notify("文件夹自己去手动上传")}}const folderinput=document.getElementById("uploadfolder"),fileInput=document.getElementById("uploadfile"),uploadarea=document.getElementById("upload-area"),filelist=document.getElementById("fileListContainer");document.addEventListener("dragover",handleDragOver),document.addEventListener("dragleave",handleDragLeave),document.addEventListener("drop",handleDrop),filelist.addEventListener("dragover",handleDragOver),filelist.addEventListener("dragleave",handleDragLeave),filelist.addEventListener("drop",handleDrop);