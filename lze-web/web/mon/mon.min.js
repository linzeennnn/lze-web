function optionbar(e){const t=document.getElementById("option-bar"),n=document.getElementById("openbar");switch(e){case 0:allmove(e),optionstatus=0,n.style.display="block",t.style.left="",setTimeout(()=>{t.style.display="none"},1e3);break;case 1:allmove(e),optionstatus=1,t.style.display="",setTimeout(()=>{n.style.display="none",t.style.left="0"},10)}}function allmove(e){const t=document.querySelectorAll(".main");switch(e){case 1:t.forEach(function(e,t){e&&(e.style.marginLeft="")});break;case 0:t.forEach(function(e,t){e.style.marginLeft="0"})}}function handleScroll(){var e=window.scrollY||document.documentElement.scrollTop;e>100?(document.getElementById("top-btn").style.bottom="7%",document.getElementById("top-bar").style.top="10px",document.getElementById("top-bar").style.marginLeft="20%",document.getElementById("top-bar").style.width="65%",document.getElementById("top-bar").style.backgroundColor="transparent",document.getElementById("top-bar").style.boxShadow="none",document.querySelector(".backbtn").style.left="1%",document.querySelector(".backbtn").style.width="15%",document.getElementById("cover-bar").style.top="0"):(document.getElementById("top-btn").style.bottom="",document.getElementById("top-bar").style.top="",document.getElementById("top-bar").style.marginLeft="",document.getElementById("top-bar").style.width="80%",document.getElementById("top-bar").style.backgroundColor="",document.getElementById("top-bar").style.boxShadow="",document.querySelector(".backbtn").style.left="5%",document.querySelector(".backbtn").style.width="",document.getElementById("cover-bar").style.top="")}function handleScroll(){var e=window.scrollY||document.documentElement.scrollTop;e>100?(document.getElementById("top-btn").style.bottom="15%",document.getElementById("top-bar").style.top="10px",document.getElementById("top-bar").style.backgroundColor="transparent",document.getElementById("top-bar").style.boxShadow="none",document.getElementById("top-bar").style.backdropFilter="none",document.getElementById("top-bar").style.webkitBackdropFilter="none",document.querySelector(".backbtn").style.left="1%",document.getElementById("cover-bar").style.top="0"):(document.getElementById("top-btn").style.bottom="",document.getElementById("top-bar").style.top="100px",document.getElementById("top-bar").style.backgroundColor="",document.getElementById("top-bar").style.boxShadow="",document.querySelector(".backbtn").style.left="5%",document.getElementById("cover-bar").style.top="",document.getElementById("top-bar").style.backdropFilter="",document.getElementById("top-bar").style.webkitBackdropFilter="")}function comin(){get_data(),theme(mode,"yellow"),document.getElementById("top-bar").style.top="100px",document.getElementById("option-bar").style.left="0",document.getElementById("option-bar").style.opacity="1",document.querySelector(".backbtn").style.left="5%",document.getElementById("notes").style.right="0px",loginstatus()}function totop(){window.scroll({top:0,left:0,behavior:"smooth"})}function goBack(){window.location.replace(`../../index.html#${ip}`)}function reloadPage(){location.reload()}async function readFile(e){const t=await fetch(e),n=await t.text();return n}async function get_data(){user||(user="visitor");const e=document.getElementById("save"),t=document.getElementById("mon-box"),n=document.getElementById("user-box"),o=document.getElementById("time-bar");e.style.display="none",o.disabled=!0,pageloading(1),n.innerHTML="",t.innerHTML="",o.classList.contains("edit")&&o.classList.remove("edit");try{const e=await fetch(`${protocol}//${ip}/server/mon/list.cgi`);if(!e.ok)throw new Error("网络响应失败");pageloading(0);const o=await e.json(),l=o.control,c=o.user;for(let e in l){let n=document.createElement("div"),o=document.createElement("div"),c=document.createElement("span"),a=l[e].action;n.id=e,c.innerText=l[e].name,c.className="ctl-tit",o.className="ctl-box",o.style.display="none",n.className="ctl",n.appendChild(c),n.appendChild(o),t.appendChild(n);for(let t in a){let n=document.createElement("div");n.className="act",n.innerText=a[t].name,0===a[t].user.length?(n.classList.add("disable"),n.title="添加"+a[t].name+"权限"):a[t].user.forEach(e=>{if(user==e)return n.classList.add("enable"),void(n.title="解除"+a[t].name+"权限");n.classList.contains("enable")||user==e||n.classList.contains("disable")||(n.classList.add("disable"),n.title="添加"+a[t].name+"权限")}),n.onclick=function(){change_control(e,t,n)},o.appendChild(n)}let d=document.createElement("div");d.title="设置"+l[e].name+"权限",d.className="setting",d.onclick=function(){show_ctl_box(o)},n.appendChild(d)}for(let e in c){let t=document.createElement("div");user==e&&(time=c[e].tokentime),t.id=e,t.innerText=e,t.title="切换为:"+e,t.className="username",t.onclick=function(){user=e,get_data()},n.appendChild(t)}switch_user(user,time)}catch(e){console.error("请求失败:",e)}}function switch_user(e,t){const n=document.getElementById("user-bar"),o=document.getElementById("time-bar");n.title="当前用户:"+e,n.innerText="admin"!=e&&"lze"!=e?"访客":e,o.value=t?"never"==t?"永不过期":t:"无"}function show_user(){const e=document.getElementById("user-box");switch(e.style.display){case"none":e.style.display="flex",document.addEventListener("click",page_hide_user);break;case"flex":e.style.display="none",document.removeEventListener("click",page_hide_user);break;default:e.style.display="flex",document.addEventListener("click",page_hide_user)}}function page_hide_user(e){const t=document.getElementById("user-box"),n=document.getElementById("user-icon");t.contains(e.target)||e.target===n||(t.style.display="none",document.removeEventListener("click",page_hide_user))}function show_ctl_box(e){switch(e.style.display){case"none":e.style.display="flex";break;case"flex":e.style.display="none"}}function edit_time(){const e=document.getElementById("save"),t=document.getElementById("time-bar");t.classList.add("edit"),t.disabled=!1,t.value="",e.style.display="block"}function change_time(){if(confirm("确定更新期限吗?")){const e=document.getElementById("time-bar");if(!check_format(e.value)&&"never"!=e.value)return void alert("格式错误\n正确格式\n小时:数字+h\n天:数字+d\n月:数字+m\n年:数字+y\n永不过期:never");if("visitor"==user)return void notify("无登陆");pageloading(1);const t={name:user,time:e.value};fetch(`${protocol}//${ip}/server/mon/date.cgi`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>{e.ok?(notify("已更新登陆期限"),get_data()):console.error("请求失败，状态码:",e.status)}).catch(e=>{console.error("请求失败:",e)})}}function check_format(e){const t=/^\d+(h|d|m|y)$/;return t.test(e)}function change_control(e,t,n){if(confirm("确定更新权限吗?")){let o;pageloading(1),o=n.classList.contains("enable")?"remove":"add";const l={name:user,change:o,control:e,action:t};fetch(`${protocol}//${ip}/server/mon/update_act.cgi`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(e=>{e.ok?(notify("已更新权限"),get_data()):console.error("请求失败，状态码:",e.status)}).catch(e=>{console.error("请求失败:",e)})}}let user;window.addEventListener("scroll",handleScroll),window.addEventListener("scroll",handleScroll),window.onload=comin;let time=null;