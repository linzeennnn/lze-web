import{c as y,j as t,n as x,r as m,W as N,T,b as L}from"./all-C-88BSI4.js";import{P as B,C as O,T as _,S as E,a as I,H as U,G,b as P}from"./page-Dh5Avlqg.js";const a=y((e,n)=>{const s=window.localStorage.getItem("userName"),r=window.localStorage.getItem("token");return{userName:s,token:r,nowuser:s?.trim()||"visitor",showBg:!1,loading:!1,controlList:null,langList:[],userList:null,showCmd:!1,theme:{mode:"",color:{mon:""}},monUrl:`${window.location.origin}/server/mon/`,setGlobal:c=>{e(l=>({...l,...c}))},replaceGlobal:c=>{e(()=>({...c}))},getGlobal:()=>n()}});function o(e){return a.getState().langList[e]||e}function D(){B(a.setState,"mon"),S()}function j(e){a.setState({loading:e,showBg:e})}function S(){j(!0);const e=a.getState().monUrl+"list";fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(n=>n.json()).then(n=>{a.setState({controlList:n.control,userList:n.user}),j(!1)})}function J({keyName:e,Mes:n}){const s=a(r=>r.nowuser);return t.jsx("div",{className:"action-bar "+(n.user.includes(s)?"have-action":"no-action"),title:o("modify_permission"),onClick:()=>{K(e.control,e.action,s,n.user.includes(s)?"remove":"add")},children:o(n.name)})}function K(e,n,s,r){let c=o(r);if(!confirm(c+"?"))return;j(!0);const l=a.getState().userName,d=a.getState().token,f=a.getState().monUrl+"update_act";fetch(f,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+d,"x-user":l},body:JSON.stringify({user:l,token:d,control:e,action:n,name:s,change:r})}).then(h=>{if(!h.ok){h.status===401?x(o("no_per")):x(o("error")+":"+h.status),j(!1);return}x(o("op_com")),S()})}function W({keyName:e,Mes:n}){const[s,r]=m.useState(!1);return n?t.jsxs("div",{className:"control-bar main-item",children:[t.jsx("span",{className:"control-name",children:o(e)}),s?t.jsx("div",{className:"action-list",children:Object.entries(n.action).map(([c,l])=>t.jsx(J,{keyName:{control:e,action:c},Mes:l},e+c))}):null,t.jsx("button",{className:"btn show-action",title:o("show"),onClick:()=>{r(!s)}})]}):null}function A(){const e=a(n=>n.controlList);return t.jsx(O,{children:e?Object.entries(e).map(([n,s])=>t.jsx(W,{keyName:n,Mes:s},n)):null})}function F({Mes:e}){const[n,s]=m.useState(!1),r=a(d=>d.userList),c=a(d=>d.nowuser),l=a.setState;return t.jsxs("div",{id:"user-box",children:[t.jsx("button",{id:"user-btn",className:"btn",title:o("view_user"),onClick:()=>{s(!0)}}),t.jsx("span",{id:"user-text",onClick:()=>{s(!0)},children:c}),n?t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"user-list",children:Object.entries(r).map(([d])=>t.jsx("div",{className:"name-item",onClick:()=>{l({nowuser:d}),s(!1)},children:t.jsx("span",{children:d})},d+"nameList"))}),t.jsx("div",{id:"user-back",onClick:()=>{s(!1)}})]}):null]})}function M(){const e={never:o("never"),h:o("hour"),d:o("day"),m:o("month"),y:o("year")},n=a(i=>i.userList),s=a(i=>i.nowuser),r=Object.keys(e),[c,l]=m.useState("h"),[d,f]=m.useState(!1),[h,g]=m.useState(""),b=()=>{const u=(r.indexOf(c)+1)%r.length;l(r[u])},C=i=>{const{value:u}=i.target;g(u)},v=i=>{i.key==="Enter"&&w(h,c)},w=(i,u)=>{let p;if(u=="never")p="never";else{if(!(i>=0)){x(o("not_correct"));return}p=i+u}f(!1),g(""),z(s,p)};return n?t.jsxs("div",{id:"time-box",children:[t.jsx("button",{id:"time-btn",className:"btn",title:o("mod_log_time"),onClick:()=>f(!d)}),d?t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"time-input-box",className:"time-text",children:[t.jsx("input",{id:"time-input",placeholder:o("num"),value:h,onChange:C,onKeyDown:v}),t.jsx("button",{className:"btn mini-btn",id:"save-time",title:o("save"),onClick:()=>{w(h,c)}})]}),t.jsx("div",{id:"unit-box",children:t.jsxs("div",{id:"unit-text",children:[t.jsx("span",{children:e[c]}),t.jsx("button",{className:"btn mini-btn",id:"switch-unit",title:o("switch"),onClick:b})]})})]}):t.jsx("span",{className:"time-text",id:"display-time",title:o("allow_login_time"),children:H(n[s].tokentime)+e[R(n[s].tokentime)]})]}):null}function z(e,n){j(!0);const s=a.getState(),r=s.token,c=s.userName,l=s.monUrl+"date";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+r,"x-user":c},body:JSON.stringify({name:e,time:n})}).then(d=>{if(!d.ok){d.status==401?x(o("no_per")):x(o("error")+":"+d.status),j(!1);return}x(o("op_com")),S()})}function H(e){return e=="never"||e==""||!e?"":parseInt(e.slice(0,-1))}function R(e){return e=="never"||e==""||!e?"never":e.slice(-1)}function $(){const e=a(n=>n.userList);return t.jsxs(_,{children:[t.jsx(F,{Mes:e}),t.jsx(M,{})]})}function q(){return t.jsx("button",{className:"btn side-btn",id:"load",title:o("refresh"),onClick:()=>{S()}})}function Q(){return a(e=>e.showCmd),t.jsx("button",{className:"btn side-btn",id:"cmd-btn",title:o("terminal"),onClick:()=>{a.setState({showCmd:!0})}})}function V(){return t.jsxs(E,{children:[t.jsx(Q,{}),t.jsx(q,{})]})}function X(){const e=a(s=>s.showBg),n=a(s=>s.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),t.jsx(N,{showBg:e})]})}function Y(){const e=a(i=>i.showCmd),[n,s]=m.useState("输出"),[r,c]=m.useState(""),[l,d]=m.useState(""),[f,h]=m.useState(""),[g,b]=m.useState([]);m.useEffect(()=>{b(JSON.parse(localStorage.getItem("cmdList"))||[])},[]);const C=(i,u)=>{const p=[...g,{title:i,cmd:u}];b(p),localStorage.setItem("cmdList",JSON.stringify(p))},v=i=>{if(!confirm(o("are_you_sure")))return;const u=[...g.slice(0,i),...g.slice(i+1)];b(u),localStorage.setItem("cmdList",JSON.stringify(u))},w=i=>{i.key==="Enter"&&C(l,f)};return t.jsx(N,{showBg:e,children:t.jsxs("div",{id:"cmd-box",children:[t.jsx("button",{className:"btn",id:"close-cmd",title:o("close"),onClick:()=>{a.setState({showCmd:!1})}}),t.jsx("div",{id:"cus-cmd-box",children:g.map((i,u)=>t.jsxs("div",{className:"cmd-item",title:o("run"),onClick:()=>{c(i.cmd),k(i.cmd,s)},children:[t.jsx("button",{className:"del-cmd btn",title:o("delete"),onClick:p=>{p.stopPropagation(),v(u)}}),t.jsx("span",{className:"cmd-title",children:i.title}),t.jsx("span",{className:"cmd-cmd",children:i.cmd})]},u+i.cmd))}),t.jsxs("div",{id:"send-box",className:"cmd-widget",children:[t.jsx("input",{id:"input-cmd",value:r,placeholder:o("cmd"),onKeyDown:i=>{i.key==="Enter"&&k(r,s)},onChange:i=>c(i.target.value)}),t.jsx("pre",{id:"output-text",children:n}),t.jsx("button",{className:"btn",id:"send-cmd",title:o("run"),onClick:()=>{k(r,s)}})]}),t.jsxs("div",{id:"cus-cmd-input-bar",className:"cmd-widget",children:[t.jsx("input",{placeholder:o("cus_name"),className:"cmd-input",onKeyDown:w,value:l,onChange:i=>d(i.target.value)}),t.jsx("input",{placeholder:o("cmd"),className:"cmd-input",onKeyDown:w,value:f,onChange:i=>h(i.target.value)}),t.jsx("button",{className:"btn",id:"add-cmd",title:o("add"),onClick:()=>{C(l,f)}})]})]})})}function k(e,n){j(!0);const s=a.getState(),r=s.token,c=s.monUrl+"cmd";fetch(c,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+r},body:JSON.stringify({cmd:e})}).then(l=>{if(!l.ok){l.status==401?x(o("no_per")):x(o("error")+":"+l.status),j(!1);return}n(l.text()),j(!1)})}function Z(){return t.jsxs(t.Fragment,{children:[t.jsx(Y,{}),t.jsx(X,{})]})}function tt(){const e=a(n=>n.theme);return m.useEffect(()=>{D()},[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.mon,children:[t.jsxs(I,{children:[t.jsx(U,{}),t.jsx($,{}),t.jsx(G,{}),t.jsx(P,{})]}),t.jsx(Z,{}),t.jsx(V,{}),t.jsx(A,{}),t.jsx(T,{}),t.jsx("div",{className:"wallpaper"})]})}L.createRoot(document.getElementById("root")).render(t.jsx(tt,{}));
