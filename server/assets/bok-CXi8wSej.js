import{c as g,j as o,n as l,r as h,W as b,T as j,b as x}from"./all-C-88BSI4.js";import{P as S,C as w,T as y,S as B,a as N,H as T,G as C,b as v}from"./page-Dh5Avlqg.js";const a=g((t,e)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),showBg:!1,loading:!1,langList:[],bokList:[],bokUrl:`${window.location.origin}/server/bok/`,theme:{mode:"",color:{bok:""}},setGlobal:n=>{t(c=>({...c,...n}))},replaceGlobal:n=>{t(()=>({...n}))},getGlobal:()=>e()}));function s(t){return a.getState().langList[t]}function _(){S(a.setState,"bok"),p()}function p(){i(!0);const t=a.getState().bokUrl+"list";a.getState().edit,fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{a.setState({bokList:e}),i(!1)})}function i(t){a.setState({loading:t,showBg:t})}function G({name:t}){return o.jsxs("div",{className:"bookmark main-item",title:s("view")+t,onClick:()=>{L(t)},children:[o.jsx("button",{className:"btn",id:"del-btn",title:s("delete"),onClick:e=>{e.stopPropagation(),U(t)}}),o.jsx("span",{children:t})]})}function L(t){i(!0);const e=a.getState().bokUrl+"get_url";fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})}).then(n=>{if(!n.ok){l(+s("error")+":"+n.status),i(!1);return}return n.text()}).then(n=>{i(!1),window.location.href=n})}function U(t){if(!confirm(s("are_you_sure")))return;i(!0);const e=a.getState().userName,n=a.getState().token,c=a.getState().bokUrl+"del";fetch(c,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+n,"x-user":e},body:JSON.stringify({name:t})}).then(r=>{if(!r.ok){r.status===401?l(s("no_per")):l(s("error")+":"+r.status),i(!1);return}l(s("op_com")),p()})}function E(){const t=a(e=>e.bokList);return o.jsx(w,{children:t.map((e,n)=>o.jsx(G,{name:e},n+e))})}function P(){const t=[{type:"none",showName:s("no_protocol")},{type:"http",showName:"http://"},{type:"https",showName:"https://"},{type:"file",showName:"file://"}],e=d=>{d.key==="Enter"&&k(r,u)},[n,c]=h.useState(0),[r,f]=h.useState(""),[u,m]=h.useState("");return o.jsxs(y,{children:[o.jsxs("div",{id:"title-box",children:[o.jsx("input",{placeholder:s("bok_name"),onKeyDown:e,id:"tit-input",type:"text",value:r,onChange:d=>f(d.target.value)}),o.jsx("button",{id:"save-add",title:s("save"),className:"btn",onClick:()=>k(r,u)})]}),o.jsxs("div",{id:"link-box",children:[o.jsx("button",{id:"switch-protocol",title:s("switch_protocol"),className:"btn",onClick:()=>{c(d=>(d+1)%t.length)}}),o.jsx("span",{id:"show-protocol",children:t[n].showName}),o.jsx("input",{placeholder:s("bok_url"),id:"link-input",onKeyDown:e,type:"text",value:u,onChange:d=>m(d.target.value)})]})]})}function k(t,e){if(t==""&&(t="new_bookmark"),!e.startsWith("http://")&&!e.startsWith("https://")&!e.startsWith("file://")&&(e="https://"+e,!W(e))){l(s("bok_url")+" "+s("error")+" "+e);return}i(!0);const n=a.getState().userName,c=a.getState().token,r=a.getState().bokUrl+"add",f={name:t,text:e};fetch(r,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+c,"x-user":n},body:JSON.stringify(f)}).then(u=>{if(!u.ok){u.status===401?l(s("no_per")):l(s("error")+":"+u.status),i(!1);return}l(s("op_com")),p()})}function W(t){try{return new URL(t).hostname.includes(".")}catch{return!1}}function I(){return o.jsx(B,{children:o.jsx("button",{className:"btn side-btn",id:"load",title:s("refresh"),onClick:()=>{p()}})})}function O(){const t=a(n=>n.showBg),e=a(n=>n.loading);return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"loading",id:"list-loading",style:e?{display:"block"}:{display:"none"}}),o.jsx(b,{showBg:t})]})}function D(){return o.jsx(o.Fragment,{children:o.jsx(O,{})})}function J(){const t=a(e=>e.theme);return h.useEffect(()=>{_()},[]),o.jsxs("div",{id:"app",mode:t.mode,color:t.color.bok,children:[o.jsx("div",{className:"wallpaper"}),o.jsxs(N,{children:[o.jsx(T,{}),o.jsx(P,{}),o.jsx(C,{}),o.jsx(v,{})]}),o.jsx(D,{}),o.jsx(I,{}),o.jsx(E,{}),o.jsx(j,{})]})}x.createRoot(document.getElementById("root")).render(o.jsx(J,{}));
