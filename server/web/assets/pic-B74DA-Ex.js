import{c as M,n as w,r as h,j as t,W as I,T as U,b as $}from"./all-9OI7PJQr.js";import{P as R,C as O,T as A,S as H,a as V,H as X,G as Y,b as q}from"./page-BNS8bVuN.js";const i=M((e,n)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),nowPath:"",parentPath:"",imgList:[],vidList:[],dirList:[],uploading:!1,showBg:!1,langList:[],pageNum:1,theme:{mode:"",color:{pic:""},userSelect:""},loading:!1,dragWin:!1,imgPage:!0,mediaWin:{status:!1,img:!0,path:window.location.origin+"/file/Pictures/",index:0},upload:{status:!1,percent:"0%"},picUrl:`${window.location.origin}/server/pic/`,setGlobal:o=>{e(s=>({...s,...o}))},replaceGlobal:o=>{e(()=>({...o}))},getGlobal:()=>n()}));function u(e){return i.getState().langList[e]}function J(){R(i.setState,"pic"),y("")}function y(e,n){const o={folder:e},s=i.getState().picUrl+"list";E(!0),fetch(s,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{let r=[],p=[],c=[],m=[],l=[];a.filelist.forEach(g=>{g[1]=="dir"||g[1]=="dir_link"?r.push(g[0]):(g[1]=="file"||g[1]=="file_link")&&(g[2]=="img"&&(m.length<12||(p.push(m),m=[]),m.push(g[0])),g[2]=="vid"&&(l.length<12||(c.push(l),l=[]),l.push(g[0])))}),m.length>0&&p.push(m),l.length>0&&c.push(l),i.setState({dirList:r,imgList:p,vidList:c,nowPath:a.currentFolder,parentPath:a.parentFolder,selected:[],imgPage:!n,pageNum:1}),E(!1)})}function E(e){i.setState({loading:e,showBg:e})}function z(e,n){if(e.size==0){w(e.name+u("is_empty"));return}let o;const s=i.getState();s.userName;const a=s.token,r=s.nowPath,p=s.upload,c=i.setState,m=["jpg","jpeg","png","gif","webp","bmp","svg","ico","apng","avif"],l=["mp4","webm","ogg","ogv","mov","m4v","avi","3gp","mkv"],g=e.name.split(".").pop().toLowerCase();if(m.includes(g))o=!1,c({imgPage:!0});else if(l.includes(g))o=!0,c({imgPage:!1});else{w(e.name+":"+u("not_support_type")),c({upload:{...p,status:!1}});return}const j=s.picUrl+"upload",b=K(e.size),k=Math.ceil(e.size/b);let P=0;function N(){if(n.sendSize>=n.totalSize){c({upload:{...p,status:!1}}),w(u("op_com")),y(r,o);return}if(P>=e.size)return;let d="",f=0;const v=e.slice(P,P+b),L=Math.floor(P/b),S=new FormData;S.append("file",v),S.append("fileName",e.name),S.append("totalChunks",k),S.append("currentChunk",L),S.append("nowpath",r);const x=new XMLHttpRequest;x.open("POST",j,!0),x.setRequestHeader("authorization","Bearer "+a),x.upload.onprogress=function(C){C.lengthComputable&&(n.sendSize=n.sendSize+Math.min(C.loaded,e.size)-f,f=C.loaded,d=Math.floor(n.sendSize/n.totalSize*100)+"%",c({upload:{...p,percent:d}}))},x.onload=function(){if(x.status!==200){x.status===401?w(u("no_per")):w(u("error")+":"+x.status+x.responseText),c({upload:{...p,status:!1}});return}P+=b,N()},x.onerror=function(){console.error(`Chunk ${L+1} upload encountered error.`),c({upload:!1})},x.send(S)}N()}function K(e){return e<=1024*1048576?10*1048576:e<=5120*1048576&&e>1024*1048576?50*1048576:100*1048576}function _(e){i.setState({dragWin:!0}),e.stopPropagation(),e.preventDefault()}function B(e){i.setState({dragWin:!1}),e.stopPropagation(),e.preventDefault()}function T(e){const o=i.getState().upload,s=i.setState;s({dragWin:!1}),e.stopPropagation(),e.preventDefault();const a=e.dataTransfer.items,r=[];let p=0,c=0;function m(g){const j=g.webkitGetAsEntry();if(j){if(j.isDirectory){w(u("not_support_type"));return}j.isFile&&(c++,j.file(b=>{r.push(b),p+=b.size,c--,l()}))}}async function l(){if(c===0){if(r.length===0){w(u("empty"));return}s({upload:{...o,status:!0,win:!1}});const g={totalSize:p,sendSize:0};if(!await D())return;r.forEach(b=>{z(b,g)})}}for(let g=0;g<a.length;g++)m(a[g])}async function D(){i.getState().userName;const e=i.getState().token,n=i.getState().upload,o=window.location.origin+"/server/login/upload",s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${e}`},body:JSON.stringify({appType:"pic",fileType:""})});return s.ok?!0:(s.status==401?w(u("no_per")):w(u("error")+":"+s.status),i.setState({upload:{...n,status:!1}}),!1)}function G({url:e,name:n,type:o,index:s}){const[a,r]=h.useState(!0),[p,c]=h.useState(!1);return h.useEffect(()=>{r(!0),c(!1)},[e]),h.useEffect(()=>{let m;return p&&(m=setTimeout(()=>{r(!1)},100)),()=>clearTimeout(m)},[p]),t.jsxs("div",{className:"pic-item main-item",title:n,onClick:()=>{Q(e,o,s)},children:[a&&t.jsx("div",{className:"media-loading loading"}),o==="img"?t.jsx("img",{src:e+n,loading:"lazy",onLoad:()=>{c(!0)}}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"play-icon btn"}),t.jsx("video",{src:e+n,onLoadedData:()=>{c(!0)}})]})]},e)}function Q(e,n,o){const s=i.setState;s({mediaWin:{url:e,img:n=="img",status:!0,index:o}})}function Z(){const e=i(a=>a.imgList),n=i(a=>a.pageNum),o=i(a=>a.nowPath),s=`${window.location.origin}/file/Pictures/`+o+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((a,r)=>t.jsx(G,{url:s,name:a,type:"img",index:r},s+a)):null})}function tt(){const e=i(a=>a.vidList),n=i(a=>a.pageNum),o=i(a=>a.nowPath),s=`${window.location.origin}/file/Pictures/`+o+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((a,r)=>t.jsx(G,{url:s,name:a,type:"vid",index:r},s+a)):null})}function et(){const[e,n]=h.useState(""),o=i(l=>l.vidList),s=i(l=>l.imgList),a=i(l=>l.pageNum);let p=i(l=>l.imgPage)?s.length:o.length;const c=i.setState,m=l=>{l=Number(l),l>=1&&l<=p&&p!=1?c({pageNum:l}):l==a||w(u("page_num")+u("not_correct"))};return t.jsxs("div",{id:"page-bar",children:[t.jsx("button",{className:"btn",id:"last-page",onClick:()=>{m(a==1?p:a-1)}}),t.jsx("span",{id:"page-num",children:a+"/"+(p==0?1:p)}),t.jsxs("div",{id:"jump-page",children:[t.jsx("input",{id:"page-input",value:e,type:"text",placeholder:u("page_num"),onChange:l=>n(l.target.value),onKeyDown:l=>{l.key=="Enter"&&(m(e),n(""))}}),t.jsx("button",{className:"btn",id:"jump-btn",onClick:()=>{m(e),n("")},title:u("jump")})]}),t.jsx("button",{className:"btn",id:"next-page",onClick:()=>{m(a==p?1:a+1)}})]})}function nt(){const e=i(n=>n.imgPage);return t.jsxs(O,{children:[t.jsx("div",{id:"pic-box",children:e?t.jsx(Z,{}):t.jsx(tt,{})}),t.jsx(et,{})]})}function st(){const e=i(n=>n.nowPath);return t.jsx("button",{id:"home-pic",className:"btn",onClick:()=>{e==""?w(u("main_album")):y("")},title:u("back_main_album")})}function it(){const e=i(o=>o.nowPath),n=i(o=>o.parentPath);return t.jsxs("div",{id:"show-path-box",children:[e==""&&n==""?null:t.jsx("span",{id:"par-text",title:u("back_parent_album"),onClick:()=>{y(n)},children:n==""?u("main_album"):W(n)}),t.jsx("span",{id:"cur-text",children:e==""?u("main_album"):W(e)})]})}function W(e){return e?(e=e.replace(/\/+$/,""),e.split("/").pop()||""):""}function at(){const e=i(n=>n.upload);return t.jsxs("div",{id:"upload-box",children:[t.jsx("div",{id:"progress-box",children:t.jsx("div",{id:"progress-bar",style:{width:e.percent}})}),t.jsx("span",{id:"show-percent",children:e.percent})]})}function ot(){const e=i(n=>n.upload);return t.jsx("div",{id:"top-bar-box",children:e.status?t.jsx(at,{}):t.jsx(it,{})})}function rt(){const[e,n]=h.useState(!1),o=i(r=>r.dirList),s=i(r=>r.nowPath),a=()=>{n(!e)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"dir-list",className:"btn",title:u("view_album"),onClick:()=>a(),children:t.jsx("div",{id:"dir-list-box",style:{display:e?"flex":"none"},children:o.map((r,p)=>t.jsx("div",{id:"dir-item",title:u("view")+r,onClick:()=>{y(s+"/"+r)},children:r},r+p))})}),e?t.jsx("div",{id:"close-list-win",onClick:()=>a()}):null]})}function lt(){return t.jsxs(A,{children:[t.jsx(st,{}),t.jsx(ot,{}),t.jsx(rt,{})]})}function dt(){const e=i.setState,n=i(a=>a.pageNum),o=i(a=>a.imgPage),s=a=>{switch(a){case"img":e({imgPage:!0,pageNum:o?n:1});break;case"vid":e({imgPage:!1,pageNum:o?1:n});break}};return t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn side-btn "+(o?"media-selected":""),id:"img-btn",title:u("image"),onClick:()=>{s("img")}}),t.jsx("button",{className:"btn side-btn "+(o?"":"media-selected"),id:"vid-btn",title:u("video"),onClick:()=>{s("vid")}})]})}function ct(){const e=i.setState;i(s=>s.pageNum),i(s=>s.imgPage);const n=i(s=>s.upload);i(s=>s.dragWin),i(s=>s.nowPath);const o=async s=>{e({upload:{...n,status:!0}});const a=Array.from(s.target.files);let r={totalSize:0,sendSize:0};a.forEach((c,m)=>{r.totalSize+=c.size}),await D()&&(a.forEach((c,m)=>{z(c,r)}),s.target.value=null)};return t.jsxs(t.Fragment,{children:[t.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:s=>o(s)}),t.jsx("label",{className:"btn side-btn",id:"upload",title:u("upload_media"),htmlFor:"upFile"})]})}function ut(){const e=i(n=>n.nowPath);return t.jsx(t.Fragment,{children:t.jsx("button",{className:"btn side-btn",id:"load",title:u("refresh"),onClick:()=>{y(e)}})})}function pt(){return t.jsxs(H,{children:[t.jsx(ct,{}),t.jsx(dt,{}),t.jsx(ut,{})]})}function gt(){const e=i(o=>o.showBg),n=i(o=>o.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),t.jsx(I,{showBg:e})]})}function mt(){const e=i(o=>o.dragWin),n=i(o=>o.upload);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"drag-win",style:e?{display:"flex"}:{display:"none"},children:t.jsx("div",{})}),n.status&&t.jsx("div",{id:"uploading",className:"bg-enable"})]})}function ft(){const e=i.setState,n=i(d=>d.mediaWin),o=i(d=>d.pageNum);let s;n.img?s=i(d=>d.imgList)[o-1]:s=i(d=>d.vidList)[o-1];const[a,r]=h.useState(1),p=h.useRef(null),[c,m]=h.useState(!1),[l,g]=h.useState({x:0,y:0}),[j,b]=h.useState({x:0,y:0}),k=d=>{let f;switch(d){case"in":f=a+.3;break;case"out":if(a-.3<0)return;f=a-.3;break}r(Number(f.toFixed(2)))},P=d=>{g({x:0,y:0}),r(1);let f=n.index;const v=s.length;switch(d){case"min":f--,f=f<0?v-1:f;break;case"add":f++,f=f>v-1?0:f;break}e({mediaWin:{...n,index:f}})};h.useEffect(()=>{const d=v=>{if(!c)return;const L=v.clientX-j.x,S=v.clientY-j.y;g(x=>({x:x.x+L,y:x.y+S})),b({x:v.clientX,y:v.clientY})},f=()=>{m(!1)};return window.addEventListener("mousemove",d),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",f)}},[c,j]);const N=d=>{d.preventDefault(),d.stopPropagation(),m(!0),b({x:d.clientX,y:d.clientY})};return h.useEffect(()=>{n.status&&(g({x:0,y:0}),r(1))},[n.status]),n.status?t.jsxs("div",{className:"bg-enable",onClick:()=>e({mediaWin:{status:!1}}),children:[t.jsx("button",{className:"btn media-btn media-widget",id:"close-media"}),t.jsx("button",{className:"btn media-btn media-widget",id:"last-pic",onClick:d=>{d.stopPropagation(),P("min")}}),t.jsx("button",{className:"btn media-btn media-widget",id:"next-pic",onClick:d=>{d.stopPropagation(),P("add")}}),t.jsx("div",{id:"media-box",ref:p,onMouseDown:N,style:{cursor:c?"grabbing":"grab",transform:`translate(${l.x}px, ${l.y}px) scale(${a})`,transition:c?"none":"transform 0.15s ease-out"},onClick:d=>d.stopPropagation(),children:n.img?t.jsx("img",{loading:"lazy",src:n.url+s[n.index]}):t.jsx("video",{src:n.url+s[n.index],controls:!0,autoPlay:!0,loop:!0})}),t.jsxs("div",{id:"zoom-bar",className:"media-widget",children:[t.jsx("button",{className:"btn zoom-btn",style:{marginRight:"20px"},title:u("zoom_out"),onClick:d=>{d.stopPropagation(),k("out")},children:t.jsx("div",{id:"zoom-out"})}),t.jsx("button",{className:"btn zoom-btn",style:{marginLeft:"20px"},title:u("zoom_in"),onClick:d=>{d.stopPropagation(),k("in")},children:t.jsx("div",{id:"zoom-in"})})]})]}):null}function ht(){return t.jsxs(t.Fragment,{children:[t.jsx(gt,{}),t.jsx(mt,{}),t.jsx(ft,{})]})}function xt(){const e=i(n=>n.theme);return h.useEffect(()=>(J(),window.addEventListener("dragover",_),window.addEventListener("dragleave",B),window.addEventListener("drop",T),window.addEventListener("paste",F),()=>{window.removeEventListener("dragover",_),window.removeEventListener("dragleave",B),window.removeEventListener("drop",T),window.removeEventListener("paste",F)}),[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.pic,children:[t.jsx("div",{className:"wallpaper"}),t.jsxs(V,{children:[t.jsx(X,{}),t.jsx(lt,{}),t.jsx(Y,{}),t.jsx(q,{})]}),t.jsx(ht,{}),t.jsx(pt,{}),t.jsx(nt,{}),t.jsx(U,{})]})}function F(e){if(!e)return;const n=e.clipboardData.items[0];if(n.type.startsWith("image/")&&confirm(u("are_you_sure"))){const o=n.getAsFile(),s={totalSize:o.size,sendSize:0};z(o,s)}}$.createRoot(document.getElementById("root")).render(t.jsx(xt,{}));
