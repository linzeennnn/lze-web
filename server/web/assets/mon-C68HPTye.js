import{c as k,A as g,j as t,f as o,l as C,r as d,n as S,W as y,e as B,P as T,m as E}from"./all-B5MRgsKL.js";import{P as I,C as U,T as _,S as G,a as O,H as A,G as W,b as D}from"./page-DHHrF6de.js";const a=k((e,s)=>{const n=window.localStorage.getItem("userName"),c=window.localStorage.getItem("token");return{userName:n,token:c,nowuser:n?.trim()||"guest",showBg:!1,loading:!1,controlList:null,langList:[],userList:null,showCmd:!1,showLogout:!1,theme:{mode:"",color:{mon:""}},monUrl:`${window.location.origin}/server/mon/`,setGlobal:r=>{e(m=>({...m,...r}))},replaceGlobal:r=>{e(()=>({...r}))},getGlobal:()=>s()}});function P(){I(a.setState,"mon"),v()}function v(){g.get({api:"mon/list",success:e=>{a.setState({controlList:e.control,userList:e.user})}})}function K({keyName:e,Mes:s}){const n=a(c=>c.nowuser);return t.jsx("div",{className:"action-bar "+(s.user.includes(n)?"have-action":"no-action"),title:o("modify_permission"),onClick:()=>{F(e.control,e.action,n,s.user.includes(n)?"remove":"add")},children:o(s.name)})}async function F(e,s,n,c){let r=o(c);await C.normal(r+"?")&&g.patch({api:"mon/update_act",body:{control:e,action:s,name:n,change:c},notice:!0,success:()=>{v()}})}function M({keyName:e,Mes:s}){const[n,c]=d.useState(!1);return s?t.jsxs("div",{className:"control-bar main-item",children:[t.jsx("span",{className:"control-name",children:o(e)}),n?t.jsx("div",{className:"action-list",children:Object.entries(s.action).map(([r,m])=>t.jsx(K,{keyName:{control:e,action:r},Mes:m},e+r))}):null,t.jsx("button",{className:"btn show-action",title:o("show"),onClick:()=>{c(!n)}})]}):null}function J(){const e=a(s=>s.controlList);return t.jsx(U,{children:e?Object.entries(e).map(([s,n])=>t.jsx(M,{keyName:s,Mes:n},s)):null})}function R({Mes:e}){const[s,n]=d.useState(!1),c=a(u=>u.userList),r=a(u=>u.nowuser),m=a.setState;return t.jsxs("div",{id:"user-box",children:[t.jsx("button",{id:"user-btn",className:"btn",title:o("view_user"),onClick:()=>{n(!0)}}),t.jsx("span",{id:"user-text",onClick:()=>{n(!0)},children:r}),s?t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"user-list",children:Object.entries(c).map(([u])=>t.jsx("div",{className:"name-item",onClick:()=>{m({nowuser:u}),n(!1)},children:t.jsx("span",{children:u})},u+"nameList"))}),t.jsx("div",{id:"user-back",onClick:()=>{n(!1)}})]}):null]})}function H(){const e={never:o("never"),h:o("hour"),d:o("day"),m:o("month"),y:o("year")},s=a(i=>i.userList),n=a(i=>i.nowuser),c=Object.keys(e),[r,m]=d.useState("h"),[u,h]=d.useState(!1),[p,j]=d.useState(""),b=()=>{const l=(c.indexOf(r)+1)%c.length;m(c[l])},w=i=>{const{value:l}=i.target;j(l)},L=i=>{i.key==="Enter"&&f(p,r)},f=(i,l)=>{let x;if(l=="never")x="never";else{if(!(i>=0)){S.err(o("not_correct"));return}x=i+l}h(!1),j(""),$(n,x)};return s?t.jsxs("div",{id:"time-box",children:[t.jsx("button",{id:"time-btn",className:"btn",title:o("mod_log_time"),onClick:()=>h(!u)}),u?t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"time-input-box",className:"time-text",children:[t.jsx("input",{id:"time-input",placeholder:o("num"),value:p,onChange:w,onKeyDown:L}),t.jsx("button",{className:"btn mini-btn",id:"save-time",title:o("save"),onClick:()=>{f(p,r)}})]}),t.jsx("div",{id:"unit-box",children:t.jsxs("div",{id:"unit-text",children:[t.jsx("span",{children:e[r]}),t.jsx("button",{className:"btn mini-btn",id:"switch-unit",title:o("switch"),onClick:b})]})})]}):t.jsx("span",{className:"time-text",id:"display-time",title:o("allow_login_time"),children:q(s[n].tokentime)+e[z(s[n].tokentime)]})]}):null}function $(e,s){g.patch({api:"mon/date",body:{name:e,time:s},notice:!0,success:()=>[v()]})}function q(e){return e=="never"||e==""||!e?"":parseInt(e.slice(0,-1))}function z(e){return e=="never"||e==""||!e?"never":e.slice(-1)}function Q(){const e=a(s=>s.userList);return t.jsxs(_,{children:[t.jsx(R,{Mes:e}),t.jsx(H,{})]})}function V(){return t.jsx("button",{className:"btn side-btn",id:"load",title:o("refresh"),onClick:()=>{v()}})}function X(){return a(e=>e.showCmd),t.jsx("button",{className:"btn side-btn",id:"cmd-btn",title:o("terminal"),onClick:()=>{a.setState({showCmd:!0})}})}function Y(){return a(e=>e.showLogout),t.jsx("button",{className:"btn side-btn",id:"logout-btn",title:o("logout"),onClick:()=>{a.setState({showLogout:!0})}})}function Z(){return t.jsxs(G,{children:[t.jsx(X,{}),t.jsx(Y,{}),t.jsx(V,{})]})}function tt(){const e=a(n=>n.showBg),s=a(n=>n.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:s?{display:"block"}:{display:"none"}}),t.jsx(y,{showBg:e})]})}function et(){const e=a(i=>i.showCmd),[s,n]=d.useState("输出"),[c,r]=d.useState(""),[m,u]=d.useState(""),[h,p]=d.useState(""),[j,b]=d.useState([]);d.useEffect(()=>{b(JSON.parse(localStorage.getItem("cmdList"))||[])},[]);const w=(i,l)=>{if(m==""||h==""){S.normal(o("none"));return}u(""),p("");const x=[...j,{title:i,cmd:l}];b(x),localStorage.setItem("cmdList",JSON.stringify(x)),S.normal(o("op_com"))},L=async i=>{if(!await C.normal(o("are_you_sure")))return;const l=[...j.slice(0,i),...j.slice(i+1)];b(l),localStorage.setItem("cmdList",JSON.stringify(l))},f=i=>{i.key==="Enter"&&w(m,h)};return t.jsx(y,{showBg:e,children:t.jsxs("div",{id:"cmd-box",children:[t.jsx("button",{className:"btn",id:"close-cmd",title:o("close"),onClick:()=>{a.setState({showCmd:!1})}}),t.jsx("div",{id:"cus-cmd-box",children:j.map((i,l)=>t.jsxs("div",{className:"cmd-item",title:o("run"),onClick:()=>{r(i.cmd),N(i.cmd,n)},children:[t.jsx("button",{className:"del-cmd btn",title:o("delete"),onClick:x=>{x.stopPropagation(),L(l)}}),t.jsx("span",{className:"cmd-title",children:i.title}),t.jsx("span",{className:"cmd-cmd",children:i.cmd})]},l+i.cmd))}),t.jsxs("div",{id:"send-box",className:"cmd-widget",children:[t.jsx("input",{id:"input-cmd",value:c,placeholder:o("cmd"),onKeyDown:i=>{i.key==="Enter"&&N(c,n)},onChange:i=>r(i.target.value)}),t.jsx("pre",{id:"output-text",children:s}),t.jsx("button",{className:"btn",id:"send-cmd",title:o("run"),onClick:()=>{N(c,n)}})]}),t.jsxs("div",{id:"cus-cmd-input-bar",className:"cmd-widget",children:[t.jsx("input",{placeholder:o("cus_name"),className:"cmd-input",onKeyDown:f,value:m,onChange:i=>u(i.target.value)}),t.jsx("input",{placeholder:o("cmd"),className:"cmd-input",onKeyDown:f,value:h,onChange:i=>p(i.target.value)}),t.jsx("button",{className:"btn",id:"add-cmd",title:o("add"),onClick:()=>{w(m,h)}})]})]})})}async function N(e,s){await C.normal(o("run")+"?")&&g.post({api:"mon/cmd",body:{cmd:e},success:n=>{s(n)}})}function st(){const[e,s]=d.useState([]),n=a(c=>c.showLogout);return d.useEffect(()=>{(async()=>{const r=await ot();s(r)})()},[]),t.jsx(y,{showBg:n,children:t.jsxs("div",{id:"user-list-box",children:[t.jsx("button",{id:"close-logout",className:"btn",title:o("close"),onClick:()=>{a.setState({showLogout:!1})}}),e.map(c=>t.jsxs("div",{className:"user-item-box",children:[t.jsx("button",{className:"del-uaer-btn btn",title:o("delete"),onClick:()=>{nt(c,s)}}),t.jsx("span",{className:"user-showname",children:c})]},c+"-user-box"))]})})}async function nt(e,s){await C.normal(o("are_you_sure"))&&g.delete({api:"mon/userList",body:{name:e},notice:!0,success:n=>{s(n)}})}async function ot(){const e=await B.get({api:"mon/userList"});return e||[]}function it(){return t.jsxs(t.Fragment,{children:[t.jsx(et,{}),t.jsx(st,{}),t.jsx(tt,{})]})}function ct(){const e=a(s=>s.theme);return t.jsxs("div",{id:"app",mode:e.mode,color:e.color.mon,children:[t.jsxs(O,{children:[t.jsx(A,{}),t.jsx(Q,{}),t.jsx(W,{}),t.jsx(D,{})]}),t.jsx(it,{}),t.jsx(Z,{}),t.jsx(J,{}),t.jsx(T,{}),t.jsx("div",{className:"wallpaper"})]})}P();E.createRoot(document.getElementById("root")).render(t.jsx(ct,{}));
