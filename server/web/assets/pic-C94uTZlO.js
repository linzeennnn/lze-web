import{c as M,n as j,r as h,j as t,W as I,T as U,b as $}from"./all-BL_U5SVG.js";import{P as R,C as H,T as O,S as A,a as V,H as X,G as q,b as Y}from"./page-LTMY0JaK.js";const i=M((e,n)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),nowPath:"",parentPath:"",imgList:[],vidList:[],dirList:[],uploading:!1,showBg:!1,langList:[],pageNum:1,theme:{mode:"",color:{pic:""},userSelect:""},loading:!1,dragWin:!1,imgPage:!0,mediaWin:{status:!1,img:!0,path:window.location.origin+"/file/Pictures/",index:0},upload:{status:!1,percent:"0%"},picUrl:`${window.location.origin}/server/pic/`,setGlobal:o=>{e(a=>({...a,...o}))},replaceGlobal:o=>{e(()=>({...o}))},getGlobal:()=>n()}));function p(e){return i.getState().langList[e]}function J(){R(i.setState,"pic"),k("")}function k(e,n){const o={folder:e},a=i.getState().picUrl+"list";E(!0),fetch(a,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{let l=[],m=[],u=[],d=[],r=[];s.filelist.forEach(g=>{g[1]=="dir"||g[1]=="dir_link"?l.push(g[0]):(g[1]=="file"||g[1]=="file_link")&&(g[2]=="img"&&(d.length<12||(m.push(d),d=[]),d.push(g[0])),g[2]=="vid"&&(r.length<12||(u.push(r),r=[]),r.push(g[0])))}),d.length>0&&m.push(d),r.length>0&&u.push(r),i.setState({dirList:l,imgList:m,vidList:u,nowPath:s.currentFolder,parentPath:s.parentFolder,selected:[],imgPage:!n,pageNum:1}),E(!1)})}function E(e){i.setState({loading:e,showBg:e})}function G(e,n){if(e.size==0){j(e.name+p("is_empty"));return}let o;const a=i.getState(),s=a.userName,l=a.token,m=a.nowPath,u=a.upload,d=i.setState,r=["jpg","jpeg","png","gif","webp","bmp","svg","ico","apng","avif"],g=["mp4","webm","ogg","ogv","mov","m4v","avi","3gp","mkv"],x=e.name.split(".").pop().toLowerCase();if(r.includes(x))o=!1,d({imgPage:!0});else if(g.includes(x))o=!0,d({imgPage:!1});else{j(e.name+":"+p("not_support_type")),d({upload:{...u,status:!1}});return}const v=a.picUrl+"upload",S=K(e.size),L=Math.ceil(e.size/S);let y=0;function c(){if(n.sendSize>=n.totalSize){d({upload:{...u,status:!1}}),j(p("op_com")),k(m,o);return}if(y>=e.size)return;let f="",w=0;const C=e.slice(y,y+S),N=Math.floor(y/S),P=new FormData;P.append("file",C),P.append("fileName",e.name),P.append("totalChunks",L),P.append("currentChunk",N),P.append("nowpath",m);const b=new XMLHttpRequest;b.open("POST",v,!0),b.setRequestHeader("authorization","Bearer "+l),b.setRequestHeader("x-user",s),b.upload.onprogress=function(z){z.lengthComputable&&(n.sendSize=n.sendSize+Math.min(z.loaded,e.size)-w,w=z.loaded,f=Math.floor(n.sendSize/n.totalSize*100)+"%",d({upload:{...u,percent:f}}))},b.onload=function(){if(b.status!==200){b.status===401?j(p("no_per")):j(p("error")+":"+b.status+b.responseText),d({upload:{...u,status:!1}});return}y+=S,c()},b.onerror=function(){console.error(`Chunk ${N+1} upload encountered error.`),d({upload:!1})},b.send(P)}c()}function K(e){return e<=1024*1048576?10*1048576:e<=5120*1048576&&e>1024*1048576?50*1048576:100*1048576}function _(e){i.setState({dragWin:!0}),e.stopPropagation(),e.preventDefault()}function B(e){i.setState({dragWin:!1}),e.stopPropagation(),e.preventDefault()}function T(e){const o=i.getState().upload,a=i.setState;a({dragWin:!1}),e.stopPropagation(),e.preventDefault();const s=e.dataTransfer.items,l=[];let m=0,u=0;function d(g){const x=g.webkitGetAsEntry();if(x){if(x.isDirectory){j(p("not_support_type"));return}x.isFile&&(u++,x.file(v=>{l.push(v),m+=v.size,u--,r()}))}}async function r(){if(u===0){if(l.length===0){j(p("empty"));return}a({upload:{...o,status:!0,win:!1}});const g={totalSize:m,sendSize:0};if(!await F())return;l.forEach(v=>{G(v,g)})}}for(let g=0;g<s.length;g++)d(s[g])}async function F(){const e=i.getState().userName,n=i.getState().token,o=i.getState().upload,a=window.location.origin+"/server/login/upload",s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${n}`,"x-user":e},body:JSON.stringify({appType:"pic",fileType:""})});return s.ok?!0:(s.status==401?j(p("no_per")):j(p("error")+":"+s.status),i.setState({upload:{...o,status:!1}}),!1)}function D({url:e,name:n,type:o,index:a}){const[s,l]=h.useState(!0),[m,u]=h.useState(!1);h.useEffect(()=>{l(!0),u(!1)},[e]),h.useEffect(()=>{let r;return m&&(r=setTimeout(()=>{l(!1)},100)),()=>clearTimeout(r)},[m]);const d=()=>{u(!0)};return t.jsxs("div",{className:"pic-item main-item",title:n,onClick:()=>{Q(e,o,a)},children:[s&&t.jsx("div",{className:"media-loading loading"}),o==="img"?t.jsx("img",{src:e+n,loading:"lazy",onLoad:d}):t.jsx("video",{src:e+n,onLoadedData:d})]},e)}function Q(e,n,o){const a=i.setState;a({mediaWin:{url:e,img:n=="img",status:!0,index:o}})}function Z(){const e=i(s=>s.imgList),n=i(s=>s.pageNum),o=i(s=>s.nowPath),a=`${window.location.origin}/file/Pictures/`+o+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((s,l)=>t.jsx(D,{url:a,name:s,type:"img",index:l},a+s)):null})}function tt(){const e=i(s=>s.vidList),n=i(s=>s.pageNum),o=i(s=>s.nowPath),a=`${window.location.origin}/file/Pictures/`+o+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((s,l)=>t.jsx(D,{url:a,name:s,type:"vid",index:l},a+s)):null})}function et(){const[e,n]=h.useState(""),o=i(r=>r.vidList),a=i(r=>r.imgList),s=i(r=>r.pageNum);let m=i(r=>r.imgPage)?a.length:o.length;const u=i.setState,d=r=>{r>=1&&r<=m&&m!=1?u({pageNum:r}):r==s||j(p("page_num")+p("not_correct"))};return t.jsxs("div",{id:"page-bar",children:[t.jsx("button",{className:"btn",id:"last-page",onClick:()=>{d(s==1?m:s-1)}}),t.jsx("span",{id:"page-num",children:s+"/"+(m==0?1:m)}),t.jsxs("div",{id:"jump-page",children:[t.jsx("input",{id:"page-input",value:e,type:"text",placeholder:p("page_num"),onChange:r=>n(r.target.value),onKeyDown:r=>{r.key=="Enter"&&(d(e),n(""))}}),t.jsx("button",{className:"btn",id:"jump-btn",onClick:()=>{d(e),n("")},title:p("jump")})]}),t.jsx("button",{className:"btn",id:"next-page",onClick:()=>{d(s==m?1:s+1)}})]})}function nt(){const e=i(n=>n.imgPage);return t.jsxs(H,{children:[t.jsx("div",{id:"pic-box",children:e?t.jsx(Z,{}):t.jsx(tt,{})}),t.jsx(et,{})]})}function st(){const e=i(n=>n.nowPath);return t.jsx("button",{id:"home-pic",className:"btn",onClick:()=>{e==""?j(p("main_album")):k("")},title:p("back_main_album")})}function it(){const e=i(o=>o.nowPath),n=i(o=>o.parentPath);return t.jsxs("div",{id:"show-path-box",children:[e==""&&n==""?null:t.jsx("span",{id:"par-text",title:p("back_parent_album"),onClick:()=>{k(n)},children:n==""?p("main_album"):W(n)}),t.jsx("span",{id:"cur-text",children:e==""?p("main_album"):W(e)})]})}function W(e){return e?(e=e.replace(/\/+$/,""),e.split("/").pop()||""):""}function at(){const e=i(n=>n.upload);return t.jsxs("div",{id:"upload-box",children:[t.jsx("div",{id:"progress-box",children:t.jsx("div",{id:"progress-bar",style:{width:e.percent}})}),t.jsx("span",{id:"show-percent",children:e.percent})]})}function ot(){const e=i(n=>n.upload);return t.jsx("div",{id:"top-bar-box",children:e.status?t.jsx(at,{}):t.jsx(it,{})})}function rt(){const[e,n]=h.useState(!1),o=i(l=>l.dirList),a=i(l=>l.nowPath),s=()=>{n(!e)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"dir-list",className:"btn",title:p("view_album"),onClick:()=>s(),children:t.jsx("div",{id:"dir-list-box",style:{display:e?"flex":"none"},children:o.map((l,m)=>t.jsx("div",{id:"dir-item",title:p("view")+l,onClick:()=>{k(a+"/"+l)},children:l},l+m))})}),e?t.jsx("div",{id:"close-list-win",onClick:()=>s()}):null]})}function lt(){return t.jsxs(O,{children:[t.jsx(st,{}),t.jsx(ot,{}),t.jsx(rt,{})]})}function ct(){const e=i.setState,n=i(s=>s.pageNum),o=i(s=>s.imgPage),a=s=>{switch(s){case"img":e({imgPage:!0,pageNum:o?n:1});break;case"vid":e({imgPage:!1,pageNum:o?1:n});break}};return t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn side-btn",id:"img-btn",title:p("image"),onClick:()=>{a("img")}}),t.jsx("button",{className:"btn side-btn",id:"vid-btn",title:p("video"),onClick:()=>{a("vid")}})]})}function dt(){const e=i.setState;i(a=>a.pageNum),i(a=>a.imgPage);const n=i(a=>a.upload);i(a=>a.dragWin),i(a=>a.nowPath);const o=async a=>{e({upload:{...n,status:!0}});const s=Array.from(a.target.files);let l={totalSize:0,sendSize:0};s.forEach((u,d)=>{l.totalSize+=u.size}),await F()&&(s.forEach((u,d)=>{G(u,l)}),a.target.value=null)};return t.jsxs(t.Fragment,{children:[t.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:a=>o(a)}),t.jsx("label",{className:"btn side-btn",id:"upload",title:p("upload_media"),htmlFor:"upFile"})]})}function ut(){const e=i(n=>n.nowPath);return t.jsx(t.Fragment,{children:t.jsx("button",{className:"btn side-btn",id:"load",title:p("refresh"),onClick:()=>{k(e)}})})}function pt(){return t.jsxs(A,{children:[t.jsx(dt,{}),t.jsx(ct,{}),t.jsx(ut,{})]})}function gt(){const e=i(o=>o.showBg),n=i(o=>o.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),t.jsx(I,{showBg:e})]})}function mt(){const e=i(o=>o.dragWin),n=i(o=>o.upload);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"drag-win",style:e?{display:"flex"}:{display:"none"},children:t.jsx("div",{})}),n.status&&t.jsx("div",{id:"uploading",className:"bg-enable"})]})}function ft(){const e=i.setState,n=i(c=>c.mediaWin),o=i(c=>c.pageNum);let a;n.img?a=i(c=>c.imgList)[o-1]:a=i(c=>c.vidList)[o-1];const[s,l]=h.useState(1),m=h.useRef(null),[u,d]=h.useState(!1),[r,g]=h.useState({x:0,y:0}),[x,v]=h.useState({x:0,y:0}),S=c=>{let f;switch(c){case"in":f=s+.3;break;case"out":if(s-.3<0)return;f=s-.3;break}l(Number(f.toFixed(2)))},L=c=>{g({x:0,y:0}),l(1);let f=n.index;const w=a.length;switch(c){case"min":f--,f=f<0?w-1:f;break;case"add":f++,f=f>w-1?0:f;break}e({mediaWin:{...n,index:f}})};h.useEffect(()=>{const c=w=>{if(!u)return;const C=w.clientX-x.x,N=w.clientY-x.y;g(P=>({x:P.x+C,y:P.y+N})),v({x:w.clientX,y:w.clientY})},f=()=>{d(!1)};return window.addEventListener("mousemove",c),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",f)}},[u,x]);const y=c=>{c.preventDefault(),c.stopPropagation(),d(!0),v({x:c.clientX,y:c.clientY})};return h.useEffect(()=>{n.status&&(g({x:0,y:0}),l(1))},[n.status]),n.status?t.jsxs("div",{className:"bg-enable",onClick:()=>e({mediaWin:{status:!1}}),children:[t.jsx("button",{className:"btn media-btn media-widget",id:"close-media"}),t.jsx("button",{className:"btn media-btn media-widget",id:"last-pic",onClick:c=>{c.stopPropagation(),L("min")}}),t.jsx("button",{className:"btn media-btn media-widget",id:"next-pic",onClick:c=>{c.stopPropagation(),L("add")}}),t.jsx("div",{id:"media-box",ref:m,onMouseDown:y,style:{cursor:u?"grabbing":"grab",transform:`translate(${r.x}px, ${r.y}px) scale(${s})`,transition:u?"none":"transform 0.15s ease-out"},onClick:c=>c.stopPropagation(),children:n.img?t.jsx("img",{loading:"lazy",src:n.url+a[n.index]}):t.jsx("video",{src:n.url+a[n.index],controls:!0,autoPlay:!0,loop:!0})}),t.jsxs("div",{id:"zoom-bar",className:"media-widget",children:[t.jsx("button",{className:"btn",id:"zoom-out",style:{marginRight:"20px"},title:p("zoom_out"),onClick:c=>{c.stopPropagation(),S("out")}}),t.jsx("button",{className:"btn",id:"zoom-in",style:{marginLeft:"20px"},title:p("zoom_in"),onClick:c=>{c.stopPropagation(),S("in")}})]})]}):null}function ht(){return t.jsxs(t.Fragment,{children:[t.jsx(gt,{}),t.jsx(mt,{}),t.jsx(ft,{})]})}function xt(){const e=i(n=>n.theme);return h.useEffect(()=>(J(),window.addEventListener("dragover",_),window.addEventListener("dragleave",B),window.addEventListener("drop",T),()=>{window.removeEventListener("dragover",_),window.removeEventListener("dragleave",B),window.removeEventListener("drop",T)}),[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.pic,children:[t.jsx("div",{className:"wallpaper"}),t.jsxs(V,{children:[t.jsx(X,{}),t.jsx(lt,{}),t.jsx(q,{}),t.jsx(Y,{})]}),t.jsx(ht,{}),t.jsx(pt,{}),t.jsx(nt,{}),t.jsx(U,{})]})}$.createRoot(document.getElementById("root")).render(t.jsx(xt,{}));
