import{c as O,m as E,A as k,S as T,f as H,n as g,h as l,t as q,v as G,j as s,p as R,W as N,w as V,r as p,l as v,u as X,P as J,q as M}from"./all-DWkV-mtA.js";import{P as Q,C as Y,T as Z,S as ee,a as te,H as ne,G as se,b as oe}from"./page-CbAAv2xf.js";import{a as P}from"./page-C3qsDjGe.js";function ie(e){return e?e.split("/").pop():""}function ae(e){if(!e)return"";const t=e.lastIndexOf("/");return t===-1?"":e.slice(0,t)||"/"}const r=O((e,t)=>({nowPath:"",parentPath:"",fileList:[],uploading:!1,linkWin:{show:!1,link:""},showBg:!1,loading:!1,dragWin:!1,fileWin:{status:!1,url:"",view:!1,data:null,currentType:"",path:""},upload:{win:!1,status:!1,percent:"0%"},selected:[],setGlobal:n=>{e(o=>({...o,...n}))},replaceGlobal:n=>{e(()=>({...n}))},getGlobal:()=>t()}));function le(){Q("doc");const t=E().doc.list.path;h(t)}function h(e){const t=E(),n=t.doc.list.path;k.post({api:"doc/list",body:{file:e},success:o=>{de(!1),o.type=="dir"&&(r.setState({fileList:o.filelist,nowPath:o.currentFolder,parentPath:o.parentFolder,selected:[]}),n!=""&&(t.doc.list.path="",T(t))),o.type=="file"&&U(o,e)}})}function U(e,t){ce(t,e.innerApp[0],e.url);const n=e.innerApp.length!=0;r.setState({fileWin:{status:!0,url:re(e.innerApp[0],e.url),view:n,innerApp:e.innerApp,currentType:n?e.innerApp[0]:"",data:e,path:t}})}function re(e,t){let n;switch(e){case"doc":n=P(t);break;case"img":n=P("pic");break;case"vid":n=P("pic");break;case"not":n=P("not");break;default:n="";break}return n}function ce(e,t,n){const o=E(),i=o.doc.list.path;let a={source:"doc",enable:!0,name:ie(e)};t=="img"||t=="vid"?(t=="img"&&(a.media="img"),t=="vid"&&(a.media="vid"),a.url=P(ae(n)+"/"),o.pic.inner=a):t=="not"?(a.path=e,o.not.inner=a):(a.source="",a.enable=!1,a.name=""),T(o),i!=""&&h("")}function de(e){r.setState({loading:e,showBg:e})}function I(e,t,n){if(e.size==0){g.err(l("error")+":"+e.name+l("is_empty"));return}const o=r.getState(),i=q(),a=o.nowPath,c=o.upload,u=r.setState,f=G()+"doc/",m=n==="file"?f+"upload_file":f+"upload_folder",d=pe(e.size),w=Math.ceil(e.size/d);let b=0;function S(){if(t.sendSize>=t.totalSize&&!t.completed){if(u({upload:{...c,status:!1}}),n==="file")t.completed=!0,g.normal(l("op_com")),h(a);else if(n==="dir"){const y=e.webkitRelativePath.split("/")[0];ue(y)}return}if(b>=e.size)return;let C=0,_=0;const $=e.slice(b,b+d),D=Math.floor(b/d),j=new FormData;if(j.append("file",$),j.append("fileName",e.name),j.append("totalChunks",w),j.append("currentChunk",D),n==="dir"){const y=e.webkitRelativePath;j.append("relativePath",y)}n==="file"&&j.append("nowpath",a);const x=new XMLHttpRequest;x.open("POST",m,!0),x.setRequestHeader("authorization","Bearer "+i),x.upload.onprogress=function(y){y.lengthComputable&&(t.sendSize=t.sendSize+Math.min(y.loaded,e.size)-C,C=y.loaded,_=Math.floor(t.sendSize/t.totalSize*100)+"%",u({upload:{...c,percent:_}}))},x.onload=function(){if(x.status!=200){x.status==401?g.err(l("no_per")):g.err(l("error")+":"+x.status),u({upload:{...c,status:!1}}),t.completed=!0;return}else b+=d,S()},x.onerror=function(){console.error(`Chunk ${D+1} upload encountered error.`),u({upload:!1})},x.send(j)}S()}function ue(e){const t=r.getState();k.post({api:"doc/move_folder",body:{name:e,path:t.nowPath},success:()=>{h(t.nowPath)}})}function pe(e){return e<=100*1048576?2*1048576:e<=1024*1048576?5*1048576:e<=10240*1048576?10*1048576:20*1048576}function L(e){r.setState({dragWin:!0}),e.stopPropagation(),e.preventDefault()}function W(e){r.setState({dragWin:!1}),e.stopPropagation(),e.preventDefault()}function F(e){const n=r.getState().upload,o=r.setState;o({dragWin:!1}),e.stopPropagation(),e.preventDefault();const i=e.dataTransfer.items,a=[];let c=0,u=0;function f(d,w=""){if(d.isFile)u++,d.file(b=>{w&&Object.defineProperty(b,"webkitRelativePath",{value:w+b.name}),a.push(b),c+=b.size,u--,m()});else if(d.isDirectory){const b=d.createReader();u++,b.readEntries(S=>{u--;for(const C of S)f(C,w+d.name+"/");m()})}}async function m(){if(u===0){if(a.length===0){g.err(l("empty"));return}o({upload:{...n,status:!0,win:!1}});const d={totalSize:c,sendSize:0,completed:!1},w=a[0].webkitRelativePath?"dir":"file";if(!await K(w))return;a.forEach(S=>{I(S,d,w)})}}for(let d=0;d<i.length;d++){const w=i[d].webkitGetAsEntry();w&&f(w)}}async function K(e){const t=r.getState().upload;return await H.post({api:"login/upload",body:{appType:"doc",fileType:e}})==null?(r.setState({upload:{...t,status:!1}}),!1):!0}function fe({fileMes:e,editing:t,nameEdit:n,rename:o}){const[i,a]=n,[c,u]=t,f=r(d=>d.nowPath),m=d=>{d.key==="Enter"&&(o(e[0],i),u(!1))};return s.jsx(s.Fragment,{children:c?s.jsx("input",{value:i,className:"file-list-text file-list-input",onClick:d=>d.stopPropagation(),onChange:d=>a(d.target.value),onKeyDown:m}):s.jsx("span",{className:(e[1]==="dir"||e[1]==="dir_link"?"dir-text":"file-text")+" file-list-text",title:l("view")+e[0],onClick:d=>{d.stopPropagation(),h(f+"/"+e[0])},children:e[0]})})}function me({name:e,editing:t,newName:n,rename:o}){const[i,a]=t;return s.jsx(s.Fragment,{children:i?s.jsx("button",{className:"save-name file-edit-btn btn",title:l("save"),onClick:c=>{c.stopPropagation(),a(!1),o(e,n)}}):s.jsx("button",{className:"edit-name file-edit-btn btn",title:l("rename"),onClick:c=>{c.stopPropagation(),a(!0)}})})}function be({fileMes:e}){const t=r.getState();return s.jsx("button",{className:"down-btn btn",title:l("download")+":"+e[0],onClick:n=>{n.stopPropagation(),e[1]==="file"||e[1]==="file_link"?z(t.nowPath+"/"+e[0],!0):z(t.nowPath+"/"+e[0],!1)}})}async function z(e,t){if(!await R.normal(l("are_you_sure")))return;r.getState();const o="doc/"+(t?"download_file":"download_folder");k.post({api:o,notice:!0,body:{path:e},success:i=>{he(G()+o+"/"+i)}})}function he(e){console.log(e);const t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function we(){const e=r.setState,t=r(n=>n.linkWin);return s.jsx(s.Fragment,{children:s.jsx(N,{showBg:t.show,children:s.jsxs("div",{id:"link-win",children:[s.jsx("button",{id:"close-link-btn",onClick:()=>{e({linkWin:{link:"",show:!1}})},title:l("close"),className:"btn link-win-btn"}),s.jsx("span",{onClick:()=>{xe()},children:t.link}),s.jsx("button",{id:"copy-link-btn",title:l("copy"),className:"btn link-win-btn",onClick:()=>{ge()}})]})})})}function ge(){V(r.getState().linkWin.link)}function xe(){window.open(r.getState().linkWin.link,"_blank")}function ke({name:e}){return s.jsx("button",{className:"btn link-btn",title:l("get_link"),onClick:t=>{t.stopPropagation(),je(e)}})}function je(e){const n=r.getState().nowPath+"/"+e;k.post({api:"doc/link",notice:!0,body:{path:n},success:o=>{r.setState({linkWin:{link:encodeURI(window.location.origin+"/"+o),show:!0}})}})}function ye({fileMes:e,selected:t,docClick:n}){const[o,i]=p.useState(!1),[a,c]=p.useState(e[0]),f=r.getState().nowPath+"/"+e[0];return s.jsxs("div",{className:"doc-list main-item "+(t.includes(f)?"doc-list-selected ":"")+(e[1]==="dir"||e[1]==="dir_link"?"dir-item ":"file-item "),onClick:()=>n(f),children:[s.jsx(fe,{fileMes:e,editing:[o,i],nameEdit:[a,c],rename:A}),s.jsx(me,{name:e[0],editing:[o,i],newName:a,rename:A}),s.jsx(be,{fileMes:e}),e[1]==="dir"||e[1]==="dir_link"?null:s.jsx(ke,{name:e[0]})]},"doclist"+e[0])}function A(e,t){if(e==t)return;const n=r.getState(),o=n.nowPath+"/"+e,i=n.nowPath+"/"+t;k.patch({api:"doc/rename",body:{oldpath:o,newpath:i},notice:!0,success:()=>{h(n.nowPath)}})}function ve(){const e=i=>{let a=[...n];a.includes(i)?(a.splice(a.indexOf(i),1),g.normal(l("cancel"))):(a.push(i),g.normal(l("selected")+a.length+l("file"))),o({selected:a})},t=r(i=>i.fileList),n=r(i=>i.selected),o=r(i=>i.setGlobal);return s.jsx(Y,{children:t.map(i=>s.jsx(ye,{fileMes:i,selected:n,docClick:e},"doclist"+i[0]))})}function Se(){const e=r(t=>t.nowPath);return s.jsx("div",{id:"show-path",title:e,children:s.jsx("span",{children:e})})}function Pe({setCreate:e}){const[t,n]=p.useState(""),o=a=>{const{value:c}=a.target;n(c)},i=a=>{a.key==="Enter"&&(e(!1),B(t))};return s.jsxs(s.Fragment,{children:[s.jsx("input",{placeholder:l("folder_name"),id:"new-dir-input",onChange:o,value:t,onKeyDown:i}),s.jsx("button",{id:"new-dir-save",className:"btn",title:l("save"),onClick:()=>{e(!1),B(t)}})]})}function B(e){if(e.includes("/")||e.includes("\\")){g.err(l("name_not_con")+" / \\");return}else if(e.length===0){g.err(l("folder_name")+l("is_empty"));return}const t=r.getState();k.post({api:"doc/new_folder",notice:!0,body:{folderName:e,nowpath:t.nowPath},success:()=>{h(t.nowPath)}})}function Ce({createStatus:e}){const[t,n]=e,o=r(c=>c.upload),i=r(c=>c.nowPath),a=()=>{i!==""&&h("")};return p.useEffect(()=>{v({home:{disable:i==="",name:l("back_main_dir"),fun:a}})},[i]),s.jsxs("div",{id:"top-bar-box",children:[!t&&!o.status&&s.jsx("button",{id:"home-icon",className:"btn",title:l("back_main_dir"),onClick:a}),!t&&!o.status&&s.jsx(Se,{}),o.status&&s.jsxs(s.Fragment,{children:[s.jsx("div",{id:"progress",style:{width:o.percent}}),s.jsx("span",{id:"progress-text",children:o.percent})]}),t&&!o.status&&s.jsx(Pe,{setCreate:n})]})}function Ee(){const e=r(i=>i.nowPath),t=r(i=>i.parentPath),n=e==="/"||e==="",o=()=>{n||h(t)};return p.useEffect(()=>{v({goUp:{disable:n,name:l("back"),fun:o}})},[n,t]),s.jsx("button",{id:"go-up",className:(n?"go-up-disable":"")+" btn",disabled:n,title:n?"":l("back"),onClick:o})}function Ne({createStatus:e}){const[t,n]=e;return s.jsx(s.Fragment,{children:t?s.jsx("button",{id:"new-dir-cancel",className:"btn new-dir-btn",title:l("cancel"),onClick:()=>n(!1)}):s.jsx("button",{id:"new-dir-btn",className:"btn new-dir-btn",title:l("create_folder"),onClick:()=>n(!0)})})}function _e(){const[e,t]=p.useState(!1);return s.jsxs(Z,{children:[s.jsx(Ee,{}),s.jsx(Ce,{createStatus:[e,t]}),s.jsx(Ne,{createStatus:[e,t]})]})}function De({setPaste:e,setCopyList:t}){const n=()=>{const o=r.getState().selected;t([...o]),e({status:!0,type:"copy"}),g.normal(l("copied"))};return p.useEffect(()=>{v({copy:{name:`${l("copy")} (C)`,fun:n}})},[]),p.useEffect(()=>{const o=i=>{(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="c"&&(i.preventDefault(),n())};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[]),s.jsx("button",{id:"copy",className:"btn side-btn",title:`${l("copy")} (Ctrl/Cmd + C)`,onClick:n})}function Le(){const e=async()=>{if(!await R.normal(l("are_you_sure")))return;const t=r.getState(),n=t.selected;k.delete({api:"doc/del",notice:!0,body:{dellist:n},success:()=>{h(t.nowPath)}})};return p.useEffect(()=>{v({del:{name:`${l("delete")}(Delete)`,fun:e}})},[]),p.useEffect(()=>{const t=n=>{const o=navigator.platform.toUpperCase().indexOf("MAC")>=0,i=n.metaKey;o&&i&&n.key==="Delete"&&(n.preventDefault(),e()),!o&&n.key==="Delete"&&(n.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),s.jsx("button",{id:"del",className:"btn side-btn",title:`${l("delete")} (Delete / Cmd + Delete)`,onClick:e})}function We({setPaste:e,setCopyList:t}){const n=()=>{const o=r.getState().selected;t([...o]),e({status:!0,type:"move"})};return p.useEffect(()=>{v({cut:{name:l("cut")+"(X)",fun:n}})},[]),s.jsx("button",{id:"move",className:"btn side-btn",title:l("cut"),onClick:n})}function Fe({paste:e,copyList:t}){const[n,o]=e,i=()=>{n.status&&(o({status:!1}),ze(n.type,t))};return p.useEffect(()=>{v({paste:{name:`${l("paste")} (V)`,fun:i,disable:!n.status}})},[n.status]),p.useEffect(()=>{const a=c=>{if(!n.status)return;(c.ctrlKey||c.metaKey)&&c.key.toLowerCase()==="v"&&(c.preventDefault(),i())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[n.status,t]),n.status?s.jsx("button",{id:"paste",title:`${l("paste")} (Ctrl/Cmd + V)`,className:"btn side-btn",onClick:i}):null}function ze(e,t){const n=r.getState();if(t.length===0){g.err(l("no_select_file"));return}const o=n.nowPath;k.post({api:"doc/"+e,notice:!0,body:{copylist:t,nowpath:o},success:()=>{h(o)}})}function Ae(){const e=()=>{h(r.getState().nowPath)};return p.useEffect(()=>{v({refresh:{name:l("refresh"),fun:e}})},[]),s.jsx("button",{id:"reload",className:"btn side-btn",title:l("refresh"),onClick:e})}function Be(){const e=r.setState,t=r(n=>n.upload);return s.jsx(s.Fragment,{children:s.jsx("button",{id:"upload",className:"btn side-btn",title:l("upload"),onClick:()=>{e({upload:{...t,win:!0}})}})})}function Te(){const[e,t]=p.useState({type:"",status:!1}),[n,o]=p.useState([]);return s.jsxs(ee,{children:[s.jsx(Be,{}),s.jsx(Ae,{}),s.jsx(Le,{}),s.jsx(De,{setPaste:t,setCopyList:o}),s.jsx(We,{setPaste:t,setCopyList:o}),s.jsx(Fe,{paste:[e,t],copyList:n})]})}function Ge(){const e=r(n=>n.showBg),t=r(n=>n.loading);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loading",id:"list-loading",style:t?{display:"block"}:{display:"none"}}),s.jsx(N,{showBg:e})]})}function Re(){const e=r.setState,t=r(i=>i.upload),n=r(i=>i.dragWin);r(i=>i.nowPath);const o=async(i,a)=>{e({upload:{...t,status:!0,win:!1}});const c=Array.from(i.target.files);let u={totalSize:0,sendSize:0,completed:!1};await K(a)&&(c.forEach((m,d)=>{u.totalSize+=m.size}),c.forEach((m,d)=>{I(m,u,a)}),i.target.value=null)};return s.jsxs(s.Fragment,{children:[t.win?s.jsxs("div",{id:"upload-opt",children:[s.jsx("button",{id:"close-upload",className:"btn",title:l("close"),onClick:()=>{e({upload:{...t,win:!1}})}}),s.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:i=>o(i,"file")}),s.jsx("input",{type:"file",name:"folder",style:{display:"none"},webkitdirectory:"true",mozdirectory:"true",directory:"true",multiple:!0,onChange:i=>o(i,"dir"),id:"upDir"}),s.jsx("label",{id:"upload-file",className:"btn upload-opt-btn",title:l("upload_file"),htmlFor:"upFile"}),s.jsx("label",{id:"upload-dir",className:"btn upload-opt-btn",title:l("upload_folder"),htmlFor:"upDir"})]}):null,s.jsx(N,{showBg:t.win}),t.status?s.jsx("div",{id:"uploading-back"}):null,s.jsx("div",{id:"drag-win",style:n?{display:"flex"}:{display:"none"},children:s.jsx("div",{})})]})}function Ue(){const[e,t]=p.useState(!1),n=r(a=>a.fileWin),o=p.useRef(null);p.useEffect(()=>{function a(c){c.key==="Escape"&&e&&t(!1)}return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e]),p.useEffect(()=>{if(!n.url)return;function a(){const u=o.current;if(!u)return;const f=u.contentDocument||u.contentWindow.document;if(!f)return;const m=f.createElement("style");m.textContent=`
            body {
                display:flex;
                justify-content: center;
                align-items: center;
                width: 100%;
                height: 100%;
            }
            body img {
                margin: 0;
                max-height: 100%;
                max-width: 100%;
            }
        `,f.head.appendChild(m)}const c=o.current;c&&(c.onload=a)},[n.url]);const i=()=>{[n.data.innerApp[0],n.data.innerApp[1]]=[n.data.innerApp[1],n.data.innerApp[0]],r.setState({fileWin:{...n}}),U(n.data,n.path)};return n.status?s.jsxs("div",{id:"file-win",children:[e?null:s.jsx("button",{className:"btn close-file-win",title:l("close"),onClick:()=>{r.setState({fileWin:{status:!1,url:"",view:!1}})}}),n.view?s.jsxs("div",{className:"file-view-box",children:[s.jsx("iframe",{ref:o,src:n.url,className:"file-view "+(e?"full-screen":"")},n.url),e?s.jsx("button",{className:"btn ext-full-screen-btn",title:l("zoom_out"),onClick:()=>{t(!1)}}):s.jsxs("div",{className:"file-win-btn-bar",children:[n.data.innerApp.length>1?s.jsx(s.Fragment,{children:n.currentType=="not"?s.jsx("button",{className:"btn file-win-btn view-btn",title:l("view"),onClick:i}):s.jsx("button",{className:"btn file-win-btn edit-btn",title:l("edit"),onClick:i})}):null,s.jsx("button",{className:"btn file-win-btn refresh-btn",title:l("refresh"),disabled:n.currentType!="doc",onClick:()=>{o.current&&(o.current.src=o.current.src)}}),s.jsx("button",{className:"btn file-win-btn full-screen-btn",title:l("zoom_in"),onClick:()=>{t(!0)}})]})]}):s.jsx("span",{children:l("not_support_type")})]}):null}function Ie(){return s.jsxs(s.Fragment,{children:[s.jsx(Ge,{}),s.jsx(Re,{}),s.jsx(Ue,{}),s.jsx(we,{})]})}function Ke(){const e=X(t=>t.theme);return p.useEffect(()=>(window.addEventListener("dragover",L),window.addEventListener("dragleave",W),window.addEventListener("drop",F),()=>{window.removeEventListener("dragover",L),window.removeEventListener("dragleave",W),window.removeEventListener("drop",F)}),[]),s.jsxs("div",{id:"app",color:e.color.doc,mode:e.mode,children:[s.jsxs(te,{children:[s.jsx(ne,{}),s.jsx(_e,{}),s.jsx(se,{}),s.jsx(oe,{})]}),s.jsx(Ie,{}),s.jsx(Te,{}),s.jsx(ve,{}),s.jsx(J,{}),s.jsx("div",{className:"wallpaper"})]})}le();M.createRoot(document.getElementById("root")).render(s.jsx(Ke,{}));
