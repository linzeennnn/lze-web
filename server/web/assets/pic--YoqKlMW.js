import{c as U,A as F,n as v,f as r,p as I,q as H,e as R,r as f,j as t,k as L,m as M,W as $,P as O,o as V}from"./all-D8KwLJwx.js";import{P as X,C as q,T as Y,S as K,a as J,H as Q,G as Z,b as ee}from"./page-BkcQCuwQ.js";const a=U((e,s)=>({nowPath:"",parentPath:"",imgList:[],vidList:[],dirList:[],uploading:!1,showBg:!1,pageNum:1,theme:{mode:"",color:{pic:""},userSelect:""},loading:!1,dragWin:!1,imgPage:!0,mediaWin:{status:!1,img:!0,path:window.location.origin+"/file/Pictures/",index:0},select:{status:!1,list:[]},upload:{status:!1,percent:"0%"},setGlobal:n=>{e(i=>({...i,...n}))},replaceGlobal:n=>{e(()=>({...n}))},getGlobal:()=>s()}));function te(){X(a.setState,"pic"),S("")}function S(e,s){const n=a.setState;a.getState().select,F.post({api:"pic/list",body:{folder:e},success:i=>{let o=[],c=[],m=[],d=[],p=[];n({select:{status:!1,list:[]}}),i.filelist.forEach(l=>{l[1]=="dir"||l[1]=="dir_link"?o.push(l[0]):(l[1]=="file"||l[1]=="file_link")&&(l[2]=="img"&&(d.length<12||(c.push(d),d=[]),d.push(l[0])),l[2]=="vid"&&(p.length<12||(m.push(p),p=[]),p.push(l[0])))}),d.length>0&&c.push(d),p.length>0&&m.push(p),a.setState({dirList:o,imgList:c,vidList:m,nowPath:i.currentFolder,parentPath:i.parentFolder,selected:[],imgPage:!s,pageNum:1})}})}function _(e,s){if(e.size==0){v.err(e.name+r("is_empty"));return}let n;const i=a.getState(),o=I(),c=i.nowPath,m=i.upload,d=a.setState,p=["jpg","jpeg","png","gif","webp","bmp","svg","ico","apng","avif"],l=["mp4","webm","ogg","ogv","mov","m4v","avi","3gp","mkv"],g=e.name.split(".").pop().toLowerCase();if(p.includes(g))n=!1,d({imgPage:!0});else if(l.includes(g))n=!0,d({imgPage:!1});else{v.err(e.name+":"+r("not_support_type")),d({upload:{...m,status:!1}});return}const b=H()+"pic/upload",h=se(e.size),w=Math.ceil(e.size/h);let y=0;function N(){if(s.sendSize>=s.totalSize){d({upload:{...m,status:!1}}),v.normal(r("op_com")),S(c,n);return}if(y>=e.size)return;let u="",x=0;const P=e.slice(y,y+h),C=Math.floor(y/h),k=new FormData;k.append("file",P),k.append("fileName",e.name),k.append("totalChunks",w),k.append("currentChunk",C),k.append("nowpath",c);const j=new XMLHttpRequest;j.open("POST",b,!0),j.setRequestHeader("authorization","Bearer "+o),j.upload.onprogress=function(E){E.lengthComputable&&(s.sendSize=s.sendSize+Math.min(E.loaded,e.size)-x,x=E.loaded,u=Math.floor(s.sendSize/s.totalSize*100)+"%",d({upload:{...m,percent:u}}))},j.onload=function(){if(j.status!==200){j.status===401?v.err(r("no_per")):v.err(r("error")+":"+j.status+j.responseText),d({upload:{...m,status:!1}});return}y+=h,N()},j.onerror=function(){console.error(`Chunk ${C+1} upload encountered error.`),d({upload:!1})},j.send(k)}N()}function se(e){return e<=1024*1048576?10*1048576:e<=5120*1048576&&e>1024*1048576?50*1048576:100*1048576}function z(e){a.setState({dragWin:!0}),e.stopPropagation(),e.preventDefault()}function G(e){a.setState({dragWin:!1}),e.stopPropagation(),e.preventDefault()}function D(e){const n=a.getState().upload,i=a.setState;i({dragWin:!1}),e.stopPropagation(),e.preventDefault();const o=e.dataTransfer.items,c=[];let m=0,d=0;function p(g){const b=g.webkitGetAsEntry();if(b){if(b.isDirectory){v.err(r("not_support_type"));return}b.isFile&&(d++,b.file(h=>{c.push(h),m+=h.size,d--,l()}))}}async function l(){if(d===0){if(c.length===0){v.err(r("empty"));return}i({upload:{...n,status:!0,win:!1}});const g={totalSize:m,sendSize:0};if(!await T())return;c.forEach(h=>{_(h,g)})}}for(let g=0;g<o.length;g++)p(o[g])}async function T(){const e=a.getState().upload;return await R.post({api:"login/upload",body:{appType:"pic",fileType:""}})==null?(a.setState({upload:{...e,status:!1}}),!1):!0}function A({url:e,name:s,type:n,index:i}){const[o,c]=f.useState(!0),[m,d]=f.useState(!1),p=a(g=>g.select);a(g=>g.setGlobal),f.useEffect(()=>{c(!0),d(!1)},[e]),f.useEffect(()=>{let g;return m&&(g=setTimeout(()=>{c(!1)},100)),()=>clearTimeout(g)},[m]);const l=(g,b)=>{g.stopPropagation();const h=a.setState;let w=[...p.list];w.includes(b)?w.splice(w.indexOf(b),1):w.push(b),h({select:{...p,list:w}})};return t.jsxs("div",{className:"pic-item main-item",title:s,onClick:()=>{ne(e,n,i)},children:[t.jsx("div",{className:"mask "+(p.status?"mask-enable ":"")+(p.list.includes(s)&&p.status?"mask-selected":""),onClick:g=>{l(g,s)}}),o&&t.jsx("div",{className:"media-loading loading"}),n==="img"?t.jsx("img",{src:e+s,loading:"lazy",onLoad:()=>{d(!0)}}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"play-icon btn"}),t.jsx("video",{src:e+s,onLoadedData:()=>{d(!0)}})]})]},e)}function ne(e,s,n){const i=a.setState;i({mediaWin:{url:e,img:s=="img",status:!0,index:n}})}function ie(){const e=a(o=>o.imgList),s=a(o=>o.pageNum),n=a(o=>o.nowPath),i=`${window.location.origin}/file/Pictures/`+n+"/";return t.jsx(t.Fragment,{children:e[s-1]?e[s-1].map((o,c)=>t.jsx(A,{url:i,name:o,type:"img",index:c},i+o)):null})}function ae(){const e=a(o=>o.vidList),s=a(o=>o.pageNum),n=a(o=>o.nowPath),i=`${window.location.origin}/file/Pictures/`+n+"/";return t.jsx(t.Fragment,{children:e[s-1]?e[s-1].map((o,c)=>t.jsx(A,{url:i,name:o,type:"vid",index:c},i+o)):null})}function oe(){const[e,s]=f.useState(""),n=a(l=>l.vidList),i=a(l=>l.imgList),o=a(l=>l.pageNum);let m=a(l=>l.imgPage)?i.length:n.length;const d=a.setState,p=l=>{l=Number(l),l>=1&&l<=m&&m!=1?d({pageNum:l}):l==o||v.err(r("page_num")+r("not_correct"))};return t.jsxs("div",{id:"page-bar",children:[t.jsx("button",{className:"btn",id:"last-page",onClick:()=>{p(o==1?m:o-1)}}),t.jsx("span",{id:"page-num",children:o+"/"+(m==0?1:m)}),t.jsxs("div",{id:"jump-page",children:[t.jsx("input",{id:"page-input",value:e,type:"text",placeholder:r("page_num"),onChange:l=>s(l.target.value),onKeyDown:l=>{l.key=="Enter"&&(p(e),s(""))}}),t.jsx("button",{className:"btn",id:"jump-btn",onClick:()=>{p(e),s("")},title:r("jump")})]}),t.jsx("button",{className:"btn",id:"next-page",onClick:()=>{p(o==m?1:o+1)}})]})}function le(){const e=a(s=>s.imgPage);return t.jsxs(q,{children:[t.jsx("div",{id:"pic-box",children:e?t.jsx(ie,{}):t.jsx(ae,{})}),t.jsx(oe,{})]})}function re(){const e=a(n=>n.nowPath),s=()=>{e===""?v.normal(r("main_album")):S("")};return f.useEffect(()=>{L({home:{name:r("back_main_album"),fun:s,disable:e==""}})},[e]),t.jsx("button",{id:"home-pic",className:"btn",title:r("back_main_album"),onClick:s})}function ce(){const e=a(i=>i.nowPath),s=a(i=>i.parentPath),n=()=>{S(a.getState().parentPath)};return f.useEffect(()=>{L({back:{name:r("back_parent_album"),fun:n,disable:e==""}})},[e]),t.jsxs("div",{id:"show-path-box",children:[e==""&&s==""?null:t.jsx("span",{id:"par-text",title:r("back_parent_album"),onClick:n,children:s==""?r("main_album"):W(s)}),t.jsx("span",{id:"cur-text",children:e==""?r("main_album"):W(e)})]})}function W(e){return e?(e=e.replace(/\/+$/,""),e.split("/").pop()||""):""}function de(){const e=a(s=>s.upload);return t.jsxs("div",{id:"upload-box",children:[t.jsx("div",{id:"progress-box",children:t.jsx("div",{id:"progress-bar",style:{width:e.percent}})}),t.jsx("span",{id:"show-percent",children:e.percent})]})}function ue(){const e=a(s=>s.upload);return t.jsx("div",{id:"top-bar-box",children:e.status?t.jsx(de,{}):t.jsx(ce,{})})}function pe(){const[e,s]=f.useState(!1),n=a(c=>c.dirList),i=a(c=>c.nowPath),o=()=>{s(!e)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"dir-list",className:"btn",title:r("view_album"),onClick:()=>o(),children:t.jsx("div",{id:"dir-list-box",style:{display:e?"flex":"none"},children:n.map((c,m)=>t.jsx("div",{id:"dir-item",title:r("view")+c,onClick:()=>{S(i+"/"+c)},children:c},c+m))})}),e?t.jsx("div",{id:"close-list-win",onClick:()=>o()}):null]})}function me(){return t.jsxs(Y,{children:[t.jsx(re,{}),t.jsx(ue,{}),t.jsx(pe,{})]})}function ge(){const e=a.setState,s=a(o=>o.pageNum),n=a(o=>o.imgPage),i=o=>{switch(o){case"img":e({imgPage:!0,pageNum:n?s:1});break;case"vid":e({imgPage:!1,pageNum:n?1:s});break}};return f.useEffect(()=>{L({img:{disable:n,name:r("image"),fun:()=>i("img")},vid:{disable:!n,name:r("video"),fun:()=>i("vid")}})},[n]),t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn side-btn "+(n?"media-selected":""),id:"img-btn",title:r("image"),onClick:()=>i("img")}),t.jsx("button",{className:"btn side-btn "+(n?"":"media-selected"),id:"vid-btn",title:r("video"),onClick:()=>i("vid")})]})}function fe(){const e=a.setState;a(i=>i.pageNum),a(i=>i.imgPage);const s=a(i=>i.upload);a(i=>i.dragWin),a(i=>i.nowPath);const n=async i=>{e({upload:{...s,status:!0}});const o=Array.from(i.target.files);let c={totalSize:0,sendSize:0};o.forEach((d,p)=>{c.totalSize+=d.size}),await T()&&(o.forEach((d,p)=>{_(d,c)}),i.target.value=null)};return t.jsxs(t.Fragment,{children:[t.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:i=>n(i)}),t.jsx("label",{className:"btn side-btn",id:"upload",title:r("upload_media"),htmlFor:"upFile"})]})}function xe(){const e=a(n=>n.nowPath),s=()=>{S(e)};return f.useEffect(()=>{L({load:{name:r("refresh"),fun:s}})},[e]),t.jsx("button",{className:"btn side-btn",id:"load",title:r("refresh"),onClick:s})}function be(){const e=a(i=>i.setGlobal),s=a(i=>i.select),n=()=>{e({select:{...s,status:!s.status}})};return f.useEffect(()=>{L({select:{name:r("select")+(s.status?"("+r("cancel")+")":""),fun:n}})},[s.status]),t.jsx("button",{className:"btn side-btn "+(s.status?"select-btn-active":""),id:"select-btn",title:r("select"),onClick:n})}function he(){const e=async()=>{if(!await M.normal(r("are_you_sure")))return;const n=a.getState(),i=n.nowPath,o=n.select,c=n.setGlobal;if(!o.list||o.list.length===0){v.err(r("no_select_file"));return}F.delete({api:"pic/del",notice:!0,body:{delArr:o.list,nowPath:i},success:()=>{c({select:{status:!1,list:[]}}),S(i)}})};return f.useEffect(()=>{L({del:{name:r("delete")+"(Delete)",fun:e}});const s=n=>{const i=navigator.platform.toUpperCase().indexOf("MAC")>=0;(i&&n.metaKey&&n.key==="Delete"||!i&&n.key==="Delete")&&(n.preventDefault(),e())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),t.jsx("button",{className:"btn side-btn",id:"del-btn",title:r("delete"),onClick:e})}function je(){return t.jsxs(K,{children:[t.jsx(be,{}),t.jsx(fe,{}),t.jsx(ge,{}),t.jsx(xe,{}),t.jsx(he,{})]})}function we(){const e=a(n=>n.showBg),s=a(n=>n.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:s?{display:"block"}:{display:"none"}}),t.jsx($,{showBg:e})]})}function ve(){const e=a(n=>n.dragWin),s=a(n=>n.upload);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"drag-win",style:e?{display:"flex"}:{display:"none"},children:t.jsx("div",{})}),s.status&&t.jsx("div",{id:"uploading",className:"bg-enable"})]})}function Pe(){const e=a.setState,s=a(u=>u.mediaWin),n=a(u=>u.pageNum);let i;s.img?i=a(u=>u.imgList)[n-1]:i=a(u=>u.vidList)[n-1];const[o,c]=f.useState(1),m=f.useRef(null),[d,p]=f.useState(!1),[l,g]=f.useState({x:0,y:0}),[b,h]=f.useState({x:0,y:0}),w=u=>{let x;switch(u){case"in":x=o+.3;break;case"out":if(o-.3<0)return;x=o-.3;break}c(Number(x.toFixed(2)))},y=u=>{g({x:0,y:0}),c(1);let x=s.index;const P=i.length;switch(u){case"min":x--,x=x<0?P-1:x;break;case"add":x++,x=x>P-1?0:x;break}e({mediaWin:{...s,index:x}})};f.useEffect(()=>{const u=P=>{if(!d)return;const C=P.clientX-b.x,k=P.clientY-b.y;g(j=>({x:j.x+C,y:j.y+k})),h({x:P.clientX,y:P.clientY})},x=()=>{p(!1)};return window.addEventListener("mousemove",u),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",x)}},[d,b]);const N=u=>{u.preventDefault(),u.stopPropagation(),p(!0),h({x:u.clientX,y:u.clientY})};return f.useEffect(()=>{s.status&&(g({x:0,y:0}),c(1))},[s.status]),s.status?t.jsxs("div",{className:"bg-enable",onClick:()=>e({mediaWin:{status:!1}}),children:[t.jsx("button",{className:"btn media-btn media-widget",id:"close-media"}),t.jsx("button",{className:"btn media-btn media-widget",id:"last-pic",onClick:u=>{u.stopPropagation(),y("min")}}),t.jsx("button",{className:"btn media-btn media-widget",id:"next-pic",onClick:u=>{u.stopPropagation(),y("add")}}),t.jsx("div",{id:"media-box",ref:m,onMouseDown:N,style:{cursor:d?"grabbing":"grab",transform:`translate(${l.x}px, ${l.y}px) scale(${o})`,transition:d?"none":"transform 0.15s ease-out"},onClick:u=>u.stopPropagation(),children:s.img?t.jsx("img",{loading:"lazy",src:s.url+i[s.index]}):t.jsx("video",{src:s.url+i[s.index],controls:!0,autoPlay:!0,loop:!0})}),t.jsxs("div",{id:"zoom-bar",className:"media-widget",children:[t.jsx("button",{className:"btn zoom-btn",style:{marginRight:"20px"},title:r("zoom_out"),onClick:u=>{u.stopPropagation(),w("out")},children:t.jsx("div",{id:"zoom-out"})}),t.jsx("button",{className:"btn zoom-btn",style:{marginLeft:"20px"},title:r("zoom_in"),onClick:u=>{u.stopPropagation(),w("in")},children:t.jsx("div",{id:"zoom-in"})})]})]}):null}function ye(){return t.jsxs(t.Fragment,{children:[t.jsx(we,{}),t.jsx(ve,{}),t.jsx(Pe,{})]})}function ke(){const e=a(s=>s.theme);return f.useEffect(()=>(window.addEventListener("dragover",z),window.addEventListener("dragleave",G),window.addEventListener("drop",D),window.addEventListener("paste",B),()=>{window.removeEventListener("dragover",z),window.removeEventListener("dragleave",G),window.removeEventListener("drop",D),window.removeEventListener("paste",B)}),[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.pic,children:[t.jsx("div",{className:"wallpaper"}),t.jsxs(J,{children:[t.jsx(Q,{}),t.jsx(me,{}),t.jsx(Z,{}),t.jsx(ee,{})]}),t.jsx(ye,{}),t.jsx(je,{}),t.jsx(le,{}),t.jsx(O,{})]})}async function B(e){if(!e)return;const s=e.clipboardData.items[0];if(s.type.startsWith("image/")&&await M.normal(r("are_you_sure"))){const n=s.getAsFile(),i={totalSize:n.size,sendSize:0};_(n,i)}}te();V.createRoot(document.getElementById("root")).render(t.jsx(ke,{}));
