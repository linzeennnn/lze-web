import{c as y,j as t,n as h,r as m,W as N,T,b as L}from"./all-9OI7PJQr.js";import{P as B,C as O,T as _,S as E,a as I,H as U,G,b as P}from"./page-BNS8bVuN.js";const a=y((e,s)=>{const o=window.localStorage.getItem("userName"),r=window.localStorage.getItem("token");return{userName:o,token:r,nowuser:o?.trim()||"guest",showBg:!1,loading:!1,controlList:null,langList:[],userList:null,showCmd:!1,theme:{mode:"",color:{mon:""}},monUrl:`${window.location.origin}/server/mon/`,setGlobal:l=>{e(c=>({...c,...l}))},replaceGlobal:l=>{e(()=>({...l}))},getGlobal:()=>s()}});function n(e){return a.getState().langList[e]||e}function D(){B(a.setState,"mon"),S()}function j(e){a.setState({loading:e,showBg:e})}function S(){j(!0);const e=a.getState().monUrl+"list";fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{a.setState({controlList:s.control,userList:s.user}),j(!1)})}function J({keyName:e,Mes:s}){const o=a(r=>r.nowuser);return t.jsx("div",{className:"action-bar "+(s.user.includes(o)?"have-action":"no-action"),title:n("modify_permission"),onClick:()=>{K(e.control,e.action,o,s.user.includes(o)?"remove":"add")},children:n(s.name)})}function K(e,s,o,r){let l=n(r);if(!confirm(l+"?"))return;j(!0);const c=a.getState().userName,d=a.getState().token,f=a.getState().monUrl+"update_act";fetch(f,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+d},body:JSON.stringify({user:c,token:d,control:e,action:s,name:o,change:r})}).then(x=>{if(!x.ok){x.status===401?h(n("no_per")):h(n("error")+":"+x.status),j(!1);return}h(n("op_com")),S()})}function W({keyName:e,Mes:s}){const[o,r]=m.useState(!1);return s?t.jsxs("div",{className:"control-bar main-item",children:[t.jsx("span",{className:"control-name",children:n(e)}),o?t.jsx("div",{className:"action-list",children:Object.entries(s.action).map(([l,c])=>t.jsx(J,{keyName:{control:e,action:l},Mes:c},e+l))}):null,t.jsx("button",{className:"btn show-action",title:n("show"),onClick:()=>{r(!o)}})]}):null}function A(){const e=a(s=>s.controlList);return t.jsx(O,{children:e?Object.entries(e).map(([s,o])=>t.jsx(W,{keyName:s,Mes:o},s)):null})}function F({Mes:e}){const[s,o]=m.useState(!1),r=a(d=>d.userList),l=a(d=>d.nowuser),c=a.setState;return t.jsxs("div",{id:"user-box",children:[t.jsx("button",{id:"user-btn",className:"btn",title:n("view_user"),onClick:()=>{o(!0)}}),t.jsx("span",{id:"user-text",onClick:()=>{o(!0)},children:l}),s?t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"user-list",children:Object.entries(r).map(([d])=>t.jsx("div",{className:"name-item",onClick:()=>{c({nowuser:d}),o(!1)},children:t.jsx("span",{children:d})},d+"nameList"))}),t.jsx("div",{id:"user-back",onClick:()=>{o(!1)}})]}):null]})}function M(){const e={never:n("never"),h:n("hour"),d:n("day"),m:n("month"),y:n("year")},s=a(i=>i.userList),o=a(i=>i.nowuser),r=Object.keys(e),[l,c]=m.useState("h"),[d,f]=m.useState(!1),[x,g]=m.useState(""),b=()=>{const u=(r.indexOf(l)+1)%r.length;c(r[u])},C=i=>{const{value:u}=i.target;g(u)},v=i=>{i.key==="Enter"&&w(x,l)},w=(i,u)=>{let p;if(u=="never")p="never";else{if(!(i>=0)){h(n("not_correct"));return}p=i+u}f(!1),g(""),z(o,p)};return s?t.jsxs("div",{id:"time-box",children:[t.jsx("button",{id:"time-btn",className:"btn",title:n("mod_log_time"),onClick:()=>f(!d)}),d?t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"time-input-box",className:"time-text",children:[t.jsx("input",{id:"time-input",placeholder:n("num"),value:x,onChange:C,onKeyDown:v}),t.jsx("button",{className:"btn mini-btn",id:"save-time",title:n("save"),onClick:()=>{w(x,l)}})]}),t.jsx("div",{id:"unit-box",children:t.jsxs("div",{id:"unit-text",children:[t.jsx("span",{children:e[l]}),t.jsx("button",{className:"btn mini-btn",id:"switch-unit",title:n("switch"),onClick:b})]})})]}):t.jsx("span",{className:"time-text",id:"display-time",title:n("allow_login_time"),children:H(s[o].tokentime)+e[R(s[o].tokentime)]})]}):null}function z(e,s){j(!0);const o=a.getState(),r=o.token;o.userName;const l=o.monUrl+"date";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+r},body:JSON.stringify({name:e,time:s})}).then(c=>{if(!c.ok){c.status==401?h(n("no_per")):h(n("error")+":"+c.status),j(!1);return}h(n("op_com")),S()})}function H(e){return e=="never"||e==""||!e?"":parseInt(e.slice(0,-1))}function R(e){return e=="never"||e==""||!e?"never":e.slice(-1)}function $(){const e=a(s=>s.userList);return t.jsxs(_,{children:[t.jsx(F,{Mes:e}),t.jsx(M,{})]})}function q(){return t.jsx("button",{className:"btn side-btn",id:"load",title:n("refresh"),onClick:()=>{S()}})}function Q(){return a(e=>e.showCmd),t.jsx("button",{className:"btn side-btn",id:"cmd-btn",title:n("terminal"),onClick:()=>{a.setState({showCmd:!0})}})}function V(){return t.jsxs(E,{children:[t.jsx(Q,{}),t.jsx(q,{})]})}function X(){const e=a(o=>o.showBg),s=a(o=>o.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:s?{display:"block"}:{display:"none"}}),t.jsx(N,{showBg:e})]})}function Y(){const e=a(i=>i.showCmd),[s,o]=m.useState("输出"),[r,l]=m.useState(""),[c,d]=m.useState(""),[f,x]=m.useState(""),[g,b]=m.useState([]);m.useEffect(()=>{b(JSON.parse(localStorage.getItem("cmdList"))||[])},[]);const C=(i,u)=>{if(c==""||f==""){h(n("none"));return}d(""),x("");const p=[...g,{title:i,cmd:u}];b(p),localStorage.setItem("cmdList",JSON.stringify(p)),h(n("op_com"))},v=i=>{if(!confirm(n("are_you_sure")))return;const u=[...g.slice(0,i),...g.slice(i+1)];b(u),localStorage.setItem("cmdList",JSON.stringify(u))},w=i=>{i.key==="Enter"&&C(c,f)};return t.jsx(N,{showBg:e,children:t.jsxs("div",{id:"cmd-box",children:[t.jsx("button",{className:"btn",id:"close-cmd",title:n("close"),onClick:()=>{a.setState({showCmd:!1})}}),t.jsx("div",{id:"cus-cmd-box",children:g.map((i,u)=>t.jsxs("div",{className:"cmd-item",title:n("run"),onClick:()=>{l(i.cmd),k(i.cmd,o)},children:[t.jsx("button",{className:"del-cmd btn",title:n("delete"),onClick:p=>{p.stopPropagation(),v(u)}}),t.jsx("span",{className:"cmd-title",children:i.title}),t.jsx("span",{className:"cmd-cmd",children:i.cmd})]},u+i.cmd))}),t.jsxs("div",{id:"send-box",className:"cmd-widget",children:[t.jsx("input",{id:"input-cmd",value:r,placeholder:n("cmd"),onKeyDown:i=>{i.key==="Enter"&&k(r,o)},onChange:i=>l(i.target.value)}),t.jsx("pre",{id:"output-text",children:s}),t.jsx("button",{className:"btn",id:"send-cmd",title:n("run"),onClick:()=>{k(r,o)}})]}),t.jsxs("div",{id:"cus-cmd-input-bar",className:"cmd-widget",children:[t.jsx("input",{placeholder:n("cus_name"),className:"cmd-input",onKeyDown:w,value:c,onChange:i=>d(i.target.value)}),t.jsx("input",{placeholder:n("cmd"),className:"cmd-input",onKeyDown:w,value:f,onChange:i=>x(i.target.value)}),t.jsx("button",{className:"btn",id:"add-cmd",title:n("add"),onClick:()=>{C(c,f)}})]})]})})}function k(e,s){if(!confirm(n("run")+"?"))return;j(!0);const o=a.getState(),r=o.token,l=o.monUrl+"cmd";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+r},body:JSON.stringify({cmd:e})}).then(c=>{if(!c.ok){c.status==401?h(n("no_per")):h(n("error")+":"+c.status),j(!1);return}s(c.text()),j(!1)})}function Z(){return t.jsxs(t.Fragment,{children:[t.jsx(Y,{}),t.jsx(X,{})]})}function tt(){const e=a(s=>s.theme);return m.useEffect(()=>{D()},[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.mon,children:[t.jsxs(I,{children:[t.jsx(U,{}),t.jsx($,{}),t.jsx(G,{}),t.jsx(P,{})]}),t.jsx(Z,{}),t.jsx(V,{}),t.jsx(A,{}),t.jsx(T,{}),t.jsx("div",{className:"wallpaper"})]})}L.createRoot(document.getElementById("root")).render(t.jsx(tt,{}));
