import{c as y,j as t,n as h,r as m,W as N,T,b as L}from"./all-Cdk6ncyA.js";import{P as B,C as O,T as _,S as E,a as I,H as U,G,b as P}from"./page-BdnlRZ9n.js";const r=y((e,s)=>{const o=window.localStorage.getItem("userName"),a=window.localStorage.getItem("token");return{userName:o,token:a,nowuser:o?.trim()||"visitor",showBg:!1,loading:!1,controlList:null,langList:[],userList:null,showCmd:!1,theme:{mode:"",color:{mon:""}},monUrl:`${window.location.origin}/server/mon/`,setGlobal:c=>{e(l=>({...l,...c}))},replaceGlobal:c=>{e(()=>({...c}))},getGlobal:()=>s()}});function n(e){return r.getState().langList[e]||e}function D(){B(r.setState,"mon"),S()}function j(e){r.setState({loading:e,showBg:e})}function S(){j(!0);const e=r.getState().monUrl+"list";fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{r.setState({controlList:s.control,userList:s.user}),j(!1)})}function J({keyName:e,Mes:s}){const o=r(a=>a.nowuser);return t.jsx("div",{className:"action-bar "+(s.user.includes(o)?"have-action":"no-action"),title:n("modify_permission"),onClick:()=>{K(e.control,e.action,o,s.user.includes(o)?"remove":"add")},children:n(s.name)})}function K(e,s,o,a){let c=n(a);if(!confirm(c+"?"))return;j(!0);const l=r.getState().userName,u=r.getState().token,f=r.getState().monUrl+"update_act";fetch(f,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+u,"x-user":l},body:JSON.stringify({user:l,token:u,control:e,action:s,name:o,change:a})}).then(x=>{if(!x.ok){x.status===401?h(n("no_per")):h(n("error")+":"+x.status),j(!1);return}h(n("op_com")),S()})}function W({keyName:e,Mes:s}){const[o,a]=m.useState(!1);return s?t.jsxs("div",{className:"control-bar main-item",children:[t.jsx("span",{className:"control-name",children:n(e)}),o?t.jsx("div",{className:"action-list",children:Object.entries(s.action).map(([c,l])=>t.jsx(J,{keyName:{control:e,action:c},Mes:l},e+c))}):null,t.jsx("button",{className:"btn show-action",title:n("show"),onClick:()=>{a(!o)}})]}):null}function A(){const e=r(s=>s.controlList);return t.jsx(O,{children:e?Object.entries(e).map(([s,o])=>t.jsx(W,{keyName:s,Mes:o},s)):null})}function F({Mes:e}){const[s,o]=m.useState(!1),a=r(u=>u.userList),c=r(u=>u.nowuser),l=r.setState;return t.jsxs("div",{id:"user-box",children:[t.jsx("button",{id:"user-btn",className:"btn",title:n("view_user"),onClick:()=>{o(!0)}}),t.jsx("span",{id:"user-text",onClick:()=>{o(!0)},children:c}),s?t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"user-list",children:Object.entries(a).map(([u])=>t.jsx("div",{className:"name-item",onClick:()=>{l({nowuser:u}),o(!1)},children:t.jsx("span",{children:u})},u+"nameList"))}),t.jsx("div",{id:"user-back",onClick:()=>{o(!1)}})]}):null]})}function M(){const e={never:n("never"),h:n("hour"),d:n("day"),m:n("month"),y:n("year")},s=r(i=>i.userList),o=r(i=>i.nowuser),a=Object.keys(e),[c,l]=m.useState("h"),[u,f]=m.useState(!1),[x,g]=m.useState(""),b=()=>{const d=(a.indexOf(c)+1)%a.length;l(a[d])},C=i=>{const{value:d}=i.target;g(d)},v=i=>{i.key==="Enter"&&w(x,c)},w=(i,d)=>{let p;if(d=="never")p="never";else{if(!(i>=0)){h(n("not_correct"));return}p=i+d}f(!1),g(""),z(o,p)};return s?t.jsxs("div",{id:"time-box",children:[t.jsx("button",{id:"time-btn",className:"btn",title:n("mod_log_time"),onClick:()=>f(!u)}),u?t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"time-input-box",className:"time-text",children:[t.jsx("input",{id:"time-input",placeholder:n("num"),value:x,onChange:C,onKeyDown:v}),t.jsx("button",{className:"btn mini-btn",id:"save-time",title:n("save"),onClick:()=>{w(x,c)}})]}),t.jsx("div",{id:"unit-box",children:t.jsxs("div",{id:"unit-text",children:[t.jsx("span",{children:e[c]}),t.jsx("button",{className:"btn mini-btn",id:"switch-unit",title:n("switch"),onClick:b})]})})]}):t.jsx("span",{className:"time-text",id:"display-time",title:n("allow_login_time"),children:H(s[o].tokentime)+e[R(s[o].tokentime)]})]}):null}function z(e,s){j(!0);const o=r.getState(),a=o.token,c=o.userName,l=o.monUrl+"date";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+a,"x-user":c},body:JSON.stringify({name:e,time:s})}).then(u=>{if(!u.ok){u.status==401?h(n("no_per")):h(n("error")+":"+u.status),j(!1);return}h(n("op_com")),S()})}function H(e){return e=="never"||e==""||!e?"":parseInt(e.slice(0,-1))}function R(e){return e=="never"||e==""||!e?"never":e.slice(-1)}function $(){const e=r(s=>s.userList);return t.jsxs(_,{children:[t.jsx(F,{Mes:e}),t.jsx(M,{})]})}function q(){return t.jsx("button",{className:"btn side-btn",id:"load",title:n("refresh"),onClick:()=>{S()}})}function Q(){return r(e=>e.showCmd),t.jsx("button",{className:"btn side-btn",id:"cmd-btn",title:n("terminal"),onClick:()=>{r.setState({showCmd:!0})}})}function V(){return t.jsxs(E,{children:[t.jsx(Q,{}),t.jsx(q,{})]})}function X(){const e=r(o=>o.showBg),s=r(o=>o.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:s?{display:"block"}:{display:"none"}}),t.jsx(N,{showBg:e})]})}function Y(){const e=r(i=>i.showCmd),[s,o]=m.useState("输出"),[a,c]=m.useState(""),[l,u]=m.useState(""),[f,x]=m.useState(""),[g,b]=m.useState([]);m.useEffect(()=>{b(JSON.parse(localStorage.getItem("cmdList"))||[])},[]);const C=(i,d)=>{if(l==""||f==""){h(n("none"));return}u(""),x("");const p=[...g,{title:i,cmd:d}];b(p),localStorage.setItem("cmdList",JSON.stringify(p)),h(n("op_com"))},v=i=>{if(!confirm(n("are_you_sure")))return;const d=[...g.slice(0,i),...g.slice(i+1)];b(d),localStorage.setItem("cmdList",JSON.stringify(d))},w=i=>{i.key==="Enter"&&C(l,f)};return t.jsx(N,{showBg:e,children:t.jsxs("div",{id:"cmd-box",children:[t.jsx("button",{className:"btn",id:"close-cmd",title:n("close"),onClick:()=>{r.setState({showCmd:!1})}}),t.jsx("div",{id:"cus-cmd-box",children:g.map((i,d)=>t.jsxs("div",{className:"cmd-item",title:n("run"),onClick:()=>{c(i.cmd),k(i.cmd,o)},children:[t.jsx("button",{className:"del-cmd btn",title:n("delete"),onClick:p=>{p.stopPropagation(),v(d)}}),t.jsx("span",{className:"cmd-title",children:i.title}),t.jsx("span",{className:"cmd-cmd",children:i.cmd})]},d+i.cmd))}),t.jsxs("div",{id:"send-box",className:"cmd-widget",children:[t.jsx("input",{id:"input-cmd",value:a,placeholder:n("cmd"),onKeyDown:i=>{i.key==="Enter"&&k(a,o)},onChange:i=>c(i.target.value)}),t.jsx("pre",{id:"output-text",children:s}),t.jsx("button",{className:"btn",id:"send-cmd",title:n("run"),onClick:()=>{k(a,o)}})]}),t.jsxs("div",{id:"cus-cmd-input-bar",className:"cmd-widget",children:[t.jsx("input",{placeholder:n("cus_name"),className:"cmd-input",onKeyDown:w,value:l,onChange:i=>u(i.target.value)}),t.jsx("input",{placeholder:n("cmd"),className:"cmd-input",onKeyDown:w,value:f,onChange:i=>x(i.target.value)}),t.jsx("button",{className:"btn",id:"add-cmd",title:n("add"),onClick:()=>{C(l,f)}})]})]})})}function k(e,s){if(!confirm(n("run")+"?"))return;j(!0);const o=r.getState(),a=o.token,c=o.monUrl+"cmd";fetch(c,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+a},body:JSON.stringify({cmd:e})}).then(l=>{if(!l.ok){l.status==401?h(n("no_per")):h(n("error")+":"+l.status),j(!1);return}s(l.text()),j(!1)})}function Z(){return t.jsxs(t.Fragment,{children:[t.jsx(Y,{}),t.jsx(X,{})]})}function tt(){const e=r(s=>s.theme);return m.useEffect(()=>{D()},[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.mon,children:[t.jsxs(I,{children:[t.jsx(U,{}),t.jsx($,{}),t.jsx(G,{}),t.jsx(P,{})]}),t.jsx(Z,{}),t.jsx(V,{}),t.jsx(A,{}),t.jsx(T,{}),t.jsx("div",{className:"wallpaper"})]})}L.createRoot(document.getElementById("root")).render(t.jsx(tt,{}));
