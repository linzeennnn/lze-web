import{c as L,D as _,G as D,n as g,j as e,R as v,r as u,a as T,S as I,W as y,T as O,b as B}from"./all-9OI7PJQr.js";async function P(){let t=E();const s=await fetch(window.location.origin+"/server/lang",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lang:t.type})});return t.list=await s.json(),localStorage.setItem("langList",JSON.stringify(t.list)),t}function E(){let t;const s=["en","zh"];let o=(navigator.language||navigator.userLanguage).split("-")[0];s.includes(o)||(o="en");let n=localStorage.getItem("lang");return n==null||n=="system"?(n="system",t=o):t=n,{userSelect:n,type:t,list:[]}}const c=L((t,s)=>(window.localStorage.getItem("userName"),window.localStorage.getItem("token"),{load:0,userName:"guest",token:"",showBg:!1,locked:!0,lang:{type:"",list:[],userSelect:""},theme:{mode:"",color:{home:"",doc:"",pic:"",tra:"",mon:"",not:"",bok:""},userSelect:""},listWin:{type:"",name:"",status:!1},widgetData:{doc:[],pic:[],tra:[],mon:[],not:[],bok:[]},setGlobal:o=>{t(n=>({...n,...o}))},getGlobal:()=>s(),replaceGlobal:o=>{t(()=>({...o}))}}));function a(t){return c.getState().lang.list[t]??t}async function C(){_(),c.setState({lang:await P()});let t=localStorage.getItem("userName"),s=localStorage.getItem("token");t=t||"guest",s=s||"",c.setState({userName:t,token:s}),sessionStorage.getItem("app")=="true"?c.setState({locked:!1}):(c.setState({locked:!0}),G(t,s)),sessionStorage.setItem("app","false");const o=D("home");c.setState({theme:o}),w()}function G(t,s){c.getState().load,s=s||"",fetch(window.location.origin+"/server/login/auth_status",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+s},body:JSON.stringify({name:t,token:s})}).then(o=>{if(!o.ok){o.status===401?g(a("log_outdate")):g(o.status),window.localStorage.setItem("userName","guest"),window.localStorage.setItem("token",""),c.setState({userName:"guest",token:"",load:c.getState().load+1});return}c.setState({load:c.getState().load+1})})}function w(){const t=c.getState().userName;c.getState().load,fetch(window.location.origin+"/server/home/widget",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t})}).then(s=>s.json()).then(s=>{c.setState({widgetData:s,load:c.getState().load+1})})}async function J(){try{const t=window.location.origin+"/server/login/login",o=await(await fetch(t,{method:"GET",headers:{"Content-Type":"text/plain"}})).text();return atob(o)}catch(t){return console.error("Error fetching key:",t),null}}async function x(t){let s=await J(),o=[];for(let n=0;n<t.length;n++)o.push(t.charCodeAt(n)^s.charCodeAt(n%s.length));return btoa(String.fromCharCode(...o))}function F({showItem:t,type:s,show:o}){return e.jsx("div",{className:"widget-panel "+(o?"widget-hide":""),children:t.map((n,i)=>e.jsxs(v.Fragment,{children:[s=="tra"&&e.jsx("li",{children:a("recent_delete")}),s=="bok"&&e.jsx("li",{children:a("recent_visit")}),e.jsx("div",{className:"widget-panel-item "+s+"-panel",title:a("view"),onClick:l=>{l.stopPropagation(),A(s,n)},children:W(n,s)})]},n+i))},s+"panel")}function W(t,s){switch(s){case"pic":return U(t);case"mon":return M(t);default:return e.jsx("span",{className:"panel-text "+(t==""?"panel-text-null":""),children:t==""?a("empty"):t})}}function M(t){const s=t.split("/");switch(s[0]){case"per_num":return a(s[0])+":"+s[1];default:return a(s[0])+":"+(s[1]=="never"||s[1]=="none"?a(s[1]):s[1]+a(s[2]))}}function U(t){const s=window.location.origin+"/file/Pictures/"+t.name;return t.media=="img"?e.jsx("img",{src:s,alt:t.name}):t.media=="vid"?e.jsx("video",{src:s,controls:"controls"}):e.jsx("span",{className:"panel-text panel-text-null",children:a("empty")})}function A(t,s){if(t=="tra"){g(a("recent_delete")+":"+s);return}if(t=="mon"){const o=c.getState().userName;g(a("current_user")+":"+o);return}(t!="pic"&&s!=""||t=="pic"&&s.name!="")&&c.setState({listWin:{type:t,name:s,status:!0}})}function K({theme:t,item:s,to_next:o,widgetData:n}){const[i,l]=u.useState(!1);return e.jsx(e.Fragment,{children:e.jsxs("div",{id:s+"widget",className:"widget-item",title:a("enter")+":"+a(s),mode:t.mode,color:t.color[s],onClick:()=>o(s),children:[e.jsx("div",{className:"widget-icon "+(i?"widget-hide":""),children:e.jsx("div",{id:s+"-icon"})}),e.jsx(F,{showItem:n[s],type:s,show:!i}),e.jsx("div",{className:"show-panel btn "+(i?"show-panel-enable":""),title:a("show"),onClick:r=>{r.stopPropagation(),l(!i)}}),e.jsx("span",{className:"widget-title",mode:t.mode,color:t.color.home,children:a(s)})]},s)})}function R({tmpLoad:t}){const s=c(r=>r.locked),o=c(r=>r.widgetData),n=c(r=>r.theme),i=["doc","pic","tra","mon","not","bok"],l=[];for(let r=0;r<i.length;r+=2)l.push(i.slice(r,r+2));return e.jsx("div",{id:"widget",className:!s&&t?"widget-load":"",children:l.map((r,d)=>e.jsx("div",{className:"widget-line",children:r.map(h=>e.jsx(K,{item:h,theme:n,to_next:z,widgetData:o},h))},`line${d}`))})}function z(t){window.location.href=t}function Z(){const t=c(i=>i.lang),[s,o]=u.useState(!1),n={system:a("system"),zh:"简体中文",en:"English"};return e.jsx(e.Fragment,{children:s?e.jsx("div",{id:"lang-list",onClick:()=>{},children:Object.entries(n).map(([i,l])=>e.jsx("div",{className:"lang-list-item "+(i===t.userSelect?"lang-select":""),onClick:async()=>{localStorage.setItem("lang",i),o(!1),c.setState({lang:await P()})},children:e.jsx("span",{children:l})},i))}):e.jsxs("div",{id:"show-lang",title:a("switch"),onClick:()=>{o(!0)},children:[e.jsx("span",{children:n[t.userSelect]}),e.jsx("div",{})]})})}function $(){const[t,s]=u.useState(!1),o=[{id:"cpu",name:a("cpu_usage")},{id:"mem",name:a("mem_usage")},{id:"disk",name:a("disk_usage")}],[n,i]=u.useState({cpu:{data:"",percent:"0%"},mem:{data:"",percent:"0%"},disk:{data:"",percent:"0%"},net:{up:"0.00MB",down:"0.00MB"}});return u.useEffect(()=>{const l=setInterval(()=>{fetch(window.location.origin+"/server/system/system",{method:"GET",headers:{"Content-Type":"application/json"}}).then(r=>r.json()).then(r=>{i({cpu:{data:"",percent:r.cpuPercent},mem:{data:r.memData,percent:r.memPercent},disk:{data:r.diskData,percent:r.diskPercent},net:{up:r.netUp,down:r.netDown}}),t||s(!0)})},3e3);return()=>{clearInterval(l)}},[]),e.jsxs("div",{id:"sys-app",children:[t?null:e.jsx("div",{id:"sys-loadPage",children:e.jsx("div",{className:"loading"})}),o.map(l=>e.jsx(v.Fragment,{children:e.jsxs("div",{className:"sys-box",title:l.name,children:[e.jsxs("div",{id:l.id+"-bar",className:"sys-bar",children:[e.jsx("div",{id:l.id+"-icon",className:"sys-icon"}),e.jsx("div",{id:l.id+"-progress-bar",className:"sys-progress-bar",children:e.jsx("div",{className:"sys-progress",style:{width:n[l.id].percent}})}),e.jsx("span",{id:l.id+"-percent",className:"sys-percent",children:n[l.id].percent})]}),e.jsx("span",{className:"sys-data",children:n[l.id].data})]})},l.id)),e.jsxs("div",{id:"net-box",className:"sys-box",title:a("net_usage"),children:[e.jsx("span",{id:"net-icon",className:"sys-icon"}),e.jsx("div",{id:"net-up",className:"sys-icon"}),e.jsx("span",{id:"net-up-data",className:"sys-data",children:n.net.up}),e.jsx("div",{id:"net-down",className:"sys-icon"}),e.jsx("span",{id:"net-down-data",className:"sys-data",children:n.net.down})]})]})}function q(){const t=c(d=>d.theme),[s,o]=u.useState("home"),n={system:a("system"),dark:a("dark_mode"),light:a("light_mode")},i=["default","green","blue","orange","yellow","pink","red"],l=()=>{const d=["system","dark","light"],p=(d.indexOf(t.userSelect)+1)%d.length;S("userSelect",d[p])},r=()=>{const d=["home","doc","pic","tra","mon","not","bok"],p=(d.indexOf(s)+1)%d.length;o(d[p])};return e.jsxs("div",{id:"theme-app",children:[e.jsx("div",{id:"mode-bar",children:e.jsxs("button",{id:"show-mode",className:"btn theme-btn",onClick:l,children:[e.jsx("span",{children:n[t.userSelect]}),e.jsx("div",{className:"switch-icon",id:"switch-mode",title:"切换模式"})]})}),e.jsx("div",{id:"page-bar",children:e.jsxs("button",{id:"show-page",className:"btn theme-btn",onClick:r,children:[e.jsx("span",{children:a(s)}),e.jsx("div",{id:"switch-page",className:"switch-icon",title:a("switch")})]})}),e.jsx("div",{id:"color-bar",children:i.map((d,h)=>e.jsx("div",{className:"color-btn "+(t.color[s]===d?"color-btn-enable":""),mode:t.mode,color:d,onClick:()=>S("color",{...t.color,[s]:d}),children:e.jsx("div",{})},h+d))})]})}function S(t,s){const n={...c.getState().theme,[t]:s};t==="userSelect"&&(s==="system"?n.mode=T():n.mode=s),I(n.mode,n.color.home),document.body.setAttribute("mode",n.mode),document.body.setAttribute("color",n.color.home),c.setState({theme:n}),localStorage.setItem("theme",JSON.stringify(n))}function H({tmpLoad:t,setTmpLoad:s}){const o=c(m=>m.showBg),n=c(m=>m.setGlobal),i=c(m=>m.locked),[l,r]=u.useState(""),d=m=>{r(m),n({showBg:!0})},h=()=>{n({showBg:!1}),r("")},p=[{id:"lang",name:a("lang_setting")},{id:"theme",name:a("theme")},{id:"sys",name:a("monitor")},{id:"lock",name:a("login_manage")}];return e.jsxs(e.Fragment,{children:[o&&e.jsxs("div",{className:"app-win float-win",children:[e.jsx("button",{className:"btn",id:"close-win",title:a("close"),onClick:h}),l==="lang"&&e.jsx(Z,{}),l==="sys"&&e.jsx($,{}),l==="theme"&&e.jsx(q,{})]}),e.jsx("div",{id:"dock",className:!i&&t?"dock-load":"",children:p.map(m=>e.jsx("div",{id:m.id,title:m.name,className:"dock-app",onClick:()=>{m.id=="lock"?(s(!1),setTimeout(()=>{n({locked:!0}),s(!0)},500)):d(m.id)},children:e.jsx("div",{id:m.id+"-icon",className:"dock-icon"})},m.id))})]})}function Q(){const t=c(o=>o.listWin),s=c(o=>o.theme);return e.jsxs(y,{showBg:t.status,children:[e.jsx("div",{id:"close-back",onClick:()=>{c.setState({listWin:{type:"",name:"",status:!1,color:""}})}}),e.jsx("div",{className:"list-win",color:s.color[t.type],mode:s.mode,id:t.type+"-list",children:V(t.type,t.name)})]})}function V(t,s){switch(t){case"doc":return e.jsx(X,{name:s});case"pic":return e.jsx(Y,{name:s});case"not":return e.jsx(ee,{name:s});case"bok":return e.jsx(te,{name:s});default:return null}}function X({name:t}){const[s,o]=u.useState(!1),[n,i]=u.useState(null);return u.useEffect(()=>{j(window.location.origin+"/server/doc/list",{file:t},i,o,!0)},[]),e.jsx(e.Fragment,{children:s?n.type=="dir"?n.filelist.map((l,r)=>e.jsxs("div",{className:"dir-view",title:l[0],children:[e.jsx("div",{className:l[1]=="dir"||l[1]=="dir_link"?"dir-view-dir":"dir-view-file"}),e.jsx("span",{children:l[0]})]},r+l[0])):n.view?e.jsx("iframe",{className:"file-view",src:window.location.origin+"/"+n.url}):e.jsx("span",{children:a("not_support_type")}):e.jsx("div",{className:"loading"})})}function Y({name:t}){const s=window.location.origin+"/file/Pictures/"+t.name;if(t.media=="vid")return e.jsx("video",{src:s,controls:"controls",className:"list-media"});if(t.media="img")return e.jsx("img",{src:s,alt:t.name,className:"list-media"})}function ee({name:t}){const[s,o]=u.useState(!1),[n,i]=u.useState("");return u.useEffect(()=>{j(window.location.origin+"/server/not/get_text",{name:t},i,o,!1)},[]),s?e.jsx("code",{children:n}):e.jsx("div",{className:"loading"})}function te({name:t}){const[s,o]=u.useState(!1),[n,i]=u.useState("");return u.useEffect(()=>{j(window.location.origin+"/server/bok/get_url",{name:t},i,o,!1)},[]),s?window.location.href=n:e.jsx("div",{className:"loading"})}function j(t,s,o,n,i){fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(l=>i?l.json():l.text()).then(l=>{o(l),n(!0)})}function se(){const t=c(n=>n.showBg),[s,o]=u.useState(!0);return e.jsxs(e.Fragment,{children:[e.jsx(y,{showBg:t}),e.jsx(R,{tmpLoad:s}),e.jsx(H,{tmpLoad:s,setTmpLoad:o}),e.jsx(Q,{})]})}function ne({setTmpLoad:t}){return e.jsxs("button",{id:"unlock-btn",className:"btn lock-btn",onClick:()=>{t(!1),setTimeout(()=>{c.setState({locked:!1}),t(!0)},500)},children:[e.jsx("div",{}),e.jsx("span",{children:a("start")})]})}function oe(){const[t,s]=u.useState(!1),o=c(n=>n.load);return u.useEffect(()=>{o==2&&s(!1)},[o]),t?e.jsx("div",{className:"loading",id:"lock-loading",children:" "}):e.jsxs("button",{id:"load-btn",className:"btn lock-btn",onClick:()=>{s(!0),c.setState({load:0}),C()},children:[e.jsx("div",{}),e.jsx("span",{children:a("refresh")})]})}function ae(){const t=c(s=>s.userName);return e.jsxs("button",{id:"logout-btn",className:"btn lock-btn "+(t=="guest"?"logout-disabled":""),onClick:()=>ie(),children:[e.jsx("div",{}),e.jsx("span",{children:a("logout")})]})}function ie(){confirm(a("are_you_sure"))&&(localStorage.removeItem("token"),localStorage.removeItem("userName"),c.setState({userName:"guest",token:""}),w(),g(a("logout")))}function re({prop:t}){return e.jsxs("div",{id:"btn-box",children:[e.jsx(oe,{}),e.jsx(ne,{setTmpLoad:t}),e.jsx(ae,{})]})}function le({setSwitch:t}){const s=c(o=>o.userName);return e.jsxs("button",{className:"btn",id:"lock-user",title:a("switch"),onClick:()=>{t(!0)},children:[e.jsx("div",{id:"lock-profile"}),e.jsx("div",{id:"lock-switch"}),e.jsx("span",{children:s==""||s=="guest"?a("guest"):s})]})}function ce({prop:t}){return e.jsxs(e.Fragment,{children:[e.jsx(le,{setSwitch:t.switch}),e.jsx(re,{prop:t.unlock})]})}function f({loading:t,send:s}){return e.jsx(e.Fragment,{children:t?e.jsx("div",{className:"loading user-page-loading"}):e.jsx("button",{className:"btn user-page-send",title:a("start"),onClick:()=>s()})})}function de({para:t}){const[s,o]=u.useState({userName:"",password:""}),n=i=>{const{name:l,value:r}=i.target;o(d=>({...d,[l]:r}))};return e.jsxs("div",{className:"user-opt-page-win",onKeyDown:i=>t.keyDown(i,()=>N(s.userName,s.password,t)),children:[e.jsx("input",{className:"user-page-input",type:"text",name:"userName",placeholder:a("username"),value:s.userName,onChange:n}),e.jsx("input",{className:"user-page-input",type:"password",name:"password",value:s.password,onChange:n,placeholder:a("password")}),t.loading?e.jsx("div",{className:"loading user-page-loading"}):e.jsx(f,{loading:t.loading,send:()=>N(s.userName,s.password,t)})]})}async function N(t,s,o){o.setLoading(!0);let n=JSON.stringify({name:t,password:s});fetch(window.location.origin+"/server/login/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userMes:await x(n)})}).then(i=>{if(!i.ok)throw i.status===401?g(a("acc_or_pas_err")):g(i.status+a("error")),o.setLoading(!1),new Error(i.status);return i.json()}).then(i=>{window.localStorage.setItem("userName",t),window.localStorage.setItem("token",i.token),c.setState({userName:t,token:i.token}),w(),g(a("login")+":"+t),o.afterSend()})}function ue({para:t}){const[s,o]=u.useState({oldPassword:"",newPassword:""}),n=i=>{const{name:l,value:r}=i.target;o(d=>({...d,[l]:r}))};return e.jsxs("div",{className:"user-opt-page-win",onKeyDown:i=>t.keyDown(i,()=>b(s.oldPassword,s.newPassword,t)),children:[e.jsx("input",{className:"user-page-input",type:"password",name:"oldPassword",value:s.oldPassword,onChange:n,placeholder:a("old")+" "+a("password")}),e.jsx("input",{className:"user-page-input",type:"password",name:"newPassword",value:s.newPassword,onChange:n,placeholder:a("new")+" "+a("password")}),e.jsx(f,{loading:t.loading,send:()=>b(s.oldPassword,s.newPassword,t)})]})}async function b(t,s,o){let i=c.getState().token;const l=await x(JSON.stringify({oldPas:t,newPas:s}));o.setLoading(!0),fetch(window.location.origin+"/server/login/modPas",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({userMes:l})}).then(r=>{if(!r.ok)throw r.status===401?g(a("acc_or_pas_err")):g(r.status+a("error")),o.setLoading(!1),new Error(r.status)}).then(r=>{g(a("op_com")),o.afterSend()})}function ge({para:t}){const[s,o]=u.useState({userName:"",password:""}),n=i=>{const{name:l,value:r}=i.target;o(d=>({...d,[l]:r}))};return e.jsxs("div",{className:"user-opt-page-win",onKeyDown:i=>t.keyDown(i,()=>k(s.userName,s.password,t)),children:[e.jsx("input",{className:"user-page-input",type:"text",name:"userName",placeholder:a("new")+" "+a("username"),value:s.userName,onChange:n}),e.jsx("input",{className:"user-page-input",type:"password",name:"password",value:s.password,onChange:n,placeholder:a("password")}),t.loading?e.jsx("div",{className:"loading user-page-loading"}):e.jsx(f,{loading:t.loading,send:()=>k(s.userName,s.password,t)})]})}async function k(t,s,o){try{const i=c.getState().token,l=await x(JSON.stringify({name:t,password:s}));o.setLoading(!0);const r=await fetch(window.location.origin+"/server/login/register",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({userMes:l})}),d=await r.text();if(!r.ok){r.status===401?g(a(d)):g(r.status+a("error")),o.setLoading(!1);return}g(a("op_com")),o.afterSend()}catch(n){console.error(n),g("Network error"),o.setLoading(!1)}}function me({setSwitch:t}){const[s,o]=u.useState(!1),[n,i]=u.useState("login"),r={keyDown:(h,p)=>{h.key==="Enter"&&(s||p())},setLoading:o,loading:s,afterSend:()=>he(o,t)},d={login:e.jsx(de,{para:r}),modPas:e.jsx(ue,{para:r}),reg:e.jsx(ge,{para:r})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"user-page-win",children:[e.jsx("button",{className:"btn user-page-back",title:a("back"),onClick:()=>{t(!1)}}),e.jsxs("div",{id:"user-page-btn-bar",children:[e.jsx("button",{disabled:n==="login",className:"btn user-page-btn",title:a("login"),id:"login-btn",onClick:()=>{i("login")}}),e.jsx("button",{disabled:n==="modPas",className:"btn user-page-btn",title:a("modPas"),id:"modPas-btn",onClick:()=>{i("modPas")}}),e.jsx("button",{disabled:n==="reg",className:"btn user-page-btn",title:a("reg"),id:"reg-btn",onClick:()=>{i("reg")}})]}),d[n]]})})}function he(t,s){t(!1),s(!1)}function pe(){const[t,s]=u.useState(!1),o=c(l=>l.locked),[n,i]=u.useState(!0);return e.jsxs("div",{id:"lock-page",className:o&&n?"lock-page-load":"",children:[e.jsx("div",{id:"head-bar",className:o&&n?"head-bar-load":"",children:e.jsx("div",{id:"head-name"})}),t?e.jsx(me,{setSwitch:s}):e.jsx(ce,{prop:{unlock:i,switch:s}})]})}function we(){const t=c(s=>s.theme);return u.useEffect(()=>{C()},[]),e.jsxs("div",{id:"app",color:t.color.home,mode:t.mode,children:[e.jsx(pe,{}),e.jsx(se,{}),e.jsx("div",{className:"wallpaper"}),e.jsx(O,{})]})}B.createRoot(document.getElementById("root")).render(e.jsx(we,{}));
