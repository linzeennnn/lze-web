import{c as b,j as e,n as c,r as p,W as x,T as j,b as w}from"./all-Cdk6ncyA.js";import{P as S,C as y,T as N,S as B,a as T,H as v,G as C,b as _}from"./page-BdnlRZ9n.js";const r=b((t,o)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),showBg:!1,loading:!1,langList:[],bokList:[],bokUrl:`${window.location.origin}/server/bok/`,theme:{mode:"",color:{bok:""}},setGlobal:n=>{t(i=>({...i,...n}))},replaceGlobal:n=>{t(()=>({...n}))},getGlobal:()=>o()}));function s(t){return r.getState().langList[t]}function G(){S(r.setState,"bok"),f()}function f(){l(!0);const t=r.getState().bokUrl+"list";r.getState().edit,fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}).then(o=>o.json()).then(o=>{r.setState({bokList:o}),l(!1)})}function l(t){r.setState({loading:t,showBg:t})}function P({name:t}){return e.jsxs("div",{className:"bookmark main-item",title:s("view")+t,onClick:()=>{L(t)},children:[e.jsx("button",{className:"btn",id:"del-btn",title:s("delete"),onClick:o=>{o.stopPropagation(),U(t)}}),e.jsx("span",{children:t})]})}function L(t){l(!0);const o=r.getState().bokUrl+"get_url";fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})}).then(n=>{if(!n.ok){c(+s("error")+":"+n.status),l(!1);return}return n.text()}).then(n=>{l(!1),window.location.href=n})}function U(t){if(!confirm(s("are_you_sure")))return;l(!0);const o=r.getState().userName,n=r.getState().token,i=r.getState().bokUrl+"del";fetch(i,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+n,"x-user":o},body:JSON.stringify({name:t})}).then(u=>{if(!u.ok){u.status===401?c(s("no_per")):c(s("error")+":"+u.status),l(!1);return}c(s("op_com")),f()})}function E(){const t=r(o=>o.bokList);return e.jsx(y,{children:t.map((o,n)=>e.jsx(P,{name:o},n+o))})}function W(){const t=[{type:"none",showName:s("no_protocol")},{type:"http",showName:"http://"},{type:"https",showName:"https://"},{type:"file",showName:"file://"}],o=a=>{a.key==="Enter"&&m(d,n(k))},n=a=>I(a)?a:i==0?"https://"+a:t[i].showName+a,[i,u]=p.useState(0),[d,h]=p.useState(""),[k,g]=p.useState("");return e.jsxs(N,{children:[e.jsxs("div",{id:"title-box",children:[e.jsx("input",{placeholder:s("bok_name"),onKeyDown:o,id:"tit-input",type:"text",value:d,onChange:a=>h(a.target.value)}),e.jsx("button",{id:"save-add",title:s("save"),className:"btn",onClick:()=>m(d,n(k))})]}),e.jsxs("div",{id:"link-box",children:[e.jsx("button",{id:"switch-protocol",title:s("switch_protocol"),className:"btn",onClick:()=>{u(a=>(a+1)%t.length)}}),e.jsx("span",{id:"show-protocol",children:t[i].showName}),e.jsx("input",{placeholder:s("bok_url"),id:"link-input",onKeyDown:o,type:"text",value:k,onChange:a=>g(a.target.value)})]})]})}function I(t){return!!(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("file://"))}function m(t,o){if(t==""&&(t="new_bookmark"),!O(o)){c(s("bok_url")+" "+s("error")+" "+o),console.log(o);return}l(!0);const n=r.getState().userName,i=r.getState().token,u=r.getState().bokUrl+"add",d={name:t,text:o};fetch(u,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+i,"x-user":n},body:JSON.stringify(d)}).then(h=>{if(!h.ok){h.status===401?c(s("no_per")):c(s("error")+":"+h.status),l(!1);return}c(s("op_com")),f()})}function O(t){try{return new URL(t).hostname.includes(".")}catch{return!1}}function D(){return e.jsx(B,{children:e.jsx("button",{className:"btn side-btn",id:"load",title:s("refresh"),onClick:()=>{f()}})})}function J(){const t=r(n=>n.showBg),o=r(n=>n.loading);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading",id:"list-loading",style:o?{display:"block"}:{display:"none"}}),e.jsx(x,{showBg:t})]})}function K(){return e.jsx(e.Fragment,{children:e.jsx(J,{})})}function R(){const t=r(o=>o.theme);return p.useEffect(()=>{G()},[]),e.jsxs("div",{id:"app",mode:t.mode,color:t.color.bok,children:[e.jsx("div",{className:"wallpaper"}),e.jsxs(T,{children:[e.jsx(v,{}),e.jsx(W,{}),e.jsx(C,{}),e.jsx(_,{})]}),e.jsx(K,{}),e.jsx(D,{}),e.jsx(E,{}),e.jsx(j,{})]})}w.createRoot(document.getElementById("root")).render(e.jsx(R,{}));
