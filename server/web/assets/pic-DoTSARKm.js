import{c as I,n as j,r as h,j as e,W as U,T as $,b as R}from"./all-Cdk6ncyA.js";import{P as H,C as O,T as A,S as V,a as X,H as q,G as Y,b as J}from"./page-BdnlRZ9n.js";const i=I((t,n)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),nowPath:"",parentPath:"",imgList:[],vidList:[],dirList:[],uploading:!1,showBg:!1,langList:[],pageNum:1,theme:{mode:"",color:{pic:""},userSelect:""},loading:!1,dragWin:!1,imgPage:!0,mediaWin:{status:!1,img:!0,path:window.location.origin+"/file/Pictures/",index:0},upload:{status:!1,percent:"0%"},picUrl:`${window.location.origin}/server/pic/`,setGlobal:o=>{t(a=>({...a,...o}))},replaceGlobal:o=>{t(()=>({...o}))},getGlobal:()=>n()}));function p(t){return i.getState().langList[t]}function K(){H(i.setState,"pic"),k("")}function k(t,n){const o={folder:t},a=i.getState().picUrl+"list";_(!0),fetch(a,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{let l=[],m=[],u=[],d=[],r=[];s.filelist.forEach(g=>{g[1]=="dir"||g[1]=="dir_link"?l.push(g[0]):(g[1]=="file"||g[1]=="file_link")&&(g[2]=="img"&&(d.length<12||(m.push(d),d=[]),d.push(g[0])),g[2]=="vid"&&(r.length<12||(u.push(r),r=[]),r.push(g[0])))}),d.length>0&&m.push(d),r.length>0&&u.push(r),i.setState({dirList:l,imgList:m,vidList:u,nowPath:s.currentFolder,parentPath:s.parentFolder,selected:[],imgPage:!n,pageNum:1}),_(!1)})}function _(t){i.setState({loading:t,showBg:t})}function E(t,n){if(t.size==0){j(t.name+p("is_empty"));return}let o;const a=i.getState(),s=a.userName,l=a.token,m=a.nowPath,u=a.upload,d=i.setState,r=["jpg","jpeg","png","gif","webp","bmp","svg","ico","apng","avif"],g=["mp4","webm","ogg","ogv","mov","m4v","avi","3gp","mkv"],x=t.name.split(".").pop().toLowerCase();if(r.includes(x))o=!1,d({imgPage:!0});else if(g.includes(x))o=!0,d({imgPage:!1});else{j(t.name+":"+p("not_support_type")),d({upload:{...u,status:!1}});return}const v=a.picUrl+"upload",S=Q(t.size),N=Math.ceil(t.size/S);let y=0;function c(){if(n.sendSize>=n.totalSize){d({upload:{...u,status:!1}}),j(p("op_com")),k(m,o);return}if(y>=t.size)return;let f="",w=0;const C=t.slice(y,y+S),L=Math.floor(y/S),P=new FormData;P.append("file",C),P.append("fileName",t.name),P.append("totalChunks",N),P.append("currentChunk",L),P.append("nowpath",m);const b=new XMLHttpRequest;b.open("POST",v,!0),b.setRequestHeader("authorization","Bearer "+l),b.setRequestHeader("x-user",s),b.upload.onprogress=function(z){z.lengthComputable&&(n.sendSize=n.sendSize+Math.min(z.loaded,t.size)-w,w=z.loaded,f=Math.floor(n.sendSize/n.totalSize*100)+"%",d({upload:{...u,percent:f}}))},b.onload=function(){if(b.status!==200){b.status===401?j(p("no_per")):j(p("error")+":"+b.status+b.responseText),d({upload:{...u,status:!1}});return}y+=S,c()},b.onerror=function(){console.error(`Chunk ${L+1} upload encountered error.`),d({upload:!1})},b.send(P)}c()}function Q(t){return t<=1024*1048576?10*1048576:t<=5120*1048576&&t>1024*1048576?50*1048576:100*1048576}function B(t){i.setState({dragWin:!0}),t.stopPropagation(),t.preventDefault()}function T(t){i.setState({dragWin:!1}),t.stopPropagation(),t.preventDefault()}function W(t){const o=i.getState().upload,a=i.setState;a({dragWin:!1}),t.stopPropagation(),t.preventDefault();const s=t.dataTransfer.items,l=[];let m=0,u=0;function d(g){const x=g.webkitGetAsEntry();if(x){if(x.isDirectory){j(p("not_support_type"));return}x.isFile&&(u++,x.file(v=>{l.push(v),m+=v.size,u--,r()}))}}async function r(){if(u===0){if(l.length===0){j(p("empty"));return}a({upload:{...o,status:!0,win:!1}});const g={totalSize:m,sendSize:0};if(!await G())return;l.forEach(v=>{E(v,g)})}}for(let g=0;g<s.length;g++)d(s[g])}async function G(){const t=i.getState().userName,n=i.getState().token,o=i.getState().upload,a=window.location.origin+"/server/login/upload",s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${n}`,"x-user":t},body:JSON.stringify({appType:"pic",fileType:""})});return s.ok?!0:(s.status==401?j(p("no_per")):j(p("error")+":"+s.status),i.setState({upload:{...o,status:!1}}),!1)}function M({url:t,name:n,type:o,index:a}){const[s,l]=h.useState(!0),[m,u]=h.useState(!1);return h.useEffect(()=>{l(!0),u(!1)},[t]),h.useEffect(()=>{let d;return m&&(d=setTimeout(()=>{l(!1)},100)),()=>clearTimeout(d)},[m]),e.jsxs("div",{className:"pic-item main-item",title:n,onClick:()=>{Z(t,o,a)},children:[s&&e.jsx("div",{className:"media-loading loading"}),o==="img"?e.jsx("img",{src:t+n,loading:"lazy",onLoad:()=>{u(!0)}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"play-icon btn"}),e.jsx("video",{src:t+n,onLoadedData:()=>{u(!0)}})]})]},t)}function Z(t,n,o){const a=i.setState;a({mediaWin:{url:t,img:n=="img",status:!0,index:o}})}function ee(){const t=i(s=>s.imgList),n=i(s=>s.pageNum),o=i(s=>s.nowPath),a=`${window.location.origin}/file/Pictures/`+o+"/";return e.jsx(e.Fragment,{children:t[n-1]?t[n-1].map((s,l)=>e.jsx(M,{url:a,name:s,type:"img",index:l},a+s)):null})}function te(){const t=i(s=>s.vidList),n=i(s=>s.pageNum),o=i(s=>s.nowPath),a=`${window.location.origin}/file/Pictures/`+o+"/";return e.jsx(e.Fragment,{children:t[n-1]?t[n-1].map((s,l)=>e.jsx(M,{url:a,name:s,type:"vid",index:l},a+s)):null})}function ne(){const[t,n]=h.useState(""),o=i(r=>r.vidList),a=i(r=>r.imgList),s=i(r=>r.pageNum);let m=i(r=>r.imgPage)?a.length:o.length;const u=i.setState,d=r=>{r=Number(r),r>=1&&r<=m&&m!=1?u({pageNum:r}):r==s||j(p("page_num")+p("not_correct"))};return e.jsxs("div",{id:"page-bar",children:[e.jsx("button",{className:"btn",id:"last-page",onClick:()=>{d(s==1?m:s-1)}}),e.jsx("span",{id:"page-num",children:s+"/"+(m==0?1:m)}),e.jsxs("div",{id:"jump-page",children:[e.jsx("input",{id:"page-input",value:t,type:"text",placeholder:p("page_num"),onChange:r=>n(r.target.value),onKeyDown:r=>{r.key=="Enter"&&(d(t),n(""))}}),e.jsx("button",{className:"btn",id:"jump-btn",onClick:()=>{d(t),n("")},title:p("jump")})]}),e.jsx("button",{className:"btn",id:"next-page",onClick:()=>{d(s==m?1:s+1)}})]})}function se(){const t=i(n=>n.imgPage);return e.jsxs(O,{children:[e.jsx("div",{id:"pic-box",children:t?e.jsx(ee,{}):e.jsx(te,{})}),e.jsx(ne,{})]})}function ie(){const t=i(n=>n.nowPath);return e.jsx("button",{id:"home-pic",className:"btn",onClick:()=>{t==""?j(p("main_album")):k("")},title:p("back_main_album")})}function ae(){const t=i(o=>o.nowPath),n=i(o=>o.parentPath);return e.jsxs("div",{id:"show-path-box",children:[t==""&&n==""?null:e.jsx("span",{id:"par-text",title:p("back_parent_album"),onClick:()=>{k(n)},children:n==""?p("main_album"):F(n)}),e.jsx("span",{id:"cur-text",children:t==""?p("main_album"):F(t)})]})}function F(t){return t?(t=t.replace(/\/+$/,""),t.split("/").pop()||""):""}function oe(){const t=i(n=>n.upload);return e.jsxs("div",{id:"upload-box",children:[e.jsx("div",{id:"progress-box",children:e.jsx("div",{id:"progress-bar",style:{width:t.percent}})}),e.jsx("span",{id:"show-percent",children:t.percent})]})}function re(){const t=i(n=>n.upload);return e.jsx("div",{id:"top-bar-box",children:t.status?e.jsx(oe,{}):e.jsx(ae,{})})}function le(){const[t,n]=h.useState(!1),o=i(l=>l.dirList),a=i(l=>l.nowPath),s=()=>{n(!t)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"dir-list",className:"btn",title:p("view_album"),onClick:()=>s(),children:e.jsx("div",{id:"dir-list-box",style:{display:t?"flex":"none"},children:o.map((l,m)=>e.jsx("div",{id:"dir-item",title:p("view")+l,onClick:()=>{k(a+"/"+l)},children:l},l+m))})}),t?e.jsx("div",{id:"close-list-win",onClick:()=>s()}):null]})}function ce(){return e.jsxs(A,{children:[e.jsx(ie,{}),e.jsx(re,{}),e.jsx(le,{})]})}function de(){const t=i.setState,n=i(s=>s.pageNum),o=i(s=>s.imgPage),a=s=>{switch(s){case"img":t({imgPage:!0,pageNum:o?n:1});break;case"vid":t({imgPage:!1,pageNum:o?1:n});break}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn side-btn "+(o?"media-selected":""),id:"img-btn",title:p("image"),onClick:()=>{a("img")}}),e.jsx("button",{className:"btn side-btn "+(o?"":"media-selected"),id:"vid-btn",title:p("video"),onClick:()=>{a("vid")}})]})}function ue(){const t=i.setState;i(a=>a.pageNum),i(a=>a.imgPage);const n=i(a=>a.upload);i(a=>a.dragWin),i(a=>a.nowPath);const o=async a=>{t({upload:{...n,status:!0}});const s=Array.from(a.target.files);let l={totalSize:0,sendSize:0};s.forEach((u,d)=>{l.totalSize+=u.size}),await G()&&(s.forEach((u,d)=>{E(u,l)}),a.target.value=null)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:a=>o(a)}),e.jsx("label",{className:"btn side-btn",id:"upload",title:p("upload_media"),htmlFor:"upFile"})]})}function pe(){const t=i(n=>n.nowPath);return e.jsx(e.Fragment,{children:e.jsx("button",{className:"btn side-btn",id:"load",title:p("refresh"),onClick:()=>{k(t)}})})}function ge(){return e.jsxs(V,{children:[e.jsx(ue,{}),e.jsx(de,{}),e.jsx(pe,{})]})}function me(){const t=i(o=>o.showBg),n=i(o=>o.loading);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),e.jsx(U,{showBg:t})]})}function fe(){const t=i(o=>o.dragWin),n=i(o=>o.upload);return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"drag-win",style:t?{display:"flex"}:{display:"none"},children:e.jsx("div",{})}),n.status&&e.jsx("div",{id:"uploading",className:"bg-enable"})]})}function he(){const t=i.setState,n=i(c=>c.mediaWin),o=i(c=>c.pageNum);let a;n.img?a=i(c=>c.imgList)[o-1]:a=i(c=>c.vidList)[o-1];const[s,l]=h.useState(1),m=h.useRef(null),[u,d]=h.useState(!1),[r,g]=h.useState({x:0,y:0}),[x,v]=h.useState({x:0,y:0}),S=c=>{let f;switch(c){case"in":f=s+.3;break;case"out":if(s-.3<0)return;f=s-.3;break}l(Number(f.toFixed(2)))},N=c=>{g({x:0,y:0}),l(1);let f=n.index;const w=a.length;switch(c){case"min":f--,f=f<0?w-1:f;break;case"add":f++,f=f>w-1?0:f;break}t({mediaWin:{...n,index:f}})};h.useEffect(()=>{const c=w=>{if(!u)return;const C=w.clientX-x.x,L=w.clientY-x.y;g(P=>({x:P.x+C,y:P.y+L})),v({x:w.clientX,y:w.clientY})},f=()=>{d(!1)};return window.addEventListener("mousemove",c),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",f)}},[u,x]);const y=c=>{c.preventDefault(),c.stopPropagation(),d(!0),v({x:c.clientX,y:c.clientY})};return h.useEffect(()=>{n.status&&(g({x:0,y:0}),l(1))},[n.status]),n.status?e.jsxs("div",{className:"bg-enable",onClick:()=>t({mediaWin:{status:!1}}),children:[e.jsx("button",{className:"btn media-btn media-widget",id:"close-media"}),e.jsx("button",{className:"btn media-btn media-widget",id:"last-pic",onClick:c=>{c.stopPropagation(),N("min")}}),e.jsx("button",{className:"btn media-btn media-widget",id:"next-pic",onClick:c=>{c.stopPropagation(),N("add")}}),e.jsx("div",{id:"media-box",ref:m,onMouseDown:y,style:{cursor:u?"grabbing":"grab",transform:`translate(${r.x}px, ${r.y}px) scale(${s})`,transition:u?"none":"transform 0.15s ease-out"},onClick:c=>c.stopPropagation(),children:n.img?e.jsx("img",{loading:"lazy",src:n.url+a[n.index]}):e.jsx("video",{src:n.url+a[n.index],controls:!0,autoPlay:!0,loop:!0})}),e.jsxs("div",{id:"zoom-bar",className:"media-widget",children:[e.jsx("button",{className:"btn zoom-btn",style:{marginRight:"20px"},title:p("zoom_out"),onClick:c=>{c.stopPropagation(),S("out")},children:e.jsx("div",{id:"zoom-out"})}),e.jsx("button",{className:"btn zoom-btn",style:{marginLeft:"20px"},title:p("zoom_in"),onClick:c=>{c.stopPropagation(),S("in")},children:e.jsx("div",{id:"zoom-in"})})]})]}):null}function xe(){return e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsx(fe,{}),e.jsx(he,{})]})}function be(){const t=i(n=>n.theme);return h.useEffect(()=>(K(),window.addEventListener("dragover",B),window.addEventListener("dragleave",T),window.addEventListener("drop",W),window.addEventListener("paste",D),()=>{window.removeEventListener("dragover",B),window.removeEventListener("dragleave",T),window.removeEventListener("drop",W),window.removeEventListener("paste",D)}),[]),e.jsxs("div",{id:"app",mode:t.mode,color:t.color.pic,children:[e.jsx("div",{className:"wallpaper"}),e.jsxs(X,{children:[e.jsx(q,{}),e.jsx(ce,{}),e.jsx(Y,{}),e.jsx(J,{})]}),e.jsx(xe,{}),e.jsx(ge,{}),e.jsx(se,{}),e.jsx($,{})]})}function D(t){if(!t)return;const n=t.clipboardData.items[0];if(n.type.startsWith("image/")&&confirm(p("are_you_sure"))){const o=n.getAsFile(),a={totalSize:o.size,sendSize:0};E(o,a)}}R.createRoot(document.getElementById("root")).render(e.jsx(be,{}));
