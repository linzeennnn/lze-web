import{c as C,j as t,n as m,r as h,W as N,T,b as y}from"./all-mai5PqmV.js";import{P as B,C as L,T as _,S as E,a as G,H as U,G as O,b as I}from"./page-DzuHm9KX.js";const i=C((e,n)=>{const s=window.localStorage.getItem("userName"),r=window.localStorage.getItem("token");return{userName:s,token:r,nowuser:s?.trim()||"visitor",showBg:!1,loading:!1,controlList:null,langList:[],userList:null,theme:{mode:"",color:{mon:""}},monUrl:`${window.location.origin}/server/mon/`,setGlobal:a=>{e(l=>({...l,...a}))},replaceGlobal:a=>{e(()=>({...a}))},getGlobal:()=>n()}});function o(e){return i.getState().langList[e]}function P(){B(i.setState,"mon"),p()}function j(e){i.setState({loading:e,showBg:e})}function p(){j(!0);const e=i.getState().monUrl+"list";fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(n=>n.json()).then(n=>{i.setState({controlList:n.control,userList:n.user}),j(!1)})}function A({keyName:e,Mes:n}){const s=i(r=>r.nowuser);return t.jsx("div",{className:"action-bar "+(n.user.includes(s)?"have-action":"no-action"),title:o("modify_permission"),onClick:()=>{M(e.control,e.action,s,n.user.includes(s)?"remove":"add")},children:o(n.name)})}function M(e,n,s,r){let a=o(r);if(!confirm(a+"?"))return;j(!0);const l=i.getState().userName,c=i.getState().token,f=i.getState().monUrl+"update_act";fetch(f,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+c,"x-user":l},body:JSON.stringify({user:l,token:c,control:e,action:n,name:s,change:r})}).then(d=>{if(!d.ok){d.status===401?m(o("no_per")):m(o("error")+":"+d.status),j(!1);return}m(o("op_com")),p()})}function W({keyName:e,Mes:n}){const[s,r]=h.useState(!1);return n?t.jsxs("div",{className:"control-bar main-item",children:[t.jsx("span",{className:"control-name",children:o(e)}),s?t.jsx("div",{className:"action-list",children:Object.entries(n.action).map(([a,l])=>t.jsx(A,{keyName:{control:e,action:a},Mes:l},e+a))}):null,t.jsx("button",{className:"btn show-action",title:o("show"),onClick:()=>{r(!s)}})]}):null}function D(){const e=i(n=>n.controlList);return t.jsx(L,{children:e?Object.entries(e).map(([n,s])=>t.jsx(W,{keyName:n,Mes:s},n)):null})}function F({Mes:e}){const[n,s]=h.useState(!1),r=i(c=>c.userList),a=i(c=>c.nowuser),l=i.setState;return t.jsxs("div",{id:"user-box",children:[t.jsx("button",{id:"user-btn",className:"btn",title:o("view_user"),onClick:()=>{s(!0)}}),t.jsx("span",{id:"user-text",onClick:()=>{s(!0)},children:a}),n?t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"user-list",children:Object.entries(r).map(([c])=>t.jsx("div",{className:"name-item",onClick:()=>{l({nowuser:c}),s(!1)},children:t.jsx("span",{children:c})},c+"nameList"))}),t.jsx("div",{id:"user-back",onClick:()=>{s(!1)}})]}):null]})}function z(){const e={never:o("never"),h:o("hour"),d:o("day"),m:o("month"),y:o("year")},n=i(u=>u.userList),s=i(u=>u.nowuser),r=Object.keys(e),[a,l]=h.useState("h"),[c,f]=h.useState(!1),[d,b]=h.useState(""),v=()=>{const x=(r.indexOf(a)+1)%r.length;l(r[x])},S=u=>{const{value:x}=u.target;b(x)},k=u=>{u.key==="Enter"&&w(d,a)},w=(u,x)=>{let g;if(x=="never")g="never";else{if(!(u>=0)){m(o("not_correct"));return}g=u+x}f(!1),b(""),H(s,g)};return n?t.jsxs("div",{id:"time-box",children:[t.jsx("button",{id:"time-btn",className:"btn",title:o("mod_log_time"),onClick:()=>f(!c)}),c?t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"time-input-box",className:"time-text",children:[t.jsx("input",{id:"time-input",placeholder:o("num"),value:d,onChange:S,onKeyDown:k}),t.jsx("button",{className:"btn mini-btn",id:"save-time",title:o("save"),onClick:()=>{w(d,a)}})]}),t.jsx("div",{id:"unit-box",children:t.jsxs("div",{id:"unit-text",children:[t.jsx("span",{children:e[a]}),t.jsx("button",{className:"btn mini-btn",id:"switch-unit",title:o("switch"),onClick:v})]})})]}):t.jsx("span",{className:"time-text",id:"display-time",title:o("allow_login_time"),children:J(n[s].tokentime)+e[R(n[s].tokentime)]})]}):null}function H(e,n){j(!0);const s=i.getState(),r=s.token,a=s.userName,l=s.monUrl+"date";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+r,"x-user":a},body:JSON.stringify({token:r,user:a,name:e,time:n})}).then(c=>{if(!c.ok){c.status==401?m(o("no_per")):m(o("error")+":"+c.status),j(!1);return}m(o("op_com")),p()})}function J(e){return e=="never"||e==""||!e?"":parseInt(e.slice(0,-1))}function R(e){return e=="never"||e==""||!e?"never":e.slice(-1)}function K(){const e=i(n=>n.userList);return t.jsxs(_,{children:[t.jsx(F,{Mes:e}),t.jsx(z,{})]})}function $(){return t.jsx("button",{className:"btn",id:"load",title:o("refresh"),onClick:()=>{p()}})}function q(){return t.jsx(E,{children:t.jsx($,{})})}function Q(){const e=i(s=>s.showBg),n=i(s=>s.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),t.jsx(N,{showBg:e})]})}function V(){return t.jsx(Q,{})}function X(){const e=i(n=>n.theme);return h.useEffect(()=>{P()},[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.mon,children:[t.jsxs(G,{children:[t.jsx(U,{}),t.jsx(K,{}),t.jsx(O,{}),t.jsx(I,{})]}),t.jsx(V,{}),t.jsx(q,{}),t.jsx(D,{}),t.jsx(T,{}),t.jsx("div",{className:"wallpaper"})]})}y.createRoot(document.getElementById("root")).render(t.jsx(X,{}));
