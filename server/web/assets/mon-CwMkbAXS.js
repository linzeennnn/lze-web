import{c as B,A as g,j as t,h as n,p as v,r as l,n as S,l as y,W as k,f as E,u as T,P as I,q as U}from"./all-C4Mh-jl3.js";import{P as _,C as G,T as A,S as O,a as W,H as D,G as M,b as P}from"./page-BTxulCAt.js";const r=B((e,s)=>{const o=window.localStorage.getItem("userName"),c=window.localStorage.getItem("token");return{userName:o,token:c,nowuser:o?.trim()||"guest",showBg:!1,loading:!1,controlList:null,langList:[],userList:null,showCmd:!1,showLogout:!1,monUrl:`${window.location.origin}/server/mon/`,setGlobal:a=>{e(m=>({...m,...a}))},replaceGlobal:a=>{e(()=>({...a}))},getGlobal:()=>s()}});function K(){_("mon"),C()}function C(){g.get({api:"mon/list",success:e=>{r.setState({controlList:e.control,userList:e.user})}})}function F({keyName:e,Mes:s}){const o=r(c=>c.nowuser);return t.jsx("div",{className:"action-bar "+(s.user.includes(o)?"have-action":"no-action"),title:n("modify_permission"),onClick:()=>{J(e.control,e.action,o,s.user.includes(o)?"remove":"add")},children:n(s.name)})}async function J(e,s,o,c){let a=n(c);await v.normal(a+"?")&&g.patch({api:"mon/update_act",body:{control:e,action:s,name:o,change:c},notice:!0,success:()=>{C()}})}function R({keyName:e,Mes:s}){const[o,c]=l.useState(!1);return s?t.jsxs("div",{className:"control-bar main-item",children:[t.jsx("span",{className:"control-name",children:n(e)}),o?t.jsx("div",{className:"action-list",children:Object.entries(s.action).map(([a,m])=>t.jsx(F,{keyName:{control:e,action:a},Mes:m},e+a))}):null,t.jsx("button",{className:"btn show-action",title:n("show"),onClick:()=>{c(!o)}})]}):null}function H(){const e=r(s=>s.controlList);return t.jsx(G,{children:e?Object.entries(e).map(([s,o])=>t.jsx(R,{keyName:s,Mes:o},s)):null})}function q({Mes:e}){const[s,o]=l.useState(!1),c=r(d=>d.userList),a=r(d=>d.nowuser),m=r.setState;return t.jsxs("div",{id:"user-box",children:[t.jsx("button",{id:"user-btn",className:"btn",title:n("view_user"),onClick:()=>{o(!0)}}),t.jsx("span",{id:"user-text",onClick:()=>{o(!0)},children:a}),s?t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"user-list",children:Object.entries(c).map(([d])=>t.jsx("div",{className:"name-item",onClick:()=>{m({nowuser:d}),o(!1)},children:t.jsx("span",{children:d})},d+"nameList"))}),t.jsx("div",{id:"user-back",onClick:()=>{o(!1)}})]}):null]})}function $(){const e={never:n("never"),h:n("hour"),d:n("day"),m:n("month"),y:n("year")},s=r(i=>i.userList),o=r(i=>i.nowuser),c=Object.keys(e),[a,m]=l.useState("h"),[d,h]=l.useState(!1),[f,j]=l.useState(""),p=()=>{const u=(c.indexOf(a)+1)%c.length;m(c[u])},w=i=>{const{value:u}=i.target;j(u)},L=i=>{i.key==="Enter"&&b(f,a)},b=(i,u)=>{let x;if(u=="never")x="never";else{if(!(i>=0)){S.err(n("not_correct"));return}x=i+u}h(!1),j(""),z(o,x)};return s?t.jsxs("div",{id:"time-box",children:[t.jsx("button",{id:"time-btn",className:"btn",title:n("mod_log_time"),onClick:()=>h(!d)}),d?t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"time-input-box",className:"time-text",children:[t.jsx("input",{id:"time-input",placeholder:n("num"),value:f,onChange:w,onKeyDown:L}),t.jsx("button",{className:"btn mini-btn",id:"save-time",title:n("save"),onClick:()=>{b(f,a)}})]}),t.jsx("div",{id:"unit-box",children:t.jsxs("div",{id:"unit-text",children:[t.jsx("span",{children:e[a]}),t.jsx("button",{className:"btn mini-btn",id:"switch-unit",title:n("switch"),onClick:p})]})})]}):t.jsx("span",{className:"time-text",id:"display-time",title:n("allow_login_time"),children:Q(s[o].tokentime)+e[V(s[o].tokentime)]})]}):null}function z(e,s){g.patch({api:"mon/date",body:{name:e,time:s},notice:!0,success:()=>[C()]})}function Q(e){return e=="never"||e==""||!e?"":parseInt(e.slice(0,-1))}function V(e){return e=="never"||e==""||!e?"never":e.slice(-1)}function X(){const e=r(s=>s.userList);return t.jsxs(A,{children:[t.jsx(q,{Mes:e}),t.jsx($,{})]})}function Y(){const e=()=>{C()};return l.useEffect(()=>{y({load:{name:n("refresh"),fun:e}})},[]),t.jsx("button",{className:"btn side-btn",id:"load",title:n("refresh"),onClick:e})}function Z(){const e=()=>{r.setState({showCmd:!0})};return l.useEffect(()=>{y({terminal:{name:n("terminal"),fun:e}})},[]),t.jsx("button",{className:"btn side-btn",id:"cmd-btn",title:n("terminal"),onClick:e})}function tt(){const e=()=>{r.setState({showLogout:!0})};return l.useEffect(()=>{y({logout:{name:n("logout"),fun:e}})},[]),t.jsx("button",{className:"btn side-btn",id:"logout-btn",title:n("logout"),onClick:e})}function et(){return t.jsxs(O,{children:[t.jsx(Z,{}),t.jsx(tt,{}),t.jsx(Y,{})]})}function st(){const e=r(o=>o.showBg),s=r(o=>o.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:s?{display:"block"}:{display:"none"}}),t.jsx(k,{showBg:e})]})}function nt(){const e=r(i=>i.showCmd),[s,o]=l.useState("输出"),[c,a]=l.useState(""),[m,d]=l.useState(""),[h,f]=l.useState(""),[j,p]=l.useState([]);l.useEffect(()=>{p(JSON.parse(localStorage.getItem("cmdList"))||[])},[]);const w=(i,u)=>{if(m==""||h==""){S.normal(n("none"));return}d(""),f("");const x=[...j,{title:i,cmd:u}];p(x),localStorage.setItem("cmdList",JSON.stringify(x)),S.normal(n("op_com"))},L=async i=>{if(!await v.normal(n("are_you_sure")))return;const u=[...j.slice(0,i),...j.slice(i+1)];p(u),localStorage.setItem("cmdList",JSON.stringify(u))},b=i=>{i.key==="Enter"&&w(m,h)};return t.jsx(k,{showBg:e,children:t.jsxs("div",{id:"cmd-box",children:[t.jsx("button",{className:"btn",id:"close-cmd",title:n("close"),onClick:()=>{r.setState({showCmd:!1})}}),t.jsx("div",{id:"cus-cmd-box",children:j.map((i,u)=>t.jsxs("div",{className:"cmd-item",title:n("run"),onClick:()=>{a(i.cmd),N(i.cmd,o)},children:[t.jsx("button",{className:"del-cmd btn",title:n("delete"),onClick:x=>{x.stopPropagation(),L(u)}}),t.jsx("span",{className:"cmd-title",children:i.title}),t.jsx("span",{className:"cmd-cmd",children:i.cmd})]},u+i.cmd))}),t.jsxs("div",{id:"send-box",className:"cmd-widget",children:[t.jsx("input",{id:"input-cmd",value:c,placeholder:n("cmd"),onKeyDown:i=>{i.key==="Enter"&&N(c,o)},onChange:i=>a(i.target.value)}),t.jsx("pre",{id:"output-text",children:s}),t.jsx("button",{className:"btn",id:"send-cmd",title:n("run"),onClick:()=>{N(c,o)}})]}),t.jsxs("div",{id:"cus-cmd-input-bar",className:"cmd-widget",children:[t.jsx("input",{placeholder:n("cus_name"),className:"cmd-input",onKeyDown:b,value:m,onChange:i=>d(i.target.value)}),t.jsx("input",{placeholder:n("cmd"),className:"cmd-input",onKeyDown:b,value:h,onChange:i=>f(i.target.value)}),t.jsx("button",{className:"btn",id:"add-cmd",title:n("add"),onClick:()=>{w(m,h)}})]})]})})}async function N(e,s){await v.normal(n("run")+"?")&&g.post({api:"mon/cmd",body:{cmd:e},success:o=>{s(o)}})}function ot(){const[e,s]=l.useState([]),o=r(c=>c.showLogout);return l.useEffect(()=>{(async()=>{const a=await ct();s(a)})()},[]),t.jsx(k,{showBg:o,children:t.jsxs("div",{id:"user-list-box",children:[t.jsx("button",{id:"close-logout",className:"btn",title:n("close"),onClick:()=>{r.setState({showLogout:!1})}}),e.map(c=>t.jsxs("div",{className:"user-item-box",children:[t.jsx("button",{className:"del-uaer-btn btn",title:n("delete"),onClick:()=>{it(c,s)}}),t.jsx("span",{className:"user-showname",children:c})]},c+"-user-box"))]})})}async function it(e,s){await v.normal(n("are_you_sure"))&&g.delete({api:"mon/userList",body:{name:e},notice:!0,success:o=>{s(o)}})}async function ct(){const e=await E.get({api:"mon/userList"});return e||[]}function at(){return t.jsxs(t.Fragment,{children:[t.jsx(nt,{}),t.jsx(ot,{}),t.jsx(st,{})]})}function rt(){const e=T(s=>s.theme);return t.jsxs("div",{id:"app",mode:e.mode,color:e.color.mon,children:[t.jsxs(W,{children:[t.jsx(D,{}),t.jsx(X,{}),t.jsx(M,{}),t.jsx(P,{})]}),t.jsx(at,{}),t.jsx(et,{}),t.jsx(H,{}),t.jsx(I,{}),t.jsx("div",{className:"wallpaper"})]})}K();U.createRoot(document.getElementById("root")).render(t.jsx(rt,{}));
