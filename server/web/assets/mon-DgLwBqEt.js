import{c as N,j as t,n as m,r as f,W as y,T as L,b as T}from"./all-ByTVW_E0.js";import{P as B,C as _,T as E,S as O,a as U,H as I,G,b as D}from"./page-liDtxHOR.js";const c=N((e,s)=>{const o=window.localStorage.getItem("userName"),i=window.localStorage.getItem("token");return{userName:o,token:i,nowuser:o?.trim()||"guest",showBg:!1,loading:!1,controlList:null,langList:[],userList:null,showCmd:!1,showLogout:!1,theme:{mode:"",color:{mon:""}},monUrl:`${window.location.origin}/server/mon/`,setGlobal:l=>{e(r=>({...r,...l}))},replaceGlobal:l=>{e(()=>({...l}))},getGlobal:()=>s()}});function n(e){return c.getState().langList[e]||e}function P(){B(c.setState,"mon"),S()}function u(e){c.setState({loading:e,showBg:e})}function S(){u(!0);const e=c.getState().monUrl+"list";fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{c.setState({controlList:s.control,userList:s.user}),u(!1)})}function J({keyName:e,Mes:s}){const o=c(i=>i.nowuser);return t.jsx("div",{className:"action-bar "+(s.user.includes(o)?"have-action":"no-action"),title:n("modify_permission"),onClick:()=>{A(e.control,e.action,o,s.user.includes(o)?"remove":"add")},children:n(s.name)})}function A(e,s,o,i){let l=n(i);if(!confirm(l+"?"))return;u(!0);const r=c.getState().userName,d=c.getState().token,j=c.getState().monUrl+"update_act";fetch(j,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+d},body:JSON.stringify({user:r,token:d,control:e,action:s,name:o,change:i})}).then(x=>{if(!x.ok){x.status===401?m(n("no_per")):m(n("error")+":"+x.status),u(!1);return}m(n("op_com")),S()})}function W({keyName:e,Mes:s}){const[o,i]=f.useState(!1);return s?t.jsxs("div",{className:"control-bar main-item",children:[t.jsx("span",{className:"control-name",children:n(e)}),o?t.jsx("div",{className:"action-list",children:Object.entries(s.action).map(([l,r])=>t.jsx(J,{keyName:{control:e,action:l},Mes:r},e+l))}):null,t.jsx("button",{className:"btn show-action",title:n("show"),onClick:()=>{i(!o)}})]}):null}function z(){const e=c(s=>s.controlList);return t.jsx(_,{children:e?Object.entries(e).map(([s,o])=>t.jsx(W,{keyName:s,Mes:o},s)):null})}function K({Mes:e}){const[s,o]=f.useState(!1),i=c(d=>d.userList),l=c(d=>d.nowuser),r=c.setState;return t.jsxs("div",{id:"user-box",children:[t.jsx("button",{id:"user-btn",className:"btn",title:n("view_user"),onClick:()=>{o(!0)}}),t.jsx("span",{id:"user-text",onClick:()=>{o(!0)},children:l}),s?t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"user-list",children:Object.entries(i).map(([d])=>t.jsx("div",{className:"name-item",onClick:()=>{r({nowuser:d}),o(!1)},children:t.jsx("span",{children:d})},d+"nameList"))}),t.jsx("div",{id:"user-back",onClick:()=>{o(!1)}})]}):null]})}function F(){const e={never:n("never"),h:n("hour"),d:n("day"),m:n("month"),y:n("year")},s=c(a=>a.userList),o=c(a=>a.nowuser),i=Object.keys(e),[l,r]=f.useState("h"),[d,j]=f.useState(!1),[x,g]=f.useState(""),b=()=>{const h=(i.indexOf(l)+1)%i.length;r(i[h])},C=a=>{const{value:h}=a.target;g(h)},k=a=>{a.key==="Enter"&&w(x,l)},w=(a,h)=>{let p;if(h=="never")p="never";else{if(!(a>=0)){m(n("not_correct"));return}p=a+h}j(!1),g(""),M(o,p)};return s?t.jsxs("div",{id:"time-box",children:[t.jsx("button",{id:"time-btn",className:"btn",title:n("mod_log_time"),onClick:()=>j(!d)}),d?t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"time-input-box",className:"time-text",children:[t.jsx("input",{id:"time-input",placeholder:n("num"),value:x,onChange:C,onKeyDown:k}),t.jsx("button",{className:"btn mini-btn",id:"save-time",title:n("save"),onClick:()=>{w(x,l)}})]}),t.jsx("div",{id:"unit-box",children:t.jsxs("div",{id:"unit-text",children:[t.jsx("span",{children:e[l]}),t.jsx("button",{className:"btn mini-btn",id:"switch-unit",title:n("switch"),onClick:b})]})})]}):t.jsx("span",{className:"time-text",id:"display-time",title:n("allow_login_time"),children:H(s[o].tokentime)+e[R(s[o].tokentime)]})]}):null}function M(e,s){u(!0);const o=c.getState(),i=o.token;o.userName;const l=o.monUrl+"date";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({name:e,time:s})}).then(r=>{if(!r.ok){r.status==401?m(n("no_per")):m(n("error")+":"+r.status),u(!1);return}m(n("op_com")),S()})}function H(e){return e=="never"||e==""||!e?"":parseInt(e.slice(0,-1))}function R(e){return e=="never"||e==""||!e?"never":e.slice(-1)}function $(){const e=c(s=>s.userList);return t.jsxs(E,{children:[t.jsx(K,{Mes:e}),t.jsx(F,{})]})}function q(){return t.jsx("button",{className:"btn side-btn",id:"load",title:n("refresh"),onClick:()=>{S()}})}function Q(){return c(e=>e.showCmd),t.jsx("button",{className:"btn side-btn",id:"cmd-btn",title:n("terminal"),onClick:()=>{c.setState({showCmd:!0})}})}function V(){return c(e=>e.showLogout),t.jsx("button",{className:"btn side-btn",id:"logout-btn",title:n("logout"),onClick:()=>{c.setState({showLogout:!0})}})}function X(){return t.jsxs(O,{children:[t.jsx(Q,{}),t.jsx(V,{}),t.jsx(q,{})]})}function Y(){const e=c(o=>o.showBg),s=c(o=>o.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:s?{display:"block"}:{display:"none"}}),t.jsx(y,{showBg:e})]})}function Z(){const e=c(a=>a.showCmd),[s,o]=f.useState("输出"),[i,l]=f.useState(""),[r,d]=f.useState(""),[j,x]=f.useState(""),[g,b]=f.useState([]);f.useEffect(()=>{b(JSON.parse(localStorage.getItem("cmdList"))||[])},[]);const C=(a,h)=>{if(r==""||j==""){m(n("none"));return}d(""),x("");const p=[...g,{title:a,cmd:h}];b(p),localStorage.setItem("cmdList",JSON.stringify(p)),m(n("op_com"))},k=a=>{if(!confirm(n("are_you_sure")))return;const h=[...g.slice(0,a),...g.slice(a+1)];b(h),localStorage.setItem("cmdList",JSON.stringify(h))},w=a=>{a.key==="Enter"&&C(r,j)};return t.jsx(y,{showBg:e,children:t.jsxs("div",{id:"cmd-box",children:[t.jsx("button",{className:"btn",id:"close-cmd",title:n("close"),onClick:()=>{c.setState({showCmd:!1})}}),t.jsx("div",{id:"cus-cmd-box",children:g.map((a,h)=>t.jsxs("div",{className:"cmd-item",title:n("run"),onClick:()=>{l(a.cmd),v(a.cmd,o)},children:[t.jsx("button",{className:"del-cmd btn",title:n("delete"),onClick:p=>{p.stopPropagation(),k(h)}}),t.jsx("span",{className:"cmd-title",children:a.title}),t.jsx("span",{className:"cmd-cmd",children:a.cmd})]},h+a.cmd))}),t.jsxs("div",{id:"send-box",className:"cmd-widget",children:[t.jsx("input",{id:"input-cmd",value:i,placeholder:n("cmd"),onKeyDown:a=>{a.key==="Enter"&&v(i,o)},onChange:a=>l(a.target.value)}),t.jsx("pre",{id:"output-text",children:s}),t.jsx("button",{className:"btn",id:"send-cmd",title:n("run"),onClick:()=>{v(i,o)}})]}),t.jsxs("div",{id:"cus-cmd-input-bar",className:"cmd-widget",children:[t.jsx("input",{placeholder:n("cus_name"),className:"cmd-input",onKeyDown:w,value:r,onChange:a=>d(a.target.value)}),t.jsx("input",{placeholder:n("cmd"),className:"cmd-input",onKeyDown:w,value:j,onChange:a=>x(a.target.value)}),t.jsx("button",{className:"btn",id:"add-cmd",title:n("add"),onClick:()=>{C(r,j)}})]})]})})}function v(e,s){if(!confirm(n("run")+"?"))return;u(!0);const o=c.getState(),i=o.token,l=o.monUrl+"cmd";fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({cmd:e})}).then(r=>{if(!r.ok){r.status==401?m(n("no_per")):m(n("error")+":"+r.status),u(!1);return}s(r.text()),u(!1)})}function tt(){const[e,s]=f.useState([]),o=c(i=>i.showLogout);return f.useEffect(()=>{async function i(){const l=await nt();s(l)}i()},[]),t.jsx(y,{showBg:o,children:t.jsxs("div",{id:"user-list-box",children:[t.jsx("button",{id:"close-logout",className:"btn",title:n("close"),onClick:()=>{c.setState({showLogout:!1})}}),e.map(i=>t.jsxs("div",{className:"user-item-box",children:[t.jsx("button",{className:"del-uaer-btn btn",title:n("delete"),onClick:()=>{et(i,s)}}),t.jsx("span",{className:"user-showname",children:i})]},i+"-user-box"))]})})}function et(e,s){if(!confirm(n("are_you_sure")))return;u(!0);const o=c.getState(),i=o.monUrl+"userList",l=o.token;fetch(i,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+l},body:JSON.stringify({name:e})}).then(r=>r.status===401||r.status===405?(m(n("no_per")),u(!1),null):r.ok?r.json():(m(n("error")+":"+r.status),u(!1),null)).then(r=>{r&&(m(n("op_com")),s(r))}).catch(r=>{console.error(r)}).finally(()=>{u(!1)})}async function nt(){u(!0);const e=c.getState(),s=e.monUrl+"userList",o=e.token;try{const i=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o}});return i.status===401?[]:i.ok?(u(!1),await i.json()):(m(n("error")+":"+i.status),u(!1),[])}catch(i){return console.error(i),u(!1),[]}}function st(){return t.jsxs(t.Fragment,{children:[t.jsx(Z,{}),t.jsx(tt,{}),t.jsx(Y,{})]})}function ot(){const e=c(s=>s.theme);return f.useEffect(()=>{P()},[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.mon,children:[t.jsxs(U,{children:[t.jsx(I,{}),t.jsx($,{}),t.jsx(G,{}),t.jsx(D,{})]}),t.jsx(st,{}),t.jsx(X,{}),t.jsx(z,{}),t.jsx(L,{}),t.jsx("div",{className:"wallpaper"})]})}T.createRoot(document.getElementById("root")).render(t.jsx(ot,{}));
