import{c as w,n as g,h as i,A as d,j as t,k as c,q as y,r as a,o as N,W as S,u as B,P as v,t as F}from"./all-0L4ytAmL.js";import{P as W,C,T as L,S as _,a as G,H as P,G as I,b as T}from"./page-B6_6T00P.js";import{F as A}from"./floatWin-CZJDpZqi.js";import{u as E,G as D,S as U,F as R,a as b,A as K}from"./goUp-BSABSNmz.js";import{b as H}from"./path-Sr8gxytF.js";const l=w((e,o)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),showBg:!1,loading:!1,langList:[],bokList:[],fileWin:!1,setGlobal:s=>{e(n=>({...n,...s}))},replaceGlobal:s=>{e(()=>({...s}))},getGlobal:()=>o()}));function q(){W("bok"),u()}function u(){d.get({api:"bok/list",success:e=>{l.setState({bokList:e})}})}function m(e,o){if(e==""&&(e="new_bookmark"),!$(o)){g.err(i("bok_url")+" "+i("error")+" "+o);return}d.post({api:"bok/add",body:{name:e,text:o},notice:!0,success:()=>{u()}})}function $(e){try{const o=new URL(e);return o.protocol=="doc:"?!0:o.hostname.includes(".")}catch{return!1}}function z({name:e}){return t.jsxs("div",{className:"bookmark main-item",title:i("view")+e,onClick:()=>{J(e)},children:[t.jsx("button",{className:"btn",id:"del-btn",title:i("delete"),onClick:o=>{o.stopPropagation(),O(e)},children:c("no")}),t.jsx("span",{children:e})]})}function J(e){d.post({api:"bok/get_url",body:{name:e},success:o=>{if(o.protocol=="doc"||o.protocol=="pic"||o.protocol=="not"){const s=new URL(o.url);window.location.href=window.location.origin+"/file/Documents/"+s.pathname.replace(/^\/+/,"")}else window.location.href=o.url}})}async function O(e){await y.normal(i("are_you_sure"))&&d.delete({api:"bok/del",body:{name:e},notice:!0,success:()=>{u()}})}function Q(){const e=l(o=>o.bokList);return t.jsx(C,{children:e.map((o,s)=>t.jsx(z,{name:o},s+o))})}function V(){const e=[{type:"none",showName:i("no_protocol")},{type:"http",showName:"http://"},{type:"https",showName:"https://"},{type:"file",showName:"file://"}],o=r=>{r.key==="Enter"&&m(p,s(f))},s=r=>X(r)?r:n==0?"https://"+r:e[n].showName+r,[n,h]=a.useState(0),[p,j]=a.useState(""),[f,k]=a.useState("");return t.jsxs(L,{children:[t.jsxs("div",{id:"title-box",children:[t.jsx("input",{placeholder:i("bok_name"),onKeyDown:o,id:"tit-input",type:"text",value:p,onChange:r=>j(r.target.value)}),t.jsx("button",{id:"save-add",title:i("save"),className:"btn",onClick:()=>m(p,s(f)),children:c("save")})]}),t.jsxs("div",{id:"link-box",children:[t.jsx("button",{id:"switch-protocol",title:i("switch_protocol"),className:"btn",onClick:()=>{h(r=>(r+1)%e.length)},children:c("switch")}),t.jsx("span",{id:"show-protocol",children:e[n].showName}),t.jsx("input",{placeholder:i("bok_url"),id:"link-input",onKeyDown:o,type:"text",value:f,onChange:r=>k(r.target.value)})]})]})}function X(e){return!!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("file://"))}function Y(){return t.jsx("button",{className:"btn side-btn",onClick:()=>{l.setState({fileWin:!0})},title:i("addFile"),children:c("addFile")})}function Z(){const e=()=>{u()};return a.useEffect(()=>{N({refresh:{name:i("refresh"),fun:e}})},[]),t.jsx("button",{className:"btn side-btn",title:i("refresh"),onClick:e,children:c("load")})}function M(){return t.jsxs(_,{children:[t.jsx(Y,{}),t.jsx(Z,{})]})}function ee(){const e=E(n=>n.fileCache),o=e.fileList?.[e.current]??[],s=l(n=>n.fileWin);return a.useEffect(()=>{s&&x("")},[s]),t.jsx(A,{show:s,title:i("addFile"),setShow:()=>{l.setState({fileWin:!1})},children:t.jsxs("div",{className:"file-win",children:[t.jsxs("div",{id:"path-bar",children:[t.jsx(D,{}),t.jsx(U,{})]}),o.map((n,h)=>t.jsx(R,{name:n[0],type:n[1],Fun:n[1]=="dir"||n[1]=="dir_link"?x:te,TextFun:()=>{},mask:null,fileBtn:null},h+n[0]))]})})}function x(e){const o=e?b()+"/"+e:"";d.post({api:"doc/list",body:{file:o},success:s=>{s.type=="dir"&&K({nowPath:s.currentFolder,fileList:s.filelist,name:H(s.currentFolder)})}})}function te(e){const o=l.getState();l.setState({...o,fileWin:!1});const s="doc://"+b()+"/"+e;m(e,s)}function oe(){const e=l(s=>s.showBg),o=l(s=>s.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:o?{display:"block"}:{display:"none"}}),t.jsx(S,{showBg:e})]})}function se(){return t.jsxs(t.Fragment,{children:[t.jsx(oe,{}),t.jsx(ee,{})]})}function ne(){const e=B(o=>o.theme);return t.jsxs("div",{id:"app",mode:e.mode,color:e.color.bok,children:[t.jsx("div",{className:"wallpaper"}),t.jsxs(G,{children:[t.jsx(P,{}),t.jsx(V,{}),t.jsx(I,{}),t.jsx(T,{})]}),t.jsx(se,{}),t.jsx(M,{}),t.jsx(Q,{}),t.jsx(v,{})]})}q();F.createRoot(document.getElementById("root")).render(t.jsx(ne,{}));
