import{c as U,A as j,e as I,n as g,f as l,o as A,p as L,j as e,l as B,W as S,q as K,r as h,P as H,m as O}from"./all-B5MRgsKL.js";import{P as q,C as $,T as X,S as J,a as Q,H as V,G as Y,b as Z}from"./page-DHHrF6de.js";const a=U((t,n)=>({nowPath:"",parentPath:"",fileList:[],uploading:!1,linkWin:{show:!1,link:""},showBg:!1,loading:!1,dragWin:!1,fileWin:{status:!1,url:"",view:!1},theme:{mode:"",color:{doc:""},userSelect:""},upload:{win:!1,status:!1,percent:"0%"},selected:[],setGlobal:s=>{t(o=>({...o,...s}))},replaceGlobal:s=>{t(()=>({...s}))},getGlobal:()=>n()}));function M(){q(a.setState,"doc"),b("")}function b(t){j.post({api:"doc/list",body:{file:t},success:n=>{tt(!1),n.type=="dir"&&a.setState({fileList:n.filelist,nowPath:n.currentFolder,parentPath:n.parentFolder,selected:[]}),n.type=="file"&&a.setState({fileWin:{status:!0,url:n.url,view:n.view}})}})}function tt(t){a.setState({loading:t,showBg:t})}function G(t,n,s){if(t.size==0){g.err(l("error")+":"+t.name+l("is_empty"));return}const o=a.getState(),i=A(),r=o.nowPath,d=o.upload,u=a.setState,p=L()+"doc/",w=s==="file"?p+"upload_file":p+"upload_folder",c=nt(t.size),m=Math.ceil(t.size/c);let f=0;function v(){if(n.sendSize>=n.totalSize&&!n.completed){if(u({upload:{...d,status:!1}}),s==="file")n.completed=!0,g.normal(l("op_com")),b(r);else if(s==="dir"){const y=t.webkitRelativePath.split("/")[0];et(y)}return}if(f>=t.size)return;let P=0,C=0;const R=t.slice(f,f+c),_=Math.floor(f/c),k=new FormData;if(k.append("file",R),k.append("fileName",t.name),k.append("totalChunks",m),k.append("currentChunk",_),s==="dir"){const y=t.webkitRelativePath;k.append("relativePath",y)}s==="file"&&k.append("nowpath",r);const x=new XMLHttpRequest;x.open("POST",w,!0),x.setRequestHeader("authorization","Bearer "+i),x.upload.onprogress=function(y){y.lengthComputable&&(n.sendSize=n.sendSize+Math.min(y.loaded,t.size)-P,P=y.loaded,C=Math.floor(n.sendSize/n.totalSize*100)+"%",u({upload:{...d,percent:C}}))},x.onload=function(){if(x.status!=200){x.status==401?g.err(l("no_per")):g.err(l("error")+":"+x.status),u({upload:{...d,status:!1}}),n.completed=!0;return}else f+=c,v()},x.onerror=function(){console.error(`Chunk ${_+1} upload encountered error.`),u({upload:!1})},x.send(k)}v()}function et(t){const n=a.getState();j.post({api:"doc/move_folder",body:{name:t,path:n.nowPath},success:()=>{b(n.nowPath)}})}function nt(t){return t<=100*1048576?2*1048576:t<=1024*1048576?5*1048576:t<=10240*1048576?10*1048576:20*1048576}function N(t){a.setState({dragWin:!0}),t.stopPropagation(),t.preventDefault()}function E(t){a.setState({dragWin:!1}),t.stopPropagation(),t.preventDefault()}function W(t){const s=a.getState().upload,o=a.setState;o({dragWin:!1}),t.stopPropagation(),t.preventDefault();const i=t.dataTransfer.items,r=[];let d=0,u=0;function p(c,m=""){if(c.isFile)u++,c.file(f=>{m&&Object.defineProperty(f,"webkitRelativePath",{value:m+f.name}),r.push(f),d+=f.size,u--,w()});else if(c.isDirectory){const f=c.createReader();u++,f.readEntries(v=>{u--;for(const P of v)p(P,m+c.name+"/");w()})}}async function w(){if(u===0){if(r.length===0){g.err(l("empty"));return}o({upload:{...s,status:!0,win:!1}});const c={totalSize:d,sendSize:0,completed:!1},m=r[0].webkitRelativePath?"dir":"file";if(!await T(m))return;r.forEach(v=>{G(v,c,m)})}}for(let c=0;c<i.length;c++){const m=i[c].webkitGetAsEntry();m&&p(m)}}async function T(t){const n=a.getState().upload;return await I.post({api:"login/upload",body:{appType:"doc",fileType:t}})==null?(a.setState({upload:{...n,status:!1}}),!1):!0}function st({fileMes:t,editing:n,nameEdit:s,rename:o}){const[i,r]=s,[d,u]=n,p=a(c=>c.nowPath),w=c=>{c.key==="Enter"&&(o(t[0],i),u(!1))};return e.jsx(e.Fragment,{children:d?e.jsx("input",{value:i,className:"file-list-text file-list-input",onClick:c=>c.stopPropagation(),onChange:c=>r(c.target.value),onKeyDown:w}):e.jsx("span",{className:(t[1]==="dir"||t[1]==="dir_link"?"dir-text":"file-text")+" file-list-text",title:l("view")+t[0],onClick:c=>{c.stopPropagation(),b(p+"/"+t[0])},children:t[0]})})}function ot({name:t,editing:n,newName:s,rename:o}){const[i,r]=n;return e.jsx(e.Fragment,{children:i?e.jsx("button",{className:"save-name file-edit-btn btn",title:l("save"),onClick:d=>{d.stopPropagation(),r(!1),o(t,s)}}):e.jsx("button",{className:"edit-name file-edit-btn btn",title:l("rename"),onClick:d=>{d.stopPropagation(),r(!0)}})})}function it({fileMes:t}){const n=a.getState();return e.jsx("button",{className:"down-btn btn",title:l("download")+":"+t[0],onClick:s=>{s.stopPropagation(),t[1]==="file"||t[1]==="file_link"?F(n.nowPath+"/"+t[0],!0):F(n.nowPath+"/"+t[0],!1)}})}async function F(t,n){if(!await B.normal(l("are_you_sure")))return;a.getState();const o="doc/"+(n?"download_file":"download_folder");j.post({api:o,notice:!0,body:{path:t},success:i=>{at(L()+o+"/"+i)}})}function at(t){console.log(t);const n=document.createElement("a");n.href=t,n.download="",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function lt(){const t=a.setState,n=a(s=>s.linkWin);return e.jsx(e.Fragment,{children:e.jsx(S,{showBg:n.show,children:e.jsxs("div",{id:"link-win",children:[e.jsx("button",{id:"close-link-btn",onClick:()=>{t({linkWin:{link:"",show:!1}})},title:l("close"),className:"btn link-win-btn"}),e.jsx("span",{onClick:()=>{ct()},children:n.link}),e.jsx("button",{id:"copy-link-btn",title:l("copy"),className:"btn link-win-btn",onClick:()=>{rt()}})]})})})}function rt(){K(a.getState().linkWin.link)}function ct(){window.open(a.getState().linkWin.link,"_blank")}function dt({name:t}){return e.jsx("button",{className:"btn link-btn",title:l("get_link"),onClick:n=>{n.stopPropagation(),ut(t)}})}function ut(t){const s=a.getState().nowPath+"/"+t;j.post({api:"doc/link",notice:!0,body:{path:s},success:o=>{a.setState({linkWin:{link:encodeURI(window.location.origin+"/"+o),show:!0}})}})}function pt({fileMes:t,selected:n,docClick:s}){const[o,i]=h.useState(!1),[r,d]=h.useState(t[0]),p=a.getState().nowPath+"/"+t[0];return e.jsxs("div",{className:"doc-list main-item "+(n.includes(p)?"doc-list-selected ":"")+(t[1]==="dir"||t[1]==="dir_link"?"dir-item ":"file-item "),onClick:()=>s(p),children:[e.jsx(st,{fileMes:t,editing:[o,i],nameEdit:[r,d],rename:D}),e.jsx(ot,{name:t[0],editing:[o,i],newName:r,rename:D}),e.jsx(it,{fileMes:t}),t[1]==="dir"||t[1]==="dir_link"?null:e.jsx(dt,{name:t[0]})]},"doclist"+t[0])}function D(t,n){if(t==n)return;const s=a.getState(),o=s.nowPath+"/"+t,i=s.nowPath+"/"+n;j.patch({api:"doc/rename",body:{oldpath:o,newpath:i},notice:!0,success:()=>{b(s.nowPath)}})}function ft(){const t=i=>{let r=[...s];r.includes(i)?(r.splice(r.indexOf(i),1),g.normal(l("cancel"))):(r.push(i),g.normal(l("selected")+r.length+l("file"))),o({selected:r})},n=a(i=>i.fileList),s=a(i=>i.selected),o=a(i=>i.setGlobal);return e.jsx($,{children:n.map(i=>e.jsx(pt,{fileMes:i,selected:s,docClick:t},"doclist"+i[0]))})}function mt(){const t=a(n=>n.nowPath);return e.jsx("div",{id:"show-path",title:t,children:e.jsx("span",{children:t})})}function ht({setCreate:t}){const[n,s]=h.useState(""),o=r=>{const{value:d}=r.target;s(d)},i=r=>{r.key==="Enter"&&(t(!1),z(n))};return e.jsxs(e.Fragment,{children:[e.jsx("input",{placeholder:l("folder_name"),id:"new-dir-input",onChange:o,value:n,onKeyDown:i}),e.jsx("button",{id:"new-dir-save",className:"btn",title:l("save"),onClick:()=>{t(!1),z(n)}})]})}function z(t){if(t.includes("/")||t.includes("\\")){g.err(l("name_not_con")+" / \\");return}else if(t.length===0){g.err(l("folder_name")+l("is_empty"));return}const n=a.getState();j.post({api:"doc/new_folder",notice:!0,body:{folderName:t,nowpath:n.nowPath},success:()=>{b(n.nowPath)}})}function bt({createStatus:t}){const[n,s]=t,o=a(r=>r.upload),i=a(r=>r.nowPath);return e.jsxs("div",{id:"top-bar-box",children:[!n&&!o.status&&e.jsx("button",{id:"home-icon",className:"btn",title:l("back_main_dir"),onClick:()=>{i!=""&&b("")}}),!n&&!o.status&&e.jsx(mt,{}),o.status&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"progress",style:{width:o.percent}}),e.jsx("span",{id:"progress-text",children:o.percent})]}),n&&!o.status&&e.jsx(ht,{setCreate:s})]})}function wt(){const t=a(o=>o.nowPath),n=a(o=>o.parentPath),s=t==="/"||t==="";return e.jsx("button",{id:"go-up",className:(s?"go-up-disable":"")+" btn",disabled:s,title:s?"":l("back"),onClick:()=>{s||b(n)}})}function gt({createStatus:t}){const[n,s]=t;return e.jsx(e.Fragment,{children:n?e.jsx("button",{id:"new-dir-cancel",className:"btn new-dir-btn",title:l("cancel"),onClick:()=>s(!1)}):e.jsx("button",{id:"new-dir-btn",className:"btn new-dir-btn",title:l("create_folder"),onClick:()=>s(!0)})})}function xt(){const[t,n]=h.useState(!1);return e.jsxs(X,{children:[e.jsx(wt,{}),e.jsx(bt,{createStatus:[t,n]}),e.jsx(gt,{createStatus:[t,n]})]})}function jt({setPaste:t,setCopyList:n}){return e.jsx("button",{id:"copy",className:"btn side-btn",title:l("copy"),onClick:()=>{const s=a.getState().selected;n([...s]),t({status:!0,type:"copy"})}})}function kt(){return e.jsx("button",{id:"del",className:"btn side-btn",title:l("delete"),onClick:()=>yt()})}async function yt(){if(!await B.normal(l("are_you_sure")))return;const t=a.getState(),n=t.selected;j.delete({api:"doc/del",notice:!0,body:{dellist:n},success:()=>{b(t.nowPath)}})}function vt({setPaste:t,setCopyList:n}){return e.jsx("button",{id:"move",className:"btn side-btn",title:l("cut"),onClick:()=>{const s=a.getState().selected;n([...s]),t({status:!0,type:"move"})}})}function Pt({paste:t,copyList:n}){const[s,o]=t;return s.status?e.jsx("button",{id:"paste",title:l("paste"),className:"btn side-btn",onClick:()=>{o({status:!1}),St(s.type,n)}}):e.jsx(e.Fragment,{})}function St(t,n){const s=a.getState();if(n.length==0){g.err(l("no_select_file"));return}const o=s.nowPath;switch(t){case"copy":s.docUrl+"";break;case"move":s.docUrl+"";break}j.post({api:"doc/"+t,notice:!0,body:{copylist:n,nowpath:o},success:()=>{b(o)}})}function Ct(){return e.jsx("button",{id:"reload",className:"btn side-btn",title:l("refresh"),onClick:()=>{b(a.getState().nowPath)}})}function _t(){const t=a.setState,n=a(s=>s.upload);return e.jsx(e.Fragment,{children:e.jsx("button",{id:"upload",className:"btn side-btn",title:l("upload"),onClick:()=>{t({upload:{...n,win:!0}})}})})}function Nt(){const[t,n]=h.useState({type:"",status:!1}),[s,o]=h.useState([]);return e.jsxs(J,{children:[e.jsx(_t,{}),e.jsx(Ct,{}),e.jsx(kt,{}),e.jsx(jt,{setPaste:n,setCopyList:o}),e.jsx(vt,{setPaste:n,setCopyList:o}),e.jsx(Pt,{paste:[t,n],copyList:s})]})}function Et(){const t=a(s=>s.showBg),n=a(s=>s.loading);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),e.jsx(S,{showBg:t})]})}function Wt(){const t=a.setState,n=a(i=>i.upload),s=a(i=>i.dragWin);a(i=>i.nowPath);const o=async(i,r)=>{t({upload:{...n,status:!0,win:!1}});const d=Array.from(i.target.files);let u={totalSize:0,sendSize:0,completed:!1};await T(r)&&(d.forEach((w,c)=>{u.totalSize+=w.size}),d.forEach((w,c)=>{G(w,u,r)}),i.target.value=null)};return e.jsxs(e.Fragment,{children:[n.win?e.jsxs("div",{id:"upload-opt",children:[e.jsx("button",{id:"close-upload",className:"btn",title:l("close"),onClick:()=>{t({upload:{...n,win:!1}})}}),e.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:i=>o(i,"file")}),e.jsx("input",{type:"file",name:"folder",style:{display:"none"},webkitdirectory:"true",mozdirectory:"true",directory:"true",multiple:!0,onChange:i=>o(i,"dir"),id:"upDir"}),e.jsx("label",{id:"upload-file",className:"btn upload-opt-btn",title:l("upload_file"),htmlFor:"upFile"}),e.jsx("label",{id:"upload-dir",className:"btn upload-opt-btn",title:l("upload_folder"),htmlFor:"upDir"})]}):null,e.jsx(S,{showBg:n.win}),n.status?e.jsx("div",{id:"uploading-back"}):null,e.jsx("div",{id:"drag-win",style:s?{display:"flex"}:{display:"none"},children:e.jsx("div",{})})]})}function Ft(){const[t,n]=h.useState(!1),s=a(i=>i.fileWin),o=h.useRef(null);return h.useEffect(()=>{function i(r){r.key==="Escape"&&t&&n(!1)}return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[t]),h.useEffect(()=>{if(!s.url)return;function i(){const d=o.current;if(!d)return;const u=d.contentDocument||d.contentWindow.document;if(!u)return;const p=u.createElement("style");p.textContent=`
            body {
                display:flex;
                justify-content: center;
                align-items: center;
                width: 100%;
                height: 100%;
            }
            body img {
                margin: 0;
                max-height: 100%;
                max-width: 100%;
            }
        `,u.head.appendChild(p)}const r=o.current;r&&(r.onload=i)},[s.url]),s.status?e.jsxs("div",{id:"file-win",children:[t?null:e.jsx("button",{className:"btn close-file-win",title:l("close"),onClick:()=>{a.setState({fileWin:{status:!1,url:"",view:!1}})}}),s.view?e.jsxs("div",{className:"file-view-box",children:[e.jsx("iframe",{ref:o,src:s.url,className:"file-view "+(t?"full-screen":"")}),t?e.jsx("button",{className:"btn ext-full-screen-btn",title:l("zoom_out"),onClick:()=>{n(!1)}}):e.jsxs("div",{className:"file-win-btn-bar",children:[e.jsx("button",{className:"btn file-win-btn refresh-btn",title:l("refresh"),onClick:()=>{o.current&&(o.current.src=o.current.src)}}),e.jsx("button",{className:"btn file-win-btn full-screen-btn",title:l("zoom_in"),onClick:()=>{n(!0)}})]})]}):e.jsx("span",{children:l("not_support_type")})]}):null}function Dt(){return e.jsxs(e.Fragment,{children:[e.jsx(Et,{}),e.jsx(Wt,{}),e.jsx(Ft,{}),e.jsx(lt,{})]})}function zt(){const t=a(n=>n.theme);return h.useEffect(()=>(window.addEventListener("dragover",N),window.addEventListener("dragleave",E),window.addEventListener("drop",W),()=>{window.removeEventListener("dragover",N),window.removeEventListener("dragleave",E),window.removeEventListener("drop",W)}),[]),e.jsxs("div",{id:"app",color:t.color.doc,mode:t.mode,children:[e.jsxs(Q,{children:[e.jsx(V,{}),e.jsx(xt,{}),e.jsx(Y,{}),e.jsx(Z,{})]}),e.jsx(Dt,{}),e.jsx(Nt,{}),e.jsx(ft,{}),e.jsx(H,{}),e.jsx("div",{className:"wallpaper"})]})}M();O.createRoot(document.getElementById("root")).render(e.jsx(zt,{}));
