import{c as F,i as N,A as x,S as U,j as i,F as C,k as p,h as c,q as A,v as X,w as J,r as f,n as L,o as k,W as G,f as Q,u as Y,P as Z,t as M}from"./all-0L4ytAmL.js";import{P as ee,C as te,T as ne,S as se,a as ie,H as le,G as oe,b as ae}from"./page-B6_6T00P.js";import{b as R,d as ce}from"./path-Sr8gxytF.js";import{a as y}from"./page-C3qsDjGe.js";import{F as I}from"./floatWin-CZJDpZqi.js";const j=F(e=>({fileCache:{fileList:[],name:[],nowPath:[],current:-1},set:t=>{e({fileCache:t})}})),S=e=>j.getState().set(e),b=()=>j.getState().fileCache,w=()=>K("nowPath"),re=()=>K("fileList"),ue=()=>j.getState().fileCache.current;function K(e){const t=b().current;return b()[e][t]}function de(e){const t=structuredClone(b());if(t.current!=-1&&t.nowPath[t.current]==e.nowPath){const n=t.fileList,s=t.nowPath,o=t.name;n[t.current]=e.fileList,s[t.current]=e.nowPath,o[t.current]=e.name,S({fileList:n,nowPath:s,name:o,current:t.current});return}S({fileList:t.current==-1?[e.fileList]:t.fileList.concat([e.fileList]),nowPath:t.current==-1?[e.nowPath]:t.nowPath.concat(e.nowPath),name:t.current==-1?[e.name]:t.name.concat(e.name),current:t.current+1})}function B(e){const t=structuredClone(b()),n=t.fileList,s=t.nowPath,o=t.name;n.length=e+1,s.length=e+1,o.length=e+1,S({fileList:n,nowPath:s,name:o,current:e})}const r=F((e,t)=>({uploading:!1,linkWin:{show:!1,link:""},edit:{status:!1,fileName:""},fileBuffer:{source:-1,dest:-1,selected:{selected:[],status:!1},newFileList:[]},showBg:!1,loading:!1,dragWin:!1,fileWin:{status:!1,url:"",view:!1,data:null,currentType:"",path:""},uploadWin:!1,selected:{selected:[],status:!1},setGlobal:n=>{e(s=>({...s,...n}))},replaceGlobal:n=>{e(()=>({...n}))},getGlobal:()=>t()}));function fe(){ee("doc");const t=N().doc.list.path;v(t)}const h={add:e=>{r.setState(t=>{const n=t.fileBuffer,o=n.selected.selected;let l;return o.includes(e)?l=o.filter(a=>a!==e):l=[...o,e],{fileBuffer:{...n,selected:{selected:l,status:l.length>0}}}})},include:e=>r.getState().fileBuffer.selected.selected.includes(e),open:()=>{r.setState(e=>({fileBuffer:{...e.fileBuffer,selected:{...e.fileBuffer.selected,status:!0}}}))},hide:()=>{r.setState(e=>({fileBuffer:{...e.fileBuffer,selected:{...e.fileBuffer.selected,status:!1}}}))},clean:()=>{r.setState(e=>({fileBuffer:{...e.fileBuffer,selected:{selected:[],status:!1},source:-1,dest:-1,newFileList:[]}}))},getSelected:()=>r.getState().fileBuffer.selected.selected,getSource:()=>r.getState().fileBuffer.source,getDest:()=>r.getState().fileBuffer.dest,getNewFileList:()=>r.getState().fileBuffer.newFileList,getSelectedFileList:()=>{const e=re(),t=h.getSelected(),n=[];for(const s of t)n.push(e[s][0]);return n},setSource:e=>{r.setState(t=>({fileBuffer:{...t.fileBuffer,source:e}}))},setDest:e=>{r.setState(t=>({fileBuffer:{...t.fileBuffer,dest:e}}))},setNewFileList:e=>{r.setState(t=>({fileBuffer:{...t.fileBuffer,newFileList:e}}))},setSelected:e=>{r.setState(t=>({fileBuffer:{...t.fileBuffer,selected:e}}))}};function v(e){const t=N(),n=t.doc.list.path;x.post({api:"doc/list",body:{file:e},success:s=>{me(!1),s.type=="dir"&&(de({nowPath:s.currentFolder,fileList:s.filelist,name:R(s.currentFolder)}),n!=""&&(t.doc.list.path="",U(t))),s.type=="file"&&$(s,e)}})}function $(e,t){he(t,e.innerApp[0],e.url);const n=e.innerApp.length!=0;r.setState({fileWin:{status:!0,url:pe(e.innerApp[0],e.url),view:n,innerApp:e.innerApp,currentType:n?e.innerApp[0]:"",data:e,path:t}})}function pe(e,t){let n;switch(e){case"doc":n=y(t);break;case"img":n=y("pic");break;case"vid":n=y("pic");break;case"not":n=y("not");break;default:n="";break}return n}function he(e,t,n){const s=N(),o=s.doc.list.path;let l={source:"doc",enable:!0,name:R(e),path:e};t=="img"||t=="vid"?(t=="img"&&(l.media="img"),t=="vid"&&(l.media="vid"),l.url=y(ce(n)+"/"),s.pic.inner=l):t=="not"?(l.path=e,s.not.inner=l):(l.source="",l.enable=!1,l.name=""),U(s),o!=""&&v("")}function me(e){r.setState({loading:e,showBg:e})}function we({name:e,type:t,Fun:n,TextFun:s,mask:o,NameText:l,fileBtn:a}){return i.jsxs("div",{className:"file-item-box",children:[o,i.jsxs("div",{className:"file-item-frame",title:e,children:[a,i.jsx("div",{className:"file-item",onClick:()=>{n(e)},children:C(t)}),i.jsxs("div",{className:"file-name-box",children:[l,i.jsx("span",{className:"file-name",onClick:()=>{s(e)},children:e})]})]})]})}function ge({fileMes:e}){return i.jsx("button",{className:"down-btn file-item-btn btn",title:c("download")+":"+e[0],onClick:t=>{be(t,e)},children:p("download")})}function be(e,t){e.stopPropagation(),t[1]==="dir"||t[1]==="dir_link"?E(w()+"/"+t[0],!1):E(w()+"/"+t[0],!0)}async function E(e,t){if(!await A.normal(c("are_you_sure")))return;r.getState();const s="doc/"+(t?"download_file":"download_folder");x.post({api:s,notice:!0,body:{path:e},success:o=>{Se(X()+s+"/"+o)}})}function Se(e){const t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function xe(){const e=r.setState,t=r(n=>n.linkWin);return i.jsx(i.Fragment,{children:i.jsx(I,{show:t.show,setShow:()=>{e({linkWin:{link:"",show:!1}})},children:i.jsxs("div",{id:"link-win",children:[i.jsx("span",{onClick:()=>{je()},children:t.link}),i.jsx("button",{id:"copy-link-btn",title:c("copy"),className:"btn link-win-btn",onClick:()=>{ke()},children:p("copy")})]})})})}function ke(){J(r.getState().linkWin.link)}function je(){window.open(r.getState().linkWin.link,"_blank")}function Le({name:e}){return i.jsx("button",{className:"btn file-item-btn link-btn",title:c("get_link"),onClick:t=>{ye(t,e)},children:p("link")})}function ye(e,t){e.stopPropagation(),ve(t)}function ve(e){const t=w()+"/"+e;x.post({api:"doc/link",notice:!0,body:{path:t},success:n=>{r.setState({linkWin:{link:encodeURI(window.location.origin+"/"+n),show:!0}})}})}function Ce({index:e,fileMes:t,selected:n,docClick:s}){const o=n.selected.includes(e),l=r(a=>a.edit);return i.jsx(we,{name:t[0],type:t[1],Fun:Pe,TextFun:P,mask:n.status?i.jsx(Fe,{include:o,index:e,selected:n}):null,fileBtn:i.jsx(Ne,{fileMes:t}),NameText:l.name==t[0]&&l.status?i.jsx(Be,{name:t[0],index:e}):null})}function Fe({index:e,selected:t,include:n}){return i.jsx("div",{className:"file-item-mask "+(t.status&&n?"file-item-mask-selected":""),onClick:()=>{h.add(e)}})}function Ne({fileMes:e}){return i.jsxs(i.Fragment,{children:[e[1]!="dir"&&e[1]!="dir_link"&&i.jsx(Le,{name:e[0]}),i.jsx(ge,{fileMes:e})]})}function Be({name:e,index:t}){const[n,s]=f.useState(e),o=()=>{h.add(t),De(e,n)};return f.useEffect(()=>{const l=a=>{(a.ctrlKey||a.metaKey)&&a.key.toLowerCase()==="s"&&(a.preventDefault(),o())};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[n,e]),i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"bg-enable",onClick:()=>{P()}}),i.jsxs("div",{className:"file-item-input-box",children:[i.jsx("input",{className:"file-name-input",value:n,onChange:l=>s(l.target.value),onKeyDown:l=>{l.key==="Enter"&&o()}}),i.jsx("button",{className:"btn save-file-name",onClick:o,title:c("save"),children:p("save")})]})]})}function Pe(e){v(w()+"/"+e)}function P(e=""){r.getState().edit.status?r.setState({edit:{status:!1,name:e}}):r.setState({edit:{status:!0,name:e}})}function De(e,t){const n=w();if(P(),e==t)return;const s=n+"/"+e,o=n+"/"+t;x.patch({api:"doc/rename",body:{oldpath:s,newpath:o},notice:!0,success:l=>{const a=structuredClone(b()),u=a.fileList,m=a.fileList[a.current];m[h.getSelected()[0]]=l.fileItem,u[a.current]=m,S({...a,fileList:u}),h.clean()}})}function Ee(){const e=l=>{let a=[...s];a.includes(l)?(a.splice(a.indexOf(l),1),L.normal(c("cancel"))):(a.push(l),L.normal(c("selected")+a.length+c("file"))),o({selected:a})},t=j(l=>l.fileCache),n=t.fileList?.[t.current]??[],s=r(l=>l.fileBuffer).selected,o=r(l=>l.setGlobal);return i.jsx(te,{children:n.map((l,a)=>i.jsx(Ce,{fileMes:l,selected:s,docClick:e,index:a},a+l[0]))})}function We({setCreate:e}){const[t,n]=f.useState(""),s=l=>{const{value:a}=l.target;n(a)},o=l=>{l.key==="Enter"&&(e(!1),W(t))};return i.jsxs(i.Fragment,{children:[i.jsx("input",{placeholder:c("folder_name"),id:"new-dir-input",onChange:s,value:t,onKeyDown:o}),i.jsx("button",{id:"new-dir-save",className:"btn",title:c("save"),onClick:()=>{e(!1),W(t)},children:p("save")})]})}function W(e){if(e.includes("/")||e.includes("\\")){L.err(c("name_not_con")+" / \\");return}else if(e.length===0){L.err(c("folder_name")+c("is_empty"));return}r.getState(),x.post({api:"doc/new_folder",notice:!0,body:{folderName:e,nowpath:w()},success:t=>{const n=structuredClone(b()),s=n.fileList,o=[t.fileItem].concat(n.fileList[n.current]);s[n.current]=o,S({...n,fileList:s})}})}function _e(){const e=j(t=>t.fileCache).name??[];return i.jsx("div",{id:"show-path",children:i.jsx("span",{children:e.map((t,n)=>i.jsx("span",{className:"file-item-show-path",onClick:()=>{B(n)},children:(t?"/":"")+t},n+t))})})}const d=F((e,t)=>({upload:{apiList:{file:"",dir:""},drag:!1,token:"",files:null,fun:{success:()=>{},fail:()=>{},end:()=>{}}},init:()=>{const{upload:n}=t();e({upload:{...n,totalSize:0,totalFile:0,sendSize:0,percent:0,fileList:[],status:!0,apiUrl:"",status:!1}})},addFileList:n=>{if(!n[0]&&!n[1])return;const{upload:s}=t(),o=[...s.fileList,n];e({upload:{...s,fileList:o}})},setUrl:()=>{const{upload:n}=t(),s=Re(n.files);e({upload:{...n,apiUrl:n.apiList[s]}})},setUploadMsg:(n={})=>{const{upload:s}=t();e({upload:{...s,fun:{success:n.success??(()=>{}),fail:n.fail??(()=>{}),end:n.end??(()=>{})},apiList:{file:n.apiList[0]??s.apiList?.file,dir:n.apiList[1]??s.apiList?.dir}}})},setFiles:n=>{const{upload:s}=t();e({upload:{...s,files:n}})},setToken:n=>{const{upload:s}=t();e({upload:{...s,token:n}})},getUploadFileList:()=>{const{upload:n}=t();return n.fileList},setStatus:n=>{const{upload:s}=t();e({upload:{...s,status:n}})},setDrag:n=>{const{upload:s}=t();e({upload:{...s,drag:n}})},setTotal:n=>{let s=0;for(const a of n)s+=a.size;const{upload:o}=t(),l=o.sendSize===0?0:Math.floor(o.sendSize/s*100);e({upload:{...o,totalSize:s,totalFile:n.length,percent:l}})},setSendSize:n=>{const{upload:s}=t(),o=s.sendSize+n;let l=s.totalSize===0?0:Math.floor(o/s.totalSize*100);l>100&&(l=100),e({upload:{...s,sendSize:o,percent:l}})}}));function O(){d.getState().setStatus(!1)}function ze(){d.getState().setStatus(!0)}const Te=()=>d.getState().getUploadFileList(),Ue=()=>d.getState().upload.sendSize,Ae=()=>d.getState().upload.totalSize,Ge=()=>d.getState().upload.fun;function Re(e){if(!e||e.length===0)return null;for(const t of e)if(t.webkitRelativePath&&t.webkitRelativePath.includes("/"))return"dir";return"file"}function Ie({createStatus:e}){const[t,n]=e,s=d(a=>a.upload),o=j(a=>a.fileCache).current,l=()=>{o!=0&&B(0)};return f.useEffect(()=>{k({home:{disable:o==0,name:c("back_main_dir"),fun:l}})},[o]),i.jsxs("div",{id:"top-bar-box",children:[!t&&!s.status&&i.jsx("button",{id:"home-icon",className:"btn",title:c("back_main_dir"),onClick:l,children:p("home")}),!t&&!s.status&&i.jsx(_e,{}),s.status&&i.jsxs(i.Fragment,{children:[i.jsx("div",{id:"progress",style:{width:s.percent+"%"}}),i.jsx("span",{id:"progress-text",children:s.percent+"%"})]}),t&&!s.status&&i.jsx(We,{setCreate:n})]})}function Ke({createStatus:e}){const[t,n]=e;return i.jsx(i.Fragment,{children:t?i.jsx("button",{className:"btn new-dir-btn",title:c("cancel"),onClick:()=>n(!1),children:p("no")}):i.jsx("button",{id:"new-dir-btn",className:"btn new-dir-btn",title:c("create_folder"),onClick:()=>n(!0),children:p("addFolder")})})}function $e(){const e=j(n=>n.fileCache).current,t=()=>{B(e-1)};return f.useEffect(()=>{k({goUp:{disable:e==0,name:c("back"),fun:t}})},[e]),i.jsx("button",{id:"go-up",className:(e==0?"go-up-disable":"")+" btn",disabled:e==0,title:c("back"),onClick:t,children:p("goUp")})}function Oe(){const[e,t]=f.useState(!1);return i.jsxs(ne,{children:[i.jsx($e,{}),i.jsx(Ie,{createStatus:[e,t]}),i.jsx(Ke,{createStatus:[e,t]})]})}function He({setPaste:e,setCopyList:t,setSource:n}){const s=o=>{h.hide(),t(h.getSelectedFileList()),e({status:!0,type:o}),h.setSource(ue()),n(w()),L.normal(c("copied"))};return f.useEffect(()=>{k({copy:{name:`${c("copy")} (C)`,fun:()=>s("copy")},cut:{name:c("cut")+"(X)",fun:()=>s("move")}})},[]),f.useEffect(()=>{const o=l=>{const a=l.ctrlKey||l.metaKey;a&&l.key.toLowerCase()==="c"?(l.preventDefault(),s("copy")):a&&l.key.toLowerCase()==="x"&&(l.preventDefault(),s("move"))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[]),i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"btn side-btn",title:`${c("copy")} (Ctrl/Cmd + C)`,onClick:()=>{s("copy")},children:p("copy")}),i.jsx("button",{className:"btn side-btn",title:c("cut"),onClick:()=>{s("move")},children:p("cut")})]})}function Ve(){const e=async()=>{if(!await A.normal(c("are_you_sure")))return;const t=h.getSelectedFileList(),n=w();x.delete({api:"doc/del",notice:!0,body:{dellist:t,nowPath:n},success:()=>{const s=structuredClone(b()),o=s.fileList,l=s.fileList[s.current],a=new Set(h.getSelected()),u=l.filter((m,g)=>!a.has(g));o[s.current]=u,S({...s,fileList:o}),h.clean()}})};return f.useEffect(()=>{k({del:{name:`${c("delete")}(Delete)`,fun:e}})},[]),f.useEffect(()=>{const t=n=>{const s=navigator.platform.toUpperCase().indexOf("MAC")>=0,o=n.metaKey;s&&o&&n.key==="Delete"&&(n.preventDefault(),e()),!s&&n.key==="Delete"&&(n.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),i.jsx("button",{className:"btn side-btn",title:`${c("delete")} (Delete / Cmd + Delete)`,onClick:e,children:p("bin")})}function qe({paste:e,copyList:t,source:n}){const[s,o]=e,l=()=>{s.status&&(o({status:!1}),Xe(s.type,t,n))};return f.useEffect(()=>{k({paste:{name:`${c("paste")} (V)`,fun:l,disable:!s.status}})},[s.status]),f.useEffect(()=>{const a=u=>{if(!s.status)return;(u.ctrlKey||u.metaKey)&&u.key.toLowerCase()==="v"&&(u.preventDefault(),l())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[s.status,t]),s.status?i.jsx("button",{id:"paste",title:`${c("paste")} (Ctrl/Cmd + V)`,className:"btn side-btn",onClick:l,children:p("paste")}):null}function Xe(e,t,n){if(t.length===0){L.err(c("no_select_file"));return}const s=w();x.post({api:"doc/"+e,notice:!0,body:{copylist:t,nowpath:s,source:n},success:o=>{const l=h.getSource(),a=structuredClone(b()),u=o.fileList.concat(a.fileList[a.current]);if(a.fileList[a.current]=u,a.current>=l&&e=="move"){const m=new Set(h.getSelected()),g=a.fileList[l].filter((D,q)=>!m.has(q));a.fileList[l]=g}S(a),h.clean()}})}function Je(){const e=()=>{v(w())};return f.useEffect(()=>{k({refresh:{name:c("refresh"),fun:e}})},[]),i.jsx("button",{className:"btn side-btn",title:c("refresh"),onClick:e,children:p("load")})}function Qe(){const e=r.setState;return i.jsx(i.Fragment,{children:i.jsx("button",{className:"btn side-btn",title:c("upload"),onClick:()=>{e({uploadWin:!0})},children:p("upload")})})}function Ye(){const e=r(n=>n.fileBuffer.selected.status),t=()=>{e?h.clean():h.open()};return f.useEffect(()=>{k({select:{name:`${c("select")}`,fun:t}})}),i.jsx("button",{className:"btn side-btn",onClick:t,children:p("select")})}function Ze(){const[e,t]=f.useState({type:"",status:!1}),[n,s]=f.useState([]),[o,l]=f.useState("");return i.jsxs(se,{children:[i.jsx(Ye,{}),i.jsx(Qe,{}),i.jsx(Je,{}),i.jsx(Ve,{}),i.jsx(He,{setPaste:t,setSource:l,setCopyList:s}),i.jsx(qe,{paste:[e,t],source:o,copyList:n})]})}function Me(){const e=r(n=>n.showBg),t=r(n=>n.loading);return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"loading",id:"list-loading",style:t?{display:"block"}:{display:"none"}}),i.jsx(G,{showBg:e})]})}async function H(e){d.getState().init(),ze(),d.getState().setFiles(e),d.getState().setUrl(),d.getState().setTotal(e);const t=await lt();if(!t){O();return}d.getState().setToken(t);for(const n of e)et(n)}function et(e){const t=nt(e),n=t.length;t.forEach((s,o)=>{tt(s,e,n,o)})}function tt(e,t,n,s){const o=new FormData;o.append("filename",t.name),o.append("nowPath",w()),o.append("totalFile",d.getState().upload.totalFile),o.append("uploadToken",d.getState().upload.token),o.append("relativePath",t.webkitRelativePath),o.append("totalChunk",n),o.append("index",s),o.append("chunk",e);for(const[l,a]of o.entries());x.upload({api:d.getState().upload.apiUrl,body:o,loading:!1,setProgress:l=>{d.getState().setSendSize(l*e.size)},notice:!0,contentType:"multipart/form-data",success:l=>{d.getState().setSendSize(e.size),d.getState().addFileList(l.fileItem),it()&&(Ge().success(l),O())}})}function nt(e){const t=[];let n=0;const s=st(e);for(;n<e.size;){const o=Math.min(n+s,e.size),l=e.slice(n,o);t.push(l),n=o}return t}function st(e){return Math.min(10*1048576,Math.max(2*1048576,e.size/(100*1048576)))}function it(){return Ue()>=Ae()}async function lt(){return await Q.post({api:"login/upload",body:{action:d.getState().upload.apiUrl}})}function _(e){d.getState().setDrag(!0),e.preventDefault()}function z(e){d.getState().setDrag(!1),e.preventDefault()}async function T(e){d.getState().setDrag(!1),e.preventDefault(),e.stopPropagation();const t=e.dataTransfer.items,n=await ot(t);n.length!==0&&H(n)}function ot(e){return new Promise(t=>{const n=[];let s=e.length;s||t([]);for(let o=0;o<e.length;o++){const l=e[o].webkitGetAsEntry();l?V(l,"",n,()=>{s--,s||t(n)}):(s--,s||t(n))}})}function V(e,t="",n,s){e.isFile?e.file(o=>{Object.defineProperty(o,"webkitRelativePath",{value:t+o.name}),n.push(o),s()}):e.isDirectory&&e.createReader().readEntries(l=>{let a=l.length;if(!a){s();return}l.forEach(u=>{V(u,t+e.name+"/",n,()=>{a--,a||s()})})})}function at(){const e=f.useRef(null),t=f.useRef(null),n=r.setState,s=d(u=>u.upload),o=r(u=>u.uploadWin),l=d(u=>u.upload.drag),a=u=>{r.setState({uploadWin:!1}),H(u.target.files)};return f.useEffect(()=>(d.getState().setUploadMsg({apiList:["doc/upfile","doc/updir"],success:()=>{const u=Te(),m=structuredClone(b()),g=m.fileList,D=u.concat(g[m.current]);g[m.current]=D,S({...m,fileList:g}),e.current&&(e.current.value=null),t.current&&(t.current.value=null)}}),window.addEventListener("dragover",_),window.addEventListener("dragleave",z),window.addEventListener("drop",T),()=>{window.removeEventListener("dragover",_),window.removeEventListener("dragleave",z),window.removeEventListener("drop",T)}),[]),i.jsxs(i.Fragment,{children:[o?i.jsxs("div",{id:"upload-opt",children:[i.jsx("button",{id:"close-upload",className:"btn",title:c("close"),onClick:()=>{n({uploadWin:!1})},children:p("no")}),i.jsx("input",{ref:e,id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:u=>a(u)}),i.jsx("input",{ref:t,type:"file",name:"folder",style:{display:"none"},webkitdirectory:"true",mozdirectory:"true",directory:"true",multiple:!0,onChange:u=>a(u),id:"upDir"}),i.jsx("label",{id:"upload-file",className:"btn upload-opt-btn",title:c("upload_file"),htmlFor:"upFile",children:C("file")}),i.jsx("label",{id:"upload-dir",className:"btn upload-opt-btn",title:c("upload_folder"),htmlFor:"upDir",children:C("doc")})]}):null,i.jsx(G,{showBg:o}),s.status?i.jsx("div",{id:"uploading-back"}):null,i.jsx("div",{id:"drag-win",style:l?{display:"flex"}:{display:"none"},children:i.jsx("div",{children:p("upload")})})]})}function ct(){const[e,t]=f.useState(!1),n=r(l=>l.fileWin),s=f.useRef(null);f.useEffect(()=>{function l(a){a.key==="Escape"&&e&&t(!1)}return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[e]),f.useEffect(()=>{if(!n.url)return;function l(){const u=s.current;if(!u)return;const m=u.contentDocument||u.contentWindow.document;if(!m)return;const g=m.createElement("style");g.textContent=`
                body {
                    display:flex;
                    justify-content: center;
                    align-items: center;
                    width: 100%;
                    height: 100%;
                }
                body img {
                    margin: 0;
                    max-height: 100%;
                    max-width: 100%;
                }
            `,m.head.appendChild(g)}const a=s.current;a&&(a.onload=l)},[n.url]);const o=()=>{[n.data.innerApp[0],n.data.innerApp[1]]=[n.data.innerApp[1],n.data.innerApp[0]],r.setState({fileWin:{...n}}),$(n.data,n.path)};return n.status?i.jsx(I,{show:n.status,setShow:l=>{l||r.setState({fileWin:{status:!1,url:"",view:!1}})},children:n.view?i.jsxs("div",{className:"file-view-box",children:[i.jsx("iframe",{ref:s,src:n.url,className:"file-view "+(e?"full-screen":"")},n.url),e?i.jsx("button",{className:"btn ext-full-screen-btn",title:c("zoom_out"),onClick:()=>{t(!1)},children:p("minimize")}):i.jsxs("div",{className:"file-win-btn-bar",children:[n.data.innerApp.length>1?i.jsx(i.Fragment,{children:n.currentType=="not"?i.jsx("button",{className:"btn file-win-btn",title:c("view"),onClick:o,children:p("eye")}):i.jsx("button",{className:"btn file-win-btn",title:c("edit"),onClick:o,children:p("edit")})}):null,i.jsx("button",{className:"btn file-win-btn",title:c("refresh"),disabled:n.currentType!="doc",onClick:()=>{s.current&&(s.current.src=s.current.src)},children:p("load")}),i.jsx("button",{className:"btn file-win-btn",title:c("zoom_in"),onClick:()=>{t(!0)},children:p("maximize")})]})]}):i.jsx("div",{className:"file-view-box",children:i.jsx("span",{children:c("not_support_type")})})}):null}function rt(){return i.jsxs(i.Fragment,{children:[i.jsx(Me,{}),i.jsx(at,{}),i.jsx(ct,{}),i.jsx(xe,{})]})}function ut(){const e=Y(t=>t.theme);return i.jsxs("div",{id:"app",color:e.color.doc,mode:e.mode,children:[i.jsxs(ie,{children:[i.jsx(le,{}),i.jsx(Oe,{}),i.jsx(oe,{}),i.jsx(ae,{})]}),i.jsx(rt,{}),i.jsx(Ze,{}),i.jsx(Ee,{}),i.jsx(Z,{}),i.jsx("div",{className:"wallpaper"})]})}fe();M.createRoot(document.getElementById("root")).render(i.jsx(ut,{}));
