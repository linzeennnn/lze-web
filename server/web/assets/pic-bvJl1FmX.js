import{c as T,n as v,r as x,j as t,W as M,T as I,b as U}from"./all-hmuOc3IC.js";import{P as R,C as $,T as H,S as A,a as O,H as V,G as X,b as q}from"./page-D53qMD83.js";const i=T((e,n)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),nowPath:"",parentPath:"",imgList:[],vidList:[],dirList:[],uploading:!1,showBg:!1,langList:[],pageNum:1,theme:{mode:"",color:{pic:""},userSelect:""},loading:!1,dragWin:!1,imgPage:!0,mediaWin:{status:!1,img:!0,path:window.location.origin+"/file/Pictures/",index:0},upload:{status:!1,percent:"0%"},picUrl:`${window.location.origin}/server/pic/`,setGlobal:a=>{e(o=>({...o,...a}))},replaceGlobal:a=>{e(()=>({...a}))},getGlobal:()=>n()}));function m(e){return i.getState().langList[e]}function Y(){R(i.setState,"pic"),k("")}function k(e,n){const a={folder:e},o=i.getState().picUrl+"list";E(!0),fetch(o,{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{let l=[],u=[],g=[],d=[],r=[];s.filelist.forEach(p=>{p[1]=="dir"||p[1]=="dir_link"?l.push(p[0]):(p[1]=="file"||p[1]=="file_link")&&(p[2]=="img"&&(d.length<12||(u.push(d),d=[]),d.push(p[0])),p[2]=="vid"&&(r.length<12||(g.push(r),r=[]),r.push(p[0])))}),d.length>0&&u.push(d),r.length>0&&g.push(r),i.setState({dirList:l,imgList:u,vidList:g,nowPath:s.currentFolder,parentPath:s.parentFolder,selected:[],imgPage:!n}),E(!1)})}function E(e){i.setState({loading:e,showBg:e})}function F(e,n){if(e.size==0){v(e.name+m("is_empty"));return}let a;const o=i.getState(),s=o.userName,l=o.token,u=o.nowPath,g=o.upload,d=i.setState,r=["jpg","jpeg","png","gif","webp","bmp","svg","ico","apng","avif"],p=["mp4","webm","ogg","ogv","mov","m4v","avi","3gp","mkv"],h=e.name.split(".").pop().toLowerCase();if(r.includes(h))a=!1,d({imgPage:!0});else if(p.includes(h))a=!0,d({imgPage:!1});else{v(e.name+":"+m("not_support_type")),d({upload:{...g,status:!1}});return}const P=o.picUrl+"upload",S=J(e.size),L=Math.ceil(e.size/S);let y=0;function c(){if(n.sendSize>=n.totalSize){d({upload:{...g,status:!1}}),v(m("op_com")),k(u,a);return}if(y>=e.size)return;let f="",j=0;const C=e.slice(y,y+S),N=Math.floor(y/S),w=new FormData;w.append("file",C),w.append("fileName",e.name),w.append("totalChunks",L),w.append("currentChunk",N),w.append("nowpath",u);const b=new XMLHttpRequest;b.open("POST",P,!0),b.setRequestHeader("authorization","Bearer "+l),b.setRequestHeader("x-user",s),b.upload.onprogress=function(z){z.lengthComputable&&(n.sendSize=n.sendSize+z.loaded-j,j=z.loaded,f=Math.floor(n.sendSize/n.totalSize*100)+"%",d({upload:{...g,percent:f}}))},b.onload=function(){if(b.status!==200){b.status===401?v(m("no_per")):v(m("error")+":"+b.status+b.responseText),d({upload:{...g,status:!1}});return}y+=S,c()},b.onerror=function(){console.error(`Chunk ${N+1} upload encountered error.`),d({upload:!1})},b.send(w)}c()}function J(e){return e<=1024*1048576?10*1048576:e<=5120*1048576&&e>1024*1048576?50*1048576:100*1048576}function _(e){i.setState({dragWin:!0}),e.stopPropagation(),e.preventDefault()}function B(e){i.setState({dragWin:!1}),e.stopPropagation(),e.preventDefault()}function W(e){const a=i.getState().upload,o=i.setState;o({dragWin:!1}),e.stopPropagation(),e.preventDefault();const s=e.dataTransfer.items,l=[];let u=0,g=0;function d(p){const h=p.webkitGetAsEntry();if(h){if(h.isDirectory){v(m("not_support_type"));return}h.isFile&&(g++,h.file(P=>{l.push(P),u+=P.size,g--,r()}))}}function r(){if(g===0){if(l.length===0){v(m("empty"));return}o({upload:{...a,status:!0,win:!1}});const p={totalSize:u,sendSize:0};l.forEach(h=>{F(h,p)})}}for(let p=0;p<s.length;p++)d(s[p])}function D({url:e,name:n,type:a,index:o}){const[s,l]=x.useState(!0),[u,g]=x.useState(!1);x.useEffect(()=>{l(!0),g(!1)},[e]),x.useEffect(()=>{let r;return u&&(r=setTimeout(()=>{l(!1)},100)),()=>clearTimeout(r)},[u]);const d=()=>{g(!0)};return t.jsxs("div",{className:"pic-item main-item",title:n,onClick:()=>{K(e,a,o)},children:[s&&t.jsx("div",{className:"media-loading loading"}),a==="img"?t.jsx("img",{src:e+n,loading:"lazy",onLoad:d}):t.jsx("video",{src:e+n,onLoadedData:d})]},e)}function K(e,n,a){const o=i.setState;o({mediaWin:{url:e,img:n=="img",status:!0,index:a}})}function Q(){const e=i(s=>s.imgList),n=i(s=>s.pageNum),a=i(s=>s.nowPath),o=`${window.location.origin}/file/Pictures/`+a+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((s,l)=>t.jsx(D,{url:o,name:s,type:"img",index:l},o+s)):null})}function Z(){const e=i(s=>s.vidList),n=i(s=>s.pageNum),a=i(s=>s.nowPath),o=`${window.location.origin}/file/Pictures/`+a+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((s,l)=>t.jsx(D,{url:o,name:s,type:"vid",index:l},o+s)):null})}function tt(){const[e,n]=x.useState(""),a=i(r=>r.vidList),o=i(r=>r.imgList),s=i(r=>r.pageNum);let u=i(r=>r.imgPage)?o.length:a.length;const g=i.setState,d=r=>{r>=1&&r<=u&&u!=1?g({pageNum:r}):r==s||v(m("page_num")+m("not_correct"))};return t.jsxs("div",{id:"page-bar",children:[t.jsx("button",{className:"btn",id:"last-page",onClick:()=>{d(s==1?u:s-1)}}),t.jsx("span",{id:"page-num",children:s+"/"+(u==0?1:u)}),t.jsxs("div",{id:"jump-page",children:[t.jsx("input",{id:"page-input",value:e,type:"text",placeholder:m("page_num"),onChange:r=>n(r.target.value),onKeyDown:r=>{r.key=="Enter"&&(d(e),n(""))}}),t.jsx("button",{className:"btn",id:"jump-btn",onClick:()=>{d(e),n("")},title:m("jump")})]}),t.jsx("button",{className:"btn",id:"next-page",onClick:()=>{d(s==u?1:s+1)}})]})}function et(){const e=i(n=>n.imgPage);return t.jsxs($,{children:[t.jsx("div",{id:"pic-box",children:e?t.jsx(Q,{}):t.jsx(Z,{})}),t.jsx(tt,{})]})}function nt(){const e=i(n=>n.nowPath);return t.jsx("button",{id:"home-pic",className:"btn",onClick:()=>{e==""?v(m("main_album")):k("")},title:m("back_main_album")})}function st(){const e=i(a=>a.nowPath),n=i(a=>a.parentPath);return t.jsxs("div",{id:"show-path-box",children:[e==""&&n==""?null:t.jsx("span",{id:"par-text",title:m("back_parent_album"),onClick:()=>{k(n)},children:n==""?m("main_album"):G(n)}),t.jsx("span",{id:"cur-text",children:e==""?m("main_album"):G(e)})]})}function G(e){return e?(e=e.replace(/\/+$/,""),e.split("/").pop()||""):""}function it(){const e=i(n=>n.upload);return t.jsxs("div",{id:"upload-box",children:[t.jsx("div",{id:"progress-box",children:t.jsx("div",{id:"progress-bar",style:{width:e.percent}})}),t.jsx("span",{id:"show-percent",children:e.percent})]})}function ot(){const e=i(n=>n.upload);return t.jsx("div",{id:"top-bar-box",children:e.status?t.jsx(it,{}):t.jsx(st,{})})}function at(){const[e,n]=x.useState(!1),a=i(l=>l.dirList),o=i(l=>l.nowPath),s=()=>{n(!e)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"dir-list",className:"btn",title:m("view_album"),onClick:()=>s(),children:t.jsx("div",{id:"dir-list-box",style:{display:e?"flex":"none"},children:a.map((l,u)=>t.jsx("div",{id:"dir-item",title:m("view")+l,onClick:()=>{k(o+"/"+l)},children:l},l+u))})}),e?t.jsx("div",{id:"close-list-win",onClick:()=>s()}):null]})}function rt(){return t.jsxs(H,{children:[t.jsx(nt,{}),t.jsx(ot,{}),t.jsx(at,{})]})}function lt(){const e=i.setState,n=i(s=>s.pageNum),a=i(s=>s.imgPage),o=s=>{switch(s){case"img":e({imgPage:!0,pageNum:a?n:1});break;case"vid":e({imgPage:!1,pageNum:a?1:n});break}};return t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn side-btn",id:"img-btn",title:m("image"),onClick:()=>{o("img")}}),t.jsx("button",{className:"btn side-btn",id:"vid-btn",title:m("video"),onClick:()=>{o("vid")}})]})}function ct(){const e=i.setState;i(o=>o.pageNum),i(o=>o.imgPage);const n=i(o=>o.upload);i(o=>o.dragWin),i(o=>o.nowPath);const a=o=>{e({upload:{...n,status:!0}});const s=Array.from(o.target.files);let l={totalSize:0,sendSize:0};s.forEach((u,g)=>{l.totalSize+=u.size}),s.forEach((u,g)=>{F(u,l)}),o.target.value=null};return t.jsxs(t.Fragment,{children:[t.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:o=>a(o)}),t.jsx("label",{className:"btn side-btn",id:"upload",title:m("upload_media"),htmlFor:"upFile"})]})}function dt(){const e=i(n=>n.nowPath);return t.jsx(t.Fragment,{children:t.jsx("button",{className:"btn side-btn",id:"load",title:m("refresh"),onClick:()=>{k(e)}})})}function ut(){return t.jsxs(A,{children:[t.jsx(ct,{}),t.jsx(lt,{}),t.jsx(dt,{})]})}function pt(){const e=i(a=>a.showBg),n=i(a=>a.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),t.jsx(M,{showBg:e})]})}function gt(){const e=i(a=>a.dragWin),n=i(a=>a.upload);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"drag-win",style:e?{display:"flex"}:{display:"none"},children:t.jsx("div",{})}),n.status&&t.jsx("div",{id:"uploading",className:"bg-enable"})]})}function mt(){const e=i.setState,n=i(c=>c.mediaWin),a=i(c=>c.pageNum);let o;n.img?o=i(c=>c.imgList)[a-1]:o=i(c=>c.vidList)[a-1];const[s,l]=x.useState(1),u=x.useRef(null),[g,d]=x.useState(!1),[r,p]=x.useState({x:0,y:0}),[h,P]=x.useState({x:0,y:0}),S=c=>{let f;switch(c){case"in":f=s+.3;break;case"out":if(s-.3<0)return;f=s-.3;break}l(Number(f.toFixed(2)))},L=c=>{p({x:0,y:0}),l(1);let f=n.index;const j=o.length;switch(c){case"min":f--,f=f<0?j-1:f;break;case"add":f++,f=f>j-1?0:f;break}e({mediaWin:{...n,index:f}})};x.useEffect(()=>{const c=j=>{if(!g)return;const C=j.clientX-h.x,N=j.clientY-h.y;p(w=>({x:w.x+C,y:w.y+N})),P({x:j.clientX,y:j.clientY})},f=()=>{d(!1)};return window.addEventListener("mousemove",c),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",f)}},[g,h]);const y=c=>{c.preventDefault(),c.stopPropagation(),d(!0),P({x:c.clientX,y:c.clientY})};return x.useEffect(()=>{n.status&&(p({x:0,y:0}),l(1))},[n.status]),n.status?t.jsxs("div",{className:"bg-enable",onClick:()=>e({mediaWin:{status:!1}}),children:[t.jsx("button",{className:"btn media-btn media-widget",id:"close-media"}),t.jsx("button",{className:"btn media-btn media-widget",id:"last-pic",onClick:c=>{c.stopPropagation(),L("min")}}),t.jsx("button",{className:"btn media-btn media-widget",id:"next-pic",onClick:c=>{c.stopPropagation(),L("add")}}),t.jsx("div",{id:"media-box",ref:u,onMouseDown:y,style:{cursor:g?"grabbing":"grab",transform:`translate(${r.x}px, ${r.y}px) scale(${s})`,transition:g?"none":"transform 0.15s ease-out"},onClick:c=>c.stopPropagation(),children:n.img?t.jsx("img",{loading:"lazy",src:n.url+o[n.index]}):t.jsx("video",{src:n.url+o[n.index],controls:!0,autoPlay:!0,loop:!0})}),t.jsxs("div",{id:"zoom-bar",className:"media-widget",children:[t.jsx("button",{className:"btn",id:"zoom-out",style:{marginRight:"20px"},title:m("zoom_out"),onClick:c=>{c.stopPropagation(),S("out")}}),t.jsx("button",{className:"btn",id:"zoom-in",style:{marginLeft:"20px"},title:m("zoom_in"),onClick:c=>{c.stopPropagation(),S("in")}})]})]}):null}function ft(){return t.jsxs(t.Fragment,{children:[t.jsx(pt,{}),t.jsx(gt,{}),t.jsx(mt,{})]})}function xt(){const e=i(n=>n.theme);return x.useEffect(()=>(Y(),window.addEventListener("dragover",_),window.addEventListener("dragleave",B),window.addEventListener("drop",W),()=>{window.removeEventListener("dragover",_),window.removeEventListener("dragleave",B),window.removeEventListener("drop",W)}),[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.pic,children:[t.jsx("div",{className:"wallpaper"}),t.jsxs(O,{children:[t.jsx(V,{}),t.jsx(rt,{}),t.jsx(X,{}),t.jsx(q,{})]}),t.jsx(ft,{}),t.jsx(ut,{}),t.jsx(et,{}),t.jsx(I,{})]})}U.createRoot(document.getElementById("root")).render(t.jsx(xt,{}));
