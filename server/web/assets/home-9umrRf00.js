import{c as N,G as b,n as g,j as e,R as f,r as d,a as y,S as L,W as v,T as _,b as C}from"./all-hmuOc3IC.js";async function S(){let t=I();const s=await fetch(window.location.origin+"/server/lang",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lang:t.type})});return t.list=await s.json(),sessionStorage.setItem("lang",JSON.stringify(t.list)),t}function I(){let t;const s=["en","zh"];let n=(navigator.language||navigator.userLanguage).split("-")[0];s.includes(n)||(n="en");let o=localStorage.getItem("lang");return o==null||o=="system"?(o="system",t=n):t=o,{userSelect:o,type:t,list:[]}}const l=N((t,s)=>(window.localStorage.getItem("userName"),window.localStorage.getItem("token"),{load:0,userName:"visitor",token:"",showBg:!1,locked:!0,lang:{type:"",list:[],userSelect:""},theme:{mode:"",color:{home:"",doc:"",pic:"",tra:"",mon:"",not:"",bok:""},userSelect:""},listWin:{type:"",name:"",status:!1},widgetData:{doc:[],pic:[],tra:[],mon:[],not:[],bok:[]},setGlobal:n=>{t(o=>({...o,...n}))},getGlobal:()=>s(),replaceGlobal:n=>{t(()=>({...n}))}}));function a(t){return l.getState().lang.list[t]}async function k(){l.setState({lang:await S()});let t=localStorage.getItem("userName"),s=localStorage.getItem("token");t=t||"visitor",s=s||"",l.setState({userName:t,token:s}),sessionStorage.setItem("home","true"),sessionStorage.getItem("app")=="true"?l.setState({locked:!1}):(l.setState({locked:!0}),T(t,s)),sessionStorage.setItem("app","false");const n=b("home");l.setState({theme:n}),P()}function T(t,s){l.getState().load;let n=t||"visitor";s=s||"",fetch(window.location.origin+"/server/login/auth_status",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+s,"x-user":n},body:JSON.stringify({name:t,token:s})}).then(o=>{if(!o.ok){o.status===401?g(a("log_outdate")):g(o.status),window.localStorage.setItem("userName","visitor"),window.localStorage.setItem("token",""),l.setState({userName:"visitor",token:"",load:l.getState().load+1});return}l.setState({load:l.getState().load+1})})}function P(){const t=l.getState().userName;l.getState().load,fetch(window.location.origin+"/server/home/widget",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t})}).then(s=>s.json()).then(s=>{l.setState({widgetData:s,load:l.getState().load+1})})}function B({showItem:t,type:s}){return e.jsx("div",{className:"widget-panel",children:t.map((n,o)=>e.jsxs(f.Fragment,{children:[s=="tra"&&e.jsx("li",{children:a("recent_delete")}),s=="bok"&&e.jsx("li",{children:a("recent_visit")}),e.jsx("div",{className:"widget-panel-item "+s+"-panel",title:a("view"),onClick:r=>{r.stopPropagation(),O(s,n)},children:s=="pic"?D(n):e.jsx("span",{className:"panel-text "+(n==""?"panel-text-null":""),children:n==""?a("empty"):n})})]},n+o))})}function D(t){const s=window.location.origin+"/file/Pictures/"+t.name;return t.media=="img"?e.jsx("img",{src:s,alt:t.name}):t.media=="vid"?e.jsx("video",{src:s,controls:"controls"}):e.jsx("span",{className:"panel-text panel-text-null",children:a("empty")})}function O(t,s){if(t=="tra"){g(a("recent_delete")+":"+s);return}if(t=="mon"){const n=l.getState().userName;g(a("current_user")+":"+n);return}(t!="pic"&&s!=""||t=="pic"&&s.name!="")&&l.setState({listWin:{type:t,name:s,status:!0}})}function E({tmpLoad:t}){const s=l(c=>c.locked),n=l(c=>c.widgetData),o=l(c=>c.theme),r=["doc","pic","tra","mon","not","bok"],i=[];for(let c=0;c<r.length;c+=2)i.push(r.slice(c,c+2));return e.jsx("div",{id:"widget",className:!s&&t?"widget-load":"",children:i.map((c,u)=>e.jsx("div",{className:"widget-line",children:c.map(m=>e.jsxs("div",{id:m+"widget",className:"widget-item",title:a("enter")+":"+a(m),mode:o.mode,color:o.color[m],onClick:()=>G(m),children:[e.jsx("div",{className:"widget-icon",children:e.jsx("div",{id:m+"-icon"})}),e.jsx(B,{showItem:n[m],type:m}),e.jsx("span",{className:"widget-title",mode:o.mode,color:o.color.home,children:a(m)})]},m))},`line${u}`))})}function G(t){window.location.href=t}function W(){const t=l(r=>r.lang),[s,n]=d.useState(!1),o={system:a("system"),zh:"简体中文",en:"English"};return e.jsx(e.Fragment,{children:s?e.jsx("div",{id:"lang-list",onClick:()=>{},children:Object.entries(o).map(([r,i])=>e.jsx("div",{className:"lang-list-item "+(r===t.userSelect?"lang-select":""),onClick:async()=>{localStorage.setItem("lang",r),n(!1),l.setState({lang:await S()})},children:e.jsx("span",{children:i})},r))}):e.jsxs("div",{id:"show-lang",title:a("switch"),onClick:()=>{n(!0)},children:[e.jsx("span",{children:o[t.userSelect]}),e.jsx("div",{})]})})}function F(){const[t,s]=d.useState(!1),n=[{id:"cpu",name:a("cpu_usage")},{id:"mem",name:a("mem_usage")},{id:"disk",name:a("disk_usage")}],[o,r]=d.useState({cpu:{data:"",percent:"0%"},mem:{data:"",percent:"0%"},disk:{data:"",percent:"0%"},net:{up:"0.00MB",down:"0.00MB"}});return d.useEffect(()=>{const i=setInterval(()=>{fetch(window.location.origin+"/server/system/system",{method:"GET",headers:{"Content-Type":"application/json"}}).then(c=>c.json()).then(c=>{r({cpu:{data:"",percent:c.cpuPercent},mem:{data:c.memData,percent:c.memPercent},disk:{data:c.diskData,percent:c.diskPercent},net:{up:c.netUp,down:c.netDown}}),t||s(!0)})},3e3);return()=>{clearInterval(i)}},[]),e.jsxs("div",{id:"sys-app",children:[t?null:e.jsx("div",{id:"sys-loadPage",children:e.jsx("div",{className:"loading"})}),n.map(i=>e.jsx(f.Fragment,{children:e.jsxs("div",{className:"sys-box",title:i.name,children:[e.jsxs("div",{id:i.id+"-bar",className:"sys-bar",children:[e.jsx("div",{id:i.id+"-icon",className:"sys-icon"}),e.jsx("div",{id:i.id+"-progress-bar",className:"sys-progress-bar",children:e.jsx("div",{className:"sys-progress",style:{width:o[i.id].percent}})}),e.jsx("span",{id:i.id+"-percent",className:"sys-percent",children:o[i.id].percent})]}),e.jsx("span",{className:"sys-data",children:o[i.id].data})]})},i.id)),e.jsxs("div",{id:"net-box",className:"sys-box",title:a("net_usage"),children:[e.jsx("span",{id:"net-icon",className:"sys-icon"}),e.jsx("div",{id:"net-up",className:"sys-icon"}),e.jsx("span",{id:"net-up-data",className:"sys-data",children:o.net.up}),e.jsx("div",{id:"net-down",className:"sys-icon"}),e.jsx("span",{id:"net-down-data",className:"sys-data",children:o.net.down})]})]})}function J(){const t=l(u=>u.theme),[s,n]=d.useState("home"),o={system:a("system"),dark:a("dark_mode"),light:a("light_mode")},r=["default","green","blue","orange","yellow","pink","red"],i=()=>{const u=["system","dark","light"],x=(u.indexOf(t.userSelect)+1)%u.length;j("userSelect",u[x])},c=()=>{const u=["home","doc","pic","tra","mon","not","bok"],x=(u.indexOf(s)+1)%u.length;n(u[x])};return e.jsxs("div",{id:"theme-app",children:[e.jsx("div",{id:"mode-bar",children:e.jsxs("button",{id:"show-mode",className:"btn theme-btn",onClick:i,children:[e.jsx("span",{children:o[t.userSelect]}),e.jsx("div",{className:"switch-icon",id:"switch-mode",title:"切换模式"})]})}),e.jsx("div",{id:"page-bar",children:e.jsxs("button",{id:"show-page",className:"btn theme-btn",onClick:c,children:[e.jsx("span",{children:a(s)}),e.jsx("div",{id:"switch-page",className:"switch-icon",title:a("switch")})]})}),e.jsx("div",{id:"color-bar",children:r.map((u,m)=>e.jsx("div",{className:"color-btn "+(t.color[s]===u?"color-btn-enable":""),mode:t.mode,color:u,onClick:()=>j("color",{...t.color,[s]:u}),children:e.jsx("div",{})},m+u))})]})}function j(t,s){const o={...l.getState().theme,[t]:s};t==="userSelect"&&(s==="system"?o.mode=y():o.mode=s),L(o.mode,o.color.home),document.body.setAttribute("mode",o.mode),document.body.setAttribute("color",o.color.home),l.setState({theme:o}),localStorage.setItem("theme",JSON.stringify(o))}function R({tmpLoad:t,setTmpLoad:s}){const n=l(h=>h.showBg),o=l(h=>h.setGlobal),r=l(h=>h.locked),[i,c]=d.useState(""),u=h=>{c(h),o({showBg:!0})},m=()=>{o({showBg:!1}),c("")},x=[{id:"lang",name:a("lang_setting")},{id:"theme",name:a("theme")},{id:"sys",name:a("monitor")},{id:"lock",name:a("login_manage")}];return e.jsxs(e.Fragment,{children:[n&&e.jsxs("div",{className:"app-win float-win",children:[e.jsx("button",{className:"btn",id:"close-win",title:a("close"),onClick:m}),i==="lang"&&e.jsx(W,{}),i==="sys"&&e.jsx(F,{}),i==="theme"&&e.jsx(J,{})]}),e.jsx("div",{id:"dock",className:!r&&t?"dock-load":"",children:x.map(h=>e.jsx("div",{id:h.id,title:h.name,className:"dock-app",onClick:()=>{h.id=="lock"?(s(!1),setTimeout(()=>{o({locked:!0}),s(!0)},500)):u(h.id)},children:e.jsx("div",{id:h.id+"-icon",className:"dock-icon"})},h.id))})]})}function A(){const t=l(n=>n.listWin),s=l(n=>n.theme);return e.jsxs(v,{showBg:t.status,children:[e.jsx("div",{id:"close-back",onClick:()=>{l.setState({listWin:{type:"",name:"",status:!1,color:""}})}}),e.jsx("div",{className:"list-win",color:s.color[t.type],mode:s.mode,id:t.type+"-list",children:M(t.type,t.name)})]})}function M(t,s){switch(t){case"doc":return e.jsx(U,{name:s});case"pic":return e.jsx(z,{name:s});case"not":return e.jsx(K,{name:s});case"bok":return e.jsx($,{name:s});default:return null}}function U({name:t}){const[s,n]=d.useState(!1),[o,r]=d.useState(null);return d.useEffect(()=>{p(window.location.origin+"/server/doc/list",{file:t},r,n,!0)},[]),e.jsx(e.Fragment,{children:s?o.type=="dir"?o.filelist.map((i,c)=>e.jsxs("div",{className:"dir-view",title:i[0],children:[e.jsx("div",{className:i[1]=="dir"||i[1]=="dir_link"?"dir-view-dir":"dir-view-file"}),e.jsx("span",{children:i[0]})]},c+i[0])):o.view?e.jsx("iframe",{className:"file-view",src:window.location.origin+"/"+o.url}):e.jsx("span",{children:a("not_support_type")}):e.jsx("div",{className:"loading"})})}function z({name:t}){const s=window.location.origin+"/file/Pictures/"+t.name;if(t.media=="vid")return e.jsx("video",{src:s,controls:"controls",className:"list-media"});if(t.media="img")return e.jsx("img",{src:s,alt:t.name,className:"list-media"})}function K({name:t}){const[s,n]=d.useState(!1),[o,r]=d.useState("");return d.useEffect(()=>{p(window.location.origin+"/server/not/get_text",{name:t},r,n,!1)},[]),s?e.jsx("code",{children:o}):e.jsx("div",{className:"loading"})}function $({name:t}){const[s,n]=d.useState(!1),[o,r]=d.useState("");return d.useEffect(()=>{p(window.location.origin+"/server/bok/get_url",{name:t},r,n,!1)},[]),s?window.location.href=o:e.jsx("div",{className:"loading"})}function p(t,s,n,o,r){fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(i=>r?i.json():i.text()).then(i=>{n(i),o(!0)})}function q(){const t=l(o=>o.showBg),[s,n]=d.useState(!0);return e.jsxs(e.Fragment,{children:[e.jsx(v,{showBg:t}),e.jsx(E,{tmpLoad:s}),e.jsx(R,{tmpLoad:s,setTmpLoad:n}),e.jsx(A,{})]})}function H({setTmpLoad:t}){return e.jsxs("button",{id:"unlock-btn",className:"btn lock-btn",onClick:()=>{t(!1),setTimeout(()=>{l.setState({locked:!1}),t(!0)},500)},children:[e.jsx("div",{}),e.jsx("span",{children:a("start")})]})}function Q(){const[t,s]=d.useState(!1),n=l(o=>o.load);return d.useEffect(()=>{n==2&&s(!1)},[n]),t?e.jsx("div",{className:"loading",id:"lock-loading",children:" "}):e.jsxs("button",{id:"load-btn",className:"btn lock-btn",onClick:()=>{s(!0),l.setState({load:0}),k()},children:[e.jsx("div",{}),e.jsx("span",{children:a("refresh")})]})}function V(){return e.jsxs("button",{id:"logout-btn",className:"btn lock-btn",onClick:()=>X(),children:[e.jsx("div",{}),e.jsx("span",{children:a("logout")})]})}function X(){confirm(a("are_you_sure"))&&(localStorage.clear(),window.location.reload())}function Y({prop:t}){return e.jsxs("div",{id:"btn-box",children:[e.jsx(Q,{}),e.jsx(H,{setTmpLoad:t}),e.jsx(V,{})]})}function Z({setSwitch:t}){const s=l(n=>n.userName);return e.jsxs("button",{className:"btn",id:"lock-user",title:a("switch"),onClick:()=>{t(!0)},children:[e.jsx("div",{id:"lock-profile"}),e.jsx("div",{id:"lock-switch"}),e.jsx("span",{children:s==""||s=="visitor"?a("guest"):s})]})}function ee({prop:t}){return e.jsxs(e.Fragment,{children:[e.jsx(Z,{setSwitch:t.switch}),e.jsx(Y,{prop:t.unlock})]})}function te({setSwitch:t}){const[s,n]=d.useState({userName:"",password:""}),o=i=>{const{name:c,value:u}=i.target;n(m=>({...m,[c]:u}))},r=i=>{i.key==="Enter"&&w(s.userName,s.password)};return e.jsx(e.Fragment,{children:e.jsxs("div",{id:"login-win",onKeyDown:r,children:[e.jsx("button",{className:"btn",id:"login-back",title:a("back"),onClick:()=>{t(!1)}}),e.jsx("input",{className:"login-input",type:"text",name:"userName",placeholder:a("username"),value:s.userName,onChange:o}),e.jsx("input",{className:"login-input",type:"password",name:"password",value:s.password,onChange:o,placeholder:a("password")}),e.jsx("button",{id:"login-send",className:"btn",title:a("login"),onClick:()=>w(s.userName,s.password)})]})})}function w(t,s){fetch(window.location.origin+"/server/login/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,password:s})}).then(n=>{if(!n.ok)throw n.status===401?g(a("acc_or_pas_err")):g(n.status+a("error")),new Error(n.status);return n.json()}).then(n=>{window.localStorage.setItem("userName",t),window.localStorage.setItem("token",n.token),window.location.reload()})}function se(){const[t,s]=d.useState(!1),n=l(i=>i.locked),[o,r]=d.useState(!0);return e.jsxs("div",{id:"lock-page",className:n&&o?"lock-page-load":"",children:[e.jsx("div",{id:"head-bar",className:n&&o?"head-bar-load":"",children:e.jsx("div",{id:"head-name"})}),t?e.jsx(te,{setSwitch:s}):e.jsx(ee,{prop:{unlock:r,switch:s}})]})}function ne(){const t=l(s=>s.theme);return d.useEffect(()=>{k()},[]),e.jsxs("div",{id:"app",color:t.color.home,mode:t.mode,children:[e.jsx(se,{}),e.jsx(q,{}),e.jsx("div",{className:"wallpaper"}),e.jsx(_,{})]})}C.createRoot(document.getElementById("root")).render(e.jsx(ne,{}));
