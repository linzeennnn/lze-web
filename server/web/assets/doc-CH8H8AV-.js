import{c as O,n as d,j as e,r as S,W as B,T as U,b as L}from"./all-hmuOc3IC.js";import{P as W,C as G,T as R,S as I,a as J,H as $,G as H,b as A}from"./page-D53qMD83.js";const r=O((t,n)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),nowPath:"",parentPath:"",fileList:[],uploading:!1,showBg:!1,loading:!1,dragWin:!1,langList:[],fileWin:{status:!1,url:"",view:!1},theme:{mode:"",color:{doc:""},userSelect:""},upload:{win:!1,status:!1,percent:"0%"},selected:[],docUrl:`${window.location.origin}/server/doc/`,setGlobal:o=>{t(s=>({...s,...o}))},replaceGlobal:o=>{t(()=>({...o}))},getGlobal:()=>n()}));function i(t){return r.getState().langList[t]}function K(){W(r.setState,"doc"),w("")}function w(t){const n={file:t},o=r.getState().docUrl;m(!0),fetch(`${o}list`,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{m(!1),s.type=="dir"&&r.setState({fileList:s.filelist,nowPath:s.currentFolder,parentPath:s.parentFolder,selected:[]}),s.type=="file"&&r.setState({fileWin:{status:!0,url:s.url,view:s.view}})})}function m(t){r.setState({loading:t,showBg:t})}function E(t,n,o){if(t.size==0){d(i("error")+":"+t.name+i("is_empty"));return}const s=r.getState(),a=s.userName,l=s.token,u=s.nowPath,p=s.upload,c=r.setState,y=o==="file"?s.docUrl+"upload_file":s.docUrl+"upload_folder",f=X(t.size),g=Math.ceil(t.size/f);let h=0;function k(){if(n.sendSize>=n.totalSize){if(c({upload:{...p,status:!1}}),o==="file")d(i("op_com")),w(u);else if(o==="dir"){const j=t.webkitRelativePath.split("/")[0];q(j)}return}if(h>=t.size)return;let P=0,v=0;const F=t.slice(h,h+f),C=Math.floor(h/f),b=new FormData;if(b.append("file",F),b.append("fileName",t.name),b.append("totalChunks",g),b.append("currentChunk",C),o==="dir"){const j=t.webkitRelativePath;b.append("relativePath",j)}o==="file"&&b.append("nowpath",u);const x=new XMLHttpRequest;x.open("POST",y,!0),x.setRequestHeader("x-user",a),x.setRequestHeader("authorization","Bearer "+l),x.upload.onprogress=function(j){j.lengthComputable&&(n.sendSize=n.sendSize+j.loaded-P,P=j.loaded,v=Math.floor(n.sendSize/n.totalSize*100)+"%",c({upload:{...p,percent:v}}))},x.onload=function(){if(x.status!=200){x.status==401?d(i("no_per")):d(i("error")+":"+x.status),c({upload:{...p,status:!1}});return}else h+=f,k()},x.onerror=function(){console.error(`Chunk ${C+1} upload encountered error.`),c({upload:!1})},x.send(b)}k()}function q(t){const n=r.getState(),o=n.docUrl+"move_folder";fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,path:n.nowPath})}).then(s=>s.text()).then(s=>{d(i("op_com")),w(n.nowPath)}).catch(s=>{d(s)})}function X(t){return t<=1024*1048576?10*1048576:t<=5120*1048576&&t>1024*1048576?50*1048576:100*1048576}function _(t){r.setState({dragWin:!0}),t.stopPropagation(),t.preventDefault()}function N(t){r.setState({dragWin:!1}),t.stopPropagation(),t.preventDefault()}function T(t){const o=r.getState().upload,s=r.setState;s({dragWin:!1}),t.stopPropagation(),t.preventDefault();const a=t.dataTransfer.items,l=[];let u=0,p=0;function c(f,g=""){if(f.isFile)p++,f.file(h=>{g&&Object.defineProperty(h,"webkitRelativePath",{value:g+h.name}),l.push(h),u+=h.size,p--,y()});else if(f.isDirectory){const h=f.createReader();p++,h.readEntries(k=>{p--;for(const P of k)c(P,g+f.name+"/");y()})}}function y(){if(p===0){if(l.length===0){d(i("empty"));return}s({upload:{...o,status:!0,win:!1}});const f={totalSize:u,sendSize:0};l.forEach(g=>{const h=g.webkitRelativePath?"dir":"file";E(g,f,h)})}}for(let f=0;f<a.length;f++){const g=a[f].webkitGetAsEntry();g&&c(g)}}function Z({fileMes:t,editMode:n,nameEdit:o,rename:s}){const[a,l]=o,u=r(c=>c.nowPath),p=c=>{c.key==="Enter"&&s(t[0],a)};return e.jsx(e.Fragment,{children:n?e.jsx("input",{value:a,className:"file-list-text file-list-input",onClick:c=>c.stopPropagation(),onChange:c=>l(c.target.value),onKeyDown:p}):e.jsx("span",{className:(t[1]==="dir"||t[1]==="dir_link"?"dir-text":"file-text")+" file-list-text",title:i("view")+t[0],onClick:c=>{c.stopPropagation(),w(u+"/"+t[0])},children:t[0]})})}function Q({name:t,editing:n,newName:o,rename:s}){const[a,l]=n;return e.jsx(e.Fragment,{children:a?e.jsx("button",{className:"save-name file-edit-btn btn",title:i("save"),onClick:u=>{u.stopPropagation(),l(!1),s(t,o)}}):e.jsx("button",{className:"edit-name file-edit-btn btn",title:i("rename"),onClick:u=>{u.stopPropagation(),l(!0)}})})}function V({fileMes:t}){const n=r.getState();return e.jsx("button",{className:"down-btn btn",title:i("download")+":"+t[0],onClick:o=>{o.stopPropagation(),t[1]==="file"||t[1]==="file_link"?window.location.href=n.docUrl+"download_file?file_path="+n.nowPath+"/"+t[0]+"&token="+n.token+"&user="+n.userName:Y(t[0])}})}function Y(t){m(!0);const n=r.getState(),o=n.token,s=n.userName;fetch(n.docUrl+"zip_folder",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+o,"x-user":s},body:JSON.stringify({folder_path:n.nowPath+"/"+t})}).then(a=>{if(a.status===401)throw d(i("no_per")),m(!1),new Error("err");return a.text()}).then(a=>{window.location.href=n.docUrl+"down_zip?downToken="+a,d(i("down_one_minute")),m(!1)})}function M({fileMes:t,selected:n,docClick:o}){const[s,a]=S.useState(!1),[l,u]=S.useState(t[0]),c=r.getState().nowPath+"/"+t[0];return e.jsxs("div",{className:`doc-list main-item ${n.includes(c)?"doc-list-selected":""}`,onClick:()=>o(c),children:[e.jsx(Z,{fileMes:t,editMode:s,nameEdit:[l,u],rename:z}),e.jsx(Q,{name:t[0],editing:[s,a],newName:l,rename:z}),e.jsx(V,{fileMes:t})]},"doclist"+t[0])}function z(t,n){if(t==n)return;const o=r.getState();m(!0);const s=o.nowPath+"/"+t,a=o.nowPath+"/"+n;fetch(o.docUrl+"rename",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+o.token,"x-user":o.userName},body:JSON.stringify({oldpath:s,newpath:a})}).then(l=>{l.ok?(d(i("op_com")),w(o.nowPath)):(l.status===401?d(i("no_per")):d(i("error")+":"+l.status),m(!1))})}function tt(){const t=a=>{let l=[...o];l.includes(a)?(l.splice(l.indexOf(a),1),d(i("cancel"))):(l.push(a),d(i("selected")+l.length+i("file"))),s({selected:l})},n=r(a=>a.fileList),o=r(a=>a.selected),s=r(a=>a.setGlobal);return e.jsx(G,{children:n.map(a=>e.jsx(M,{fileMes:a,selected:o,docClick:t},"doclist"+a[0]))})}function et(){const t=r(n=>n.nowPath);return e.jsx("div",{id:"show-path",title:t,children:e.jsx("span",{children:t})})}function nt({setCreate:t}){const[n,o]=S.useState(""),s=l=>{const{value:u}=l.target;o(u)},a=l=>{l.key==="Enter"&&(t(!1),D(n))};return e.jsxs(e.Fragment,{children:[e.jsx("input",{placeholder:i("folder_name"),id:"new-dir-input",onChange:s,value:n,onKeyDown:a}),e.jsx("button",{id:"new-dir-save",className:"btn",title:i("save"),onClick:()=>{t(!1),D(n)}})]})}function D(t){if(t.includes("/")||t.includes("\\")){d(i("name_not_con")+" / \\");return}else if(t.length===0){d(i("folder_name")+i("is_empty"));return}const n=r.getState(),o={folderName:t,nowpath:n.nowPath};m(!0),fetch(`${n.docUrl}new_folder`,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json",authorization:"Bearer "+n.token,"x-user":n.userName}}).then(s=>{if(!s.ok){s.status===401?d(i("no_per")):d(i("error")+":"+s.status),m(!1);return}d(i("op_com")),w(n.nowPath)})}function ot({createStatus:t}){const[n,o]=t,s=r(l=>l.upload),a=r(l=>l.nowPath);return e.jsxs("div",{id:"top-bar-box",children:[!n&&!s.status&&e.jsx("button",{id:"home-icon",className:"btn",title:i("back_main_dir"),onClick:()=>{a!=""&&w("")}}),!n&&!s.status&&e.jsx(et,{}),s.status&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"progress",style:{width:s.percent}}),e.jsx("span",{id:"progress-text",children:s.percent})]}),n&&!s.status&&e.jsx(nt,{setCreate:o})]})}function st(){const t=r(s=>s.nowPath),n=r(s=>s.parentPath),o=t==="/"||t==="";return e.jsx("button",{id:"go-up",className:(o?"go-up-disable":"")+" btn",disabled:o,title:o?"":i("back"),onClick:()=>{o||w(n)}})}function at({createStatus:t}){const[n,o]=t;return e.jsx(e.Fragment,{children:n?e.jsx("button",{id:"new-dir-cancel",className:"btn new-dir-btn",title:i("cancel"),onClick:()=>o(!1)}):e.jsx("button",{id:"new-dir-btn",className:"btn new-dir-btn",title:i("create_folder"),onClick:()=>o(!0)})})}function it(){const[t,n]=S.useState(!1);return e.jsxs(R,{children:[e.jsx(st,{}),e.jsx(ot,{createStatus:[t,n]}),e.jsx(at,{createStatus:[t,n]})]})}function rt({setPaste:t,setCopyList:n}){return e.jsx("button",{id:"copy",className:"btn side-btn",title:i("copy"),onClick:()=>{const o=r.getState().selected;n([...o]),t({status:!0,type:"copy"})}})}function lt(){return e.jsx("button",{id:"del",className:"btn side-btn",title:i("delete"),onClick:()=>ct()})}function ct(){if(confirm(i("are_you_sure"))){m(!0);const t=r.getState(),n=t.userName,o=t.token,s=t.selected,a=t.docUrl+"del";fetch(a,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+o,"x-user":n},body:JSON.stringify({dellist:s})}).then(l=>{l.ok?(d(i("op_com")),w(t.nowPath)):(l.status==401?d(i("no_per")):d(i("error")+":"+l.status),m(!1))})}}function dt({setPaste:t,setCopyList:n}){return e.jsx("button",{id:"move",className:"btn side-btn",title:i("cut"),onClick:()=>{const o=r.getState().selected;n([...o]),t({status:!0,type:"move"})}})}function ut({paste:t,copyList:n}){const[o,s]=t;return o.status?e.jsx("button",{id:"paste",className:"btn side-btn",onClick:()=>{s({status:!1}),pt(o.type,n)}}):e.jsx(e.Fragment,{})}function pt(t,n){const o=r.getState();if(n.length==0){d(i("no_select_file"));return}m(!0);const s=o.token,a=o.userName,l=o.nowPath,u={copylist:n,nowpath:l};let p;switch(t){case"copy":p=o.docUrl+"copy";break;case"move":p=o.docUrl+"move";break}fetch(p,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+s,"x-user":a},body:JSON.stringify(u)}).then(c=>{c.ok?(d(i("op_com")),w(l)):(c.status==401?d(i("no_per")):d(i("error")+":"+c.status),m(!1))})}function ft(){return e.jsx("button",{id:"reload",className:"btn side-btn",title:i("refresh"),onClick:()=>{w(r.getState().nowPath)}})}function ht(){const t=r.setState,n=r(o=>o.upload);return e.jsx(e.Fragment,{children:e.jsx("button",{id:"upload",className:"btn side-btn",title:i("upload"),onClick:()=>{t({upload:{...n,win:!0}})}})})}function mt(){const[t,n]=S.useState({type:"",status:!1}),[o,s]=S.useState([]);return e.jsxs(I,{children:[e.jsx(ht,{}),e.jsx(ft,{}),e.jsx(lt,{}),e.jsx(rt,{setPaste:n,setCopyList:s}),e.jsx(dt,{setPaste:n,setCopyList:s}),e.jsx(ut,{paste:[t,n],copyList:o})]})}function gt(){const t=r(o=>o.showBg),n=r(o=>o.loading);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),e.jsx(B,{showBg:t})]})}function wt(){const t=r.setState,n=r(a=>a.upload),o=r(a=>a.dragWin);r(a=>a.nowPath);const s=(a,l)=>{t({upload:{...n,status:!0,win:!1}});const u=Array.from(a.target.files);let p={totalSize:0,sendSize:0};u.forEach((c,y)=>{p.totalSize+=c.size}),u.forEach((c,y)=>{E(c,p,l)}),a.target.value=null};return e.jsxs(e.Fragment,{children:[n.win?e.jsxs("div",{id:"upload-opt",children:[e.jsx("button",{id:"close-upload",className:"btn",title:i("close"),onClick:()=>{t({upload:{...n,win:!1}})}}),e.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:a=>s(a,"file")}),e.jsx("input",{type:"file",name:"folder",style:{display:"none"},webkitdirectory:"true",mozdirectory:"true",directory:"true",multiple:!0,onChange:a=>s(a,"dir"),id:"upDir"}),e.jsx("label",{id:"upload-file",className:"btn upload-opt-btn",title:i("upload_file"),htmlFor:"upFile"}),e.jsx("label",{id:"upload-dir",className:"btn upload-opt-btn",title:i("upload_folder"),htmlFor:"upDir"})]}):null,e.jsx(B,{showBg:n.win}),n.status?e.jsx("div",{id:"uploading-back"}):null,e.jsx("div",{id:"drag-win",style:o?{display:"flex"}:{display:"none"},children:e.jsx("div",{})})]})}function xt(){const t=r(n=>n.fileWin);return t.status?e.jsxs("div",{id:"file-win",children:[e.jsx("button",{id:"close-file-win",className:"btn",title:i("close"),onClick:()=>{r.setState({fileWin:{status:!1,url:"",view:!1}})}}),t.view?e.jsx("iframe",{id:"file-view",src:t.url}):e.jsx("span",{children:i("not_support_type")})]}):null}function bt(){return e.jsxs(e.Fragment,{children:[e.jsx(gt,{}),e.jsx(wt,{}),e.jsx(xt,{})]})}function jt(){const t=r(n=>n.theme);return S.useEffect(()=>(K(),window.addEventListener("dragover",_),window.addEventListener("dragleave",N),window.addEventListener("drop",T),()=>{window.removeEventListener("dragover",_),window.removeEventListener("dragleave",N),window.removeEventListener("drop",T)}),[]),e.jsxs("div",{id:"app",color:t.color.doc,mode:t.mode,children:[e.jsxs(J,{children:[e.jsx($,{}),e.jsx(it,{}),e.jsx(H,{}),e.jsx(A,{})]}),e.jsx(bt,{}),e.jsx(mt,{}),e.jsx(tt,{}),e.jsx(U,{}),e.jsx("div",{className:"wallpaper"})]})}L.createRoot(document.getElementById("root")).render(e.jsx(jt,{}));
