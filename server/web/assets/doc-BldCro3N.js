import{c as U,A as y,e as A,n as h,f as i,p as I,q as B,j as n,m as G,W as S,t as $,r as p,k as v,P as H,o as O}from"./all-D8KwLJwx.js";import{P as q,C as V,T as X,S as J,a as M,H as Q,G as Y,b as Z}from"./page-BkcQCuwQ.js";const l=U((t,e)=>({nowPath:"",parentPath:"",fileList:[],uploading:!1,linkWin:{show:!1,link:""},showBg:!1,loading:!1,dragWin:!1,fileWin:{status:!1,url:"",view:!1},theme:{mode:"",color:{doc:""},userSelect:""},upload:{win:!1,status:!1,percent:"0%"},selected:[],setGlobal:s=>{t(a=>({...a,...s}))},replaceGlobal:s=>{t(()=>({...s}))},getGlobal:()=>e()}));function tt(){q(l.setState,"doc"),b("")}function b(t){y.post({api:"doc/list",body:{file:t},success:e=>{et(!1),e.type=="dir"&&l.setState({fileList:e.filelist,nowPath:e.currentFolder,parentPath:e.parentFolder,selected:[]}),e.type=="file"&&l.setState({fileWin:{status:!0,url:e.url,view:e.view}})}})}function et(t){l.setState({loading:t,showBg:t})}function T(t,e,s){if(t.size==0){h.err(i("error")+":"+t.name+i("is_empty"));return}const a=l.getState(),o=I(),r=a.nowPath,c=a.upload,u=l.setState,f=B()+"doc/",g=s==="file"?f+"upload_file":f+"upload_folder",d=st(t.size),w=Math.ceil(t.size/d);let m=0;function C(){if(e.sendSize>=e.totalSize&&!e.completed){if(u({upload:{...c,status:!1}}),s==="file")e.completed=!0,h.normal(i("op_com")),b(r);else if(s==="dir"){const k=t.webkitRelativePath.split("/")[0];nt(k)}return}if(m>=t.size)return;let P=0,E=0;const K=t.slice(m,m+d),_=Math.floor(m/d),j=new FormData;if(j.append("file",K),j.append("fileName",t.name),j.append("totalChunks",w),j.append("currentChunk",_),s==="dir"){const k=t.webkitRelativePath;j.append("relativePath",k)}s==="file"&&j.append("nowpath",r);const x=new XMLHttpRequest;x.open("POST",g,!0),x.setRequestHeader("authorization","Bearer "+o),x.upload.onprogress=function(k){k.lengthComputable&&(e.sendSize=e.sendSize+Math.min(k.loaded,t.size)-P,P=k.loaded,E=Math.floor(e.sendSize/e.totalSize*100)+"%",u({upload:{...c,percent:E}}))},x.onload=function(){if(x.status!=200){x.status==401?h.err(i("no_per")):h.err(i("error")+":"+x.status),u({upload:{...c,status:!1}}),e.completed=!0;return}else m+=d,C()},x.onerror=function(){console.error(`Chunk ${_+1} upload encountered error.`),u({upload:!1})},x.send(j)}C()}function nt(t){const e=l.getState();y.post({api:"doc/move_folder",body:{name:t,path:e.nowPath},success:()=>{b(e.nowPath)}})}function st(t){return t<=100*1048576?2*1048576:t<=1024*1048576?5*1048576:t<=10240*1048576?10*1048576:20*1048576}function N(t){l.setState({dragWin:!0}),t.stopPropagation(),t.preventDefault()}function D(t){l.setState({dragWin:!1}),t.stopPropagation(),t.preventDefault()}function L(t){const s=l.getState().upload,a=l.setState;a({dragWin:!1}),t.stopPropagation(),t.preventDefault();const o=t.dataTransfer.items,r=[];let c=0,u=0;function f(d,w=""){if(d.isFile)u++,d.file(m=>{w&&Object.defineProperty(m,"webkitRelativePath",{value:w+m.name}),r.push(m),c+=m.size,u--,g()});else if(d.isDirectory){const m=d.createReader();u++,m.readEntries(C=>{u--;for(const P of C)f(P,w+d.name+"/");g()})}}async function g(){if(u===0){if(r.length===0){h.err(i("empty"));return}a({upload:{...s,status:!0,win:!1}});const d={totalSize:c,sendSize:0,completed:!1},w=r[0].webkitRelativePath?"dir":"file";if(!await R(w))return;r.forEach(C=>{T(C,d,w)})}}for(let d=0;d<o.length;d++){const w=o[d].webkitGetAsEntry();w&&f(w)}}async function R(t){const e=l.getState().upload;return await A.post({api:"login/upload",body:{appType:"doc",fileType:t}})==null?(l.setState({upload:{...e,status:!1}}),!1):!0}function ot({fileMes:t,editing:e,nameEdit:s,rename:a}){const[o,r]=s,[c,u]=e,f=l(d=>d.nowPath),g=d=>{d.key==="Enter"&&(a(t[0],o),u(!1))};return n.jsx(n.Fragment,{children:c?n.jsx("input",{value:o,className:"file-list-text file-list-input",onClick:d=>d.stopPropagation(),onChange:d=>r(d.target.value),onKeyDown:g}):n.jsx("span",{className:(t[1]==="dir"||t[1]==="dir_link"?"dir-text":"file-text")+" file-list-text",title:i("view")+t[0],onClick:d=>{d.stopPropagation(),b(f+"/"+t[0])},children:t[0]})})}function at({name:t,editing:e,newName:s,rename:a}){const[o,r]=e;return n.jsx(n.Fragment,{children:o?n.jsx("button",{className:"save-name file-edit-btn btn",title:i("save"),onClick:c=>{c.stopPropagation(),r(!1),a(t,s)}}):n.jsx("button",{className:"edit-name file-edit-btn btn",title:i("rename"),onClick:c=>{c.stopPropagation(),r(!0)}})})}function it({fileMes:t}){const e=l.getState();return n.jsx("button",{className:"down-btn btn",title:i("download")+":"+t[0],onClick:s=>{s.stopPropagation(),t[1]==="file"||t[1]==="file_link"?W(e.nowPath+"/"+t[0],!0):W(e.nowPath+"/"+t[0],!1)}})}async function W(t,e){if(!await G.normal(i("are_you_sure")))return;l.getState();const a="doc/"+(e?"download_file":"download_folder");y.post({api:a,notice:!0,body:{path:t},success:o=>{lt(B()+a+"/"+o)}})}function lt(t){console.log(t);const e=document.createElement("a");e.href=t,e.download="",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function rt(){const t=l.setState,e=l(s=>s.linkWin);return n.jsx(n.Fragment,{children:n.jsx(S,{showBg:e.show,children:n.jsxs("div",{id:"link-win",children:[n.jsx("button",{id:"close-link-btn",onClick:()=>{t({linkWin:{link:"",show:!1}})},title:i("close"),className:"btn link-win-btn"}),n.jsx("span",{onClick:()=>{dt()},children:e.link}),n.jsx("button",{id:"copy-link-btn",title:i("copy"),className:"btn link-win-btn",onClick:()=>{ct()}})]})})})}function ct(){$(l.getState().linkWin.link)}function dt(){window.open(l.getState().linkWin.link,"_blank")}function ut({name:t}){return n.jsx("button",{className:"btn link-btn",title:i("get_link"),onClick:e=>{e.stopPropagation(),pt(t)}})}function pt(t){const s=l.getState().nowPath+"/"+t;y.post({api:"doc/link",notice:!0,body:{path:s},success:a=>{l.setState({linkWin:{link:encodeURI(window.location.origin+"/"+a),show:!0}})}})}function ft({fileMes:t,selected:e,docClick:s}){const[a,o]=p.useState(!1),[r,c]=p.useState(t[0]),f=l.getState().nowPath+"/"+t[0];return n.jsxs("div",{className:"doc-list main-item "+(e.includes(f)?"doc-list-selected ":"")+(t[1]==="dir"||t[1]==="dir_link"?"dir-item ":"file-item "),onClick:()=>s(f),children:[n.jsx(ot,{fileMes:t,editing:[a,o],nameEdit:[r,c],rename:F}),n.jsx(at,{name:t[0],editing:[a,o],newName:r,rename:F}),n.jsx(it,{fileMes:t}),t[1]==="dir"||t[1]==="dir_link"?null:n.jsx(ut,{name:t[0]})]},"doclist"+t[0])}function F(t,e){if(t==e)return;const s=l.getState(),a=s.nowPath+"/"+t,o=s.nowPath+"/"+e;y.patch({api:"doc/rename",body:{oldpath:a,newpath:o},notice:!0,success:()=>{b(s.nowPath)}})}function mt(){const t=o=>{let r=[...s];r.includes(o)?(r.splice(r.indexOf(o),1),h.normal(i("cancel"))):(r.push(o),h.normal(i("selected")+r.length+i("file"))),a({selected:r})},e=l(o=>o.fileList),s=l(o=>o.selected),a=l(o=>o.setGlobal);return n.jsx(V,{children:e.map(o=>n.jsx(ft,{fileMes:o,selected:s,docClick:t},"doclist"+o[0]))})}function wt(){const t=l(e=>e.nowPath);return n.jsx("div",{id:"show-path",title:t,children:n.jsx("span",{children:t})})}function ht({setCreate:t}){const[e,s]=p.useState(""),a=r=>{const{value:c}=r.target;s(c)},o=r=>{r.key==="Enter"&&(t(!1),z(e))};return n.jsxs(n.Fragment,{children:[n.jsx("input",{placeholder:i("folder_name"),id:"new-dir-input",onChange:a,value:e,onKeyDown:o}),n.jsx("button",{id:"new-dir-save",className:"btn",title:i("save"),onClick:()=>{t(!1),z(e)}})]})}function z(t){if(t.includes("/")||t.includes("\\")){h.err(i("name_not_con")+" / \\");return}else if(t.length===0){h.err(i("folder_name")+i("is_empty"));return}const e=l.getState();y.post({api:"doc/new_folder",notice:!0,body:{folderName:t,nowpath:e.nowPath},success:()=>{b(e.nowPath)}})}function bt({createStatus:t}){const[e,s]=t,a=l(c=>c.upload),o=l(c=>c.nowPath),r=()=>{o!==""&&b("")};return p.useEffect(()=>{v({home:{disable:o==="",name:i("back_main_dir"),fun:r}})},[o]),n.jsxs("div",{id:"top-bar-box",children:[!e&&!a.status&&n.jsx("button",{id:"home-icon",className:"btn",title:i("back_main_dir"),onClick:r}),!e&&!a.status&&n.jsx(wt,{}),a.status&&n.jsxs(n.Fragment,{children:[n.jsx("div",{id:"progress",style:{width:a.percent}}),n.jsx("span",{id:"progress-text",children:a.percent})]}),e&&!a.status&&n.jsx(ht,{setCreate:s})]})}function gt(){const t=l(o=>o.nowPath),e=l(o=>o.parentPath),s=t==="/"||t==="",a=()=>{s||b(e)};return p.useEffect(()=>{v({goUp:{disable:s,name:i("back"),fun:a}})},[s,e]),n.jsx("button",{id:"go-up",className:(s?"go-up-disable":"")+" btn",disabled:s,title:s?"":i("back"),onClick:a})}function xt({createStatus:t}){const[e,s]=t;return n.jsx(n.Fragment,{children:e?n.jsx("button",{id:"new-dir-cancel",className:"btn new-dir-btn",title:i("cancel"),onClick:()=>s(!1)}):n.jsx("button",{id:"new-dir-btn",className:"btn new-dir-btn",title:i("create_folder"),onClick:()=>s(!0)})})}function yt(){const[t,e]=p.useState(!1);return n.jsxs(X,{children:[n.jsx(gt,{}),n.jsx(bt,{createStatus:[t,e]}),n.jsx(xt,{createStatus:[t,e]})]})}function jt({setPaste:t,setCopyList:e}){const s=()=>{const a=l.getState().selected;e([...a]),t({status:!0,type:"copy"}),h.normal(i("copied"))};return p.useEffect(()=>{v({copy:{name:`${i("copy")} (C)`,fun:s}})},[]),p.useEffect(()=>{const a=o=>{(o.ctrlKey||o.metaKey)&&o.key.toLowerCase()==="c"&&(o.preventDefault(),s())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),n.jsx("button",{id:"copy",className:"btn side-btn",title:`${i("copy")} (Ctrl/Cmd + C)`,onClick:s})}function kt(){const t=async()=>{if(!await G.normal(i("are_you_sure")))return;const e=l.getState(),s=e.selected;y.delete({api:"doc/del",notice:!0,body:{dellist:s},success:()=>{b(e.nowPath)}})};return p.useEffect(()=>{v({del:{name:`${i("delete")}(Delete)`,fun:t}})},[]),p.useEffect(()=>{const e=s=>{const a=navigator.platform.toUpperCase().indexOf("MAC")>=0,o=s.metaKey;a&&o&&s.key==="Delete"&&(s.preventDefault(),t()),!a&&s.key==="Delete"&&(s.preventDefault(),t())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),n.jsx("button",{id:"del",className:"btn side-btn",title:`${i("delete")} (Delete / Cmd + Delete)`,onClick:t})}function vt({setPaste:t,setCopyList:e}){const s=()=>{const a=l.getState().selected;e([...a]),t({status:!0,type:"move"})};return p.useEffect(()=>{v({cut:{name:i("cut")+"(X)",fun:s}})},[]),n.jsx("button",{id:"move",className:"btn side-btn",title:i("cut"),onClick:s})}function Ct({paste:t,copyList:e}){const[s,a]=t,o=()=>{s.status&&(a({status:!1}),Pt(s.type,e))};return p.useEffect(()=>{v({paste:{name:`${i("paste")} (V)`,fun:o,disable:!s.status}})},[s.status]),p.useEffect(()=>{const r=c=>{if(!s.status)return;(c.ctrlKey||c.metaKey)&&c.key.toLowerCase()==="v"&&(c.preventDefault(),o())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[s.status,e]),s.status?n.jsx("button",{id:"paste",title:`${i("paste")} (Ctrl/Cmd + V)`,className:"btn side-btn",onClick:o}):null}function Pt(t,e){const s=l.getState();if(e.length===0){h.err(i("no_select_file"));return}const a=s.nowPath;y.post({api:"doc/"+t,notice:!0,body:{copylist:e,nowpath:a},success:()=>{b(a)}})}function St(){const t=()=>{b(l.getState().nowPath)};return p.useEffect(()=>{v({refresh:{name:i("refresh"),fun:t}})},[]),n.jsx("button",{id:"reload",className:"btn side-btn",title:i("refresh"),onClick:t})}function Et(){const t=l.setState,e=l(s=>s.upload);return n.jsx(n.Fragment,{children:n.jsx("button",{id:"upload",className:"btn side-btn",title:i("upload"),onClick:()=>{t({upload:{...e,win:!0}})}})})}function _t(){const[t,e]=p.useState({type:"",status:!1}),[s,a]=p.useState([]);return n.jsxs(J,{children:[n.jsx(Et,{}),n.jsx(St,{}),n.jsx(kt,{}),n.jsx(jt,{setPaste:e,setCopyList:a}),n.jsx(vt,{setPaste:e,setCopyList:a}),n.jsx(Ct,{paste:[t,e],copyList:s})]})}function Nt(){const t=l(s=>s.showBg),e=l(s=>s.loading);return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"loading",id:"list-loading",style:e?{display:"block"}:{display:"none"}}),n.jsx(S,{showBg:t})]})}function Dt(){const t=l.setState,e=l(o=>o.upload),s=l(o=>o.dragWin);l(o=>o.nowPath);const a=async(o,r)=>{t({upload:{...e,status:!0,win:!1}});const c=Array.from(o.target.files);let u={totalSize:0,sendSize:0,completed:!1};await R(r)&&(c.forEach((g,d)=>{u.totalSize+=g.size}),c.forEach((g,d)=>{T(g,u,r)}),o.target.value=null)};return n.jsxs(n.Fragment,{children:[e.win?n.jsxs("div",{id:"upload-opt",children:[n.jsx("button",{id:"close-upload",className:"btn",title:i("close"),onClick:()=>{t({upload:{...e,win:!1}})}}),n.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:o=>a(o,"file")}),n.jsx("input",{type:"file",name:"folder",style:{display:"none"},webkitdirectory:"true",mozdirectory:"true",directory:"true",multiple:!0,onChange:o=>a(o,"dir"),id:"upDir"}),n.jsx("label",{id:"upload-file",className:"btn upload-opt-btn",title:i("upload_file"),htmlFor:"upFile"}),n.jsx("label",{id:"upload-dir",className:"btn upload-opt-btn",title:i("upload_folder"),htmlFor:"upDir"})]}):null,n.jsx(S,{showBg:e.win}),e.status?n.jsx("div",{id:"uploading-back"}):null,n.jsx("div",{id:"drag-win",style:s?{display:"flex"}:{display:"none"},children:n.jsx("div",{})})]})}function Lt(){const[t,e]=p.useState(!1),s=l(o=>o.fileWin),a=p.useRef(null);return p.useEffect(()=>{function o(r){r.key==="Escape"&&t&&e(!1)}return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t]),p.useEffect(()=>{if(!s.url)return;function o(){const c=a.current;if(!c)return;const u=c.contentDocument||c.contentWindow.document;if(!u)return;const f=u.createElement("style");f.textContent=`
            body {
                display:flex;
                justify-content: center;
                align-items: center;
                width: 100%;
                height: 100%;
            }
            body img {
                margin: 0;
                max-height: 100%;
                max-width: 100%;
            }
        `,u.head.appendChild(f)}const r=a.current;r&&(r.onload=o)},[s.url]),s.status?n.jsxs("div",{id:"file-win",children:[t?null:n.jsx("button",{className:"btn close-file-win",title:i("close"),onClick:()=>{l.setState({fileWin:{status:!1,url:"",view:!1}})}}),s.view?n.jsxs("div",{className:"file-view-box",children:[n.jsx("iframe",{ref:a,src:s.url,className:"file-view "+(t?"full-screen":"")}),t?n.jsx("button",{className:"btn ext-full-screen-btn",title:i("zoom_out"),onClick:()=>{e(!1)}}):n.jsxs("div",{className:"file-win-btn-bar",children:[n.jsx("button",{className:"btn file-win-btn refresh-btn",title:i("refresh"),onClick:()=>{a.current&&(a.current.src=a.current.src)}}),n.jsx("button",{className:"btn file-win-btn full-screen-btn",title:i("zoom_in"),onClick:()=>{e(!0)}})]})]}):n.jsx("span",{children:i("not_support_type")})]}):null}function Wt(){return n.jsxs(n.Fragment,{children:[n.jsx(Nt,{}),n.jsx(Dt,{}),n.jsx(Lt,{}),n.jsx(rt,{})]})}function Ft(){const t=l(e=>e.theme);return p.useEffect(()=>(window.addEventListener("dragover",N),window.addEventListener("dragleave",D),window.addEventListener("drop",L),()=>{window.removeEventListener("dragover",N),window.removeEventListener("dragleave",D),window.removeEventListener("drop",L)}),[]),n.jsxs("div",{id:"app",color:t.color.doc,mode:t.mode,children:[n.jsxs(M,{children:[n.jsx(Q,{}),n.jsx(yt,{}),n.jsx(Y,{}),n.jsx(Z,{})]}),n.jsx(Wt,{}),n.jsx(_t,{}),n.jsx(mt,{}),n.jsx(H,{}),n.jsx("div",{className:"wallpaper"})]})}tt();O.createRoot(document.getElementById("root")).render(n.jsx(Ft,{}));
