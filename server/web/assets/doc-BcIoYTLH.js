import{c as O,n as c,j as n,r as b,W as B,T as U,b as W}from"./all-C9ceoJJ-.js";import{P as G,C as R,T as I,S as J,a as H,H as $,G as K,b as A}from"./page-lQh4YlDb.js";const l=O((t,e)=>({userName:window.localStorage.getItem("userName"),token:window.localStorage.getItem("token"),nowPath:"",parentPath:"",fileList:[],uploading:!1,showBg:!1,loading:!1,dragWin:!1,langList:[],fileWin:{status:!1,url:"",view:!1},theme:{mode:"",color:{doc:""},userSelect:""},upload:{win:!1,status:!1,percent:"0%"},selected:[],docUrl:`${window.location.origin}/server/doc/`,setGlobal:o=>{t(s=>({...s,...o}))},replaceGlobal:o=>{t(()=>({...o}))},getGlobal:()=>e()}));function r(t){return l.getState().langList[t]}function q(){G(l.setState,"doc"),w("")}function w(t){const e={file:t},o=l.getState().docUrl;m(!0),fetch(`${o}list`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{m(!1),s.type=="dir"&&l.setState({fileList:s.filelist,nowPath:s.currentFolder,parentPath:s.parentFolder,selected:[]}),s.type=="file"&&l.setState({fileWin:{status:!0,url:s.url,view:s.view}})})}function m(t){l.setState({loading:t,showBg:t})}function D(t,e,o){if(t.size==0){c(r("error")+":"+t.name+r("is_empty"));return}const s=l.getState();s.userName;const a=s.token,i=s.nowPath,d=s.upload,u=l.setState,p=o==="file"?s.docUrl+"upload_file":s.docUrl+"upload_folder",g=Q(t.size),f=Math.ceil(t.size/g);let h=0;function x(){if(e.sendSize>=e.totalSize&&!e.completed){if(u({upload:{...d,status:!1}}),o==="file")e.completed=!0,c(r("op_com")),w(i);else if(o==="dir"){const k=t.webkitRelativePath.split("/")[0];X(k)}return}if(h>=t.size)return;let S=0,P=0;const L=t.slice(h,h+g),v=Math.floor(h/g),j=new FormData;if(j.append("file",L),j.append("fileName",t.name),j.append("totalChunks",f),j.append("currentChunk",v),o==="dir"){const k=t.webkitRelativePath;j.append("relativePath",k)}o==="file"&&j.append("nowpath",i);const y=new XMLHttpRequest;y.open("POST",p,!0),y.setRequestHeader("authorization","Bearer "+a),y.upload.onprogress=function(k){k.lengthComputable&&(e.sendSize=e.sendSize+Math.min(k.loaded,t.size)-S,S=k.loaded,P=Math.floor(e.sendSize/e.totalSize*100)+"%",u({upload:{...d,percent:P}}))},y.onload=function(){if(y.status!=200){y.status==401?c(r("no_per")):c(r("error")+":"+y.status),u({upload:{...d,status:!1}}),e.completed=!0;return}else h+=g,x()},y.onerror=function(){console.error(`Chunk ${v+1} upload encountered error.`),u({upload:!1})},y.send(j)}x()}function X(t){const e=l.getState(),o=e.docUrl+"move_folder";fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,path:e.nowPath})}).then(s=>s.text()).then(s=>{c(r("op_com")),w(e.nowPath)}).catch(s=>{c(s)})}function Q(t){return t<=1024*1048576?10*1048576:t<=5120*1048576&&t>1024*1048576?50*1048576:100*1048576}function C(t){l.setState({dragWin:!0}),t.stopPropagation(),t.preventDefault()}function N(t){l.setState({dragWin:!1}),t.stopPropagation(),t.preventDefault()}function _(t){const o=l.getState().upload,s=l.setState;s({dragWin:!1}),t.stopPropagation(),t.preventDefault();const a=t.dataTransfer.items,i=[];let d=0,u=0;function p(f,h=""){if(f.isFile)u++,f.file(x=>{h&&Object.defineProperty(x,"webkitRelativePath",{value:h+x.name}),i.push(x),d+=x.size,u--,g()});else if(f.isDirectory){const x=f.createReader();u++,x.readEntries(S=>{u--;for(const P of S)p(P,h+f.name+"/");g()})}}async function g(){if(u===0){if(i.length===0){c(r("empty"));return}s({upload:{...o,status:!0,win:!1}});const f={totalSize:d,sendSize:0,completed:!1},h=i[0].webkitRelativePath?"dir":"file";if(!await F(h))return;i.forEach(S=>{D(S,f,h)})}}for(let f=0;f<a.length;f++){const h=a[f].webkitGetAsEntry();h&&p(h)}}async function F(t){l.getState().userName;const e=l.getState().token,o=l.getState().upload,s=window.location.origin+"/server/login/upload",a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${e}`},body:JSON.stringify({appType:"doc",fileType:t})});return a.ok?!0:(a.status==401?c(r("no_per")):c(r("error")+":"+a.status),l.setState({upload:{...o,status:!1}}),!1)}function V({fileMes:t,editMode:e,nameEdit:o,rename:s}){const[a,i]=o,d=l(p=>p.nowPath),u=p=>{p.key==="Enter"&&s(t[0],a)};return n.jsx(n.Fragment,{children:e?n.jsx("input",{value:a,className:"file-list-text file-list-input",onClick:p=>p.stopPropagation(),onChange:p=>i(p.target.value),onKeyDown:u}):n.jsx("span",{className:(t[1]==="dir"||t[1]==="dir_link"?"dir-text":"file-text")+" file-list-text",title:r("view")+t[0],onClick:p=>{p.stopPropagation(),w(d+"/"+t[0])},children:t[0]})})}function Y({name:t,editing:e,newName:o,rename:s}){const[a,i]=e;return n.jsx(n.Fragment,{children:a?n.jsx("button",{className:"save-name file-edit-btn btn",title:r("save"),onClick:d=>{d.stopPropagation(),i(!1),s(t,o)}}):n.jsx("button",{className:"edit-name file-edit-btn btn",title:r("rename"),onClick:d=>{d.stopPropagation(),i(!0)}})})}function Z({fileMes:t}){const e=l.getState();return n.jsx("button",{className:"down-btn btn",title:r("download")+":"+t[0],onClick:o=>{o.stopPropagation(),t[1]==="file"||t[1]==="file_link"?T(e.nowPath+"/"+t[0],!0):T(e.nowPath+"/"+t[0],!1)}})}function T(t,e){if(!confirm(r("are_you_sure")))return;const o=l.getState();m(!0);const s={path:t};let a=e?"download_file":"download_folder";fetch(o.docUrl+a,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+o.token},body:JSON.stringify(s)}).then(i=>{if(i.ok)return i.text();throw i.status==401?c(r("no_per")):c(r("error")+":"+i.status),new Error("HTTP error "+i.status)}).then(i=>{M(o.docUrl+a+"/"+i)}).catch(i=>{console.error("Fetch failed:",i)}).finally(()=>{m(!1)})}function M(t){const e=document.createElement("a");e.href=t,e.download="",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function tt({name:t}){return n.jsx("button",{className:"btn link-btn",title:r("get_link"),onClick:e=>{e.stopPropagation(),et(t)}})}function et(t){const e=l.getState();let o=e.nowPath+"/"+t,s=e.docUrl+"link";const a={path:o};fetch(s,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+e.token},body:JSON.stringify(a)}).then(i=>{if(i.ok)return i.text();throw i.status==401?c(r("no_per")):c(r("error")+":"+i.status),new Error("HTTP error "+i.status)}).then(i=>{nt(encodeURI(window.location.origin+"/"+i))}).catch(i=>{console.error("Fetch failed:",i)}).finally(()=>{m(!1)})}function nt(t){const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),c(r("copy")+" "+r("success"))}catch(o){c(r("error"),o)}document.body.removeChild(e)}function ot({fileMes:t,selected:e,docClick:o}){const[s,a]=b.useState(!1),[i,d]=b.useState(t[0]),p=l.getState().nowPath+"/"+t[0];return n.jsxs("div",{className:"doc-list main-item "+(e.includes(p)?"doc-list-selected ":"")+(t[1]==="dir"||t[1]==="dir_link"?"dir-item ":"file-item "),onClick:()=>o(p),children:[n.jsx(V,{fileMes:t,editMode:s,nameEdit:[i,d],rename:E}),n.jsx(Y,{name:t[0],editing:[s,a],newName:i,rename:E}),n.jsx(Z,{fileMes:t}),t[1]==="dir"||t[1]==="dir_link"?null:n.jsx(tt,{name:t[0]})]},"doclist"+t[0])}function E(t,e){if(t==e)return;const o=l.getState();m(!0);const s=o.nowPath+"/"+t,a=o.nowPath+"/"+e;fetch(o.docUrl+"rename",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+o.token},body:JSON.stringify({oldpath:s,newpath:a})}).then(i=>{i.ok?(c(r("op_com")),w(o.nowPath)):(i.status===401?c(r("no_per")):c(r("error")+":"+i.status),m(!1))})}function st(){const t=a=>{let i=[...o];i.includes(a)?(i.splice(i.indexOf(a),1),c(r("cancel"))):(i.push(a),c(r("selected")+i.length+r("file"))),s({selected:i})},e=l(a=>a.fileList),o=l(a=>a.selected),s=l(a=>a.setGlobal);return n.jsx(R,{children:e.map(a=>n.jsx(ot,{fileMes:a,selected:o,docClick:t},"doclist"+a[0]))})}function at(){const t=l(e=>e.nowPath);return n.jsx("div",{id:"show-path",title:t,children:n.jsx("span",{children:t})})}function it({setCreate:t}){const[e,o]=b.useState(""),s=i=>{const{value:d}=i.target;o(d)},a=i=>{i.key==="Enter"&&(t(!1),z(e))};return n.jsxs(n.Fragment,{children:[n.jsx("input",{placeholder:r("folder_name"),id:"new-dir-input",onChange:s,value:e,onKeyDown:a}),n.jsx("button",{id:"new-dir-save",className:"btn",title:r("save"),onClick:()=>{t(!1),z(e)}})]})}function z(t){if(t.includes("/")||t.includes("\\")){c(r("name_not_con")+" / \\");return}else if(t.length===0){c(r("folder_name")+r("is_empty"));return}const e=l.getState(),o={folderName:t,nowpath:e.nowPath};m(!0),fetch(`${e.docUrl}new_folder`,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json",authorization:"Bearer "+e.token}}).then(s=>{if(!s.ok){s.status===401?c(r("no_per")):c(r("error")+":"+s.status),m(!1);return}c(r("op_com")),w(e.nowPath)})}function rt({createStatus:t}){const[e,o]=t,s=l(i=>i.upload),a=l(i=>i.nowPath);return n.jsxs("div",{id:"top-bar-box",children:[!e&&!s.status&&n.jsx("button",{id:"home-icon",className:"btn",title:r("back_main_dir"),onClick:()=>{a!=""&&w("")}}),!e&&!s.status&&n.jsx(at,{}),s.status&&n.jsxs(n.Fragment,{children:[n.jsx("div",{id:"progress",style:{width:s.percent}}),n.jsx("span",{id:"progress-text",children:s.percent})]}),e&&!s.status&&n.jsx(it,{setCreate:o})]})}function lt(){const t=l(s=>s.nowPath),e=l(s=>s.parentPath),o=t==="/"||t==="";return n.jsx("button",{id:"go-up",className:(o?"go-up-disable":"")+" btn",disabled:o,title:o?"":r("back"),onClick:()=>{o||w(e)}})}function ct({createStatus:t}){const[e,o]=t;return n.jsx(n.Fragment,{children:e?n.jsx("button",{id:"new-dir-cancel",className:"btn new-dir-btn",title:r("cancel"),onClick:()=>o(!1)}):n.jsx("button",{id:"new-dir-btn",className:"btn new-dir-btn",title:r("create_folder"),onClick:()=>o(!0)})})}function dt(){const[t,e]=b.useState(!1);return n.jsxs(I,{children:[n.jsx(lt,{}),n.jsx(rt,{createStatus:[t,e]}),n.jsx(ct,{createStatus:[t,e]})]})}function ut({setPaste:t,setCopyList:e}){return n.jsx("button",{id:"copy",className:"btn side-btn",title:r("copy"),onClick:()=>{const o=l.getState().selected;e([...o]),t({status:!0,type:"copy"})}})}function pt(){return n.jsx("button",{id:"del",className:"btn side-btn",title:r("delete"),onClick:()=>ft()})}function ft(){if(confirm(r("are_you_sure"))){m(!0);const t=l.getState();t.userName;const e=t.token,o=t.selected,s=t.docUrl+"del";fetch(s,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+e},body:JSON.stringify({dellist:o})}).then(a=>{a.ok?(c(r("op_com")),w(t.nowPath)):(a.status==401?c(r("no_per")):c(r("error")+":"+a.status),m(!1))})}}function ht({setPaste:t,setCopyList:e}){return n.jsx("button",{id:"move",className:"btn side-btn",title:r("cut"),onClick:()=>{const o=l.getState().selected;e([...o]),t({status:!0,type:"move"})}})}function mt({paste:t,copyList:e}){const[o,s]=t;return o.status?n.jsx("button",{id:"paste",title:r("paste"),className:"btn side-btn",onClick:()=>{s({status:!1}),gt(o.type,e)}}):n.jsx(n.Fragment,{})}function gt(t,e){const o=l.getState();if(e.length==0){c(r("no_select_file"));return}m(!0);const s=o.token;o.userName;const a=o.nowPath,i={copylist:e,nowpath:a};let d;switch(t){case"copy":d=o.docUrl+"copy";break;case"move":d=o.docUrl+"move";break}fetch(d,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+s},body:JSON.stringify(i)}).then(u=>{u.ok?(c(r("op_com")),w(a)):(u.status==401?c(r("no_per")):c(r("error")+":"+u.status),m(!1))})}function bt(){return n.jsx("button",{id:"reload",className:"btn side-btn",title:r("refresh"),onClick:()=>{w(l.getState().nowPath)}})}function wt(){const t=l.setState,e=l(o=>o.upload);return n.jsx(n.Fragment,{children:n.jsx("button",{id:"upload",className:"btn side-btn",title:r("upload"),onClick:()=>{t({upload:{...e,win:!0}})}})})}function xt(){const[t,e]=b.useState({type:"",status:!1}),[o,s]=b.useState([]);return n.jsxs(J,{children:[n.jsx(wt,{}),n.jsx(bt,{}),n.jsx(pt,{}),n.jsx(ut,{setPaste:e,setCopyList:s}),n.jsx(ht,{setPaste:e,setCopyList:s}),n.jsx(mt,{paste:[t,e],copyList:o})]})}function yt(){const t=l(o=>o.showBg),e=l(o=>o.loading);return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"loading",id:"list-loading",style:e?{display:"block"}:{display:"none"}}),n.jsx(B,{showBg:t})]})}function jt(){const t=l.setState,e=l(a=>a.upload),o=l(a=>a.dragWin);l(a=>a.nowPath);const s=async(a,i)=>{t({upload:{...e,status:!0,win:!1}});const d=Array.from(a.target.files);let u={totalSize:0,sendSize:0,completed:!1};await F(i)&&(d.forEach((g,f)=>{u.totalSize+=g.size}),d.forEach((g,f)=>{D(g,u,i)}),a.target.value=null)};return n.jsxs(n.Fragment,{children:[e.win?n.jsxs("div",{id:"upload-opt",children:[n.jsx("button",{id:"close-upload",className:"btn",title:r("close"),onClick:()=>{t({upload:{...e,win:!1}})}}),n.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:a=>s(a,"file")}),n.jsx("input",{type:"file",name:"folder",style:{display:"none"},webkitdirectory:"true",mozdirectory:"true",directory:"true",multiple:!0,onChange:a=>s(a,"dir"),id:"upDir"}),n.jsx("label",{id:"upload-file",className:"btn upload-opt-btn",title:r("upload_file"),htmlFor:"upFile"}),n.jsx("label",{id:"upload-dir",className:"btn upload-opt-btn",title:r("upload_folder"),htmlFor:"upDir"})]}):null,n.jsx(B,{showBg:e.win}),e.status?n.jsx("div",{id:"uploading-back"}):null,n.jsx("div",{id:"drag-win",style:o?{display:"flex"}:{display:"none"},children:n.jsx("div",{})})]})}function kt(){const[t,e]=b.useState(!1),o=l(a=>a.fileWin),s=b.useRef(null);return b.useEffect(()=>{function a(i){i.key==="Escape"&&t&&e(!1)}return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[t]),b.useEffect(()=>{if(!o.url)return;function a(){const d=s.current;if(!d)return;const u=d.contentDocument||d.contentWindow.document;if(!u)return;const p=u.createElement("style");p.textContent=`
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
            }
            body img {
                margin: 0;
                max-height: 100%;
                max-width: 100%;
            }
        `,u.head.appendChild(p)}const i=s.current;i&&(i.onload=a)},[o.url]),o.status?n.jsxs("div",{id:"file-win",children:[t?null:n.jsx("button",{className:"btn close-file-win",title:r("close"),onClick:()=>{l.setState({fileWin:{status:!1,url:"",view:!1}})}}),o.view?n.jsxs("div",{className:"file-view-box",children:[n.jsx("iframe",{ref:s,src:o.url,className:"file-view "+(t?"full-screen":"")}),t?n.jsx("button",{className:"btn ext-full-screen-btn",title:r("zoom_out"),onClick:()=>{e(!1)}}):n.jsxs("div",{className:"file-win-btn-bar",children:[n.jsx("button",{className:"btn file-win-btn refresh-btn",title:r("refresh"),onClick:()=>{s.current&&(s.current.src=s.current.src)}}),n.jsx("button",{className:"btn file-win-btn full-screen-btn",title:r("zoom_in"),onClick:()=>{e(!0)}})]})]}):n.jsx("span",{children:r("not_support_type")})]}):null}function St(){return n.jsxs(n.Fragment,{children:[n.jsx(yt,{}),n.jsx(jt,{}),n.jsx(kt,{})]})}function Pt(){const t=l(e=>e.theme);return b.useEffect(()=>(q(),window.addEventListener("dragover",C),window.addEventListener("dragleave",N),window.addEventListener("drop",_),()=>{window.removeEventListener("dragover",C),window.removeEventListener("dragleave",N),window.removeEventListener("drop",_)}),[]),n.jsxs("div",{id:"app",color:t.color.doc,mode:t.mode,children:[n.jsxs(H,{children:[n.jsx($,{}),n.jsx(dt,{}),n.jsx(K,{}),n.jsx(A,{})]}),n.jsx(St,{}),n.jsx(xt,{}),n.jsx(st,{}),n.jsx(U,{}),n.jsx("div",{className:"wallpaper"})]})}W.createRoot(document.getElementById("root")).render(n.jsx(Pt,{}));
