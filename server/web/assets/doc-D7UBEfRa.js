import{c as q,i as N,A as j,S as U,f as V,n as x,h as l,v as X,w as R,j as s,k as u,q as I,W as _,x as J,r as f,o as S,F,u as M,P as Q,t as Y}from"./all-DWz_aFjb.js";import{P as Z,C as ee,T as te,S as ne,a as se,H as oe,G as ie,b as ae}from"./page-D4VYC8C6.js";import{b as le,d as re}from"./path-BEfRmj8-.js";import{a as C}from"./page-C3qsDjGe.js";const r=q((e,t)=>({nowPath:"",parentPath:"",fileList:[],uploading:!1,linkWin:{show:!1,link:""},showBg:!1,loading:!1,dragWin:!1,fileWin:{status:!1,url:"",view:!1,data:null,currentType:"",path:""},upload:{win:!1,status:!1,percent:"0%"},selected:[],setGlobal:n=>{e(o=>({...o,...n}))},replaceGlobal:n=>{e(()=>({...n}))},getGlobal:()=>t()}));function ce(){Z("doc");const t=N().doc.list.path;b(t)}function b(e){const t=N(),n=t.doc.list.path;j.post({api:"doc/list",body:{file:e},success:o=>{pe(!1),o.type=="dir"&&(r.setState({fileList:o.filelist,nowPath:o.currentFolder,parentPath:o.parentFolder,selected:[]}),n!=""&&(t.doc.list.path="",U(t))),o.type=="file"&&K(o,e)}})}function K(e,t){ue(t,e.innerApp[0],e.url);const n=e.innerApp.length!=0;r.setState({fileWin:{status:!0,url:de(e.innerApp[0],e.url),view:n,innerApp:e.innerApp,currentType:n?e.innerApp[0]:"",data:e,path:t}})}function de(e,t){let n;switch(e){case"doc":n=C(t);break;case"img":n=C("pic");break;case"vid":n=C("pic");break;case"not":n=C("not");break;default:n="";break}return n}function ue(e,t,n){const o=N(),i=o.doc.list.path;let a={source:"doc",enable:!0,name:le(e),path:e};t=="img"||t=="vid"?(t=="img"&&(a.media="img"),t=="vid"&&(a.media="vid"),a.url=C(re(n)+"/"),o.pic.inner=a):t=="not"?(a.path=e,o.not.inner=a):(a.source="",a.enable=!1,a.name=""),U(o),i!=""&&b("")}function pe(e){r.setState({loading:e,showBg:e})}function $(e,t,n){if(e.size==0){x.err(l("error")+":"+e.name+l("is_empty"));return}const o=r.getState(),i=X(),a=o.nowPath,c=o.upload,p=r.setState,m=R()+"doc/",h=n==="file"?m+"upload_file":m+"upload_folder",d=me(e.size),g=Math.ceil(e.size/d);let w=0;function P(){if(t.sendSize>=t.totalSize&&!t.completed){if(p({upload:{...c,status:!1}}),n==="file")t.completed=!0,x.normal(l("op_com")),b(a);else if(n==="dir"){const v=e.webkitRelativePath.split("/")[0];fe(v)}return}if(w>=e.size)return;let E=0,D=0;const O=e.slice(w,w+d),L=Math.floor(w/d),y=new FormData;if(y.append("file",O),y.append("fileName",e.name),y.append("totalChunks",g),y.append("currentChunk",L),n==="dir"){const v=e.webkitRelativePath;y.append("relativePath",v)}n==="file"&&y.append("nowpath",a);const k=new XMLHttpRequest;k.open("POST",h,!0),k.setRequestHeader("authorization","Bearer "+i),k.upload.onprogress=function(v){v.lengthComputable&&(t.sendSize=t.sendSize+Math.min(v.loaded,e.size)-E,E=v.loaded,D=Math.floor(t.sendSize/t.totalSize*100)+"%",p({upload:{...c,percent:D}}))},k.onload=function(){if(k.status!=200){k.status==401?x.err(l("no_per")):x.err(l("error")+":"+k.status),p({upload:{...c,status:!1}}),t.completed=!0;return}else w+=d,P()},k.onerror=function(){console.error(`Chunk ${L+1} upload encountered error.`),p({upload:!1})},k.send(y)}P()}function fe(e){const t=r.getState();j.post({api:"doc/move_folder",body:{name:e,path:t.nowPath},success:()=>{b(t.nowPath)}})}function me(e){return e<=100*1048576?2*1048576:e<=1024*1048576?5*1048576:e<=10240*1048576?10*1048576:20*1048576}function W(e){r.setState({dragWin:!0}),e.stopPropagation(),e.preventDefault()}function z(e){r.setState({dragWin:!1}),e.stopPropagation(),e.preventDefault()}function A(e){const n=r.getState().upload,o=r.setState;o({dragWin:!1}),e.stopPropagation(),e.preventDefault();const i=e.dataTransfer.items,a=[];let c=0,p=0;function m(d,g=""){if(d.isFile)p++,d.file(w=>{g&&Object.defineProperty(w,"webkitRelativePath",{value:g+w.name}),a.push(w),c+=w.size,p--,h()});else if(d.isDirectory){const w=d.createReader();p++,w.readEntries(P=>{p--;for(const E of P)m(E,g+d.name+"/");h()})}}async function h(){if(p===0){if(a.length===0){x.err(l("empty"));return}o({upload:{...n,status:!0,win:!1}});const d={totalSize:c,sendSize:0,completed:!1},g=a[0].webkitRelativePath?"dir":"file";if(!await H(g))return;a.forEach(P=>{$(P,d,g)})}}for(let d=0;d<i.length;d++){const g=i[d].webkitGetAsEntry();g&&m(g)}}async function H(e){const t=r.getState().upload;return await V.post({api:"login/upload",body:{appType:"doc",fileType:e}})==null?(r.setState({upload:{...t,status:!1}}),!1):!0}function he({fileMes:e,editing:t,nameEdit:n,rename:o}){const[i,a]=n,[c,p]=t,m=r(d=>d.nowPath),h=d=>{d.key==="Enter"&&(o(e[0],i),p(!1))};return s.jsx(s.Fragment,{children:c?s.jsx("input",{value:i,className:"file-list-text file-list-input",onClick:d=>d.stopPropagation(),onChange:d=>a(d.target.value),onKeyDown:h}):s.jsx("span",{className:(e[1]==="dir"||e[1]==="dir_link"?"dir-text":"file-text")+" file-list-text",title:l("view")+e[0],onClick:d=>{d.stopPropagation(),b(m+"/"+e[0])},children:e[0]})})}function we({name:e,editing:t,newName:n,rename:o}){const[i,a]=t;return s.jsx(s.Fragment,{children:i?s.jsx("button",{className:"file-edit-btn btn",title:l("save"),onClick:c=>{c.stopPropagation(),a(!1),o(e,n)},children:u("save")}):s.jsx("button",{className:"edit-name file-edit-btn btn",title:l("rename"),onClick:c=>{c.stopPropagation(),a(!0)},children:u("edit")})})}function be({fileMes:e}){const t=r.getState();return s.jsx("button",{className:"down-btn btn",title:l("download")+":"+e[0],onClick:n=>{n.stopPropagation(),e[1]==="file"||e[1]==="file_link"?B(t.nowPath+"/"+e[0],!0):B(t.nowPath+"/"+e[0],!1)},children:u("download")})}async function B(e,t){if(!await I.normal(l("are_you_sure")))return;r.getState();const o="doc/"+(t?"download_file":"download_folder");j.post({api:o,notice:!0,body:{path:e},success:i=>{ge(R()+o+"/"+i)}})}function ge(e){console.log(e);const t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function xe(){const e=r.setState,t=r(n=>n.linkWin);return s.jsx(s.Fragment,{children:s.jsx(_,{showBg:t.show,children:s.jsxs("div",{id:"link-win",children:[s.jsx("button",{id:"close-link-btn",onClick:()=>{e({linkWin:{link:"",show:!1}})},title:l("close"),className:"btn link-win-btn",children:u("no")}),s.jsx("span",{onClick:()=>{je()},children:t.link}),s.jsx("button",{id:"copy-link-btn",title:l("copy"),className:"btn link-win-btn",onClick:()=>{ke()},children:u("copy")})]})})})}function ke(){J(r.getState().linkWin.link)}function je(){window.open(r.getState().linkWin.link,"_blank")}function ye({name:e}){return s.jsx("button",{className:"btn link-btn",title:l("get_link"),onClick:t=>{t.stopPropagation(),ve(e)},children:u("link")})}function ve(e){const n=r.getState().nowPath+"/"+e;j.post({api:"doc/link",notice:!0,body:{path:n},success:o=>{r.setState({linkWin:{link:encodeURI(window.location.origin+"/"+o),show:!0}})}})}function Se({fileMes:e,selected:t,docClick:n}){const[o,i]=f.useState(!1),[a,c]=f.useState(e[0]),m=r.getState().nowPath+"/"+e[0];return s.jsxs("div",{className:"doc-list main-item "+(t.includes(m)?"doc-list-selected ":"")+(e[1]==="dir"||e[1]==="dir_link"?"dir-item ":"file-item "),onClick:()=>n(m),children:[s.jsx(he,{fileMes:e,editing:[o,i],nameEdit:[a,c],rename:T}),s.jsx(we,{name:e[0],editing:[o,i],newName:a,rename:T}),s.jsx(be,{fileMes:e}),e[1]==="dir"||e[1]==="dir_link"?null:s.jsx(ye,{name:e[0]})]},"doclist"+e[0])}function T(e,t){if(e==t)return;const n=r.getState(),o=n.nowPath+"/"+e,i=n.nowPath+"/"+t;j.patch({api:"doc/rename",body:{oldpath:o,newpath:i},notice:!0,success:()=>{b(n.nowPath)}})}function Pe(){const e=i=>{let a=[...n];a.includes(i)?(a.splice(a.indexOf(i),1),x.normal(l("cancel"))):(a.push(i),x.normal(l("selected")+a.length+l("file"))),o({selected:a})},t=r(i=>i.fileList),n=r(i=>i.selected),o=r(i=>i.setGlobal);return s.jsx(ee,{children:t.map(i=>s.jsx(Se,{fileMes:i,selected:n,docClick:e},"doclist"+i[0]))})}function Ce(){const e=r(t=>t.nowPath);return s.jsx("div",{id:"show-path",title:e,children:s.jsx("span",{children:e})})}function Ee({setCreate:e}){const[t,n]=f.useState(""),o=a=>{const{value:c}=a.target;n(c)},i=a=>{a.key==="Enter"&&(e(!1),G(t))};return s.jsxs(s.Fragment,{children:[s.jsx("input",{placeholder:l("folder_name"),id:"new-dir-input",onChange:o,value:t,onKeyDown:i}),s.jsx("button",{id:"new-dir-save",className:"btn",title:l("save"),onClick:()=>{e(!1),G(t)},children:u("save")})]})}function G(e){if(e.includes("/")||e.includes("\\")){x.err(l("name_not_con")+" / \\");return}else if(e.length===0){x.err(l("folder_name")+l("is_empty"));return}const t=r.getState();j.post({api:"doc/new_folder",notice:!0,body:{folderName:e,nowpath:t.nowPath},success:()=>{b(t.nowPath)}})}function Ne({createStatus:e}){const[t,n]=e,o=r(c=>c.upload),i=r(c=>c.nowPath),a=()=>{i!==""&&b("")};return f.useEffect(()=>{S({home:{disable:i==="",name:l("back_main_dir"),fun:a}})},[i]),s.jsxs("div",{id:"top-bar-box",children:[!t&&!o.status&&s.jsx("button",{id:"home-icon",className:"btn",title:l("back_main_dir"),onClick:a,children:u("home")}),!t&&!o.status&&s.jsx(Ce,{}),o.status&&s.jsxs(s.Fragment,{children:[s.jsx("div",{id:"progress",style:{width:o.percent}}),s.jsx("span",{id:"progress-text",children:o.percent})]}),t&&!o.status&&s.jsx(Ee,{setCreate:n})]})}function _e(){const e=r(i=>i.nowPath),t=r(i=>i.parentPath),n=e==="/"||e==="",o=()=>{n||b(t)};return f.useEffect(()=>{S({goUp:{disable:n,name:l("back"),fun:o}})},[n,t]),s.jsx("button",{id:"go-up",className:(n?"go-up-disable":"")+" btn",disabled:n,title:n?"":l("back"),onClick:o,children:u("goUp")})}function De({createStatus:e}){const[t,n]=e;return s.jsx(s.Fragment,{children:t?s.jsx("button",{className:"btn new-dir-btn",title:l("cancel"),onClick:()=>n(!1),children:u("no")}):s.jsx("button",{id:"new-dir-btn",className:"btn new-dir-btn",title:l("create_folder"),onClick:()=>n(!0),children:u("addFolder")})})}function Le(){const[e,t]=f.useState(!1);return s.jsxs(te,{children:[s.jsx(_e,{}),s.jsx(Ne,{createStatus:[e,t]}),s.jsx(De,{createStatus:[e,t]})]})}function Fe({setPaste:e,setCopyList:t}){const n=()=>{const o=r.getState().selected;t([...o]),e({status:!0,type:"copy"}),x.normal(l("copied"))};return f.useEffect(()=>{S({copy:{name:`${l("copy")} (C)`,fun:n}})},[]),f.useEffect(()=>{const o=i=>{(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="c"&&(i.preventDefault(),n())};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[]),s.jsx("button",{className:"btn side-btn",title:`${l("copy")} (Ctrl/Cmd + C)`,onClick:n,children:u("copy")})}function We(){const e=async()=>{if(!await I.normal(l("are_you_sure")))return;const t=r.getState(),n=t.selected;j.delete({api:"doc/del",notice:!0,body:{dellist:n},success:()=>{b(t.nowPath)}})};return f.useEffect(()=>{S({del:{name:`${l("delete")}(Delete)`,fun:e}})},[]),f.useEffect(()=>{const t=n=>{const o=navigator.platform.toUpperCase().indexOf("MAC")>=0,i=n.metaKey;o&&i&&n.key==="Delete"&&(n.preventDefault(),e()),!o&&n.key==="Delete"&&(n.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),s.jsx("button",{className:"btn side-btn",title:`${l("delete")} (Delete / Cmd + Delete)`,onClick:e,children:u("bin")})}function ze({setPaste:e,setCopyList:t}){const n=()=>{const o=r.getState().selected;t([...o]),e({status:!0,type:"move"})};return f.useEffect(()=>{S({cut:{name:l("cut")+"(X)",fun:n}})},[]),s.jsx("button",{className:"btn side-btn",title:l("cut"),onClick:n,children:u("cut")})}function Ae({paste:e,copyList:t}){const[n,o]=e,i=()=>{n.status&&(o({status:!1}),Be(n.type,t))};return f.useEffect(()=>{S({paste:{name:`${l("paste")} (V)`,fun:i,disable:!n.status}})},[n.status]),f.useEffect(()=>{const a=c=>{if(!n.status)return;(c.ctrlKey||c.metaKey)&&c.key.toLowerCase()==="v"&&(c.preventDefault(),i())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[n.status,t]),n.status?s.jsx("button",{id:"paste",title:`${l("paste")} (Ctrl/Cmd + V)`,className:"btn side-btn",onClick:i,children:u("paste")}):null}function Be(e,t){const n=r.getState();if(t.length===0){x.err(l("no_select_file"));return}const o=n.nowPath;j.post({api:"doc/"+e,notice:!0,body:{copylist:t,nowpath:o},success:()=>{b(o)}})}function Te(){const e=()=>{b(r.getState().nowPath)};return f.useEffect(()=>{S({refresh:{name:l("refresh"),fun:e}})},[]),s.jsx("button",{className:"btn side-btn",title:l("refresh"),onClick:e,children:u("load")})}function Ge(){const e=r.setState,t=r(n=>n.upload);return s.jsx(s.Fragment,{children:s.jsx("button",{className:"btn side-btn",title:l("upload"),onClick:()=>{e({upload:{...t,win:!0}})},children:u("upload")})})}function Ue(){const[e,t]=f.useState({type:"",status:!1}),[n,o]=f.useState([]);return s.jsxs(ne,{children:[s.jsx(Ge,{}),s.jsx(Te,{}),s.jsx(We,{}),s.jsx(Fe,{setPaste:t,setCopyList:o}),s.jsx(ze,{setPaste:t,setCopyList:o}),s.jsx(Ae,{paste:[e,t],copyList:n})]})}function Re(){const e=r(n=>n.showBg),t=r(n=>n.loading);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loading",id:"list-loading",style:t?{display:"block"}:{display:"none"}}),s.jsx(_,{showBg:e})]})}function Ie(){const e=r.setState,t=r(i=>i.upload),n=r(i=>i.dragWin);r(i=>i.nowPath);const o=async(i,a)=>{e({upload:{...t,status:!0,win:!1}});const c=Array.from(i.target.files);let p={totalSize:0,sendSize:0,completed:!1};await H(a)&&(c.forEach((h,d)=>{p.totalSize+=h.size}),c.forEach((h,d)=>{$(h,p,a)}),i.target.value=null)};return s.jsxs(s.Fragment,{children:[t.win?s.jsxs("div",{id:"upload-opt",children:[s.jsx("button",{id:"close-upload",className:"btn",title:l("close"),onClick:()=>{e({upload:{...t,win:!1}})},children:u("no")}),s.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:i=>o(i,"file")}),s.jsx("input",{type:"file",name:"folder",style:{display:"none"},webkitdirectory:"true",mozdirectory:"true",directory:"true",multiple:!0,onChange:i=>o(i,"dir"),id:"upDir"}),s.jsx("label",{id:"upload-file",className:"btn upload-opt-btn",title:l("upload_file"),htmlFor:"upFile",children:F("file")}),s.jsx("label",{id:"upload-dir",className:"btn upload-opt-btn",title:l("upload_folder"),htmlFor:"upDir",children:F("doc")})]}):null,s.jsx(_,{showBg:t.win}),t.status?s.jsx("div",{id:"uploading-back"}):null,s.jsx("div",{id:"drag-win",style:n?{display:"flex"}:{display:"none"},children:s.jsx("div",{children:u("upload")})})]})}function Ke(){const[e,t]=f.useState(!1),n=r(a=>a.fileWin),o=f.useRef(null);f.useEffect(()=>{function a(c){c.key==="Escape"&&e&&t(!1)}return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e]),f.useEffect(()=>{if(!n.url)return;function a(){const p=o.current;if(!p)return;const m=p.contentDocument||p.contentWindow.document;if(!m)return;const h=m.createElement("style");h.textContent=`
            body {
                display:flex;
                justify-content: center;
                align-items: center;
                width: 100%;
                height: 100%;
            }
            body img {
                margin: 0;
                max-height: 100%;
                max-width: 100%;
            }
        `,m.head.appendChild(h)}const c=o.current;c&&(c.onload=a)},[n.url]);const i=()=>{[n.data.innerApp[0],n.data.innerApp[1]]=[n.data.innerApp[1],n.data.innerApp[0]],r.setState({fileWin:{...n}}),K(n.data,n.path)};return n.status?s.jsxs("div",{id:"file-win",children:[e?null:s.jsx("button",{className:"btn close-file-win",title:l("close"),onClick:()=>{r.setState({fileWin:{status:!1,url:"",view:!1}})},children:u("no")}),n.view?s.jsxs("div",{className:"file-view-box",children:[s.jsx("iframe",{ref:o,src:n.url,className:"file-view "+(e?"full-screen":"")},n.url),e?s.jsx("button",{className:"btn ext-full-screen-btn",title:l("zoom_out"),onClick:()=>{t(!1)},children:u("minimize")}):s.jsxs("div",{className:"file-win-btn-bar",children:[n.data.innerApp.length>1?s.jsx(s.Fragment,{children:n.currentType=="not"?s.jsx("button",{className:"btn file-win-btn",title:l("view"),onClick:i,children:u("eye")}):s.jsx("button",{className:"btn file-win-btn",title:l("edit"),onClick:i,children:u("edit")})}):null,s.jsx("button",{className:"btn file-win-btn",title:l("refresh"),disabled:n.currentType!="doc",onClick:()=>{o.current&&(o.current.src=o.current.src)},children:u("load")}),s.jsx("button",{className:"btn file-win-btn",title:l("zoom_in"),onClick:()=>{t(!0)},children:u("maximize")})]})]}):s.jsx("span",{children:l("not_support_type")})]}):null}function $e(){return s.jsxs(s.Fragment,{children:[s.jsx(Re,{}),s.jsx(Ie,{}),s.jsx(Ke,{}),s.jsx(xe,{})]})}function He(){const e=M(t=>t.theme);return f.useEffect(()=>(window.addEventListener("dragover",W),window.addEventListener("dragleave",z),window.addEventListener("drop",A),()=>{window.removeEventListener("dragover",W),window.removeEventListener("dragleave",z),window.removeEventListener("drop",A)}),[]),s.jsxs("div",{id:"app",color:e.color.doc,mode:e.mode,children:[s.jsxs(se,{children:[s.jsx(oe,{}),s.jsx(Le,{}),s.jsx(ie,{}),s.jsx(ae,{})]}),s.jsx($e,{}),s.jsx(Ue,{}),s.jsx(Pe,{}),s.jsx(Q,{}),s.jsx("div",{className:"wallpaper"})]})}ce();Y.createRoot(document.getElementById("root")).render(s.jsx(He,{}));
