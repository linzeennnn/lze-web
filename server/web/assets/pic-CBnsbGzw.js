import{c as T,A as M,n as v,f as m,o as A,p as I,e as U,r as x,j as e,W as R,P as $,l as H,m as V}from"./all-B5MRgsKL.js";import{P as X,C as Y,T as q,S as O,a as K,H as J,G as Q,b as Z}from"./page-DHHrF6de.js";const o=T((t,n)=>({nowPath:"",parentPath:"",imgList:[],vidList:[],dirList:[],uploading:!1,showBg:!1,pageNum:1,theme:{mode:"",color:{pic:""},userSelect:""},loading:!1,dragWin:!1,imgPage:!0,mediaWin:{status:!1,img:!0,path:window.location.origin+"/file/Pictures/",index:0},upload:{status:!1,percent:"0%"},setGlobal:i=>{t(a=>({...a,...i}))},replaceGlobal:i=>{t(()=>({...i}))},getGlobal:()=>n()}));function ee(){X(o.setState,"pic"),S("")}function S(t,n){M.post({api:"pic/list",body:{folder:t},success:i=>{let a=[],s=[],r=[],c=[],l=[];i.filelist.forEach(u=>{u[1]=="dir"||u[1]=="dir_link"?a.push(u[0]):(u[1]=="file"||u[1]=="file_link")&&(u[2]=="img"&&(c.length<12||(s.push(c),c=[]),c.push(u[0])),u[2]=="vid"&&(l.length<12||(r.push(l),l=[]),l.push(u[0])))}),c.length>0&&s.push(c),l.length>0&&r.push(l),o.setState({dirList:a,imgList:s,vidList:r,nowPath:i.currentFolder,parentPath:i.parentFolder,selected:[],imgPage:!n,pageNum:1})}})}function z(t,n){if(t.size==0){v.err(t.name+m("is_empty"));return}let i;const a=o.getState(),s=A(),r=a.nowPath,c=a.upload,l=o.setState,u=["jpg","jpeg","png","gif","webp","bmp","svg","ico","apng","avif"],p=["mp4","webm","ogg","ogv","mov","m4v","avi","3gp","mkv"],f=t.name.split(".").pop().toLowerCase();if(u.includes(f))i=!1,l({imgPage:!0});else if(p.includes(f))i=!0,l({imgPage:!1});else{v.err(t.name+":"+m("not_support_type")),l({upload:{...c,status:!1}});return}const j=I()+"pic/upload",b=te(t.size),L=Math.ceil(t.size/b);let P=0;function k(){if(n.sendSize>=n.totalSize){l({upload:{...c,status:!1}}),v.normal(m("op_com")),S(r,i);return}if(P>=t.size)return;let d="",g=0;const w=t.slice(P,P+b),N=Math.floor(P/b),y=new FormData;y.append("file",w),y.append("fileName",t.name),y.append("totalChunks",L),y.append("currentChunk",N),y.append("nowpath",r);const h=new XMLHttpRequest;h.open("POST",j,!0),h.setRequestHeader("authorization","Bearer "+s),h.upload.onprogress=function(C){C.lengthComputable&&(n.sendSize=n.sendSize+Math.min(C.loaded,t.size)-g,g=C.loaded,d=Math.floor(n.sendSize/n.totalSize*100)+"%",l({upload:{...c,percent:d}}))},h.onload=function(){if(h.status!==200){h.status===401?v.err(m("no_per")):v.err(m("error")+":"+h.status+h.responseText),l({upload:{...c,status:!1}});return}P+=b,k()},h.onerror=function(){console.error(`Chunk ${N+1} upload encountered error.`),l({upload:!1})},h.send(y)}k()}function te(t){return t<=1024*1048576?10*1048576:t<=5120*1048576&&t>1024*1048576?50*1048576:100*1048576}function E(t){o.setState({dragWin:!0}),t.stopPropagation(),t.preventDefault()}function _(t){o.setState({dragWin:!1}),t.stopPropagation(),t.preventDefault()}function W(t){const i=o.getState().upload,a=o.setState;a({dragWin:!1}),t.stopPropagation(),t.preventDefault();const s=t.dataTransfer.items,r=[];let c=0,l=0;function u(f){const j=f.webkitGetAsEntry();if(j){if(j.isDirectory){v.err(m("not_support_type"));return}j.isFile&&(l++,j.file(b=>{r.push(b),c+=b.size,l--,p()}))}}async function p(){if(l===0){if(r.length===0){v.err(m("empty"));return}a({upload:{...i,status:!0,win:!1}});const f={totalSize:c,sendSize:0};if(!await G())return;r.forEach(b=>{z(b,f)})}}for(let f=0;f<s.length;f++)u(s[f])}async function G(){const t=o.getState().upload;return await U.post({api:"login/upload",body:{appType:"pic",fileType:""}})==null?(o.setState({upload:{...t,status:!1}}),!1):!0}function D({url:t,name:n,type:i,index:a}){const[s,r]=x.useState(!0),[c,l]=x.useState(!1);return x.useEffect(()=>{r(!0),l(!1)},[t]),x.useEffect(()=>{let u;return c&&(u=setTimeout(()=>{r(!1)},100)),()=>clearTimeout(u)},[c]),e.jsxs("div",{className:"pic-item main-item",title:n,onClick:()=>{ne(t,i,a)},children:[s&&e.jsx("div",{className:"media-loading loading"}),i==="img"?e.jsx("img",{src:t+n,loading:"lazy",onLoad:()=>{l(!0)}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"play-icon btn"}),e.jsx("video",{src:t+n,onLoadedData:()=>{l(!0)}})]})]},t)}function ne(t,n,i){const a=o.setState;a({mediaWin:{url:t,img:n=="img",status:!0,index:i}})}function se(){const t=o(s=>s.imgList),n=o(s=>s.pageNum),i=o(s=>s.nowPath),a=`${window.location.origin}/file/Pictures/`+i+"/";return e.jsx(e.Fragment,{children:t[n-1]?t[n-1].map((s,r)=>e.jsx(D,{url:a,name:s,type:"img",index:r},a+s)):null})}function ie(){const t=o(s=>s.vidList),n=o(s=>s.pageNum),i=o(s=>s.nowPath),a=`${window.location.origin}/file/Pictures/`+i+"/";return e.jsx(e.Fragment,{children:t[n-1]?t[n-1].map((s,r)=>e.jsx(D,{url:a,name:s,type:"vid",index:r},a+s)):null})}function ae(){const[t,n]=x.useState(""),i=o(p=>p.vidList),a=o(p=>p.imgList),s=o(p=>p.pageNum);let c=o(p=>p.imgPage)?a.length:i.length;const l=o.setState,u=p=>{p=Number(p),p>=1&&p<=c&&c!=1?l({pageNum:p}):p==s||v.err(m("page_num")+m("not_correct"))};return e.jsxs("div",{id:"page-bar",children:[e.jsx("button",{className:"btn",id:"last-page",onClick:()=>{u(s==1?c:s-1)}}),e.jsx("span",{id:"page-num",children:s+"/"+(c==0?1:c)}),e.jsxs("div",{id:"jump-page",children:[e.jsx("input",{id:"page-input",value:t,type:"text",placeholder:m("page_num"),onChange:p=>n(p.target.value),onKeyDown:p=>{p.key=="Enter"&&(u(t),n(""))}}),e.jsx("button",{className:"btn",id:"jump-btn",onClick:()=>{u(t),n("")},title:m("jump")})]}),e.jsx("button",{className:"btn",id:"next-page",onClick:()=>{u(s==c?1:s+1)}})]})}function oe(){const t=o(n=>n.imgPage);return e.jsxs(Y,{children:[e.jsx("div",{id:"pic-box",children:t?e.jsx(se,{}):e.jsx(ie,{})}),e.jsx(ae,{})]})}function re(){const t=o(n=>n.nowPath);return e.jsx("button",{id:"home-pic",className:"btn",onClick:()=>{t==""?v.normal(m("main_album")):S("")},title:m("back_main_album")})}function le(){const t=o(i=>i.nowPath),n=o(i=>i.parentPath);return e.jsxs("div",{id:"show-path-box",children:[t==""&&n==""?null:e.jsx("span",{id:"par-text",title:m("back_parent_album"),onClick:()=>{S(n)},children:n==""?m("main_album"):B(n)}),e.jsx("span",{id:"cur-text",children:t==""?m("main_album"):B(t)})]})}function B(t){return t?(t=t.replace(/\/+$/,""),t.split("/").pop()||""):""}function de(){const t=o(n=>n.upload);return e.jsxs("div",{id:"upload-box",children:[e.jsx("div",{id:"progress-box",children:e.jsx("div",{id:"progress-bar",style:{width:t.percent}})}),e.jsx("span",{id:"show-percent",children:t.percent})]})}function ce(){const t=o(n=>n.upload);return e.jsx("div",{id:"top-bar-box",children:t.status?e.jsx(de,{}):e.jsx(le,{})})}function ue(){const[t,n]=x.useState(!1),i=o(r=>r.dirList),a=o(r=>r.nowPath),s=()=>{n(!t)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"dir-list",className:"btn",title:m("view_album"),onClick:()=>s(),children:e.jsx("div",{id:"dir-list-box",style:{display:t?"flex":"none"},children:i.map((r,c)=>e.jsx("div",{id:"dir-item",title:m("view")+r,onClick:()=>{S(a+"/"+r)},children:r},r+c))})}),t?e.jsx("div",{id:"close-list-win",onClick:()=>s()}):null]})}function pe(){return e.jsxs(q,{children:[e.jsx(re,{}),e.jsx(ce,{}),e.jsx(ue,{})]})}function me(){const t=o.setState,n=o(s=>s.pageNum),i=o(s=>s.imgPage),a=s=>{switch(s){case"img":t({imgPage:!0,pageNum:i?n:1});break;case"vid":t({imgPage:!1,pageNum:i?1:n});break}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn side-btn "+(i?"media-selected":""),id:"img-btn",title:m("image"),onClick:()=>{a("img")}}),e.jsx("button",{className:"btn side-btn "+(i?"":"media-selected"),id:"vid-btn",title:m("video"),onClick:()=>{a("vid")}})]})}function ge(){const t=o.setState;o(a=>a.pageNum),o(a=>a.imgPage);const n=o(a=>a.upload);o(a=>a.dragWin),o(a=>a.nowPath);const i=async a=>{t({upload:{...n,status:!0}});const s=Array.from(a.target.files);let r={totalSize:0,sendSize:0};s.forEach((l,u)=>{r.totalSize+=l.size}),await G()&&(s.forEach((l,u)=>{z(l,r)}),a.target.value=null)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:a=>i(a)}),e.jsx("label",{className:"btn side-btn",id:"upload",title:m("upload_media"),htmlFor:"upFile"})]})}function fe(){const t=o(n=>n.nowPath);return e.jsx(e.Fragment,{children:e.jsx("button",{className:"btn side-btn",id:"load",title:m("refresh"),onClick:()=>{S(t)}})})}function xe(){return e.jsxs(O,{children:[e.jsx(ge,{}),e.jsx(me,{}),e.jsx(fe,{})]})}function he(){const t=o(i=>i.showBg),n=o(i=>i.loading);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),e.jsx(R,{showBg:t})]})}function be(){const t=o(i=>i.dragWin),n=o(i=>i.upload);return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"drag-win",style:t?{display:"flex"}:{display:"none"},children:e.jsx("div",{})}),n.status&&e.jsx("div",{id:"uploading",className:"bg-enable"})]})}function je(){const t=o.setState,n=o(d=>d.mediaWin),i=o(d=>d.pageNum);let a;n.img?a=o(d=>d.imgList)[i-1]:a=o(d=>d.vidList)[i-1];const[s,r]=x.useState(1),c=x.useRef(null),[l,u]=x.useState(!1),[p,f]=x.useState({x:0,y:0}),[j,b]=x.useState({x:0,y:0}),L=d=>{let g;switch(d){case"in":g=s+.3;break;case"out":if(s-.3<0)return;g=s-.3;break}r(Number(g.toFixed(2)))},P=d=>{f({x:0,y:0}),r(1);let g=n.index;const w=a.length;switch(d){case"min":g--,g=g<0?w-1:g;break;case"add":g++,g=g>w-1?0:g;break}t({mediaWin:{...n,index:g}})};x.useEffect(()=>{const d=w=>{if(!l)return;const N=w.clientX-j.x,y=w.clientY-j.y;f(h=>({x:h.x+N,y:h.y+y})),b({x:w.clientX,y:w.clientY})},g=()=>{u(!1)};return window.addEventListener("mousemove",d),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",g)}},[l,j]);const k=d=>{d.preventDefault(),d.stopPropagation(),u(!0),b({x:d.clientX,y:d.clientY})};return x.useEffect(()=>{n.status&&(f({x:0,y:0}),r(1))},[n.status]),n.status?e.jsxs("div",{className:"bg-enable",onClick:()=>t({mediaWin:{status:!1}}),children:[e.jsx("button",{className:"btn media-btn media-widget",id:"close-media"}),e.jsx("button",{className:"btn media-btn media-widget",id:"last-pic",onClick:d=>{d.stopPropagation(),P("min")}}),e.jsx("button",{className:"btn media-btn media-widget",id:"next-pic",onClick:d=>{d.stopPropagation(),P("add")}}),e.jsx("div",{id:"media-box",ref:c,onMouseDown:k,style:{cursor:l?"grabbing":"grab",transform:`translate(${p.x}px, ${p.y}px) scale(${s})`,transition:l?"none":"transform 0.15s ease-out"},onClick:d=>d.stopPropagation(),children:n.img?e.jsx("img",{loading:"lazy",src:n.url+a[n.index]}):e.jsx("video",{src:n.url+a[n.index],controls:!0,autoPlay:!0,loop:!0})}),e.jsxs("div",{id:"zoom-bar",className:"media-widget",children:[e.jsx("button",{className:"btn zoom-btn",style:{marginRight:"20px"},title:m("zoom_out"),onClick:d=>{d.stopPropagation(),L("out")},children:e.jsx("div",{id:"zoom-out"})}),e.jsx("button",{className:"btn zoom-btn",style:{marginLeft:"20px"},title:m("zoom_in"),onClick:d=>{d.stopPropagation(),L("in")},children:e.jsx("div",{id:"zoom-in"})})]})]}):null}function we(){return e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx(be,{}),e.jsx(je,{})]})}function ve(){const t=o(n=>n.theme);return x.useEffect(()=>(window.addEventListener("dragover",E),window.addEventListener("dragleave",_),window.addEventListener("drop",W),window.addEventListener("paste",F),()=>{window.removeEventListener("dragover",E),window.removeEventListener("dragleave",_),window.removeEventListener("drop",W),window.removeEventListener("paste",F)}),[]),e.jsxs("div",{id:"app",mode:t.mode,color:t.color.pic,children:[e.jsx("div",{className:"wallpaper"}),e.jsxs(K,{children:[e.jsx(J,{}),e.jsx(pe,{}),e.jsx(Q,{}),e.jsx(Z,{})]}),e.jsx(we,{}),e.jsx(xe,{}),e.jsx(oe,{}),e.jsx($,{})]})}async function F(t){if(!t)return;const n=t.clipboardData.items[0];if(n.type.startsWith("image/")&&await H.normal(m("are_you_sure"))){const i=n.getAsFile(),a={totalSize:i.size,sendSize:0};z(i,a)}}ee();V.createRoot(document.getElementById("root")).render(e.jsx(ve,{}));
