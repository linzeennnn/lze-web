import{c as T,A,n as v,f as u,p as I,q as U,e as R,r as f,j as t,k as C,W as $,P as H,m as V,o as X}from"./all-DInseniR.js";import{P as q,C as Y,T as O,S as K,a as J,H as Q,G as Z,b as ee}from"./page-DpHUloXd.js";const o=T((e,n)=>({nowPath:"",parentPath:"",imgList:[],vidList:[],dirList:[],uploading:!1,showBg:!1,pageNum:1,theme:{mode:"",color:{pic:""},userSelect:""},loading:!1,dragWin:!1,imgPage:!0,mediaWin:{status:!1,img:!0,path:window.location.origin+"/file/Pictures/",index:0},upload:{status:!1,percent:"0%"},setGlobal:s=>{e(i=>({...i,...s}))},replaceGlobal:s=>{e(()=>({...s}))},getGlobal:()=>n()}));function te(){q(o.setState,"pic"),k("")}function k(e,n){A.post({api:"pic/list",body:{folder:e},success:s=>{let i=[],a=[],r=[],c=[],l=[];s.filelist.forEach(p=>{p[1]=="dir"||p[1]=="dir_link"?i.push(p[0]):(p[1]=="file"||p[1]=="file_link")&&(p[2]=="img"&&(c.length<12||(a.push(c),c=[]),c.push(p[0])),p[2]=="vid"&&(l.length<12||(r.push(l),l=[]),l.push(p[0])))}),c.length>0&&a.push(c),l.length>0&&r.push(l),o.setState({dirList:i,imgList:a,vidList:r,nowPath:s.currentFolder,parentPath:s.parentFolder,selected:[],imgPage:!n,pageNum:1})}})}function E(e,n){if(e.size==0){v.err(e.name+u("is_empty"));return}let s;const i=o.getState(),a=I(),r=i.nowPath,c=i.upload,l=o.setState,p=["jpg","jpeg","png","gif","webp","bmp","svg","ico","apng","avif"],m=["mp4","webm","ogg","ogv","mov","m4v","avi","3gp","mkv"],x=e.name.split(".").pop().toLowerCase();if(p.includes(x))s=!1,l({imgPage:!0});else if(m.includes(x))s=!0,l({imgPage:!1});else{v.err(e.name+":"+u("not_support_type")),l({upload:{...c,status:!1}});return}const j=U()+"pic/upload",b=ne(e.size),S=Math.ceil(e.size/b);let P=0;function L(){if(n.sendSize>=n.totalSize){l({upload:{...c,status:!1}}),v.normal(u("op_com")),k(r,s);return}if(P>=e.size)return;let d="",g=0;const w=e.slice(P,P+b),N=Math.floor(P/b),y=new FormData;y.append("file",w),y.append("fileName",e.name),y.append("totalChunks",S),y.append("currentChunk",N),y.append("nowpath",r);const h=new XMLHttpRequest;h.open("POST",j,!0),h.setRequestHeader("authorization","Bearer "+a),h.upload.onprogress=function(z){z.lengthComputable&&(n.sendSize=n.sendSize+Math.min(z.loaded,e.size)-g,g=z.loaded,d=Math.floor(n.sendSize/n.totalSize*100)+"%",l({upload:{...c,percent:d}}))},h.onload=function(){if(h.status!==200){h.status===401?v.err(u("no_per")):v.err(u("error")+":"+h.status+h.responseText),l({upload:{...c,status:!1}});return}P+=b,L()},h.onerror=function(){console.error(`Chunk ${N+1} upload encountered error.`),l({upload:!1})},h.send(y)}L()}function ne(e){return e<=1024*1048576?10*1048576:e<=5120*1048576&&e>1024*1048576?50*1048576:100*1048576}function _(e){o.setState({dragWin:!0}),e.stopPropagation(),e.preventDefault()}function W(e){o.setState({dragWin:!1}),e.stopPropagation(),e.preventDefault()}function B(e){const s=o.getState().upload,i=o.setState;i({dragWin:!1}),e.stopPropagation(),e.preventDefault();const a=e.dataTransfer.items,r=[];let c=0,l=0;function p(x){const j=x.webkitGetAsEntry();if(j){if(j.isDirectory){v.err(u("not_support_type"));return}j.isFile&&(l++,j.file(b=>{r.push(b),c+=b.size,l--,m()}))}}async function m(){if(l===0){if(r.length===0){v.err(u("empty"));return}i({upload:{...s,status:!0,win:!1}});const x={totalSize:c,sendSize:0};if(!await D())return;r.forEach(b=>{E(b,x)})}}for(let x=0;x<a.length;x++)p(a[x])}async function D(){const e=o.getState().upload;return await R.post({api:"login/upload",body:{appType:"pic",fileType:""}})==null?(o.setState({upload:{...e,status:!1}}),!1):!0}function M({url:e,name:n,type:s,index:i}){const[a,r]=f.useState(!0),[c,l]=f.useState(!1);return f.useEffect(()=>{r(!0),l(!1)},[e]),f.useEffect(()=>{let p;return c&&(p=setTimeout(()=>{r(!1)},100)),()=>clearTimeout(p)},[c]),t.jsxs("div",{className:"pic-item main-item",title:n,onClick:()=>{se(e,s,i)},children:[a&&t.jsx("div",{className:"media-loading loading"}),s==="img"?t.jsx("img",{src:e+n,loading:"lazy",onLoad:()=>{l(!0)}}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"play-icon btn"}),t.jsx("video",{src:e+n,onLoadedData:()=>{l(!0)}})]})]},e)}function se(e,n,s){const i=o.setState;i({mediaWin:{url:e,img:n=="img",status:!0,index:s}})}function ie(){const e=o(a=>a.imgList),n=o(a=>a.pageNum),s=o(a=>a.nowPath),i=`${window.location.origin}/file/Pictures/`+s+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((a,r)=>t.jsx(M,{url:i,name:a,type:"img",index:r},i+a)):null})}function ae(){const e=o(a=>a.vidList),n=o(a=>a.pageNum),s=o(a=>a.nowPath),i=`${window.location.origin}/file/Pictures/`+s+"/";return t.jsx(t.Fragment,{children:e[n-1]?e[n-1].map((a,r)=>t.jsx(M,{url:i,name:a,type:"vid",index:r},i+a)):null})}function oe(){const[e,n]=f.useState(""),s=o(m=>m.vidList),i=o(m=>m.imgList),a=o(m=>m.pageNum);let c=o(m=>m.imgPage)?i.length:s.length;const l=o.setState,p=m=>{m=Number(m),m>=1&&m<=c&&c!=1?l({pageNum:m}):m==a||v.err(u("page_num")+u("not_correct"))};return t.jsxs("div",{id:"page-bar",children:[t.jsx("button",{className:"btn",id:"last-page",onClick:()=>{p(a==1?c:a-1)}}),t.jsx("span",{id:"page-num",children:a+"/"+(c==0?1:c)}),t.jsxs("div",{id:"jump-page",children:[t.jsx("input",{id:"page-input",value:e,type:"text",placeholder:u("page_num"),onChange:m=>n(m.target.value),onKeyDown:m=>{m.key=="Enter"&&(p(e),n(""))}}),t.jsx("button",{className:"btn",id:"jump-btn",onClick:()=>{p(e),n("")},title:u("jump")})]}),t.jsx("button",{className:"btn",id:"next-page",onClick:()=>{p(a==c?1:a+1)}})]})}function re(){const e=o(n=>n.imgPage);return t.jsxs(Y,{children:[t.jsx("div",{id:"pic-box",children:e?t.jsx(ie,{}):t.jsx(ae,{})}),t.jsx(oe,{})]})}function le(){const e=o(s=>s.nowPath),n=()=>{e===""?v.normal(u("main_album")):k("")};return f.useEffect(()=>{console.log(e),C({home:{name:u("back_main_album"),fun:n,disable:e==""}})},[e]),t.jsx("button",{id:"home-pic",className:"btn",title:u("back_main_album"),onClick:n})}function de(){const e=o(i=>i.nowPath),n=o(i=>i.parentPath),s=()=>{k(o.getState().parentPath)};return f.useEffect(()=>{C({back:{name:u("back_parent_album"),fun:s,disable:e==""}})},[e]),t.jsxs("div",{id:"show-path-box",children:[e==""&&n==""?null:t.jsx("span",{id:"par-text",title:u("back_parent_album"),onClick:s,children:n==""?u("main_album"):F(n)}),t.jsx("span",{id:"cur-text",children:e==""?u("main_album"):F(e)})]})}function F(e){return e?(e=e.replace(/\/+$/,""),e.split("/").pop()||""):""}function ce(){const e=o(n=>n.upload);return t.jsxs("div",{id:"upload-box",children:[t.jsx("div",{id:"progress-box",children:t.jsx("div",{id:"progress-bar",style:{width:e.percent}})}),t.jsx("span",{id:"show-percent",children:e.percent})]})}function ue(){const e=o(n=>n.upload);return t.jsx("div",{id:"top-bar-box",children:e.status?t.jsx(ce,{}):t.jsx(de,{})})}function pe(){const[e,n]=f.useState(!1),s=o(r=>r.dirList),i=o(r=>r.nowPath),a=()=>{n(!e)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"dir-list",className:"btn",title:u("view_album"),onClick:()=>a(),children:t.jsx("div",{id:"dir-list-box",style:{display:e?"flex":"none"},children:s.map((r,c)=>t.jsx("div",{id:"dir-item",title:u("view")+r,onClick:()=>{k(i+"/"+r)},children:r},r+c))})}),e?t.jsx("div",{id:"close-list-win",onClick:()=>a()}):null]})}function me(){return t.jsxs(O,{children:[t.jsx(le,{}),t.jsx(ue,{}),t.jsx(pe,{})]})}function ge(){const e=o.setState,n=o(a=>a.pageNum),s=o(a=>a.imgPage),i=a=>{switch(a){case"img":e({imgPage:!0,pageNum:s?n:1});break;case"vid":e({imgPage:!1,pageNum:s?1:n});break}};return f.useEffect(()=>{C({img:{disable:s,name:u("image"),fun:()=>i("img")},vid:{disable:!s,name:u("video"),fun:()=>i("vid")}})},[s]),t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn side-btn "+(s?"media-selected":""),id:"img-btn",title:u("image"),onClick:()=>i("img")}),t.jsx("button",{className:"btn side-btn "+(s?"":"media-selected"),id:"vid-btn",title:u("video"),onClick:()=>i("vid")})]})}function fe(){const e=o.setState;o(i=>i.pageNum),o(i=>i.imgPage);const n=o(i=>i.upload);o(i=>i.dragWin),o(i=>i.nowPath);const s=async i=>{e({upload:{...n,status:!0}});const a=Array.from(i.target.files);let r={totalSize:0,sendSize:0};a.forEach((l,p)=>{r.totalSize+=l.size}),await D()&&(a.forEach((l,p)=>{E(l,r)}),i.target.value=null)};return t.jsxs(t.Fragment,{children:[t.jsx("input",{id:"upFile",style:{display:"none"},type:"file",multiple:!0,onChange:i=>s(i)}),t.jsx("label",{className:"btn side-btn",id:"upload",title:u("upload_media"),htmlFor:"upFile"})]})}function xe(){const e=o(s=>s.nowPath),n=()=>{k(e)};return f.useEffect(()=>{C({load:{name:u("refresh"),fun:n}})},[e]),t.jsx("button",{className:"btn side-btn",id:"load",title:u("refresh"),onClick:n})}function he(){return t.jsxs(K,{children:[t.jsx(fe,{}),t.jsx(ge,{}),t.jsx(xe,{})]})}function be(){const e=o(s=>s.showBg),n=o(s=>s.loading);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"loading",id:"list-loading",style:n?{display:"block"}:{display:"none"}}),t.jsx($,{showBg:e})]})}function je(){const e=o(s=>s.dragWin),n=o(s=>s.upload);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:"drag-win",style:e?{display:"flex"}:{display:"none"},children:t.jsx("div",{})}),n.status&&t.jsx("div",{id:"uploading",className:"bg-enable"})]})}function we(){const e=o.setState,n=o(d=>d.mediaWin),s=o(d=>d.pageNum);let i;n.img?i=o(d=>d.imgList)[s-1]:i=o(d=>d.vidList)[s-1];const[a,r]=f.useState(1),c=f.useRef(null),[l,p]=f.useState(!1),[m,x]=f.useState({x:0,y:0}),[j,b]=f.useState({x:0,y:0}),S=d=>{let g;switch(d){case"in":g=a+.3;break;case"out":if(a-.3<0)return;g=a-.3;break}r(Number(g.toFixed(2)))},P=d=>{x({x:0,y:0}),r(1);let g=n.index;const w=i.length;switch(d){case"min":g--,g=g<0?w-1:g;break;case"add":g++,g=g>w-1?0:g;break}e({mediaWin:{...n,index:g}})};f.useEffect(()=>{const d=w=>{if(!l)return;const N=w.clientX-j.x,y=w.clientY-j.y;x(h=>({x:h.x+N,y:h.y+y})),b({x:w.clientX,y:w.clientY})},g=()=>{p(!1)};return window.addEventListener("mousemove",d),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",g)}},[l,j]);const L=d=>{d.preventDefault(),d.stopPropagation(),p(!0),b({x:d.clientX,y:d.clientY})};return f.useEffect(()=>{n.status&&(x({x:0,y:0}),r(1))},[n.status]),n.status?t.jsxs("div",{className:"bg-enable",onClick:()=>e({mediaWin:{status:!1}}),children:[t.jsx("button",{className:"btn media-btn media-widget",id:"close-media"}),t.jsx("button",{className:"btn media-btn media-widget",id:"last-pic",onClick:d=>{d.stopPropagation(),P("min")}}),t.jsx("button",{className:"btn media-btn media-widget",id:"next-pic",onClick:d=>{d.stopPropagation(),P("add")}}),t.jsx("div",{id:"media-box",ref:c,onMouseDown:L,style:{cursor:l?"grabbing":"grab",transform:`translate(${m.x}px, ${m.y}px) scale(${a})`,transition:l?"none":"transform 0.15s ease-out"},onClick:d=>d.stopPropagation(),children:n.img?t.jsx("img",{loading:"lazy",src:n.url+i[n.index]}):t.jsx("video",{src:n.url+i[n.index],controls:!0,autoPlay:!0,loop:!0})}),t.jsxs("div",{id:"zoom-bar",className:"media-widget",children:[t.jsx("button",{className:"btn zoom-btn",style:{marginRight:"20px"},title:u("zoom_out"),onClick:d=>{d.stopPropagation(),S("out")},children:t.jsx("div",{id:"zoom-out"})}),t.jsx("button",{className:"btn zoom-btn",style:{marginLeft:"20px"},title:u("zoom_in"),onClick:d=>{d.stopPropagation(),S("in")},children:t.jsx("div",{id:"zoom-in"})})]})]}):null}function ve(){return t.jsxs(t.Fragment,{children:[t.jsx(be,{}),t.jsx(je,{}),t.jsx(we,{})]})}function Pe(){const e=o(n=>n.theme);return f.useEffect(()=>(window.addEventListener("dragover",_),window.addEventListener("dragleave",W),window.addEventListener("drop",B),window.addEventListener("paste",G),()=>{window.removeEventListener("dragover",_),window.removeEventListener("dragleave",W),window.removeEventListener("drop",B),window.removeEventListener("paste",G)}),[]),t.jsxs("div",{id:"app",mode:e.mode,color:e.color.pic,children:[t.jsx("div",{className:"wallpaper"}),t.jsxs(J,{children:[t.jsx(Q,{}),t.jsx(me,{}),t.jsx(Z,{}),t.jsx(ee,{})]}),t.jsx(ve,{}),t.jsx(he,{}),t.jsx(re,{}),t.jsx(H,{})]})}async function G(e){if(!e)return;const n=e.clipboardData.items[0];if(n.type.startsWith("image/")&&await V.normal(u("are_you_sure"))){const s=n.getAsFile(),i={totalSize:s.size,sendSize:0};E(s,i)}}te();X.createRoot(document.getElementById("root")).render(t.jsx(Pe,{}));
